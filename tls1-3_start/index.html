<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=theme-color content="#FFFFFF"><meta http-equiv=x-ua-compatible content="IE=edge"><title>本站开始支持 TLS 1.3 | prometheus</title><meta name=description content="Explore in every moment of the hard thinking"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="本站开始支持 TLS 1.3"><meta property="og:description" content="笔者最近在研究 TLS 1.3 协议，所以想要实践一下，博客必须先部署 TLS 1.3 。另外它的 0-RTT 对博客速度的也是一种提升。需要注意目前 Chrome 68 和 Firefox 支持的是 TLS 1.3 draft 28，暂时不要用在生产环境。
关于 TLS 1.3 的更多细节，会在之后的文章里面分析。
一. 安装依赖 先来看看依赖项的一些情况。
Nginx 1.13.0 开始 正式支持 ssl_protocols 的 TLSv1.3 的选项. 在此之前 TLSv1.2 选项会自动使用 TLSv1.3.
OpenSSL 目前有 draft-18 分支, pre2 版本的 draft-23 以及 pre7+ 的 draft-28 通过 tls1.h (include/openssl/tls1.h 第35行) 可以查看目前的 Draft。
从 Chrome 65 开始会默认开启并使用 TLSv1.3 Draft 23, 从 Chrome 68 开始支持 Draft 28 (Firefox Nightly 应该也支持)."><meta property="og:type" content="article"><meta property="og:url" content="https://new.halfrost.com/tls1-3_start/"><meta property="article:published_time" content="2018-07-14T15:32:00+00:00"><meta property="article:modified_time" content="2018-07-14T15:32:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="本站开始支持 TLS 1.3"><meta name=twitter:description content="笔者最近在研究 TLS 1.3 协议，所以想要实践一下，博客必须先部署 TLS 1.3 。另外它的 0-RTT 对博客速度的也是一种提升。需要注意目前 Chrome 68 和 Firefox 支持的是 TLS 1.3 draft 28，暂时不要用在生产环境。
关于 TLS 1.3 的更多细节，会在之后的文章里面分析。
一. 安装依赖 先来看看依赖项的一些情况。
Nginx 1.13.0 开始 正式支持 ssl_protocols 的 TLSv1.3 的选项. 在此之前 TLSv1.2 选项会自动使用 TLSv1.3.
OpenSSL 目前有 draft-18 分支, pre2 版本的 draft-23 以及 pre7+ 的 draft-28 通过 tls1.h (include/openssl/tls1.h 第35行) 可以查看目前的 Draft。
从 Chrome 65 开始会默认开启并使用 TLSv1.3 Draft 23, 从 Chrome 68 开始支持 Draft 28 (Firefox Nightly 应该也支持)."><link rel=stylesheet href=/css/style-white.min.css><link rel=manifest href=/manifest.json><link rel=stylesheet href=/prism.css><link href=/images/apple-touch-icon-60x60.png rel=apple-touch-icon sizes=60x60><link href=/images/apple-touch-icon-76x76.png rel=apple-touch-icon sizes=76x76><link href=/images/apple-touch-icon-120x120.png rel=apple-touch-icon sizes=120x120><link href=/images/apple-touch-icon-152x152.png rel=apple-touch-icon sizes=152x152><link href=/images/apple-touch-icon-180x180.png rel=apple-touch-icon sizes=180x180><link href=/images/apple-touch-icon-512x512.png rel=apple-touch-icon sizes=512x512><link href=/images/apple-touch-icon-1024x1024.png rel=apple-touch-icon sizes=1024x1024><script async>if('serviceWorker'in navigator){navigator.serviceWorker.register("\/serviceworker-v1.min.a64912b78d282eab1ad3715a0943da21616e5f326f8afea27034784ad445043b.js").then(function(){if(navigator.serviceWorker.controller){console.log('Assets cached by the controlling service worker.');}else{console.log('Please reload this page to allow the service worker to handle network operations.');}}).catch(function(error){console.log('ERROR: '+error);});}else{console.log('Service workers are not supported in the current browser.');}</script><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://new.halfrost.com/images/favicon.ico><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-82753806-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="single-max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a><a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a><a id=top-icon-tablet href=# onclick="$('html, body').animate({scrollTop:0},'fast');" style=display:none><i class="fas fa-chevron-up fa-lg"></i></a><span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=https://books.halfrost.com/>Books</a></li><li><a href=https://github.com/halfrost/Halfrost-Field>Github</a></li><li><a href=https://halfrost.me/>About</a></li><li><a href=/index.xml>RSS</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://new.halfrost.com/ghost_fast/><i class="fas fa-chevron-left" aria-hidden=true onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li><li><a class=icon href=https://new.halfrost.com/quic_start/><i class="fas fa-chevron-right" aria-hidden=true onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li><li><a class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast');"><i class="fas fa-chevron-up" aria-hidden=true onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li><li><a class=icon href=#><i class="fas fa-share-alt" aria-hidden=true onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fnew.halfrost.com%2ftls1-3_start%2f"><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fnew.halfrost.com%2ftls1-3_start%2f&text=%e6%9c%ac%e7%ab%99%e5%bc%80%e5%a7%8b%e6%94%af%e6%8c%81%20TLS%201.3"><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fnew.halfrost.com%2ftls1-3_start%2f&title=%e6%9c%ac%e7%ab%99%e5%bc%80%e5%a7%8b%e6%94%af%e6%8c%81%20TLS%201.3"><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fnew.halfrost.com%2ftls1-3_start%2f&is_video=false&description=%e6%9c%ac%e7%ab%99%e5%bc%80%e5%a7%8b%e6%94%af%e6%8c%81%20TLS%201.3"><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=%e6%9c%ac%e7%ab%99%e5%bc%80%e5%a7%8b%e6%94%af%e6%8c%81%20TLS%201.3&body=Check out this article: https%3a%2f%2fnew.halfrost.com%2ftls1-3_start%2f"><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fnew.halfrost.com%2ftls1-3_start%2f&title=%e6%9c%ac%e7%ab%99%e5%bc%80%e5%a7%8b%e6%94%af%e6%8c%81%20TLS%201.3"><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fnew.halfrost.com%2ftls1-3_start%2f&title=%e6%9c%ac%e7%ab%99%e5%bc%80%e5%a7%8b%e6%94%af%e6%8c%81%20TLS%201.3"><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fnew.halfrost.com%2ftls1-3_start%2f&title=%e6%9c%ac%e7%ab%99%e5%bc%80%e5%a7%8b%e6%94%af%e6%8c%81%20TLS%201.3"><i class="fab fa-stumbleupon" aria-hidden=true></i></a></li><li><a class=icon href="http://digg.com/submit?url=https%3a%2f%2fnew.halfrost.com%2ftls1-3_start%2f&title=%e6%9c%ac%e7%ab%99%e5%bc%80%e5%a7%8b%e6%94%af%e6%8c%81%20TLS%201.3"><i class="fab fa-digg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fnew.halfrost.com%2ftls1-3_start%2f&name=%e6%9c%ac%e7%ab%99%e5%bc%80%e5%a7%8b%e6%94%af%e6%8c%81%20TLS%201.3&description=%e7%ac%94%e8%80%85%e6%9c%80%e8%bf%91%e5%9c%a8%e7%a0%94%e7%a9%b6%20TLS%201.3%20%e5%8d%8f%e8%ae%ae%ef%bc%8c%e6%89%80%e4%bb%a5%e6%83%b3%e8%a6%81%e5%ae%9e%e8%b7%b5%e4%b8%80%e4%b8%8b%ef%bc%8c%e5%8d%9a%e5%ae%a2%e5%bf%85%e9%a1%bb%e5%85%88%e9%83%a8%e7%bd%b2%20TLS%201.3%20%e3%80%82%e5%8f%a6%e5%a4%96%e5%ae%83%e7%9a%84%200-RTT%20%e5%af%b9%e5%8d%9a%e5%ae%a2%e9%80%9f%e5%ba%a6%e7%9a%84%e4%b9%9f%e6%98%af%e4%b8%80%e7%a7%8d%e6%8f%90%e5%8d%87%e3%80%82%e9%9c%80%e8%a6%81%e6%b3%a8%e6%84%8f%e7%9b%ae%e5%89%8d%20Chrome%2068%20%e5%92%8c%20Firefox%20%e6%94%af%e6%8c%81%e7%9a%84%e6%98%af%20TLS%201.3%20draft%2028%ef%bc%8c%e6%9a%82%e6%97%b6%e4%b8%8d%e8%a6%81%e7%94%a8%e5%9c%a8%e7%94%9f%e4%ba%a7%e7%8e%af%e5%a2%83%e3%80%82%0a%e5%85%b3%e4%ba%8e%20TLS%201.3%20%e7%9a%84%e6%9b%b4%e5%a4%9a%e7%bb%86%e8%8a%82%ef%bc%8c%e4%bc%9a%e5%9c%a8%e4%b9%8b%e5%90%8e%e7%9a%84%e6%96%87%e7%ab%a0%e9%87%8c%e9%9d%a2%e5%88%86%e6%9e%90%e3%80%82%0a%e4%b8%80.%20%e5%ae%89%e8%a3%85%e4%be%9d%e8%b5%96%20%e5%85%88%e6%9d%a5%e7%9c%8b%e7%9c%8b%e4%be%9d%e8%b5%96%e9%a1%b9%e7%9a%84%e4%b8%80%e4%ba%9b%e6%83%85%e5%86%b5%e3%80%82%0aNginx%201.13.0%20%e5%bc%80%e5%a7%8b%20%e6%ad%a3%e5%bc%8f%e6%94%af%e6%8c%81%20ssl_protocols%20%e7%9a%84%20TLSv1.3%20%e7%9a%84%e9%80%89%e9%a1%b9.%20%e5%9c%a8%e6%ad%a4%e4%b9%8b%e5%89%8d%20TLSv1.2%20%e9%80%89%e9%a1%b9%e4%bc%9a%e8%87%aa%e5%8a%a8%e4%bd%bf%e7%94%a8%20TLSv1.3.%0aOpenSSL%20%e7%9b%ae%e5%89%8d%e6%9c%89%20draft-18%20%e5%88%86%e6%94%af%2c%20pre2%20%e7%89%88%e6%9c%ac%e7%9a%84%20draft-23%20%e4%bb%a5%e5%8f%8a%20pre7%2b%20%e7%9a%84%20draft-28%20%e9%80%9a%e8%bf%87%20tls1.h%20%28include%2fopenssl%2ftls1.h%20%e7%ac%ac35%e8%a1%8c%29%20%e5%8f%af%e4%bb%a5%e6%9f%a5%e7%9c%8b%e7%9b%ae%e5%89%8d%e7%9a%84%20Draft%e3%80%82%0a%e4%bb%8e%20Chrome%2065%20%e5%bc%80%e5%a7%8b%e4%bc%9a%e9%bb%98%e8%ae%a4%e5%bc%80%e5%90%af%e5%b9%b6%e4%bd%bf%e7%94%a8%20TLSv1.3%20Draft%2023%2c%20%e4%bb%8e%20Chrome%2068%20%e5%bc%80%e5%a7%8b%e6%94%af%e6%8c%81%20Draft%2028%20%28Firefox%20Nightly%20%e5%ba%94%e8%af%a5%e4%b9%9f%e6%94%af%e6%8c%81%29."><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fnew.halfrost.com%2ftls1-3_start%2f&t=%e6%9c%ac%e7%ab%99%e5%bc%80%e5%a7%8b%e6%94%af%e6%8c%81%20TLS%201.3"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div><div id=toc><nav id=TableOfContents><ul><li><a href=#一-安装依赖>一. 安装依赖</a><ul><li><a href=#nginx-1153>Nginx 1.15.3</a></li><li><a href=#openssl-111-pre9>OpenSSL 1.1.1-pre9</a></li><li><a href=#ngx_brotli>ngx_brotli</a></li><li><a href=#jemalloc>jemalloc</a></li><li><a href=#zlib-cloudflare>zlib (Cloudflare)</a></li><li><a href=#libatomic_ops>libatomic_ops</a></li><li><a href=#pcre>pcre</a></li></ul></li><li><a href=#二-编译-nginx>二. 编译 Nginx</a></li><li><a href=#三-更换-nginx>三. 更换 Nginx</a></li><li><a href=#四配置-nginx>四.配置 Nginx</a></li><li><a href=#五部署-nginx>五.部署 Nginx</a></li><li><a href=#六验证-tls-13>六.验证 TLS 1.3</a><ul><li><a href=#chrome-验证>chrome 验证</a></li><li><a href=#wireshark-抓包验证>wireshark 抓包验证</a></li><li><a href=#ssllabs-检测报告>SSLlabs 检测报告</a></li><li><a href=#myssl-检测报告>MySSL 检测报告</a></li><li><a href=#使用-testssl-工具>使用 testssl 工具</a></li><li><a href=#开启-tls-13-0-rtt>开启 TLS 1.3 0-RTT</a></li></ul></li></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">本站开始支持 TLS 1.3</h1><div class=meta><div class=postdate><time datetime="2018-07-14 15:32:00 +0000 UTC" itemprop=datePublished>Jul 14</time></div></div></header><div class=content itemprop=articleBody><p>笔者最近在研究 TLS 1.3 协议，所以想要实践一下，博客必须先部署 TLS 1.3 。另外它的 0-RTT 对博客速度的也是一种提升。需要注意目前 Chrome 68 和 Firefox 支持的是 TLS 1.3 draft 28，暂时不要用在生产环境。</p><p>关于 TLS 1.3 的更多细节，会在之后的文章里面分析。</p><h2 id=一-安装依赖>一. 安装依赖</h2><p>先来看看依赖项的一些情况。</p><p>Nginx 1.13.0 开始 正式支持 ssl_protocols 的 TLSv1.3 的选项. 在此之前 TLSv1.2 选项会自动使用 TLSv1.3.</p><p>OpenSSL 目前有 draft-18 分支, pre2 版本的 draft-23 以及 pre7+ 的 draft-28 通过 tls1.h (include/openssl/tls1.h 第35行) 可以查看目前的 Draft。</p><p>从 Chrome 65 开始会默认开启并使用 TLSv1.3 Draft 23, 从 Chrome 68 开始支持 Draft 28 (Firefox Nightly 应该也支持).</p><p>我的 ECS 系统是 centOS 7.0，如果你使用其它发行版，与包管理有关的命令请自行调整。</p><p>目前 nginx 最新是 Nginx 1.15.3，OpenSSL 最新是 1.1.1-pre9，笔者这次都安装最新版。</p><p>首先安装依赖库和编译要用到的工具：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo yum groupinstall -y <span style=color:#e6db74>&#34;Development Tools&#34;</span>
$ sudo yum install -y git wget zlib zlib-devel pcre-devel google-perftools google-perftools-devel lua-devel GeoIP-devel
$ sudo yum install -y git gcc gcc-c clang automake make autoconf libtool zlib-devel libatomic_ops-devel pcre-devel openssl-devel libxml2-devel libxslt-devel gd-devel GeoIP-devel gperftools-devel  perl-devel perl-ExtUtils-Embed
</code></pre></div><h3 id=nginx-1153>Nginx 1.15.3</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>#下载 Nginx 1.15.3</span>
$ wget https://nginx.org/download/nginx-1.15.3.tar.gz
$ tar zxf nginx-1.15.3.tar.gz
</code></pre></div><p>安装原版的 Nginx 1.15.3，少了一些好用的功能，还好有 patch，笔者在这里打了 5 个 patch，也推荐大家使用。</p><ul><li>恢复对 SPDY 协议的支持</li><li>支持 HTTP/2 HPACK 加密</li><li>支持 Dynamic TLS Record (这个强烈推荐)</li><li>支持 SSL_OP_PRIORITIZE_CHACHA (这个强烈推荐)</li><li>Fix Http2 Push Error 补丁 (推荐)</li></ul><p>这些补丁不一定适用于最新的 Nginx 已测试通过的版本请查看<a href=https://github.com/kn007/patch>https://github.com/kn007/patch</a></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># 打 SPDY, HTTP2 HPACK, Dynamic TLS Record, PRIORITIZE_CHACHA, Fix Http2 Push Error 补丁</span>

$ cd nginx-1.15.3
$ wget https://raw.githubusercontent.com/kn007/patch/45f1417c450fc82cd470cb73a32e23085c4ba3d5/nginx.patch
$ wget https://raw.githubusercontent.com/kn007/patch/c59592bc1269ba666b3bb471243c5212b50fd608/nginx_auto_using_PRIORITIZE_CHACHA.patch
$ patch -p1 &lt; nginx.patch
$ patch -p1 &lt; nginx_auto_using_PRIORITIZE_CHACHA.patch
$ cd ..
</code></pre></div><p><strong>更新：</strong></p><p>支持 TLS 1.3 0-RTT 的 Nginx 最好使用 1.15.4+，笔者这里直接更新到最新版本 1.15.8</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>#下载 Nginx 1.15.8</span>
$ wget https://nginx.org/download/nginx-1.15.8.tar.gz
$ tar zxf nginx-1.15.8.tar.gz
</code></pre></div><p>Nginx 1.15.8 对应的补丁有变化：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># SPDY, HTTP2 HPACK, Dynamic TLS Record, Fix Http2 Push Error Patch</span>
<span style=color:#75715e># 此补丁不一定适用于最新的 Nginx 已测试通过的版本请查看 https://github.com/kn007/patch</span>
$ cd nginx-1.15.8
$ curl https://raw.githubusercontent.com/kn007/patch/d6bd9f7e345a0afc88e050a4dd991a57b7fb39be/nginx.patch | patch -p1
$ cd ..
</code></pre></div><p>下面这个是 Strict-SNI Patch 的补丁，可选安装，笔者没有安装:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># Strict-SNI Patch</span>
<span style=color:#75715e># Strict SNI requires at least two ssl server (fake) settings (server { listen 443 ssl }).</span>
<span style=color:#75715e>#It does not matter what kind of certificate or duplicate.</span>

$ cd nginx-1.15.8
$ curl https://raw.githubusercontent.com/hakasenyang/openssl-patch/master/nginx_strict-sni.patch | patch -p1
$ cd ..
</code></pre></div><h3 id=openssl-111-pre9>OpenSSL 1.1.1-pre9</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># 下载 OpenSSL 1.1.1-pre9</span>
$ wget https://www.openssl.org/source/openssl-1.1.1-pre9.tar.gz
$ tar zxf openssl-1.1.1-pre9.tar.gz
</code></pre></div><p>由于不同版本的 chrome 支持的 TLS 不同，所以我们最好能支持所有主流版本的 TLS 1.3 。这里再打上同时支持 draft 23,26,28 的补丁。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># 打 TLS1.3 Draft 23,26,28 补丁</span>
<span style=color:#75715e># 根据 OpenSSL 版本决定, 具体见 https://github.com/hakasenyang/openssl-patch</span>
$ cd openssl-1.1.1-pre9
$ wget https://raw.githubusercontent.com/hakasenyang/openssl-patch/master/openssl-equal-pre9.patch
$ patch -p1 &lt; openssl-equal-pre9.patch
$ cd ..
</code></pre></div><p><strong>更新：</strong></p><p>支持 TLS 1.3 0-RTT 的 OpenSSL 必须使用 1.1.1+，笔者这里直接更新到最新版本 1.1.1a</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># 安装 OpenSSL 1.1.1a (LTS)</span>
$ wget https://www.openssl.org/source/openssl-1.1.1a.tar.gz
$ tar zxf openssl-1.1.1a.tar.gz
</code></pre></div><p>同样，为了支持 Chrome 不同版本，所以需要支持 TLS 1.3 的几个主要草案版本，Draft 23, 26, 28, Final 这几个版本都需要支持，打补丁！</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># 打 TLS1.3 Draft 23, 26, 28, Final Patch 的补丁</span>
<span style=color:#75715e>#根据 OpenSSL 版本决定, 具体见 https://github.com/hakasenyang/openssl-patch</span>
$ cd openssl-1.1.1a
$ curl https://raw.githubusercontent.com/hakasenyang/openssl-patch/master/openssl-equal-1.1.1a_ciphers.patch | patch -p1
$ cd ..
</code></pre></div><p>为了给 OpenSSL 增加下面 2 个功能：</p><ul><li>使 OpenSSL 能支持 BoringSSL 等效加密算法组的功能。</li><li>在 TLS 1.1 以后的版本中，3DES 不能使用 ECDHE 密钥套件，提高安全性。</li></ul><p>需要打补丁。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># 打 CHACHA20-POLY1305-OLD Patch 补丁</span>
$ cd openssl-1.1.1a
$ curl https://raw.githubusercontent.com/hakasenyang/openssl-patch/master/openssl-1.1.1a-chacha_draft.patch | patch -p1
$ cd ..
</code></pre></div><h3 id=ngx_brotli>ngx_brotli</h3><p>本站支持 Google 开发的 Brotli 压缩格式，它通过内置分析大量网页得出的字典，实现了更高的压缩比率，同时几乎不影响压缩 / 解压速度。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># 安装 ngx_brotli</span>
$ git clone https://github.com/eustas/ngx_brotli.git
pushd ngx_brotli
$ git submodule update --init
$ cd ..
</code></pre></div><h3 id=jemalloc>jemalloc</h3><p>这个插件也是可选安装，笔者没有安装。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ git clone https://github.com/jemalloc/jemalloc.git
$ cd jemalloc
$ ./autogen.sh
$ make -j<span style=color:#66d9ef>$(</span>nproc --all<span style=color:#66d9ef>)</span>
$ touch doc/jemalloc.html
$ touch doc/jemalloc.3
$ sudo make install
$ echo <span style=color:#e6db74>&#39;/usr/local/lib&#39;</span> | sudo tee /etc/ld.so.conf.d/local.conf
$ sudo ldconfig
</code></pre></div><h3 id=zlib-cloudflare>zlib (Cloudflare)</h3><p>zlib 是 Cloudflare 推荐安装的，笔者暂时也没有安装。主要是编译参数有点问题，编译出来报错了。有时间还需要研究一下。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ git clone https://github.com/cloudflare/zlib.git
$ cd zlib
$ ./configure
$ cd ..
</code></pre></div><h3 id=libatomic_ops>libatomic_ops</h3><p>这个插件也是可选安装，笔者没有安装。同样也是因为编译参数的问题。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ git clone https://github.com/ivmai/libatomic_ops.git
$ cd libatomic_ops
$ ./autogen.sh
$ ./configure
$ make -j<span style=color:#66d9ef>$(</span>nproc --all<span style=color:#66d9ef>)</span>
$ make install
$ sudo ldconfig
$ cd ..
</code></pre></div><h3 id=pcre>pcre</h3><p>这个插件也是可选安装，笔者没有安装。同样也是因为编译参数的问题。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ wget https://ftp.pcre.org/pub/pcre/pcre-8.42.zip
$ unzip pcre-8.42.zip<span style=color:#f92672>&amp;&amp;</span>rm pcre-8.42.zip
$ mv pcre-8.42 pcre
$ cd pcre
$ ./configure
$ cd ..
</code></pre></div><h2 id=二-编译-nginx>二. 编译 Nginx</h2><p>使用 <code>--with\-openssl=../openssl\-1.1.1\-pre9</code> 来指定 OpenSSL 路径。</p><p>HTTP2 HPACK 需要加入 <code>--with-http_v2_hpack_enc</code></p><p>SPDY 需要加入 <code>--with-http_spdy_module</code></p><p>TLS 1.3 需要加入 <code>--with-openssl-opt='enable-tls1_3'</code></p><p>所有的编译参数合起来如下：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#960050;background-color:#1e0010>$</span> <span style=color:#66d9ef>auto</span><span style=color:#f92672>/</span>configure <span style=color:#f92672>--</span>prefix<span style=color:#f92672>=/</span>etc<span style=color:#f92672>/</span>nginx <span style=color:#f92672>--</span>sbin<span style=color:#f92672>-</span>path<span style=color:#f92672>=/</span>usr<span style=color:#f92672>/</span>sbin<span style=color:#f92672>/</span>nginx <span style=color:#f92672>--</span>modules<span style=color:#f92672>-</span>path<span style=color:#f92672>=/</span>usr<span style=color:#f92672>/</span>lib64<span style=color:#f92672>/</span>nginx<span style=color:#f92672>/</span>modules <span style=color:#f92672>--</span>conf<span style=color:#f92672>-</span>path<span style=color:#f92672>=/</span>etc<span style=color:#f92672>/</span>nginx<span style=color:#f92672>/</span>nginx.conf <span style=color:#f92672>--</span>error<span style=color:#f92672>-</span>log<span style=color:#f92672>-</span>path<span style=color:#f92672>=/</span>var<span style=color:#f92672>/</span>log<span style=color:#f92672>/</span>nginx<span style=color:#f92672>/</span>error.log <span style=color:#f92672>--</span>http<span style=color:#f92672>-</span>log<span style=color:#f92672>-</span>path<span style=color:#f92672>=/</span>var<span style=color:#f92672>/</span>log<span style=color:#f92672>/</span>nginx<span style=color:#f92672>/</span>access.log <span style=color:#f92672>--</span>pid<span style=color:#f92672>-</span>path<span style=color:#f92672>=/</span>var<span style=color:#f92672>/</span>run<span style=color:#f92672>/</span>nginx.pid <span style=color:#f92672>--</span>lock<span style=color:#f92672>-</span>path<span style=color:#f92672>=/</span>var<span style=color:#f92672>/</span>run<span style=color:#f92672>/</span>nginx.lock <span style=color:#f92672>--</span>http<span style=color:#f92672>-</span>client<span style=color:#f92672>-</span>body<span style=color:#f92672>-</span>temp<span style=color:#f92672>-</span>path<span style=color:#f92672>=/</span>var<span style=color:#f92672>/</span>cache<span style=color:#f92672>/</span>nginx<span style=color:#f92672>/</span>client_temp <span style=color:#f92672>--</span>http<span style=color:#f92672>-</span>proxy<span style=color:#f92672>-</span>temp<span style=color:#f92672>-</span>path<span style=color:#f92672>=/</span>var<span style=color:#f92672>/</span>cache<span style=color:#f92672>/</span>nginx<span style=color:#f92672>/</span>proxy_temp <span style=color:#f92672>--</span>http<span style=color:#f92672>-</span>fastcgi<span style=color:#f92672>-</span>temp<span style=color:#f92672>-</span>path<span style=color:#f92672>=/</span>var<span style=color:#f92672>/</span>cache<span style=color:#f92672>/</span>nginx<span style=color:#f92672>/</span>fastcgi_temp <span style=color:#f92672>--</span>http<span style=color:#f92672>-</span>uwsgi<span style=color:#f92672>-</span>temp<span style=color:#f92672>-</span>path<span style=color:#f92672>=/</span>var<span style=color:#f92672>/</span>cache<span style=color:#f92672>/</span>nginx<span style=color:#f92672>/</span>uwsgi_temp <span style=color:#f92672>--</span>http<span style=color:#f92672>-</span>scgi<span style=color:#f92672>-</span>temp<span style=color:#f92672>-</span>path<span style=color:#f92672>=/</span>var<span style=color:#f92672>/</span>cache<span style=color:#f92672>/</span>nginx<span style=color:#f92672>/</span>scgi_temp <span style=color:#f92672>--</span>user<span style=color:#f92672>=</span>nginx <span style=color:#f92672>--</span>group<span style=color:#f92672>=</span>nginx <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>compat <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>file<span style=color:#f92672>-</span>aio <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>threads <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>http_addition_module <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>http_auth_request_module <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>http_dav_module <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>http_flv_module <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>http_gunzip_module <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>http_gzip_static_module <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>http_mp4_module <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>http_random_index_module <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>openssl<span style=color:#f92672>=/</span>tmp<span style=color:#f92672>/</span>openssl<span style=color:#f92672>-</span>OpenSSL_1_1_1<span style=color:#f92672>-</span>pre9 <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>openssl<span style=color:#f92672>-</span>opt<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>&#39;</span>enable<span style=color:#f92672>-</span>tls1_3<span style=color:#960050;background-color:#1e0010>&#39;</span> <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>http_realip_module <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>http_secure_link_module <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>http_slice_module <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>http_ssl_module <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>http_stub_status_module <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>http_sub_module <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>http_v2_module <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>mail <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>mail_ssl_module <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>stream <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>stream_realip_module <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>stream_ssl_module <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>stream_ssl_preread_module <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>cc<span style=color:#f92672>-</span>opt<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#f92672>-</span>O2 <span style=color:#f92672>-</span>g <span style=color:#f92672>-</span>pipe <span style=color:#f92672>-</span>Wall <span style=color:#f92672>-</span>Wp,<span style=color:#f92672>-</span>D_FORTIFY_SOURCE<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>-</span>fexceptions <span style=color:#f92672>-</span>fstack<span style=color:#f92672>-</span>protector<span style=color:#f92672>-</span>strong <span style=color:#f92672>--</span>param<span style=color:#f92672>=</span>ssp<span style=color:#f92672>-</span>buffer<span style=color:#f92672>-</span>size<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span> <span style=color:#f92672>-</span>grecord<span style=color:#f92672>-</span>gcc<span style=color:#f92672>-</span>switches <span style=color:#f92672>-</span>m64 <span style=color:#f92672>-</span>mtune<span style=color:#f92672>=</span>generic <span style=color:#f92672>-</span>fPIC<span style=color:#960050;background-color:#1e0010>&#39;</span> <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>ld<span style=color:#f92672>-</span>opt<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#f92672>-</span>Wl,<span style=color:#f92672>-</span>z,relro <span style=color:#f92672>-</span>Wl,<span style=color:#f92672>-</span>z,now <span style=color:#f92672>-</span>pie<span style=color:#960050;background-color:#1e0010>&#39;</span> <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>http_spdy_module <span style=color:#f92672>--</span>with<span style=color:#f92672>-</span>http_v2_hpack_enc <span style=color:#f92672>--</span>add<span style=color:#f92672>-</span>module<span style=color:#f92672>=/</span>tmp<span style=color:#f92672>/</span>ngx_brotli
</code></pre></div><p>如果读者安装了上面笔者推荐的所有补丁，那么再往下编译可能会出现问题。需要把编译参数 <code>--with-cc-opt</code> 里面的 <code>-O2</code> 去掉即可。</p><p>笔者的最终编译参数如下，仅供参考：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ auto/configure --prefix<span style=color:#f92672>=</span>/etc/nginx --sbin-path<span style=color:#f92672>=</span>/usr/sbin/nginx --modules-path<span style=color:#f92672>=</span>/usr/lib64/nginx/modules --conf-path<span style=color:#f92672>=</span>/etc/nginx/nginx.conf --error-log-path<span style=color:#f92672>=</span>/var/log/nginx/error.log --http-log-path<span style=color:#f92672>=</span>/var/log/nginx/access.log --pid-path<span style=color:#f92672>=</span>/var/run/nginx.pid --lock-path<span style=color:#f92672>=</span>/var/run/nginx.lock --http-client-body-temp-path<span style=color:#f92672>=</span>/var/cache/nginx/client_temp --http-proxy-temp-path<span style=color:#f92672>=</span>/var/cache/nginx/proxy_temp --http-fastcgi-temp-path<span style=color:#f92672>=</span>/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path<span style=color:#f92672>=</span>/var/cache/nginx/uwsgi_temp --http-scgi-temp-path<span style=color:#f92672>=</span>/var/cache/nginx/scgi_temp --user<span style=color:#f92672>=</span>nginx --group<span style=color:#f92672>=</span>nginx --with-compat --with-file-aio --with-threads --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_mp4_module --with-http_random_index_module --with-openssl<span style=color:#f92672>=</span>/tmp/openssl-OpenSSL_1_1_1-pre9 --with-openssl-opt<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;enable-tls1_3&#39;</span> --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-mail --with-mail_ssl_module --with-stream --with-stream_realip_module --with-stream_ssl_module --with-stream_ssl_preread_module --with-cc-opt<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;-g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -m64 -mtune=generic -fPIC&#39;</span> --with-ld-opt<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;-Wl,-z,relro -Wl,-z,now -pie&#39;</span> --with-http_spdy_module --with-http_v2_hpack_enc --add-module<span style=color:#f92672>=</span>/tmp/ngx_brotli
</code></pre></div><p>修改好编译参数以后就可以开始 make 了：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ make
</code></pre></div><p>如果编译过程中还遇到了 <code>pthread_atfork</code> 的错误：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>threads_pthread.c:<span style=color:#f92672>(</span>.text+0x16<span style=color:#f92672>)</span>: undefined reference to <span style=color:#e6db74>`</span>pthread_atfork<span style=color:#960050;background-color:#1e0010>&#39;</span>
collect2: error: ld returned <span style=color:#ae81ff>1</span> exit status
make<span style=color:#f92672>[</span>1<span style=color:#f92672>]</span>: *** <span style=color:#f92672>[</span>objs/nginx<span style=color:#f92672>]</span> Error <span style=color:#ae81ff>1</span>
</code></pre></div><p>要修改 nginx 目录下的 objs 内的 Makefile:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ vim ./objs/Makefile
</code></pre></div><p>找到下面这一行：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>-Wl,-z,relro -Wl,-z,now -pie -ldl -lpthread -lpthread -lcrypt -lpcre /tmp/openssl-master/.openssl/lib/libssl.a /tmp/openssl-master/.openssl/lib/libcrypto.a -ldl -lz <span style=color:#ae81ff>\
</span></code></pre></div><p>修改为：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>-Wl,-z,relro -Wl,-z,now -pie -ldl -lcrypt -lpcre /tmp/openssl-master/.openssl/lib/libssl.a /tmp/openssl-master/.openssl/lib/libcrypto.a -ldl -lz -lpthread <span style=color:#ae81ff>\
</span></code></pre></div><p>编译完成以后，验证一下：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ nginx -V

nginx version: nginx/1.15.3
built by gcc 4.8.5 <span style=color:#ae81ff>20150623</span> <span style=color:#f92672>(</span>Red Hat 4.8.5-28<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>GCC<span style=color:#f92672>)</span>
built with OpenSSL 1.1.1-pre9 <span style=color:#f92672>(</span>beta<span style=color:#f92672>)</span> <span style=color:#ae81ff>21</span> Aug <span style=color:#ae81ff>2018</span>
TLS SNI support enabled
configure arguments: --prefix<span style=color:#f92672>=</span>/etc/nginx --sbin-path<span style=color:#f92672>=</span>/usr/sbin/nginx --modules-path<span style=color:#f92672>=</span>/usr/lib64/nginx/modules --conf-path<span style=color:#f92672>=</span>/etc/nginx/nginx.conf --error-log-path<span style=color:#f92672>=</span>/var/log/nginx/error.log --http-log-path<span style=color:#f92672>=</span>/var/log/nginx/access.log --pid-path<span style=color:#f92672>=</span>/var/run/nginx.pid --lock-path<span style=color:#f92672>=</span>/var/run/nginx.lock --http-client-body-temp-path<span style=color:#f92672>=</span>/var/cache/nginx/client_temp --http-proxy-temp-path<span style=color:#f92672>=</span>/var/cache/nginx/proxy_temp --http-fastcgi-temp-path<span style=color:#f92672>=</span>/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path<span style=color:#f92672>=</span>/var/cache/nginx/uwsgi_temp --http-scgi-temp-path<span style=color:#f92672>=</span>/var/cache/nginx/scgi_temp --user<span style=color:#f92672>=</span>nginx --group<span style=color:#f92672>=</span>nginx --with-compat --with-file-aio --with-threads --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_mp4_module --with-http_random_index_module --with-openssl<span style=color:#f92672>=</span>/tmp/openssl-OpenSSL_1_1_1-pre9 --with-openssl-opt<span style=color:#f92672>=</span>enable-tls1_3 --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-mail --with-mail_ssl_module --with-stream --with-stream_realip_module --with-stream_ssl_module --with-stream_ssl_preread_module --with-cc-opt<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;-g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -m64 -mtune=generic -fPIC&#39;</span> --with-ld-opt<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;-Wl,-z,relro -Wl,-z,now -pie&#39;</span> --with-http_spdy_module --with-http_v2_hpack_enc --add-module<span style=color:#f92672>=</span>/tmp/ngx_brotli
</code></pre></div><p><strong>更新：</strong></p><p>由于 Nginx 和 OpenSSL 都支持到了 TLS 1.3 0-RTT，所以编译参数也更新了：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ cd nginx-1.15.8
$ ./configure --prefix<span style=color:#f92672>=</span>/etc/nginx --sbin-path<span style=color:#f92672>=</span>/usr/sbin/nginx --modules-path<span style=color:#f92672>=</span>/usr/lib64/nginx/modules --conf-path<span style=color:#f92672>=</span>/etc/nginx/nginx.conf --error-log-path<span style=color:#f92672>=</span>/var/log/nginx/error.log --http-log-path<span style=color:#f92672>=</span>/var/log/nginx/access.log --pid-path<span style=color:#f92672>=</span>/var/run/nginx.pid --lock-path<span style=color:#f92672>=</span>/var/run/nginx.lock --http-client-body-temp-path<span style=color:#f92672>=</span>/var/cache/nginx/client_temp --http-proxy-temp-path<span style=color:#f92672>=</span>/var/cache/nginx/proxy_temp --http-fastcgi-temp-path<span style=color:#f92672>=</span>/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path<span style=color:#f92672>=</span>/var/cache/nginx/uwsgi_temp --http-scgi-temp-path<span style=color:#f92672>=</span>/var/cache/nginx/scgi_temp --user<span style=color:#f92672>=</span>nginx --group<span style=color:#f92672>=</span>nginx --with-compat --with-file-aio --with-threads --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_mp4_module --with-http_random_index_module --with-libatomic --with-openssl<span style=color:#f92672>=</span>/tmp/openssl-1.1.1a --with-openssl-opt<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;zlib -march=native -ljemalloc -Wl,-flto&#39;</span> --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-mail --with-mail_ssl_module --with-stream --with-stream_realip_module --with-stream_ssl_module --with-stream_ssl_preread_module --with-pcre-jit --with-http_geoip_module --with-http_degradation_module --with-cc-opt<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;-g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -m64 -mtune=generic -fPIC&#39;</span> --with-ld-opt<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;-Wl,-z,relro -Wl,-z,now -pie&#39;</span> --with-http_spdy_module --with-http_v2_hpack_enc --add-module<span style=color:#f92672>=</span>/tmp/ngx_brotli
</code></pre></div><p>编译命令:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ make -j<span style=color:#66d9ef>$(</span>nproc --all<span style=color:#66d9ef>)</span>
$ sudo make install
</code></pre></div><p>编译完成以后，验证一下：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ nginx -t

nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful

$ nginx -V

nginx version: nginx/1.15.8
built by gcc 4.8.5 <span style=color:#ae81ff>20150623</span> <span style=color:#f92672>(</span>Red Hat 4.8.5-28<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>GCC<span style=color:#f92672>)</span>
built with OpenSSL 1.1.1a  <span style=color:#ae81ff>20</span> Nov <span style=color:#ae81ff>2018</span>
TLS SNI support enabled
configure arguments: --prefix<span style=color:#f92672>=</span>/etc/nginx --sbin-path<span style=color:#f92672>=</span>/usr/sbin/nginx --modules-path<span style=color:#f92672>=</span>/usr/lib64/nginx/modules --conf-path<span style=color:#f92672>=</span>/etc/nginx/nginx.conf --error-log-path<span style=color:#f92672>=</span>/var/log/nginx/error.log --http-log-path<span style=color:#f92672>=</span>/var/log/nginx/access.log --pid-path<span style=color:#f92672>=</span>/var/run/nginx.pid --lock-path<span style=color:#f92672>=</span>/var/run/nginx.lock --http-client-body-temp-path<span style=color:#f92672>=</span>/var/cache/nginx/client_temp --http-proxy-temp-path<span style=color:#f92672>=</span>/var/cache/nginx/proxy_temp --http-fastcgi-temp-path<span style=color:#f92672>=</span>/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path<span style=color:#f92672>=</span>/var/cache/nginx/uwsgi_temp --http-scgi-temp-path<span style=color:#f92672>=</span>/var/cache/nginx/scgi_temp --user<span style=color:#f92672>=</span>nginx --group<span style=color:#f92672>=</span>nginx --with-compat --with-file-aio --with-threads --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_mp4_module --with-http_random_index_module --with-libatomic --with-openssl<span style=color:#f92672>=</span>/tmp/openssl-1.1.1a --with-openssl-opt<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;zlib -march=native -ljemalloc -Wl,-flto&#39;</span> --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-mail --with-mail_ssl_module --with-stream --with-stream_realip_module --with-stream_ssl_module --with-stream_ssl_preread_module --with-pcre-jit --with-http_geoip_module --with-http_degradation_module --with-cc-opt<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;-g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -m64 -mtune=generic -fPIC&#39;</span> --with-ld-opt<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;-Wl,-z,relro -Wl,-z,now -pie&#39;</span> --with-http_spdy_module --with-http_v2_hpack_enc --add-module<span style=color:#f92672>=</span>/tmp/ngx_brotli
</code></pre></div><h2 id=三-更换-nginx>三. 更换 Nginx</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ cd /usr/sbin
$ mv nginx nginx.1.13.8_old
$ cp /tmp/nginx-release-1.15.3/objs/nginx ./
</code></pre></div><p>测试 nginx 是否能正常工作：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ nginx -t
</code></pre></div><h2 id=四配置-nginx>四.配置 Nginx</h2><p>配置 Brotli (Optional)</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo vim /etc/nginx/nginx.conf

<span style=color:#75715e># 在 http{} 中加入</span>
brotli             on;
brotli_static      on;
brotli_comp_level  6;
brotli_buffers     <span style=color:#ae81ff>32</span> 8k;
brotli_types       text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript application/javascript image/svg+xml;
</code></pre></div><p>配置 Web 站点</p><p>在 Nginx 的站点配置中，以下两个参数需要修改：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ssl_protocols              TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; <span style=color:#75715e># 增加 TLSv1.3</span>
ssl_ciphers                TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+ECDSA+AES128:EECDH+aRSA+AES128:RSA+AES128:EECDH+ECDSA+AES256:EECDH+aRSA+AES256:RSA+AES256:EECDH+ECDSA+3DES:EECDH+aRSA+3DES:RSA+3DES:!MD5;
</code></pre></div><p>包含 TLS13 是 TLS 1.3 新增的 Cipher Suite，加在最前面即可。</p><p>最后使用 <code>nginx -t</code> 测试一下，确认无问题。</p><h2 id=五部署-nginx>五.部署 Nginx</h2><p>重启 nginx 生效上面所有配置</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ systemctl restart nginx
</code></pre></div><h2 id=六验证-tls-13>六.验证 TLS 1.3</h2><h3 id=chrome-验证>chrome 验证</h3><p><img src=https://img.halfrost.com/Blog/ArticleImage/99_4.png alt></p><p>进入 chrome://flags 页面，找到 TLS 1.3，选择支持 draft-28。</p><p>然后访问博客主页，打开开发者工具，security 选项卡：</p><p><img src=https://img.halfrost.com/Blog/ArticleImage/99_1.png alt></p><p><img src=https://img.halfrost.com/Blog/ArticleImage/99_2.png alt></p><p>可以看到链接已经是 TLS 1.3 的了。</p><h3 id=wireshark-抓包验证>wireshark 抓包验证</h3><p>如果还不放心，可以通过抓包来验证是否开启了 TLS 1.3 。</p><p><img src=https://img.halfrost.com/Blog/ArticleImage/99_3.png alt></p><p>从报文上来看，握手阶段确实用的 TLS 1.3 。</p><h3 id=ssllabs-检测报告>SSLlabs 检测报告</h3><p>可以通过<a href=https://www.ssllabs.com/>https://www.ssllabs.com/</a>检测自己的站点 TLS 支持情况。</p><h3 id=myssl-检测报告>MySSL 检测报告</h3><p>可以通过<a href=https://myssl.com/>https://myssl.com/</a>检测自己的站点 TLS 支持情况。</p><h3 id=使用-testssl-工具>使用 testssl 工具</h3><p>在服务端安装 testssl 工具</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ git clone --depth <span style=color:#ae81ff>1</span> https://github.com/drwetter/testssl.sh.git
$ cd testssl.sh
$ ./testssl.sh --help
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ ./testssl.sh -p halfrost.com

 Testing protocols via sockets except NPN+ALPN

 SSLv2      not offered <span style=color:#f92672>(</span>OK<span style=color:#f92672>)</span>
 SSLv3      not offered <span style=color:#f92672>(</span>OK<span style=color:#f92672>)</span>
 TLS <span style=color:#ae81ff>1</span>      offered
 TLS 1.1    offered
 TLS 1.2    offered <span style=color:#f92672>(</span>OK<span style=color:#f92672>)</span>
 TLS 1.3    offered <span style=color:#f92672>(</span>OK<span style=color:#f92672>)</span>: draft 28, draft 27, draft <span style=color:#ae81ff>26</span>
 NPN/SPDY   h2, spdy/3.1, http/1.1 <span style=color:#f92672>(</span>advertised<span style=color:#f92672>)</span>
 ALPN/HTTP2 h2, spdy/3.1, http/1.1 <span style=color:#f92672>(</span>offered<span style=color:#f92672>)</span>
</code></pre></div><p>详细的情况可以用 -P</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ ./testssl.sh -P halfrost.com

 Testing server preferences

 Has server cipher order?     yes <span style=color:#f92672>(</span>OK<span style=color:#f92672>)</span>
 Negotiated protocol          TLSv1.3
 Negotiated cipher            TLS_AES_256_GCM_SHA384, <span style=color:#ae81ff>253</span> bit ECDH <span style=color:#f92672>(</span>X25519<span style=color:#f92672>)</span>
</code></pre></div><p>更加详细的报告这里就不贴了，感兴趣的同学可以用</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ ./testssl.sh halfrost.com
$ ./testssl.sh --full https://halfrost.com
</code></pre></div><p>自己测试。</p><h3 id=开启-tls-13-0-rtt>开启 TLS 1.3 0-RTT</h3><p><strong>更新</strong>：</p><p>在 nginx 的 conf 配置文件中添加:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ssl_early_data on;
</code></pre></div><p>另外还建议添加 Early-Data 头告知后端, 防止重放攻击</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>proxy_set_header Early-Data $ssl_early_data;
</code></pre></div><p>最后使用 sudo nginx -t 测试一下。</p><p>关于 TLS 1.3 的更多细节，会在之后的文章里面分析。Enjoy ~</p><hr><blockquote><p>GitHub Repo：<a href=https://github.com/halfrost/Halfrost-Field>Halfrost-Field</a></p><p>Follow: <a href=https://github.com/halfrost>halfrost · GitHub</a></p><p>Source: <a href=https://halfrost.com/tls1-3_start/>https://halfrost.com/tls1-3_start/</a></p></blockquote><img src=https://img.halfrost.com/wechat-qr-code.png></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=https://books.halfrost.com/>Books</a></li><li><a href=https://github.com/halfrost/Halfrost-Field>Github</a></li><li><a href=https://halfrost.me/>About</a></li><li><a href=/index.xml>RSS</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents><ul><li><a href=#一-安装依赖>一. 安装依赖</a><ul><li><a href=#nginx-1153>Nginx 1.15.3</a></li><li><a href=#openssl-111-pre9>OpenSSL 1.1.1-pre9</a></li><li><a href=#ngx_brotli>ngx_brotli</a></li><li><a href=#jemalloc>jemalloc</a></li><li><a href=#zlib-cloudflare>zlib (Cloudflare)</a></li><li><a href=#libatomic_ops>libatomic_ops</a></li><li><a href=#pcre>pcre</a></li></ul></li><li><a href=#二-编译-nginx>二. 编译 Nginx</a></li><li><a href=#三-更换-nginx>三. 更换 Nginx</a></li><li><a href=#四配置-nginx>四.配置 Nginx</a></li><li><a href=#五部署-nginx>五.部署 Nginx</a></li><li><a href=#六验证-tls-13>六.验证 TLS 1.3</a><ul><li><a href=#chrome-验证>chrome 验证</a></li><li><a href=#wireshark-抓包验证>wireshark 抓包验证</a></li><li><a href=#ssllabs-检测报告>SSLlabs 检测报告</a></li><li><a href=#myssl-检测报告>MySSL 检测报告</a></li><li><a href=#使用-testssl-工具>使用 testssl 工具</a></li><li><a href=#开启-tls-13-0-rtt>开启 TLS 1.3 0-RTT</a></li></ul></li></ul></nav></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fnew.halfrost.com%2ftls1-3_start%2f"><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fnew.halfrost.com%2ftls1-3_start%2f&text=%e6%9c%ac%e7%ab%99%e5%bc%80%e5%a7%8b%e6%94%af%e6%8c%81%20TLS%201.3"><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fnew.halfrost.com%2ftls1-3_start%2f&title=%e6%9c%ac%e7%ab%99%e5%bc%80%e5%a7%8b%e6%94%af%e6%8c%81%20TLS%201.3"><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fnew.halfrost.com%2ftls1-3_start%2f&is_video=false&description=%e6%9c%ac%e7%ab%99%e5%bc%80%e5%a7%8b%e6%94%af%e6%8c%81%20TLS%201.3"><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=%e6%9c%ac%e7%ab%99%e5%bc%80%e5%a7%8b%e6%94%af%e6%8c%81%20TLS%201.3&body=Check out this article: https%3a%2f%2fnew.halfrost.com%2ftls1-3_start%2f"><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fnew.halfrost.com%2ftls1-3_start%2f&title=%e6%9c%ac%e7%ab%99%e5%bc%80%e5%a7%8b%e6%94%af%e6%8c%81%20TLS%201.3"><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fnew.halfrost.com%2ftls1-3_start%2f&title=%e6%9c%ac%e7%ab%99%e5%bc%80%e5%a7%8b%e6%94%af%e6%8c%81%20TLS%201.3"><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fnew.halfrost.com%2ftls1-3_start%2f&title=%e6%9c%ac%e7%ab%99%e5%bc%80%e5%a7%8b%e6%94%af%e6%8c%81%20TLS%201.3"><i class="fab fa-stumbleupon fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://digg.com/submit?url=https%3a%2f%2fnew.halfrost.com%2ftls1-3_start%2f&title=%e6%9c%ac%e7%ab%99%e5%bc%80%e5%a7%8b%e6%94%af%e6%8c%81%20TLS%201.3"><i class="fab fa-digg fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fnew.halfrost.com%2ftls1-3_start%2f&name=%e6%9c%ac%e7%ab%99%e5%bc%80%e5%a7%8b%e6%94%af%e6%8c%81%20TLS%201.3&description=%e7%ac%94%e8%80%85%e6%9c%80%e8%bf%91%e5%9c%a8%e7%a0%94%e7%a9%b6%20TLS%201.3%20%e5%8d%8f%e8%ae%ae%ef%bc%8c%e6%89%80%e4%bb%a5%e6%83%b3%e8%a6%81%e5%ae%9e%e8%b7%b5%e4%b8%80%e4%b8%8b%ef%bc%8c%e5%8d%9a%e5%ae%a2%e5%bf%85%e9%a1%bb%e5%85%88%e9%83%a8%e7%bd%b2%20TLS%201.3%20%e3%80%82%e5%8f%a6%e5%a4%96%e5%ae%83%e7%9a%84%200-RTT%20%e5%af%b9%e5%8d%9a%e5%ae%a2%e9%80%9f%e5%ba%a6%e7%9a%84%e4%b9%9f%e6%98%af%e4%b8%80%e7%a7%8d%e6%8f%90%e5%8d%87%e3%80%82%e9%9c%80%e8%a6%81%e6%b3%a8%e6%84%8f%e7%9b%ae%e5%89%8d%20Chrome%2068%20%e5%92%8c%20Firefox%20%e6%94%af%e6%8c%81%e7%9a%84%e6%98%af%20TLS%201.3%20draft%2028%ef%bc%8c%e6%9a%82%e6%97%b6%e4%b8%8d%e8%a6%81%e7%94%a8%e5%9c%a8%e7%94%9f%e4%ba%a7%e7%8e%af%e5%a2%83%e3%80%82%0a%e5%85%b3%e4%ba%8e%20TLS%201.3%20%e7%9a%84%e6%9b%b4%e5%a4%9a%e7%bb%86%e8%8a%82%ef%bc%8c%e4%bc%9a%e5%9c%a8%e4%b9%8b%e5%90%8e%e7%9a%84%e6%96%87%e7%ab%a0%e9%87%8c%e9%9d%a2%e5%88%86%e6%9e%90%e3%80%82%0a%e4%b8%80.%20%e5%ae%89%e8%a3%85%e4%be%9d%e8%b5%96%20%e5%85%88%e6%9d%a5%e7%9c%8b%e7%9c%8b%e4%be%9d%e8%b5%96%e9%a1%b9%e7%9a%84%e4%b8%80%e4%ba%9b%e6%83%85%e5%86%b5%e3%80%82%0aNginx%201.13.0%20%e5%bc%80%e5%a7%8b%20%e6%ad%a3%e5%bc%8f%e6%94%af%e6%8c%81%20ssl_protocols%20%e7%9a%84%20TLSv1.3%20%e7%9a%84%e9%80%89%e9%a1%b9.%20%e5%9c%a8%e6%ad%a4%e4%b9%8b%e5%89%8d%20TLSv1.2%20%e9%80%89%e9%a1%b9%e4%bc%9a%e8%87%aa%e5%8a%a8%e4%bd%bf%e7%94%a8%20TLSv1.3.%0aOpenSSL%20%e7%9b%ae%e5%89%8d%e6%9c%89%20draft-18%20%e5%88%86%e6%94%af%2c%20pre2%20%e7%89%88%e6%9c%ac%e7%9a%84%20draft-23%20%e4%bb%a5%e5%8f%8a%20pre7%2b%20%e7%9a%84%20draft-28%20%e9%80%9a%e8%bf%87%20tls1.h%20%28include%2fopenssl%2ftls1.h%20%e7%ac%ac35%e8%a1%8c%29%20%e5%8f%af%e4%bb%a5%e6%9f%a5%e7%9c%8b%e7%9b%ae%e5%89%8d%e7%9a%84%20Draft%e3%80%82%0a%e4%bb%8e%20Chrome%2065%20%e5%bc%80%e5%a7%8b%e4%bc%9a%e9%bb%98%e8%ae%a4%e5%bc%80%e5%90%af%e5%b9%b6%e4%bd%bf%e7%94%a8%20TLSv1.3%20Draft%2023%2c%20%e4%bb%8e%20Chrome%2068%20%e5%bc%80%e5%a7%8b%e6%94%af%e6%8c%81%20Draft%2028%20%28Firefox%20Nightly%20%e5%ba%94%e8%af%a5%e4%b9%9f%e6%94%af%e6%8c%81%29."><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fnew.halfrost.com%2ftls1-3_start%2f&t=%e6%9c%ac%e7%ab%99%e5%bc%80%e5%a7%8b%e6%94%af%e6%8c%81%20TLS%201.3"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu class=icon href=# onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden=true></i>Menu</a>
<a id=toc class=icon href=# onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden=true></i>TOC</a>
<a id=share class=icon href=# onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden=true></i>share</a>
<a id=top style=display:none class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i>Top</a></div></div></div><footer id=footer><div class=footer-left><p class=copyright style=float:left;margin-bottom:0><a href=https://github.com/halfrost/Halfrost-Field class=github-repo style=height:18px><span class=gadget-github></span>Star</a>
Copyright &copy;halfrost 2016 - 2021
<a href=http://www.miit.gov.cn/>鄂ICP备16014744号</a></p><br><p class="copyright statistics" style=margin-bottom:20px><span id=busuanzi_container_site_pv>Cumulative Page Views <span id=busuanzi_value_site_pv></span>| Unique Visitors <span id=busuanzi_value_site_uv></span></span></p></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/main.min.f870a4d110314b9e50e65f8ac982dc1c9c376c8f1a5083d39c62cfc49073f011.js></script><script async src=/prism.js></script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']]},svg:{fontCache:'global'}};</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></html>