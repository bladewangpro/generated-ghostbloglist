<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=theme-color content="#FFFFFF"><meta http-equiv=x-ua-compatible content="IE=edge"><title>微信,QQ 这类 IM app 怎么做——谈谈 Websocket | prometheus</title><meta name=description content="Explore in every moment of the hard thinking"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="微信,QQ 这类 IM app 怎么做——谈谈 Websocket"><meta property="og:description" content="####前言 关于我和WebSocket的缘：我从大二在计算机网络课上听老师讲过之后，第一次使用就到了毕业之后的第一份工作。直到最近换了工作，到了一家是含有IM社交聊天功能的app的时候，我觉得我现在可以谈谈我对WebSocket/Socket的一些看法了。要想做IM聊天app，就不得不理解WebSocket和Socket的原理了，听我一一道来。
####目录
 1.WebSocket使用场景 2.WebSocket诞生由来 3.谈谈WebSocket协议原理 4.WebSocket 和 Socket的区别与联系 5.iOS平台有哪些WebSocket和Socket的开源框架 6.iOS平台如何实现WebSocket协议  #####一.WebSocket的使用场景 1.社交聊天
最著名的就是微信，QQ，这一类社交聊天的app。这一类聊天app的特点是低延迟，高即时。即时是这里面要求最高的，如果有一个紧急的事情，通过IM软件通知你，假设网络环境良好的情况下，这条message还无法立即送达到你的客户端上，紧急的事情都结束了，你才收到消息，那么这个软件肯定是失败的。
2.弹幕
说到这里，大家一定里面想到了A站和B站了。确实，他们的弹幕一直是一种特色。而且弹幕对于一个视频来说，很可能弹幕才是精华。发弹幕需要实时显示，也需要和聊天一样，需要即时。
3.多玩家游戏
4.协同编辑
现在很多开源项目都是分散在世界各地的开发者一起协同开发，此时就会用到版本控制系统，比如Git，SVN去合并冲突。但是如果有一份文档，支持多人实时在线协同编辑，那么此时就会用到比如WebSocket了，它可以保证各个编辑者都在编辑同一个文档，此时不需要用到Git，SVN这些版本控制，因为在协同编辑界面就会实时看到对方编辑了什么，谁在修改哪些段落和文字。
5.股票基金实时报价
金融界瞬息万变——几乎是每毫秒都在变化。如果采用的网络架构无法满足实时性，那么就会给客户带来巨大的损失。几毫秒钱股票开始大跌，几秒以后才刷新数据，一秒钟的时间内，很可能用户就已经损失巨大财产了。
6.体育实况更新
全世界的球迷，体育爱好者特别多，当然大家在关心自己喜欢的体育活动的时候，比赛实时的赛况是他们最最关心的事情。这类新闻中最好的体验就是利用Websocket达到实时的更新！
7.视频会议/聊天
视频会议并不能代替和真人相见，但是他能让分布在全球天涯海角的人聚在电脑前一起开会。既能节省大家聚在一起路上花费的时间，讨论聚会地点的纠结，还能随时随地，只要有网络就可以开会。
8.基于位置的应用
越来越多的开发者借用移动设备的GPS功能来实现他们基于位置的网络应用。如果你一直记录用户的位置(比如运行应用来记录运动轨迹)，你可以收集到更加细致化的数据。
9.在线教育
在线教育近几年也发展迅速。优点很多，免去了场地的限制，能让名师的资源合理的分配给全国各地想要学习知识的同学手上，Websocket是个不错的选择，可以视频聊天、即时聊天以及其与别人合作一起在网上讨论问题&mldr;
10.智能家居
这也是我一毕业加入的一个伟大的物联网智能家居的公司。考虑到家里的智能设备的状态必须需要实时的展现在手机app客户端上，毫无疑问选择了Websocket。
11.总结
从上面我列举的这些场景来看，一个共同点就是，高实时性！
#####二.WebSocket诞生由来 1.最开始的轮询Polling阶段
这种方式下，是不适合获取实时信息的，客户端和服务器之间会一直进行连接，每隔一段时间就询问一次。客户端会轮询，有没有新消息。这种方式连接数会很多，一个接受，一个发送。而且每次发送请求都会有Http的Header，会很耗流量，也会消耗CPU的利用率。
2.改进版的长轮询Long polling阶段
长轮询是对轮询的改进版，客户端发送HTTP给服务器之后，有没有新消息，如果没有新消息，就一直等待。当有新消息的时候，才会返回给客户端。在某种程度上减小了网络带宽和CPU利用率等问题。但是这种方式还是有一种弊端：例如假设服务器端的数据更新速度很快，服务器在传送一个数据包给客户端后必须等待客户端的下一个Get请求到来，才能传递第二个更新的数据包给客户端，那么这样的话，客户端显示实时数据最快的时间为2×RTT（往返时间），而且如果在网络拥塞的情况下，这个时间用户是不能接受的，比如在股市的的报价上。另外，由于http数据包的头部数据量往往很大（通常有400多个字节），但是真正被服务器需要的数据却很少（有时只有10个字节左右），这样的数据包在网络上周期性的传输，难免对网络带宽是一种浪费。
3.WebSocket诞生
现在急需的需求是能支持客户端和服务器端的双向通信，而且协议的头部又没有HTTP的Header那么大，于是，Websocket就诞生了！
上图就是Websocket和Polling的区别，从图中可以看到Polling里面客户端发送了好多Request，而下图，只有一个Upgrade，非常简洁高效。至于消耗方面的比较就要看下图了
上图中，我们先看蓝色的柱状图，是Polling轮询消耗的流量，这次测试，HTTP请求和响应头信息开销总共包括871字节。当然每次测试不同的请求，头的开销不同。这次测试都以871字节的请求来测试。
**Use case A:**1,000 clients polling every second: Network throughput is (871 x 1,000) = 871,000 bytes = 6,968,000 bits per second (6.6 Mbps)
Use case B: 10,000 clients polling every second: Network throughput is (871 x 10,000) = 8,710,000 bytes = 69,680,000 bits per second (66 Mbps)"><meta property="og:type" content="article"><meta property="og:url" content="https://new.halfrost.com/ios_weixin_qq_websocket/"><meta property="article:published_time" content="2016-05-15T02:55:00+00:00"><meta property="article:modified_time" content="2016-05-15T02:55:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="微信,QQ 这类 IM app 怎么做——谈谈 Websocket"><meta name=twitter:description content="####前言 关于我和WebSocket的缘：我从大二在计算机网络课上听老师讲过之后，第一次使用就到了毕业之后的第一份工作。直到最近换了工作，到了一家是含有IM社交聊天功能的app的时候，我觉得我现在可以谈谈我对WebSocket/Socket的一些看法了。要想做IM聊天app，就不得不理解WebSocket和Socket的原理了，听我一一道来。
####目录
 1.WebSocket使用场景 2.WebSocket诞生由来 3.谈谈WebSocket协议原理 4.WebSocket 和 Socket的区别与联系 5.iOS平台有哪些WebSocket和Socket的开源框架 6.iOS平台如何实现WebSocket协议  #####一.WebSocket的使用场景 1.社交聊天
最著名的就是微信，QQ，这一类社交聊天的app。这一类聊天app的特点是低延迟，高即时。即时是这里面要求最高的，如果有一个紧急的事情，通过IM软件通知你，假设网络环境良好的情况下，这条message还无法立即送达到你的客户端上，紧急的事情都结束了，你才收到消息，那么这个软件肯定是失败的。
2.弹幕
说到这里，大家一定里面想到了A站和B站了。确实，他们的弹幕一直是一种特色。而且弹幕对于一个视频来说，很可能弹幕才是精华。发弹幕需要实时显示，也需要和聊天一样，需要即时。
3.多玩家游戏
4.协同编辑
现在很多开源项目都是分散在世界各地的开发者一起协同开发，此时就会用到版本控制系统，比如Git，SVN去合并冲突。但是如果有一份文档，支持多人实时在线协同编辑，那么此时就会用到比如WebSocket了，它可以保证各个编辑者都在编辑同一个文档，此时不需要用到Git，SVN这些版本控制，因为在协同编辑界面就会实时看到对方编辑了什么，谁在修改哪些段落和文字。
5.股票基金实时报价
金融界瞬息万变——几乎是每毫秒都在变化。如果采用的网络架构无法满足实时性，那么就会给客户带来巨大的损失。几毫秒钱股票开始大跌，几秒以后才刷新数据，一秒钟的时间内，很可能用户就已经损失巨大财产了。
6.体育实况更新
全世界的球迷，体育爱好者特别多，当然大家在关心自己喜欢的体育活动的时候，比赛实时的赛况是他们最最关心的事情。这类新闻中最好的体验就是利用Websocket达到实时的更新！
7.视频会议/聊天
视频会议并不能代替和真人相见，但是他能让分布在全球天涯海角的人聚在电脑前一起开会。既能节省大家聚在一起路上花费的时间，讨论聚会地点的纠结，还能随时随地，只要有网络就可以开会。
8.基于位置的应用
越来越多的开发者借用移动设备的GPS功能来实现他们基于位置的网络应用。如果你一直记录用户的位置(比如运行应用来记录运动轨迹)，你可以收集到更加细致化的数据。
9.在线教育
在线教育近几年也发展迅速。优点很多，免去了场地的限制，能让名师的资源合理的分配给全国各地想要学习知识的同学手上，Websocket是个不错的选择，可以视频聊天、即时聊天以及其与别人合作一起在网上讨论问题&mldr;
10.智能家居
这也是我一毕业加入的一个伟大的物联网智能家居的公司。考虑到家里的智能设备的状态必须需要实时的展现在手机app客户端上，毫无疑问选择了Websocket。
11.总结
从上面我列举的这些场景来看，一个共同点就是，高实时性！
#####二.WebSocket诞生由来 1.最开始的轮询Polling阶段
这种方式下，是不适合获取实时信息的，客户端和服务器之间会一直进行连接，每隔一段时间就询问一次。客户端会轮询，有没有新消息。这种方式连接数会很多，一个接受，一个发送。而且每次发送请求都会有Http的Header，会很耗流量，也会消耗CPU的利用率。
2.改进版的长轮询Long polling阶段
长轮询是对轮询的改进版，客户端发送HTTP给服务器之后，有没有新消息，如果没有新消息，就一直等待。当有新消息的时候，才会返回给客户端。在某种程度上减小了网络带宽和CPU利用率等问题。但是这种方式还是有一种弊端：例如假设服务器端的数据更新速度很快，服务器在传送一个数据包给客户端后必须等待客户端的下一个Get请求到来，才能传递第二个更新的数据包给客户端，那么这样的话，客户端显示实时数据最快的时间为2×RTT（往返时间），而且如果在网络拥塞的情况下，这个时间用户是不能接受的，比如在股市的的报价上。另外，由于http数据包的头部数据量往往很大（通常有400多个字节），但是真正被服务器需要的数据却很少（有时只有10个字节左右），这样的数据包在网络上周期性的传输，难免对网络带宽是一种浪费。
3.WebSocket诞生
现在急需的需求是能支持客户端和服务器端的双向通信，而且协议的头部又没有HTTP的Header那么大，于是，Websocket就诞生了！
上图就是Websocket和Polling的区别，从图中可以看到Polling里面客户端发送了好多Request，而下图，只有一个Upgrade，非常简洁高效。至于消耗方面的比较就要看下图了
上图中，我们先看蓝色的柱状图，是Polling轮询消耗的流量，这次测试，HTTP请求和响应头信息开销总共包括871字节。当然每次测试不同的请求，头的开销不同。这次测试都以871字节的请求来测试。
**Use case A:**1,000 clients polling every second: Network throughput is (871 x 1,000) = 871,000 bytes = 6,968,000 bits per second (6.6 Mbps)
Use case B: 10,000 clients polling every second: Network throughput is (871 x 10,000) = 8,710,000 bytes = 69,680,000 bits per second (66 Mbps)"><link rel=stylesheet href=/css/style-white.min.css><link rel=manifest href=/manifest.json><link rel=stylesheet href=/prism.css><link href=/images/apple-touch-icon-60x60.png rel=apple-touch-icon sizes=60x60><link href=/images/apple-touch-icon-76x76.png rel=apple-touch-icon sizes=76x76><link href=/images/apple-touch-icon-120x120.png rel=apple-touch-icon sizes=120x120><link href=/images/apple-touch-icon-152x152.png rel=apple-touch-icon sizes=152x152><link href=/images/apple-touch-icon-180x180.png rel=apple-touch-icon sizes=180x180><link href=/images/apple-touch-icon-512x512.png rel=apple-touch-icon sizes=512x512><link href=/images/apple-touch-icon-1024x1024.png rel=apple-touch-icon sizes=1024x1024><script async>if('serviceWorker'in navigator){navigator.serviceWorker.register("\/serviceworker-v1.min.a64912b78d282eab1ad3715a0943da21616e5f326f8afea27034784ad445043b.js").then(function(){if(navigator.serviceWorker.controller){console.log('Assets cached by the controlling service worker.');}else{console.log('Please reload this page to allow the service worker to handle network operations.');}}).catch(function(error){console.log('ERROR: '+error);});}else{console.log('Service workers are not supported in the current browser.');}</script><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://new.halfrost.com/images/favicon.ico><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-82753806-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="single-max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a><a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a><a id=top-icon-tablet href=# onclick="$('html, body').animate({scrollTop:0},'fast');" style=display:none><i class="fas fa-chevron-up fa-lg"></i></a><span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=https://books.halfrost.com/>Books</a></li><li><a href=https://github.com/halfrost/Halfrost-Field>Github</a></li><li><a href=https://halfrost.me/>About</a></li><li><a href=/index.xml>RSS</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://new.halfrost.com/ios_coredata_migration/><i class="fas fa-chevron-left" aria-hidden=true onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li><li><a class=icon href=https://new.halfrost.com/ios_launchpage_logo_fly/><i class="fas fa-chevron-right" aria-hidden=true onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li><li><a class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast');"><i class="fas fa-chevron-up" aria-hidden=true onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li><li><a class=icon href=#><i class="fas fa-share-alt" aria-hidden=true onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fnew.halfrost.com%2fios_weixin_qq_websocket%2f"><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fnew.halfrost.com%2fios_weixin_qq_websocket%2f&text=%e5%be%ae%e4%bf%a1%2cQQ%20%e8%bf%99%e7%b1%bb%20IM%20app%20%e6%80%8e%e4%b9%88%e5%81%9a%e2%80%94%e2%80%94%e8%b0%88%e8%b0%88%20Websocket"><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fnew.halfrost.com%2fios_weixin_qq_websocket%2f&title=%e5%be%ae%e4%bf%a1%2cQQ%20%e8%bf%99%e7%b1%bb%20IM%20app%20%e6%80%8e%e4%b9%88%e5%81%9a%e2%80%94%e2%80%94%e8%b0%88%e8%b0%88%20Websocket"><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fnew.halfrost.com%2fios_weixin_qq_websocket%2f&is_video=false&description=%e5%be%ae%e4%bf%a1%2cQQ%20%e8%bf%99%e7%b1%bb%20IM%20app%20%e6%80%8e%e4%b9%88%e5%81%9a%e2%80%94%e2%80%94%e8%b0%88%e8%b0%88%20Websocket"><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=%e5%be%ae%e4%bf%a1%2cQQ%20%e8%bf%99%e7%b1%bb%20IM%20app%20%e6%80%8e%e4%b9%88%e5%81%9a%e2%80%94%e2%80%94%e8%b0%88%e8%b0%88%20Websocket&body=Check out this article: https%3a%2f%2fnew.halfrost.com%2fios_weixin_qq_websocket%2f"><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fnew.halfrost.com%2fios_weixin_qq_websocket%2f&title=%e5%be%ae%e4%bf%a1%2cQQ%20%e8%bf%99%e7%b1%bb%20IM%20app%20%e6%80%8e%e4%b9%88%e5%81%9a%e2%80%94%e2%80%94%e8%b0%88%e8%b0%88%20Websocket"><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fnew.halfrost.com%2fios_weixin_qq_websocket%2f&title=%e5%be%ae%e4%bf%a1%2cQQ%20%e8%bf%99%e7%b1%bb%20IM%20app%20%e6%80%8e%e4%b9%88%e5%81%9a%e2%80%94%e2%80%94%e8%b0%88%e8%b0%88%20Websocket"><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fnew.halfrost.com%2fios_weixin_qq_websocket%2f&title=%e5%be%ae%e4%bf%a1%2cQQ%20%e8%bf%99%e7%b1%bb%20IM%20app%20%e6%80%8e%e4%b9%88%e5%81%9a%e2%80%94%e2%80%94%e8%b0%88%e8%b0%88%20Websocket"><i class="fab fa-stumbleupon" aria-hidden=true></i></a></li><li><a class=icon href="http://digg.com/submit?url=https%3a%2f%2fnew.halfrost.com%2fios_weixin_qq_websocket%2f&title=%e5%be%ae%e4%bf%a1%2cQQ%20%e8%bf%99%e7%b1%bb%20IM%20app%20%e6%80%8e%e4%b9%88%e5%81%9a%e2%80%94%e2%80%94%e8%b0%88%e8%b0%88%20Websocket"><i class="fab fa-digg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fnew.halfrost.com%2fios_weixin_qq_websocket%2f&name=%e5%be%ae%e4%bf%a1%2cQQ%20%e8%bf%99%e7%b1%bb%20IM%20app%20%e6%80%8e%e4%b9%88%e5%81%9a%e2%80%94%e2%80%94%e8%b0%88%e8%b0%88%20Websocket&description=%23%23%23%23%e5%89%8d%e8%a8%80%20%e5%85%b3%e4%ba%8e%e6%88%91%e5%92%8cWebSocket%e7%9a%84%e7%bc%98%ef%bc%9a%e6%88%91%e4%bb%8e%e5%a4%a7%e4%ba%8c%e5%9c%a8%e8%ae%a1%e7%ae%97%e6%9c%ba%e7%bd%91%e7%bb%9c%e8%af%be%e4%b8%8a%e5%90%ac%e8%80%81%e5%b8%88%e8%ae%b2%e8%bf%87%e4%b9%8b%e5%90%8e%ef%bc%8c%e7%ac%ac%e4%b8%80%e6%ac%a1%e4%bd%bf%e7%94%a8%e5%b0%b1%e5%88%b0%e4%ba%86%e6%af%95%e4%b8%9a%e4%b9%8b%e5%90%8e%e7%9a%84%e7%ac%ac%e4%b8%80%e4%bb%bd%e5%b7%a5%e4%bd%9c%e3%80%82%e7%9b%b4%e5%88%b0%e6%9c%80%e8%bf%91%e6%8d%a2%e4%ba%86%e5%b7%a5%e4%bd%9c%ef%bc%8c%e5%88%b0%e4%ba%86%e4%b8%80%e5%ae%b6%e6%98%af%e5%90%ab%e6%9c%89IM%e7%a4%be%e4%ba%a4%e8%81%8a%e5%a4%a9%e5%8a%9f%e8%83%bd%e7%9a%84app%e7%9a%84%e6%97%b6%e5%80%99%ef%bc%8c%e6%88%91%e8%a7%89%e5%be%97%e6%88%91%e7%8e%b0%e5%9c%a8%e5%8f%af%e4%bb%a5%e8%b0%88%e8%b0%88%e6%88%91%e5%af%b9WebSocket%2fSocket%e7%9a%84%e4%b8%80%e4%ba%9b%e7%9c%8b%e6%b3%95%e4%ba%86%e3%80%82%e8%a6%81%e6%83%b3%e5%81%9aIM%e8%81%8a%e5%a4%a9app%ef%bc%8c%e5%b0%b1%e4%b8%8d%e5%be%97%e4%b8%8d%e7%90%86%e8%a7%a3WebSocket%e5%92%8cSocket%e7%9a%84%e5%8e%9f%e7%90%86%e4%ba%86%ef%bc%8c%e5%90%ac%e6%88%91%e4%b8%80%e4%b8%80%e9%81%93%e6%9d%a5%e3%80%82%0a%23%23%23%23%e7%9b%ae%e5%bd%95%0a%201.WebSocket%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af%202.WebSocket%e8%af%9e%e7%94%9f%e7%94%b1%e6%9d%a5%203.%e8%b0%88%e8%b0%88WebSocket%e5%8d%8f%e8%ae%ae%e5%8e%9f%e7%90%86%204.WebSocket%20%e5%92%8c%20Socket%e7%9a%84%e5%8c%ba%e5%88%ab%e4%b8%8e%e8%81%94%e7%b3%bb%205.iOS%e5%b9%b3%e5%8f%b0%e6%9c%89%e5%93%aa%e4%ba%9bWebSocket%e5%92%8cSocket%e7%9a%84%e5%bc%80%e6%ba%90%e6%a1%86%e6%9e%b6%206.iOS%e5%b9%b3%e5%8f%b0%e5%a6%82%e4%bd%95%e5%ae%9e%e7%8e%b0WebSocket%e5%8d%8f%e8%ae%ae%20%20%23%23%23%23%23%e4%b8%80.WebSocket%e7%9a%84%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af%201.%e7%a4%be%e4%ba%a4%e8%81%8a%e5%a4%a9%0a%e6%9c%80%e8%91%97%e5%90%8d%e7%9a%84%e5%b0%b1%e6%98%af%e5%be%ae%e4%bf%a1%ef%bc%8cQQ%ef%bc%8c%e8%bf%99%e4%b8%80%e7%b1%bb%e7%a4%be%e4%ba%a4%e8%81%8a%e5%a4%a9%e7%9a%84app%e3%80%82%e8%bf%99%e4%b8%80%e7%b1%bb%e8%81%8a%e5%a4%a9app%e7%9a%84%e7%89%b9%e7%82%b9%e6%98%af%e4%bd%8e%e5%bb%b6%e8%bf%9f%ef%bc%8c%e9%ab%98%e5%8d%b3%e6%97%b6%e3%80%82%e5%8d%b3%e6%97%b6%e6%98%af%e8%bf%99%e9%87%8c%e9%9d%a2%e8%a6%81%e6%b1%82%e6%9c%80%e9%ab%98%e7%9a%84%ef%bc%8c%e5%a6%82%e6%9e%9c%e6%9c%89%e4%b8%80%e4%b8%aa%e7%b4%a7%e6%80%a5%e7%9a%84%e4%ba%8b%e6%83%85%ef%bc%8c%e9%80%9a%e8%bf%87IM%e8%bd%af%e4%bb%b6%e9%80%9a%e7%9f%a5%e4%bd%a0%ef%bc%8c%e5%81%87%e8%ae%be%e7%bd%91%e7%bb%9c%e7%8e%af%e5%a2%83%e8%89%af%e5%a5%bd%e7%9a%84%e6%83%85%e5%86%b5%e4%b8%8b%ef%bc%8c%e8%bf%99%e6%9d%a1message%e8%bf%98%e6%97%a0%e6%b3%95%e7%ab%8b%e5%8d%b3%e9%80%81%e8%be%be%e5%88%b0%e4%bd%a0%e7%9a%84%e5%ae%a2%e6%88%b7%e7%ab%af%e4%b8%8a%ef%bc%8c%e7%b4%a7%e6%80%a5%e7%9a%84%e4%ba%8b%e6%83%85%e9%83%bd%e7%bb%93%e6%9d%9f%e4%ba%86%ef%bc%8c%e4%bd%a0%e6%89%8d%e6%94%b6%e5%88%b0%e6%b6%88%e6%81%af%ef%bc%8c%e9%82%a3%e4%b9%88%e8%bf%99%e4%b8%aa%e8%bd%af%e4%bb%b6%e8%82%af%e5%ae%9a%e6%98%af%e5%a4%b1%e8%b4%a5%e7%9a%84%e3%80%82%0a2.%e5%bc%b9%e5%b9%95%0a%e8%af%b4%e5%88%b0%e8%bf%99%e9%87%8c%ef%bc%8c%e5%a4%a7%e5%ae%b6%e4%b8%80%e5%ae%9a%e9%87%8c%e9%9d%a2%e6%83%b3%e5%88%b0%e4%ba%86A%e7%ab%99%e5%92%8cB%e7%ab%99%e4%ba%86%e3%80%82%e7%a1%ae%e5%ae%9e%ef%bc%8c%e4%bb%96%e4%bb%ac%e7%9a%84%e5%bc%b9%e5%b9%95%e4%b8%80%e7%9b%b4%e6%98%af%e4%b8%80%e7%a7%8d%e7%89%b9%e8%89%b2%e3%80%82%e8%80%8c%e4%b8%94%e5%bc%b9%e5%b9%95%e5%af%b9%e4%ba%8e%e4%b8%80%e4%b8%aa%e8%a7%86%e9%a2%91%e6%9d%a5%e8%af%b4%ef%bc%8c%e5%be%88%e5%8f%af%e8%83%bd%e5%bc%b9%e5%b9%95%e6%89%8d%e6%98%af%e7%b2%be%e5%8d%8e%e3%80%82%e5%8f%91%e5%bc%b9%e5%b9%95%e9%9c%80%e8%a6%81%e5%ae%9e%e6%97%b6%e6%98%be%e7%a4%ba%ef%bc%8c%e4%b9%9f%e9%9c%80%e8%a6%81%e5%92%8c%e8%81%8a%e5%a4%a9%e4%b8%80%e6%a0%b7%ef%bc%8c%e9%9c%80%e8%a6%81%e5%8d%b3%e6%97%b6%e3%80%82%0a3.%e5%a4%9a%e7%8e%a9%e5%ae%b6%e6%b8%b8%e6%88%8f%0a4.%e5%8d%8f%e5%90%8c%e7%bc%96%e8%be%91%0a%e7%8e%b0%e5%9c%a8%e5%be%88%e5%a4%9a%e5%bc%80%e6%ba%90%e9%a1%b9%e7%9b%ae%e9%83%bd%e6%98%af%e5%88%86%e6%95%a3%e5%9c%a8%e4%b8%96%e7%95%8c%e5%90%84%e5%9c%b0%e7%9a%84%e5%bc%80%e5%8f%91%e8%80%85%e4%b8%80%e8%b5%b7%e5%8d%8f%e5%90%8c%e5%bc%80%e5%8f%91%ef%bc%8c%e6%ad%a4%e6%97%b6%e5%b0%b1%e4%bc%9a%e7%94%a8%e5%88%b0%e7%89%88%e6%9c%ac%e6%8e%a7%e5%88%b6%e7%b3%bb%e7%bb%9f%ef%bc%8c%e6%af%94%e5%a6%82Git%ef%bc%8cSVN%e5%8e%bb%e5%90%88%e5%b9%b6%e5%86%b2%e7%aa%81%e3%80%82%e4%bd%86%e6%98%af%e5%a6%82%e6%9e%9c%e6%9c%89%e4%b8%80%e4%bb%bd%e6%96%87%e6%a1%a3%ef%bc%8c%e6%94%af%e6%8c%81%e5%a4%9a%e4%ba%ba%e5%ae%9e%e6%97%b6%e5%9c%a8%e7%ba%bf%e5%8d%8f%e5%90%8c%e7%bc%96%e8%be%91%ef%bc%8c%e9%82%a3%e4%b9%88%e6%ad%a4%e6%97%b6%e5%b0%b1%e4%bc%9a%e7%94%a8%e5%88%b0%e6%af%94%e5%a6%82WebSocket%e4%ba%86%ef%bc%8c%e5%ae%83%e5%8f%af%e4%bb%a5%e4%bf%9d%e8%af%81%e5%90%84%e4%b8%aa%e7%bc%96%e8%be%91%e8%80%85%e9%83%bd%e5%9c%a8%e7%bc%96%e8%be%91%e5%90%8c%e4%b8%80%e4%b8%aa%e6%96%87%e6%a1%a3%ef%bc%8c%e6%ad%a4%e6%97%b6%e4%b8%8d%e9%9c%80%e8%a6%81%e7%94%a8%e5%88%b0Git%ef%bc%8cSVN%e8%bf%99%e4%ba%9b%e7%89%88%e6%9c%ac%e6%8e%a7%e5%88%b6%ef%bc%8c%e5%9b%a0%e4%b8%ba%e5%9c%a8%e5%8d%8f%e5%90%8c%e7%bc%96%e8%be%91%e7%95%8c%e9%9d%a2%e5%b0%b1%e4%bc%9a%e5%ae%9e%e6%97%b6%e7%9c%8b%e5%88%b0%e5%af%b9%e6%96%b9%e7%bc%96%e8%be%91%e4%ba%86%e4%bb%80%e4%b9%88%ef%bc%8c%e8%b0%81%e5%9c%a8%e4%bf%ae%e6%94%b9%e5%93%aa%e4%ba%9b%e6%ae%b5%e8%90%bd%e5%92%8c%e6%96%87%e5%ad%97%e3%80%82%0a5.%e8%82%a1%e7%a5%a8%e5%9f%ba%e9%87%91%e5%ae%9e%e6%97%b6%e6%8a%a5%e4%bb%b7%0a%e9%87%91%e8%9e%8d%e7%95%8c%e7%9e%ac%e6%81%af%e4%b8%87%e5%8f%98%e2%80%94%e2%80%94%e5%87%a0%e4%b9%8e%e6%98%af%e6%af%8f%e6%af%ab%e7%a7%92%e9%83%bd%e5%9c%a8%e5%8f%98%e5%8c%96%e3%80%82%e5%a6%82%e6%9e%9c%e9%87%87%e7%94%a8%e7%9a%84%e7%bd%91%e7%bb%9c%e6%9e%b6%e6%9e%84%e6%97%a0%e6%b3%95%e6%bb%a1%e8%b6%b3%e5%ae%9e%e6%97%b6%e6%80%a7%ef%bc%8c%e9%82%a3%e4%b9%88%e5%b0%b1%e4%bc%9a%e7%bb%99%e5%ae%a2%e6%88%b7%e5%b8%a6%e6%9d%a5%e5%b7%a8%e5%a4%a7%e7%9a%84%e6%8d%9f%e5%a4%b1%e3%80%82%e5%87%a0%e6%af%ab%e7%a7%92%e9%92%b1%e8%82%a1%e7%a5%a8%e5%bc%80%e5%a7%8b%e5%a4%a7%e8%b7%8c%ef%bc%8c%e5%87%a0%e7%a7%92%e4%bb%a5%e5%90%8e%e6%89%8d%e5%88%b7%e6%96%b0%e6%95%b0%e6%8d%ae%ef%bc%8c%e4%b8%80%e7%a7%92%e9%92%9f%e7%9a%84%e6%97%b6%e9%97%b4%e5%86%85%ef%bc%8c%e5%be%88%e5%8f%af%e8%83%bd%e7%94%a8%e6%88%b7%e5%b0%b1%e5%b7%b2%e7%bb%8f%e6%8d%9f%e5%a4%b1%e5%b7%a8%e5%a4%a7%e8%b4%a2%e4%ba%a7%e4%ba%86%e3%80%82%0a6.%e4%bd%93%e8%82%b2%e5%ae%9e%e5%86%b5%e6%9b%b4%e6%96%b0%0a%e5%85%a8%e4%b8%96%e7%95%8c%e7%9a%84%e7%90%83%e8%bf%b7%ef%bc%8c%e4%bd%93%e8%82%b2%e7%88%b1%e5%a5%bd%e8%80%85%e7%89%b9%e5%88%ab%e5%a4%9a%ef%bc%8c%e5%bd%93%e7%84%b6%e5%a4%a7%e5%ae%b6%e5%9c%a8%e5%85%b3%e5%bf%83%e8%87%aa%e5%b7%b1%e5%96%9c%e6%ac%a2%e7%9a%84%e4%bd%93%e8%82%b2%e6%b4%bb%e5%8a%a8%e7%9a%84%e6%97%b6%e5%80%99%ef%bc%8c%e6%af%94%e8%b5%9b%e5%ae%9e%e6%97%b6%e7%9a%84%e8%b5%9b%e5%86%b5%e6%98%af%e4%bb%96%e4%bb%ac%e6%9c%80%e6%9c%80%e5%85%b3%e5%bf%83%e7%9a%84%e4%ba%8b%e6%83%85%e3%80%82%e8%bf%99%e7%b1%bb%e6%96%b0%e9%97%bb%e4%b8%ad%e6%9c%80%e5%a5%bd%e7%9a%84%e4%bd%93%e9%aa%8c%e5%b0%b1%e6%98%af%e5%88%a9%e7%94%a8Websocket%e8%be%be%e5%88%b0%e5%ae%9e%e6%97%b6%e7%9a%84%e6%9b%b4%e6%96%b0%ef%bc%81%0a7.%e8%a7%86%e9%a2%91%e4%bc%9a%e8%ae%ae%2f%e8%81%8a%e5%a4%a9%0a%e8%a7%86%e9%a2%91%e4%bc%9a%e8%ae%ae%e5%b9%b6%e4%b8%8d%e8%83%bd%e4%bb%a3%e6%9b%bf%e5%92%8c%e7%9c%9f%e4%ba%ba%e7%9b%b8%e8%a7%81%ef%bc%8c%e4%bd%86%e6%98%af%e4%bb%96%e8%83%bd%e8%ae%a9%e5%88%86%e5%b8%83%e5%9c%a8%e5%85%a8%e7%90%83%e5%a4%a9%e6%b6%af%e6%b5%b7%e8%a7%92%e7%9a%84%e4%ba%ba%e8%81%9a%e5%9c%a8%e7%94%b5%e8%84%91%e5%89%8d%e4%b8%80%e8%b5%b7%e5%bc%80%e4%bc%9a%e3%80%82%e6%97%a2%e8%83%bd%e8%8a%82%e7%9c%81%e5%a4%a7%e5%ae%b6%e8%81%9a%e5%9c%a8%e4%b8%80%e8%b5%b7%e8%b7%af%e4%b8%8a%e8%8a%b1%e8%b4%b9%e7%9a%84%e6%97%b6%e9%97%b4%ef%bc%8c%e8%ae%a8%e8%ae%ba%e8%81%9a%e4%bc%9a%e5%9c%b0%e7%82%b9%e7%9a%84%e7%ba%a0%e7%bb%93%ef%bc%8c%e8%bf%98%e8%83%bd%e9%9a%8f%e6%97%b6%e9%9a%8f%e5%9c%b0%ef%bc%8c%e5%8f%aa%e8%a6%81%e6%9c%89%e7%bd%91%e7%bb%9c%e5%b0%b1%e5%8f%af%e4%bb%a5%e5%bc%80%e4%bc%9a%e3%80%82%0a8.%e5%9f%ba%e4%ba%8e%e4%bd%8d%e7%bd%ae%e7%9a%84%e5%ba%94%e7%94%a8%0a%e8%b6%8a%e6%9d%a5%e8%b6%8a%e5%a4%9a%e7%9a%84%e5%bc%80%e5%8f%91%e8%80%85%e5%80%9f%e7%94%a8%e7%a7%bb%e5%8a%a8%e8%ae%be%e5%a4%87%e7%9a%84GPS%e5%8a%9f%e8%83%bd%e6%9d%a5%e5%ae%9e%e7%8e%b0%e4%bb%96%e4%bb%ac%e5%9f%ba%e4%ba%8e%e4%bd%8d%e7%bd%ae%e7%9a%84%e7%bd%91%e7%bb%9c%e5%ba%94%e7%94%a8%e3%80%82%e5%a6%82%e6%9e%9c%e4%bd%a0%e4%b8%80%e7%9b%b4%e8%ae%b0%e5%bd%95%e7%94%a8%e6%88%b7%e7%9a%84%e4%bd%8d%e7%bd%ae%28%e6%af%94%e5%a6%82%e8%bf%90%e8%a1%8c%e5%ba%94%e7%94%a8%e6%9d%a5%e8%ae%b0%e5%bd%95%e8%bf%90%e5%8a%a8%e8%bd%a8%e8%bf%b9%29%ef%bc%8c%e4%bd%a0%e5%8f%af%e4%bb%a5%e6%94%b6%e9%9b%86%e5%88%b0%e6%9b%b4%e5%8a%a0%e7%bb%86%e8%87%b4%e5%8c%96%e7%9a%84%e6%95%b0%e6%8d%ae%e3%80%82%0a9.%e5%9c%a8%e7%ba%bf%e6%95%99%e8%82%b2%0a%e5%9c%a8%e7%ba%bf%e6%95%99%e8%82%b2%e8%bf%91%e5%87%a0%e5%b9%b4%e4%b9%9f%e5%8f%91%e5%b1%95%e8%bf%85%e9%80%9f%e3%80%82%e4%bc%98%e7%82%b9%e5%be%88%e5%a4%9a%ef%bc%8c%e5%85%8d%e5%8e%bb%e4%ba%86%e5%9c%ba%e5%9c%b0%e7%9a%84%e9%99%90%e5%88%b6%ef%bc%8c%e8%83%bd%e8%ae%a9%e5%90%8d%e5%b8%88%e7%9a%84%e8%b5%84%e6%ba%90%e5%90%88%e7%90%86%e7%9a%84%e5%88%86%e9%85%8d%e7%bb%99%e5%85%a8%e5%9b%bd%e5%90%84%e5%9c%b0%e6%83%b3%e8%a6%81%e5%ad%a6%e4%b9%a0%e7%9f%a5%e8%af%86%e7%9a%84%e5%90%8c%e5%ad%a6%e6%89%8b%e4%b8%8a%ef%bc%8cWebsocket%e6%98%af%e4%b8%aa%e4%b8%8d%e9%94%99%e7%9a%84%e9%80%89%e6%8b%a9%ef%bc%8c%e5%8f%af%e4%bb%a5%e8%a7%86%e9%a2%91%e8%81%8a%e5%a4%a9%e3%80%81%e5%8d%b3%e6%97%b6%e8%81%8a%e5%a4%a9%e4%bb%a5%e5%8f%8a%e5%85%b6%e4%b8%8e%e5%88%ab%e4%ba%ba%e5%90%88%e4%bd%9c%e4%b8%80%e8%b5%b7%e5%9c%a8%e7%bd%91%e4%b8%8a%e8%ae%a8%e8%ae%ba%e9%97%ae%e9%a2%98%26hellip%3b%0a10.%e6%99%ba%e8%83%bd%e5%ae%b6%e5%b1%85%0a%e8%bf%99%e4%b9%9f%e6%98%af%e6%88%91%e4%b8%80%e6%af%95%e4%b8%9a%e5%8a%a0%e5%85%a5%e7%9a%84%e4%b8%80%e4%b8%aa%e4%bc%9f%e5%a4%a7%e7%9a%84%e7%89%a9%e8%81%94%e7%bd%91%e6%99%ba%e8%83%bd%e5%ae%b6%e5%b1%85%e7%9a%84%e5%85%ac%e5%8f%b8%e3%80%82%e8%80%83%e8%99%91%e5%88%b0%e5%ae%b6%e9%87%8c%e7%9a%84%e6%99%ba%e8%83%bd%e8%ae%be%e5%a4%87%e7%9a%84%e7%8a%b6%e6%80%81%e5%bf%85%e9%a1%bb%e9%9c%80%e8%a6%81%e5%ae%9e%e6%97%b6%e7%9a%84%e5%b1%95%e7%8e%b0%e5%9c%a8%e6%89%8b%e6%9c%baapp%e5%ae%a2%e6%88%b7%e7%ab%af%e4%b8%8a%ef%bc%8c%e6%af%ab%e6%97%a0%e7%96%91%e9%97%ae%e9%80%89%e6%8b%a9%e4%ba%86Websocket%e3%80%82%0a11.%e6%80%bb%e7%bb%93%0a%e4%bb%8e%e4%b8%8a%e9%9d%a2%e6%88%91%e5%88%97%e4%b8%be%e7%9a%84%e8%bf%99%e4%ba%9b%e5%9c%ba%e6%99%af%e6%9d%a5%e7%9c%8b%ef%bc%8c%e4%b8%80%e4%b8%aa%e5%85%b1%e5%90%8c%e7%82%b9%e5%b0%b1%e6%98%af%ef%bc%8c%e9%ab%98%e5%ae%9e%e6%97%b6%e6%80%a7%ef%bc%81%0a%23%23%23%23%23%e4%ba%8c.WebSocket%e8%af%9e%e7%94%9f%e7%94%b1%e6%9d%a5%201.%e6%9c%80%e5%bc%80%e5%a7%8b%e7%9a%84%e8%bd%ae%e8%af%a2Polling%e9%98%b6%e6%ae%b5%0a%e8%bf%99%e7%a7%8d%e6%96%b9%e5%bc%8f%e4%b8%8b%ef%bc%8c%e6%98%af%e4%b8%8d%e9%80%82%e5%90%88%e8%8e%b7%e5%8f%96%e5%ae%9e%e6%97%b6%e4%bf%a1%e6%81%af%e7%9a%84%ef%bc%8c%e5%ae%a2%e6%88%b7%e7%ab%af%e5%92%8c%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%b9%8b%e9%97%b4%e4%bc%9a%e4%b8%80%e7%9b%b4%e8%bf%9b%e8%a1%8c%e8%bf%9e%e6%8e%a5%ef%bc%8c%e6%af%8f%e9%9a%94%e4%b8%80%e6%ae%b5%e6%97%b6%e9%97%b4%e5%b0%b1%e8%af%a2%e9%97%ae%e4%b8%80%e6%ac%a1%e3%80%82%e5%ae%a2%e6%88%b7%e7%ab%af%e4%bc%9a%e8%bd%ae%e8%af%a2%ef%bc%8c%e6%9c%89%e6%b2%a1%e6%9c%89%e6%96%b0%e6%b6%88%e6%81%af%e3%80%82%e8%bf%99%e7%a7%8d%e6%96%b9%e5%bc%8f%e8%bf%9e%e6%8e%a5%e6%95%b0%e4%bc%9a%e5%be%88%e5%a4%9a%ef%bc%8c%e4%b8%80%e4%b8%aa%e6%8e%a5%e5%8f%97%ef%bc%8c%e4%b8%80%e4%b8%aa%e5%8f%91%e9%80%81%e3%80%82%e8%80%8c%e4%b8%94%e6%af%8f%e6%ac%a1%e5%8f%91%e9%80%81%e8%af%b7%e6%b1%82%e9%83%bd%e4%bc%9a%e6%9c%89Http%e7%9a%84Header%ef%bc%8c%e4%bc%9a%e5%be%88%e8%80%97%e6%b5%81%e9%87%8f%ef%bc%8c%e4%b9%9f%e4%bc%9a%e6%b6%88%e8%80%97CPU%e7%9a%84%e5%88%a9%e7%94%a8%e7%8e%87%e3%80%82%0a2.%e6%94%b9%e8%bf%9b%e7%89%88%e7%9a%84%e9%95%bf%e8%bd%ae%e8%af%a2Long%20polling%e9%98%b6%e6%ae%b5%0a%e9%95%bf%e8%bd%ae%e8%af%a2%e6%98%af%e5%af%b9%e8%bd%ae%e8%af%a2%e7%9a%84%e6%94%b9%e8%bf%9b%e7%89%88%ef%bc%8c%e5%ae%a2%e6%88%b7%e7%ab%af%e5%8f%91%e9%80%81HTTP%e7%bb%99%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%b9%8b%e5%90%8e%ef%bc%8c%e6%9c%89%e6%b2%a1%e6%9c%89%e6%96%b0%e6%b6%88%e6%81%af%ef%bc%8c%e5%a6%82%e6%9e%9c%e6%b2%a1%e6%9c%89%e6%96%b0%e6%b6%88%e6%81%af%ef%bc%8c%e5%b0%b1%e4%b8%80%e7%9b%b4%e7%ad%89%e5%be%85%e3%80%82%e5%bd%93%e6%9c%89%e6%96%b0%e6%b6%88%e6%81%af%e7%9a%84%e6%97%b6%e5%80%99%ef%bc%8c%e6%89%8d%e4%bc%9a%e8%bf%94%e5%9b%9e%e7%bb%99%e5%ae%a2%e6%88%b7%e7%ab%af%e3%80%82%e5%9c%a8%e6%9f%90%e7%a7%8d%e7%a8%8b%e5%ba%a6%e4%b8%8a%e5%87%8f%e5%b0%8f%e4%ba%86%e7%bd%91%e7%bb%9c%e5%b8%a6%e5%ae%bd%e5%92%8cCPU%e5%88%a9%e7%94%a8%e7%8e%87%e7%ad%89%e9%97%ae%e9%a2%98%e3%80%82%e4%bd%86%e6%98%af%e8%bf%99%e7%a7%8d%e6%96%b9%e5%bc%8f%e8%bf%98%e6%98%af%e6%9c%89%e4%b8%80%e7%a7%8d%e5%bc%8a%e7%ab%af%ef%bc%9a%e4%be%8b%e5%a6%82%e5%81%87%e8%ae%be%e6%9c%8d%e5%8a%a1%e5%99%a8%e7%ab%af%e7%9a%84%e6%95%b0%e6%8d%ae%e6%9b%b4%e6%96%b0%e9%80%9f%e5%ba%a6%e5%be%88%e5%bf%ab%ef%bc%8c%e6%9c%8d%e5%8a%a1%e5%99%a8%e5%9c%a8%e4%bc%a0%e9%80%81%e4%b8%80%e4%b8%aa%e6%95%b0%e6%8d%ae%e5%8c%85%e7%bb%99%e5%ae%a2%e6%88%b7%e7%ab%af%e5%90%8e%e5%bf%85%e9%a1%bb%e7%ad%89%e5%be%85%e5%ae%a2%e6%88%b7%e7%ab%af%e7%9a%84%e4%b8%8b%e4%b8%80%e4%b8%aaGet%e8%af%b7%e6%b1%82%e5%88%b0%e6%9d%a5%ef%bc%8c%e6%89%8d%e8%83%bd%e4%bc%a0%e9%80%92%e7%ac%ac%e4%ba%8c%e4%b8%aa%e6%9b%b4%e6%96%b0%e7%9a%84%e6%95%b0%e6%8d%ae%e5%8c%85%e7%bb%99%e5%ae%a2%e6%88%b7%e7%ab%af%ef%bc%8c%e9%82%a3%e4%b9%88%e8%bf%99%e6%a0%b7%e7%9a%84%e8%af%9d%ef%bc%8c%e5%ae%a2%e6%88%b7%e7%ab%af%e6%98%be%e7%a4%ba%e5%ae%9e%e6%97%b6%e6%95%b0%e6%8d%ae%e6%9c%80%e5%bf%ab%e7%9a%84%e6%97%b6%e9%97%b4%e4%b8%ba2%c3%97RTT%ef%bc%88%e5%be%80%e8%bf%94%e6%97%b6%e9%97%b4%ef%bc%89%ef%bc%8c%e8%80%8c%e4%b8%94%e5%a6%82%e6%9e%9c%e5%9c%a8%e7%bd%91%e7%bb%9c%e6%8b%a5%e5%a1%9e%e7%9a%84%e6%83%85%e5%86%b5%e4%b8%8b%ef%bc%8c%e8%bf%99%e4%b8%aa%e6%97%b6%e9%97%b4%e7%94%a8%e6%88%b7%e6%98%af%e4%b8%8d%e8%83%bd%e6%8e%a5%e5%8f%97%e7%9a%84%ef%bc%8c%e6%af%94%e5%a6%82%e5%9c%a8%e8%82%a1%e5%b8%82%e7%9a%84%e7%9a%84%e6%8a%a5%e4%bb%b7%e4%b8%8a%e3%80%82%e5%8f%a6%e5%a4%96%ef%bc%8c%e7%94%b1%e4%ba%8ehttp%e6%95%b0%e6%8d%ae%e5%8c%85%e7%9a%84%e5%a4%b4%e9%83%a8%e6%95%b0%e6%8d%ae%e9%87%8f%e5%be%80%e5%be%80%e5%be%88%e5%a4%a7%ef%bc%88%e9%80%9a%e5%b8%b8%e6%9c%89400%e5%a4%9a%e4%b8%aa%e5%ad%97%e8%8a%82%ef%bc%89%ef%bc%8c%e4%bd%86%e6%98%af%e7%9c%9f%e6%ad%a3%e8%a2%ab%e6%9c%8d%e5%8a%a1%e5%99%a8%e9%9c%80%e8%a6%81%e7%9a%84%e6%95%b0%e6%8d%ae%e5%8d%b4%e5%be%88%e5%b0%91%ef%bc%88%e6%9c%89%e6%97%b6%e5%8f%aa%e6%9c%8910%e4%b8%aa%e5%ad%97%e8%8a%82%e5%b7%a6%e5%8f%b3%ef%bc%89%ef%bc%8c%e8%bf%99%e6%a0%b7%e7%9a%84%e6%95%b0%e6%8d%ae%e5%8c%85%e5%9c%a8%e7%bd%91%e7%bb%9c%e4%b8%8a%e5%91%a8%e6%9c%9f%e6%80%a7%e7%9a%84%e4%bc%a0%e8%be%93%ef%bc%8c%e9%9a%be%e5%85%8d%e5%af%b9%e7%bd%91%e7%bb%9c%e5%b8%a6%e5%ae%bd%e6%98%af%e4%b8%80%e7%a7%8d%e6%b5%aa%e8%b4%b9%e3%80%82%0a3.WebSocket%e8%af%9e%e7%94%9f%0a%e7%8e%b0%e5%9c%a8%e6%80%a5%e9%9c%80%e7%9a%84%e9%9c%80%e6%b1%82%e6%98%af%e8%83%bd%e6%94%af%e6%8c%81%e5%ae%a2%e6%88%b7%e7%ab%af%e5%92%8c%e6%9c%8d%e5%8a%a1%e5%99%a8%e7%ab%af%e7%9a%84%e5%8f%8c%e5%90%91%e9%80%9a%e4%bf%a1%ef%bc%8c%e8%80%8c%e4%b8%94%e5%8d%8f%e8%ae%ae%e7%9a%84%e5%a4%b4%e9%83%a8%e5%8f%88%e6%b2%a1%e6%9c%89HTTP%e7%9a%84Header%e9%82%a3%e4%b9%88%e5%a4%a7%ef%bc%8c%e4%ba%8e%e6%98%af%ef%bc%8cWebsocket%e5%b0%b1%e8%af%9e%e7%94%9f%e4%ba%86%ef%bc%81%0a%e4%b8%8a%e5%9b%be%e5%b0%b1%e6%98%afWebsocket%e5%92%8cPolling%e7%9a%84%e5%8c%ba%e5%88%ab%ef%bc%8c%e4%bb%8e%e5%9b%be%e4%b8%ad%e5%8f%af%e4%bb%a5%e7%9c%8b%e5%88%b0Polling%e9%87%8c%e9%9d%a2%e5%ae%a2%e6%88%b7%e7%ab%af%e5%8f%91%e9%80%81%e4%ba%86%e5%a5%bd%e5%a4%9aRequest%ef%bc%8c%e8%80%8c%e4%b8%8b%e5%9b%be%ef%bc%8c%e5%8f%aa%e6%9c%89%e4%b8%80%e4%b8%aaUpgrade%ef%bc%8c%e9%9d%9e%e5%b8%b8%e7%ae%80%e6%b4%81%e9%ab%98%e6%95%88%e3%80%82%e8%87%b3%e4%ba%8e%e6%b6%88%e8%80%97%e6%96%b9%e9%9d%a2%e7%9a%84%e6%af%94%e8%be%83%e5%b0%b1%e8%a6%81%e7%9c%8b%e4%b8%8b%e5%9b%be%e4%ba%86%0a%e4%b8%8a%e5%9b%be%e4%b8%ad%ef%bc%8c%e6%88%91%e4%bb%ac%e5%85%88%e7%9c%8b%e8%93%9d%e8%89%b2%e7%9a%84%e6%9f%b1%e7%8a%b6%e5%9b%be%ef%bc%8c%e6%98%afPolling%e8%bd%ae%e8%af%a2%e6%b6%88%e8%80%97%e7%9a%84%e6%b5%81%e9%87%8f%ef%bc%8c%e8%bf%99%e6%ac%a1%e6%b5%8b%e8%af%95%ef%bc%8cHTTP%e8%af%b7%e6%b1%82%e5%92%8c%e5%93%8d%e5%ba%94%e5%a4%b4%e4%bf%a1%e6%81%af%e5%bc%80%e9%94%80%e6%80%bb%e5%85%b1%e5%8c%85%e6%8b%ac871%e5%ad%97%e8%8a%82%e3%80%82%e5%bd%93%e7%84%b6%e6%af%8f%e6%ac%a1%e6%b5%8b%e8%af%95%e4%b8%8d%e5%90%8c%e7%9a%84%e8%af%b7%e6%b1%82%ef%bc%8c%e5%a4%b4%e7%9a%84%e5%bc%80%e9%94%80%e4%b8%8d%e5%90%8c%e3%80%82%e8%bf%99%e6%ac%a1%e6%b5%8b%e8%af%95%e9%83%bd%e4%bb%a5871%e5%ad%97%e8%8a%82%e7%9a%84%e8%af%b7%e6%b1%82%e6%9d%a5%e6%b5%8b%e8%af%95%e3%80%82%0a%2a%2aUse%20case%20A%3a%2a%2a1%2c000%20clients%20polling%20every%20second%3a%20Network%20throughput%20is%20%28871%20x%201%2c000%29%20%3d%20871%2c000%20bytes%20%3d%206%2c968%2c000%20bits%20per%20second%20%286.6%20Mbps%29%0aUse%20case%20B%3a%2010%2c000%20clients%20polling%20every%20second%3a%20Network%20throughput%20is%20%28871%20x%2010%2c000%29%20%3d%208%2c710%2c000%20bytes%20%3d%2069%2c680%2c000%20bits%20per%20second%20%2866%20Mbps%29"><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fnew.halfrost.com%2fios_weixin_qq_websocket%2f&t=%e5%be%ae%e4%bf%a1%2cQQ%20%e8%bf%99%e7%b1%bb%20IM%20app%20%e6%80%8e%e4%b9%88%e5%81%9a%e2%80%94%e2%80%94%e8%b0%88%e8%b0%88%20Websocket"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div><div id=toc><nav id=TableOfContents></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">微信,QQ 这类 IM app 怎么做——谈谈 Websocket</h1><div class=meta><div class=postdate><time datetime="2016-05-15 02:55:00 +0000 UTC" itemprop=datePublished>May 15</time></div><div class=article-category><i class="fas fa-archive"></i><a class=category-link href=/categories/ios>iOS</a>
,
<a class=category-link href=/categories/%E5%BE%AE%E4%BF%A1>微信</a>
,
<a class=category-link href=/categories/qq>QQ</a>
,
<a class=category-link href=/categories/%E8%81%8A%E5%A4%A9>聊天</a>
,
<a class=category-link href=/categories/im>IM</a>
,
<a class=category-link href=/categories/websocket>Websocket</a>
,
<a class=category-link href=/categories/socket>Socket</a></div><div class=article-tag><i class="fas fa-tag"></i><a class=tag-link href=/tags/ios rel=tag>iOS</a>
,
<a class=tag-link href=/tags/%E5%BE%AE%E4%BF%A1 rel=tag>微信</a>
,
<a class=tag-link href=/tags/qq rel=tag>QQ</a>
,
<a class=tag-link href=/tags/%E8%81%8A%E5%A4%A9 rel=tag>聊天</a>
,
<a class=tag-link href=/tags/im rel=tag>IM</a>
,
<a class=tag-link href=/tags/websocket rel=tag>Websocket</a>
,
<a class=tag-link href=/tags/socket rel=tag>Socket</a></div></div></header><div class=content itemprop=articleBody><p>####前言
关于我和WebSocket的缘：我从大二在计算机网络课上听老师讲过之后，第一次使用就到了毕业之后的第一份工作。直到最近换了工作，到了一家是含有IM社交聊天功能的app的时候，我觉得我现在可以谈谈我对WebSocket/Socket的一些看法了。要想做IM聊天app，就不得不理解WebSocket和Socket的原理了，听我一一道来。</p><p>####目录</p><ul><li>1.WebSocket使用场景</li><li>2.WebSocket诞生由来</li><li>3.谈谈WebSocket协议原理</li><li>4.WebSocket 和 Socket的区别与联系</li><li>5.iOS平台有哪些WebSocket和Socket的开源框架</li><li>6.iOS平台如何实现WebSocket协议</li></ul><p>#####一.WebSocket的使用场景
<strong>1.社交聊天</strong><br>最著名的就是微信，QQ，这一类社交聊天的app。这一类聊天app的特点是低延迟，高即时。即时是这里面要求最高的，如果有一个紧急的事情，通过IM软件通知你，假设网络环境良好的情况下，这条message还无法立即送达到你的客户端上，紧急的事情都结束了，你才收到消息，那么这个软件肯定是失败的。<br><strong>2.弹幕</strong><br>说到这里，大家一定里面想到了A站和B站了。确实，他们的弹幕一直是一种特色。而且弹幕对于一个视频来说，很可能弹幕才是精华。发弹幕需要实时显示，也需要和聊天一样，需要即时。<br><strong>3.多玩家游戏</strong><br><strong>4.协同编辑</strong><br>现在很多开源项目都是分散在世界各地的开发者一起协同开发，此时就会用到版本控制系统，比如Git，SVN去合并冲突。但是如果有一份文档，支持多人实时在线协同编辑，那么此时就会用到比如WebSocket了，它可以保证各个编辑者都在编辑同一个文档，此时不需要用到Git，SVN这些版本控制，因为在协同编辑界面就会实时看到对方编辑了什么，谁在修改哪些段落和文字。<br><strong>5.股票基金实时报价</strong><br>金融界瞬息万变——几乎是每毫秒都在变化。如果采用的网络架构无法满足实时性，那么就会给客户带来巨大的损失。几毫秒钱股票开始大跌，几秒以后才刷新数据，一秒钟的时间内，很可能用户就已经损失巨大财产了。<br><strong>6.体育实况更新</strong><br>全世界的球迷，体育爱好者特别多，当然大家在关心自己喜欢的体育活动的时候，比赛实时的赛况是他们最最关心的事情。这类新闻中最好的体验就是利用Websocket达到实时的更新！<br><strong>7.视频会议/聊天</strong><br>视频会议并不能代替和真人相见，但是他能让分布在全球天涯海角的人聚在电脑前一起开会。既能节省大家聚在一起路上花费的时间，讨论聚会地点的纠结，还能随时随地，只要有网络就可以开会。<br><strong>8.基于位置的应用</strong><br>越来越多的开发者借用移动设备的GPS功能来实现他们基于位置的网络应用。如果你一直记录用户的位置(比如运行应用来记录运动轨迹)，你可以收集到更加细致化的数据。<br><strong>9.在线教育</strong><br>在线教育近几年也发展迅速。优点很多，免去了场地的限制，能让名师的资源合理的分配给全国各地想要学习知识的同学手上，Websocket是个不错的选择，可以视频聊天、即时聊天以及其与别人合作一起在网上讨论问题&mldr;<br><strong>10.智能家居</strong><br>这也是我一毕业加入的一个伟大的物联网智能家居的公司。考虑到家里的智能设备的状态必须需要实时的展现在手机app客户端上，毫无疑问选择了Websocket。<br><strong>11.总结</strong><br>从上面我列举的这些场景来看，一个共同点就是，高实时性！</p><p>#####二.WebSocket诞生由来
1.<strong>最开始的轮询Polling阶段</strong></p><p><img src=https://img.halfrost.com/Blog/ArticleImage/8_2.png alt></p><p>这种方式下，是不适合获取实时信息的，客户端和服务器之间会一直进行连接，每隔一段时间就询问一次。客户端会轮询，有没有新消息。这种方式连接数会很多，一个接受，一个发送。而且每次发送请求都会有Http的Header，会很耗流量，也会消耗CPU的利用率。</p><p>2.<strong>改进版的长轮询Long polling阶段</strong></p><p><img src=https://img.halfrost.com/Blog/ArticleImage/8_3.png alt></p><p>长轮询是对轮询的改进版，客户端发送HTTP给服务器之后，有没有新消息，如果没有新消息，就一直等待。当有新消息的时候，才会返回给客户端。在某种程度上减小了网络带宽和CPU利用率等问题。但是这种方式还是有一种弊端：例如假设服务器端的数据更新速度很快，服务器在传送一个数据包给客户端后必须等待客户端的下一个Get请求到来，才能传递第二个更新的数据包给客户端，那么这样的话，客户端显示实时数据最快的时间为2×RTT（往返时间），而且如果在网络拥塞的情况下，这个时间用户是不能接受的，比如在股市的的报价上。另外，由于http数据包的头部数据量往往很大（通常有400多个字节），但是真正被服务器需要的数据却很少（有时只有10个字节左右），这样的数据包在网络上周期性的传输，难免对网络带宽是一种浪费。</p><p>3.<strong>WebSocket诞生</strong></p><p>现在急需的需求是能支持客户端和服务器端的双向通信，而且协议的头部又没有HTTP的Header那么大，于是，Websocket就诞生了！</p><p><img src=https://img.halfrost.com/Blog/ArticleImage/8_4.png alt></p><p>上图就是Websocket和Polling的区别，从图中可以看到Polling里面客户端发送了好多Request，而下图，只有一个Upgrade，非常简洁高效。至于消耗方面的比较就要看下图了</p><p><img src=https://img.halfrost.com/Blog/ArticleImage/8_5.png alt></p><p>上图中，我们先看蓝色的柱状图，是Polling轮询消耗的流量，这次测试，HTTP请求和响应头信息开销总共包括871字节。当然每次测试不同的请求，头的开销不同。这次测试都以871字节的请求来测试。</p><p>**Use case A:**1,000 clients polling every second: Network throughput is (871 x 1,000) = 871,000 bytes = 6,968,000 bits per second (6.6 Mbps)</p><p><strong>Use case B:</strong> 10,000 clients polling every second: Network throughput is (871 x 10,000) = 8,710,000 bytes = 69,680,000 bits per second (66 Mbps)</p><p>**Use case C:**100,000 clients polling every 1 second: Network throughput is (871 x 100,000) = 87,100,000 bytes = 696,800,000 bits per second (665 Mbps)<br>而Websocket的Frame是 just two bytes of overhead instead of 871，仅仅用2个字节就代替了轮询的871字节！</p><p>**Use case A:**1,000 clients receive 1 message per second: Network throughput is (2 x 1,000) = 2,000 bytes = 16,000 bits per second (0.015 Mbps)</p><p>**Use case B:**10,000 clients receive 1 message per second: Network throughput is (2 x 10,000) = 20,000 bytes = 160,000 bits per second (0.153 Mbps)</p><p>**Use case C:**100,000 clients receive 1 message per second: Network throughput is (2 x 100,000) = 200,000 bytes = 1,600,000 bits per second (1.526 Mbps)</p><p>相同的每秒客户端轮询的次数，当次数高达10W/s的高频率次数的时候，Polling轮询需要消耗665Mbps，而Websocket仅仅只花费了1.526Mbps，将近435倍！！</p><p>#####三.谈谈WebSocket协议原理
Websocket是应用层第七层上的一个应用层协议，它必须依赖 <a href=http://tools.ietf.org/html/rfc6455#section-4>HTTP 协议进行一次握手</a> ，握手成功后，数据就直接从 TCP 通道传输，与 HTTP 无关了。</p><p>Websocket的数据传输是frame形式传输的，比如会将一条消息分为几个frame，按照先后顺序传输出去。这样做会有几个好处：</p><p>1 大数据的传输可以分片传输，不用考虑到数据大小导致的长度标志位不足够的情况。
2 和http的chunk一样，可以边生成数据边传递消息，即提高传输效率。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c> <span style=color:#ae81ff>0</span>                   <span style=color:#ae81ff>1</span>                   <span style=color:#ae81ff>2</span>                   <span style=color:#ae81ff>3</span>
 <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>5</span> <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>7</span> <span style=color:#ae81ff>8</span> <span style=color:#ae81ff>9</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>5</span> <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>7</span> <span style=color:#ae81ff>8</span> <span style=color:#ae81ff>9</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>5</span> <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>7</span> <span style=color:#ae81ff>8</span> <span style=color:#ae81ff>9</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>1</span>
 <span style=color:#f92672>+-+-+-+-+-------+-+-------------+-------------------------------+</span>
 <span style=color:#f92672>|</span>F<span style=color:#f92672>|</span>R<span style=color:#f92672>|</span>R<span style=color:#f92672>|</span>R<span style=color:#f92672>|</span> opcode<span style=color:#f92672>|</span>M<span style=color:#f92672>|</span> Payload len <span style=color:#f92672>|</span>    Extended payload length    <span style=color:#f92672>|</span>
 <span style=color:#f92672>|</span>I<span style=color:#f92672>|</span>S<span style=color:#f92672>|</span>S<span style=color:#f92672>|</span>S<span style=color:#f92672>|</span>  (<span style=color:#ae81ff>4</span>)  <span style=color:#f92672>|</span>A<span style=color:#f92672>|</span>     (<span style=color:#ae81ff>7</span>)     <span style=color:#f92672>|</span>             (<span style=color:#ae81ff>16</span><span style=color:#f92672>/</span><span style=color:#ae81ff>64</span>)           <span style=color:#f92672>|</span>
 <span style=color:#f92672>|</span>N<span style=color:#f92672>|</span>V<span style=color:#f92672>|</span>V<span style=color:#f92672>|</span>V<span style=color:#f92672>|</span>       <span style=color:#f92672>|</span>S<span style=color:#f92672>|</span>             <span style=color:#f92672>|</span>   (<span style=color:#66d9ef>if</span> payload len<span style=color:#f92672>==</span><span style=color:#ae81ff>126</span><span style=color:#f92672>/</span><span style=color:#ae81ff>127</span>)   <span style=color:#f92672>|</span>
 <span style=color:#f92672>|</span> <span style=color:#f92672>|</span><span style=color:#ae81ff>1</span><span style=color:#f92672>|</span><span style=color:#ae81ff>2</span><span style=color:#f92672>|</span><span style=color:#ae81ff>3</span><span style=color:#f92672>|</span>       <span style=color:#f92672>|</span>K<span style=color:#f92672>|</span>             <span style=color:#f92672>|</span>                               <span style=color:#f92672>|</span>
 <span style=color:#f92672>+-+-+-+-+-------+-+-------------+</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>+</span>
 <span style=color:#f92672>|</span>     Extended payload length continued, <span style=color:#66d9ef>if</span> payload len <span style=color:#f92672>==</span> <span style=color:#ae81ff>127</span>  <span style=color:#f92672>|</span>
 <span style=color:#f92672>+</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>+-------------------------------+</span>
 <span style=color:#f92672>|</span>                               <span style=color:#f92672>|</span>Masking<span style=color:#f92672>-</span>key, <span style=color:#66d9ef>if</span> MASK set to <span style=color:#ae81ff>1</span>  <span style=color:#f92672>|</span>
 <span style=color:#f92672>+-------------------------------+-------------------------------+</span>
 <span style=color:#f92672>|</span> Masking<span style=color:#f92672>-</span>key (continued)       <span style=color:#f92672>|</span>          Payload Data         <span style=color:#f92672>|</span>
 <span style=color:#f92672>+--------------------------------</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>+</span>
 <span style=color:#f92672>:</span>                     Payload Data continued ...                <span style=color:#f92672>:</span>
 <span style=color:#f92672>+</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>-</span> <span style=color:#f92672>+</span>
 <span style=color:#f92672>|</span>                     Payload Data continued ...                <span style=color:#f92672>|</span>
 <span style=color:#f92672>+---------------------------------------------------------------+</span>



    FIN      <span style=color:#ae81ff>1</span>bit <span style=color:#960050;background-color:#1e0010>表示信息的最后一帧，</span>flag<span style=color:#960050;background-color:#1e0010>，也就是标记符</span>
    RSV <span style=color:#ae81ff>1</span><span style=color:#f92672>-</span><span style=color:#ae81ff>3</span>  <span style=color:#ae81ff>1</span>bit each <span style=color:#960050;background-color:#1e0010>以后备用的</span> <span style=color:#960050;background-color:#1e0010>默认都为</span> <span style=color:#ae81ff>0</span>
    Opcode   <span style=color:#ae81ff>4</span>bit <span style=color:#960050;background-color:#1e0010>帧类型，稍后细说</span>
    Mask     <span style=color:#ae81ff>1</span>bit <span style=color:#960050;background-color:#1e0010>掩码，是否加密数据，默认必须置为</span><span style=color:#ae81ff>1</span> <span style=color:#960050;background-color:#1e0010>（这里很蛋疼）</span>
    Payload  <span style=color:#ae81ff>7</span>bit <span style=color:#960050;background-color:#1e0010>数据的长度</span>
    Masking<span style=color:#f92672>-</span>key      <span style=color:#ae81ff>1</span> or <span style=color:#ae81ff>4</span> bit <span style=color:#960050;background-color:#1e0010>掩码</span>
    Payload data     (x <span style=color:#f92672>+</span> y) bytes <span style=color:#960050;background-color:#1e0010>数据</span>
    Extension data   x bytes  <span style=color:#960050;background-color:#1e0010>扩展数据</span>
    Application data y bytes  <span style=color:#960050;background-color:#1e0010>程序数据</span>
</code></pre></div><p>具体的规范，还请看官网的<a href=https://tools.ietf.org/html/rfc6455>RFC 6455</a>文档给出的详细定义。这里还有一个<a href=https://www.gitbook.com/book/chenjianlong/rfc-6455-websocket-protocol-in-chinese/details>翻译版本</a></p><p>#####四.WebSocket 和 Socket的区别与联系
首先，<br><a href=http://en.wikipedia.org/wiki/Network_socket>Socket</a> 其实并不是一个协议。它工作在 OSI 模型会话层（第5层），是为了方便大家直接使用更底层协议（一般是 <a href=http://en.wikipedia.org/wiki/Transmission_Control_Protocol>TCP</a> 或 <a href=http://en.wikipedia.org/wiki/User_Datagram_Protocol>UDP</a> ）而存在的一个抽象层。Socket是对TCP/IP协议的封装，Socket本身并不是协议，而是一个调用接口(API)。</p><p><img src=https://img.halfrost.com/Blog/ArticleImage/8_6.png alt></p><p>Socket通常也称作”套接字”，用于描述IP地址和端口，是一个通信链的句柄。网络上的两个程序通过一个双向的通讯连接实现数据的交换，这个双向链路的一端称为一个Socket，一个Socket由一个IP地址和一个端口号唯一确定。应用程序通常通过”套接字”向网络发出请求或者应答网络请求。</p><p>Socket在通讯过程中，服务端监听某个端口是否有连接请求，客户端向服务端发送连接请求，服务端收到连接请求向客户端发出接收消息，这样一个连接就建立起来了。客户端和服务端也都可以相互发送消息与对方进行通讯，直到双方连接断开。</p><p>所以基于WebSocket和基于Socket都可以开发出IM社交聊天类的app</p><p>#####五.iOS平台有哪些WebSocket和Socket的开源框架
Socket开源框架有：<a href=https://github.com/robbiehanson/CocoaAsyncSocket>CocoaAsync<em>Socket</em></a>，<a href=https://github.com/socketio/socket.io-client-swift>socketio/<em>socket</em>.io-client-swift</a>
WebSocket开源框架有:<a href=https://github.com/facebook/SocketRocket>facebook/<em>Socket</em>Rocket</a>，<a href=https://github.com/tidwall/SwiftWebSocket>tidwall/SwiftWeb<em>Socket</em></a></p><p>#####六.iOS平台如何实现WebSocket协议</p><blockquote><p>Talk is cheap。Show me the code ——Linus Torvalds</p></blockquote><p>我们今天来看看<a href=https://github.com/facebook/SocketRocket>facebook/<em>Socket</em>Rocket</a>的实现方法<br>首先这是SRWebSocket定义的一些成员变量</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objectivec data-lang=objectivec>
<span style=color:#66d9ef>@property</span> (<span style=color:#66d9ef>nonatomic</span>, <span style=color:#66d9ef>weak</span>) <span style=color:#66d9ef>id</span> <span style=color:#f92672>&lt;</span>SRWebSocketDelegate<span style=color:#f92672>&gt;</span> delegate;
<span style=color:#75715e>/**
</span><span style=color:#75715e> A dispatch queue for scheduling the delegate calls. The queue doesn&#39;t need be a serial queue.
</span><span style=color:#75715e>
</span><span style=color:#75715e> If `nil` and `delegateOperationQueue` is `nil`, the socket uses main queue for performing all delegate method calls.
</span><span style=color:#75715e> */</span>
<span style=color:#66d9ef>@property</span> (<span style=color:#66d9ef>nonatomic</span>, <span style=color:#66d9ef>strong</span>) dispatch_queue_t delegateDispatchQueue;
<span style=color:#75715e>/**
</span><span style=color:#75715e> An operation queue for scheduling the delegate calls.
</span><span style=color:#75715e>
</span><span style=color:#75715e> If `nil` and `delegateOperationQueue` is `nil`, the socket uses main queue for performing all delegate method calls.
</span><span style=color:#75715e> */</span>
<span style=color:#66d9ef>@property</span> (<span style=color:#66d9ef>nonatomic</span>, <span style=color:#66d9ef>strong</span>) NSOperationQueue <span style=color:#f92672>*</span>delegateOperationQueue;
<span style=color:#66d9ef>@property</span> (<span style=color:#66d9ef>nonatomic</span>, <span style=color:#66d9ef>readonly</span>) SRReadyState readyState;
<span style=color:#66d9ef>@property</span> (<span style=color:#66d9ef>nonatomic</span>, <span style=color:#66d9ef>readonly</span>, <span style=color:#66d9ef>retain</span>) NSURL <span style=color:#f92672>*</span>url;
<span style=color:#66d9ef>@property</span> (<span style=color:#66d9ef>nonatomic</span>, <span style=color:#66d9ef>readonly</span>) CFHTTPMessageRef receivedHTTPHeaders;
<span style=color:#75715e>// Optional array of cookies (NSHTTPCookie objects) to apply to the connections
</span><span style=color:#75715e></span><span style=color:#66d9ef>@property</span> (<span style=color:#66d9ef>nonatomic</span>, <span style=color:#66d9ef>copy</span>) NSArray<span style=color:#f92672>&lt;</span>NSHTTPCookie <span style=color:#f92672>*&gt;</span> <span style=color:#f92672>*</span>requestCookies;

<span style=color:#75715e>// This returns the negotiated protocol.
</span><span style=color:#75715e>// It will be nil until after the handshake completes.
</span><span style=color:#75715e></span><span style=color:#66d9ef>@property</span> (<span style=color:#66d9ef>nonatomic</span>, <span style=color:#66d9ef>readonly</span>, <span style=color:#66d9ef>copy</span>) NSString <span style=color:#f92672>*</span>protocol;

</code></pre></div><p>下面这些是SRWebSocket的一些方法</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objectivec data-lang=objectivec>
<span style=color:#75715e>// Protocols should be an array of strings that turn into Sec-WebSocket-Protocol.
</span><span style=color:#75715e></span>- (<span style=color:#66d9ef>instancetype</span>)<span style=color:#a6e22e>initWithURLRequest:</span>(NSURLRequest <span style=color:#f92672>*</span>)request;
- (<span style=color:#66d9ef>instancetype</span>)<span style=color:#a6e22e>initWithURLRequest:</span>(NSURLRequest <span style=color:#f92672>*</span>)request <span style=color:#a6e22e>protocols:</span>(NSArray<span style=color:#f92672>&lt;</span>NSString <span style=color:#f92672>*&gt;</span> <span style=color:#f92672>*</span>)protocols;
- (<span style=color:#66d9ef>instancetype</span>)<span style=color:#a6e22e>initWithURLRequest:</span>(NSURLRequest <span style=color:#f92672>*</span>)request <span style=color:#a6e22e>protocols:</span>(NSArray<span style=color:#f92672>&lt;</span>NSString <span style=color:#f92672>*&gt;</span> <span style=color:#f92672>*</span>)protocols <span style=color:#a6e22e>allowsUntrustedSSLCertificates:</span>(<span style=color:#66d9ef>BOOL</span>)allowsUntrustedSSLCertificates;

<span style=color:#75715e>// Some helper constructors.
</span><span style=color:#75715e></span>- (<span style=color:#66d9ef>instancetype</span>)<span style=color:#a6e22e>initWithURL:</span>(NSURL <span style=color:#f92672>*</span>)url;
- (<span style=color:#66d9ef>instancetype</span>)<span style=color:#a6e22e>initWithURL:</span>(NSURL <span style=color:#f92672>*</span>)url <span style=color:#a6e22e>protocols:</span>(NSArray<span style=color:#f92672>&lt;</span>NSString <span style=color:#f92672>*&gt;</span> <span style=color:#f92672>*</span>)protocols;
- (<span style=color:#66d9ef>instancetype</span>)<span style=color:#a6e22e>initWithURL:</span>(NSURL <span style=color:#f92672>*</span>)url <span style=color:#a6e22e>protocols:</span>(NSArray<span style=color:#f92672>&lt;</span>NSString <span style=color:#f92672>*&gt;</span> <span style=color:#f92672>*</span>)protocols <span style=color:#a6e22e>allowsUntrustedSSLCertificates:</span>(<span style=color:#66d9ef>BOOL</span>)allowsUntrustedSSLCertificates;

<span style=color:#75715e>// By default, it will schedule itself on +[NSRunLoop SR_networkRunLoop] using defaultModes.
</span><span style=color:#75715e></span>- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>scheduleInRunLoop:</span>(NSRunLoop <span style=color:#f92672>*</span>)aRunLoop <span style=color:#a6e22e>forMode:</span>(NSString <span style=color:#f92672>*</span>)mode;
- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>unscheduleFromRunLoop:</span>(NSRunLoop <span style=color:#f92672>*</span>)aRunLoop <span style=color:#a6e22e>forMode:</span>(NSString <span style=color:#f92672>*</span>)mode;

<span style=color:#75715e>// SRWebSockets are intended for one-time-use only.  Open should be called once and only once.
</span><span style=color:#75715e></span>- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>open</span>;
- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>close</span>;
- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>closeWithCode:</span>(NSInteger)code <span style=color:#a6e22e>reason:</span>(NSString <span style=color:#f92672>*</span>)reason;

<span style=color:#75715e>///--------------------------------------
</span><span style=color:#75715e></span><span style=color:#75715e>#pragma mark Send
</span><span style=color:#75715e></span><span style=color:#75715e>///--------------------------------------
</span><span style=color:#75715e></span>
<span style=color:#75715e>//下面是4个发送的方法
</span><span style=color:#75715e></span><span style=color:#75715e>/**
</span><span style=color:#75715e> Send a UTF-8 string or binary data to the server.
</span><span style=color:#75715e>
</span><span style=color:#75715e> @param message UTF-8 String or Data to send.
</span><span style=color:#75715e>
</span><span style=color:#75715e> @deprecated Please use `sendString:` or `sendData` instead.
</span><span style=color:#75715e> */</span>
- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>send:</span>(<span style=color:#66d9ef>id</span>)message __attribute__((deprecated(<span style=color:#e6db74>&#34;Please use `sendString:` or `sendData` instead.&#34;</span>)));
- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>sendString:</span>(NSString <span style=color:#f92672>*</span>)string;
- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>sendData:</span>(NSData <span style=color:#f92672>*</span>)data;
- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>sendPing:</span>(NSData <span style=color:#f92672>*</span>)data;

<span style=color:#66d9ef>@end</span>
</code></pre></div><p>对应5种状态的代理方法</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objectivec data-lang=objectivec><span style=color:#75715e>///--------------------------------------
</span><span style=color:#75715e></span><span style=color:#75715e>#pragma mark - SRWebSocketDelegate
</span><span style=color:#75715e></span><span style=color:#75715e>///--------------------------------------
</span><span style=color:#75715e></span><span style=color:#66d9ef>@protocol</span> <span style=color:#a6e22e>SRWebSocketDelegate</span> <span style=color:#f92672>&lt;</span>NSObject<span style=color:#f92672>&gt;</span>

<span style=color:#f92672>-</span> (<span style=color:#66d9ef>void</span>)webSocket:(SRWebSocket <span style=color:#f92672>*</span>)webSocket didReceiveMessage:(<span style=color:#66d9ef>id</span>)message;

<span style=color:#66d9ef>@optional</span>
<span style=color:#f92672>-</span> (<span style=color:#66d9ef>void</span>)webSocketDidOpen:(SRWebSocket <span style=color:#f92672>*</span>)webSocket;
- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>webSocket:</span>(SRWebSocket <span style=color:#f92672>*</span>)webSocket <span style=color:#a6e22e>didFailWithError:</span>(NSError <span style=color:#f92672>*</span>)error;
- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>webSocket:</span>(SRWebSocket <span style=color:#f92672>*</span>)webSocket <span style=color:#a6e22e>didCloseWithCode:</span>(NSInteger)code <span style=color:#a6e22e>reason:</span>(NSString <span style=color:#f92672>*</span>)reason <span style=color:#a6e22e>wasClean:</span>(<span style=color:#66d9ef>BOOL</span>)wasClean;
- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>webSocket:</span>(SRWebSocket <span style=color:#f92672>*</span>)webSocket <span style=color:#a6e22e>didReceivePong:</span>(NSData <span style=color:#f92672>*</span>)pongPayload;

<span style=color:#75715e>// Return YES to convert messages sent as Text to an NSString. Return NO to skip NSData -&gt; NSString conversion for Text messages. Defaults to YES.
</span><span style=color:#75715e></span>- (<span style=color:#66d9ef>BOOL</span>)<span style=color:#a6e22e>webSocketShouldConvertTextFrameToString:</span>(SRWebSocket <span style=color:#f92672>*</span>)webSocket;
<span style=color:#66d9ef>@end</span>
</code></pre></div><p>didReceiveMessage方法是必须实现的，用来接收消息的。
下面4个did方法分别对应着Open，Fail，Close，ReceivePong不同状态的代理方法</p><p>方法就上面这些了，我们实际来看看代码怎么写</p><p>先是初始化Websocket连接，注意此处ws://或者wss://连接有且最多只能有一个，这个是Websocket协议规定的</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objectivec data-lang=objectivec>    self.ws <span style=color:#f92672>=</span> [[SRWebSocket alloc] initWithURLRequest:[NSURLRequest requestWithURL:[NSURL URLWithString:[NSString stringWithFormat:<span style=color:#e6db74>@&#34;%@://%@:%zd/ws&#34;</span>, serverProto, serverIP, serverPort]]]];
    self.ws.delegate <span style=color:#f92672>=</span> delegate;
    [self.ws open];
</code></pre></div><p>发送消息</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objectivec data-lang=objectivec>    [self.ws send:message];
</code></pre></div><p>接收消息以及其他3个代理方法</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objectivec data-lang=objectivec><span style=color:#75715e>//这个就是接受消息的代理方法了，这里接受服务器返回的数据，方法里面就应该写处理数据，存储数据的方法了。
</span><span style=color:#75715e></span>- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>webSocket:</span>(SRWebSocket <span style=color:#f92672>*</span>)webSocket <span style=color:#a6e22e>didReceiveMessage:</span>(<span style=color:#66d9ef>id</span>)message
{
    NSDictionary <span style=color:#f92672>*</span>data <span style=color:#f92672>=</span> [NetworkUtils decodeData:message];
    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>data)
        <span style=color:#66d9ef>return</span>;
}

<span style=color:#75715e>//这里是Websocket刚刚Open之后的代理方法。就想微信刚刚连接中，会显示连接中，当连接上了，就不显示连接中了，取消显示连接的方法就应该写在这里面
</span><span style=color:#75715e></span>- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>webSocketDidOpen:</span>(SRWebSocket <span style=color:#f92672>*</span>)webSocket
{
    <span style=color:#75715e>// Open = silent ping
</span><span style=color:#75715e></span>    [self.ws receivedPing];
}

<span style=color:#75715e>//这是关闭Websocket的代理方法
</span><span style=color:#75715e></span>- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>webSocket:</span>(SRWebSocket <span style=color:#f92672>*</span>)webSocket <span style=color:#a6e22e>didCloseWithCode:</span>(NSInteger)code <span style=color:#a6e22e>reason:</span>(NSString <span style=color:#f92672>*</span>)reason <span style=color:#a6e22e>wasClean:</span>(<span style=color:#66d9ef>BOOL</span>)wasClean
{
    [self failedConnection:NSLS(Disconnected)];
}

<span style=color:#75715e>//这里是连接Websocket失败的方法，这里面一般都会写重连的方法
</span><span style=color:#75715e></span>- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>webSocket:</span>(SRWebSocket <span style=color:#f92672>*</span>)webSocket <span style=color:#a6e22e>didFailWithError:</span>(NSError <span style=color:#f92672>*</span>)error
{
    [self failedConnection:NSLS(Disconnected)];
}
</code></pre></div><p>####最后
以上就是我想分享的一些关于Websocket的心得，文中如果有错误的地方，欢迎大家指点！一般没有微信QQ那么大用户量的app，用Websocket应该都可以完成IM社交聊天的任务。当用户达到亿级别，应该还有很多需要优化，优化性能各种的吧。</p><p>最后，微信和QQ的实现方法也许并不是只用Websocket和Socket这么简单，也许是他们自己开发的一套能支持这么大用户，大数据的，各方面也都优化都最优的方法。如果有开发和微信和QQ的大神看到这篇文章，可以留言说说看你们用什么方式实现的，也可以和我们一起分享，我们一起学习！我先谢谢大神们的指点了！</p><img src=https://img.halfrost.com/wechat-qr-code.png></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=https://books.halfrost.com/>Books</a></li><li><a href=https://github.com/halfrost/Halfrost-Field>Github</a></li><li><a href=https://halfrost.me/>About</a></li><li><a href=/index.xml>RSS</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents></nav></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fnew.halfrost.com%2fios_weixin_qq_websocket%2f"><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fnew.halfrost.com%2fios_weixin_qq_websocket%2f&text=%e5%be%ae%e4%bf%a1%2cQQ%20%e8%bf%99%e7%b1%bb%20IM%20app%20%e6%80%8e%e4%b9%88%e5%81%9a%e2%80%94%e2%80%94%e8%b0%88%e8%b0%88%20Websocket"><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fnew.halfrost.com%2fios_weixin_qq_websocket%2f&title=%e5%be%ae%e4%bf%a1%2cQQ%20%e8%bf%99%e7%b1%bb%20IM%20app%20%e6%80%8e%e4%b9%88%e5%81%9a%e2%80%94%e2%80%94%e8%b0%88%e8%b0%88%20Websocket"><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fnew.halfrost.com%2fios_weixin_qq_websocket%2f&is_video=false&description=%e5%be%ae%e4%bf%a1%2cQQ%20%e8%bf%99%e7%b1%bb%20IM%20app%20%e6%80%8e%e4%b9%88%e5%81%9a%e2%80%94%e2%80%94%e8%b0%88%e8%b0%88%20Websocket"><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=%e5%be%ae%e4%bf%a1%2cQQ%20%e8%bf%99%e7%b1%bb%20IM%20app%20%e6%80%8e%e4%b9%88%e5%81%9a%e2%80%94%e2%80%94%e8%b0%88%e8%b0%88%20Websocket&body=Check out this article: https%3a%2f%2fnew.halfrost.com%2fios_weixin_qq_websocket%2f"><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fnew.halfrost.com%2fios_weixin_qq_websocket%2f&title=%e5%be%ae%e4%bf%a1%2cQQ%20%e8%bf%99%e7%b1%bb%20IM%20app%20%e6%80%8e%e4%b9%88%e5%81%9a%e2%80%94%e2%80%94%e8%b0%88%e8%b0%88%20Websocket"><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fnew.halfrost.com%2fios_weixin_qq_websocket%2f&title=%e5%be%ae%e4%bf%a1%2cQQ%20%e8%bf%99%e7%b1%bb%20IM%20app%20%e6%80%8e%e4%b9%88%e5%81%9a%e2%80%94%e2%80%94%e8%b0%88%e8%b0%88%20Websocket"><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fnew.halfrost.com%2fios_weixin_qq_websocket%2f&title=%e5%be%ae%e4%bf%a1%2cQQ%20%e8%bf%99%e7%b1%bb%20IM%20app%20%e6%80%8e%e4%b9%88%e5%81%9a%e2%80%94%e2%80%94%e8%b0%88%e8%b0%88%20Websocket"><i class="fab fa-stumbleupon fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://digg.com/submit?url=https%3a%2f%2fnew.halfrost.com%2fios_weixin_qq_websocket%2f&title=%e5%be%ae%e4%bf%a1%2cQQ%20%e8%bf%99%e7%b1%bb%20IM%20app%20%e6%80%8e%e4%b9%88%e5%81%9a%e2%80%94%e2%80%94%e8%b0%88%e8%b0%88%20Websocket"><i class="fab fa-digg fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fnew.halfrost.com%2fios_weixin_qq_websocket%2f&name=%e5%be%ae%e4%bf%a1%2cQQ%20%e8%bf%99%e7%b1%bb%20IM%20app%20%e6%80%8e%e4%b9%88%e5%81%9a%e2%80%94%e2%80%94%e8%b0%88%e8%b0%88%20Websocket&description=%23%23%23%23%e5%89%8d%e8%a8%80%20%e5%85%b3%e4%ba%8e%e6%88%91%e5%92%8cWebSocket%e7%9a%84%e7%bc%98%ef%bc%9a%e6%88%91%e4%bb%8e%e5%a4%a7%e4%ba%8c%e5%9c%a8%e8%ae%a1%e7%ae%97%e6%9c%ba%e7%bd%91%e7%bb%9c%e8%af%be%e4%b8%8a%e5%90%ac%e8%80%81%e5%b8%88%e8%ae%b2%e8%bf%87%e4%b9%8b%e5%90%8e%ef%bc%8c%e7%ac%ac%e4%b8%80%e6%ac%a1%e4%bd%bf%e7%94%a8%e5%b0%b1%e5%88%b0%e4%ba%86%e6%af%95%e4%b8%9a%e4%b9%8b%e5%90%8e%e7%9a%84%e7%ac%ac%e4%b8%80%e4%bb%bd%e5%b7%a5%e4%bd%9c%e3%80%82%e7%9b%b4%e5%88%b0%e6%9c%80%e8%bf%91%e6%8d%a2%e4%ba%86%e5%b7%a5%e4%bd%9c%ef%bc%8c%e5%88%b0%e4%ba%86%e4%b8%80%e5%ae%b6%e6%98%af%e5%90%ab%e6%9c%89IM%e7%a4%be%e4%ba%a4%e8%81%8a%e5%a4%a9%e5%8a%9f%e8%83%bd%e7%9a%84app%e7%9a%84%e6%97%b6%e5%80%99%ef%bc%8c%e6%88%91%e8%a7%89%e5%be%97%e6%88%91%e7%8e%b0%e5%9c%a8%e5%8f%af%e4%bb%a5%e8%b0%88%e8%b0%88%e6%88%91%e5%af%b9WebSocket%2fSocket%e7%9a%84%e4%b8%80%e4%ba%9b%e7%9c%8b%e6%b3%95%e4%ba%86%e3%80%82%e8%a6%81%e6%83%b3%e5%81%9aIM%e8%81%8a%e5%a4%a9app%ef%bc%8c%e5%b0%b1%e4%b8%8d%e5%be%97%e4%b8%8d%e7%90%86%e8%a7%a3WebSocket%e5%92%8cSocket%e7%9a%84%e5%8e%9f%e7%90%86%e4%ba%86%ef%bc%8c%e5%90%ac%e6%88%91%e4%b8%80%e4%b8%80%e9%81%93%e6%9d%a5%e3%80%82%0a%23%23%23%23%e7%9b%ae%e5%bd%95%0a%201.WebSocket%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af%202.WebSocket%e8%af%9e%e7%94%9f%e7%94%b1%e6%9d%a5%203.%e8%b0%88%e8%b0%88WebSocket%e5%8d%8f%e8%ae%ae%e5%8e%9f%e7%90%86%204.WebSocket%20%e5%92%8c%20Socket%e7%9a%84%e5%8c%ba%e5%88%ab%e4%b8%8e%e8%81%94%e7%b3%bb%205.iOS%e5%b9%b3%e5%8f%b0%e6%9c%89%e5%93%aa%e4%ba%9bWebSocket%e5%92%8cSocket%e7%9a%84%e5%bc%80%e6%ba%90%e6%a1%86%e6%9e%b6%206.iOS%e5%b9%b3%e5%8f%b0%e5%a6%82%e4%bd%95%e5%ae%9e%e7%8e%b0WebSocket%e5%8d%8f%e8%ae%ae%20%20%23%23%23%23%23%e4%b8%80.WebSocket%e7%9a%84%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af%201.%e7%a4%be%e4%ba%a4%e8%81%8a%e5%a4%a9%0a%e6%9c%80%e8%91%97%e5%90%8d%e7%9a%84%e5%b0%b1%e6%98%af%e5%be%ae%e4%bf%a1%ef%bc%8cQQ%ef%bc%8c%e8%bf%99%e4%b8%80%e7%b1%bb%e7%a4%be%e4%ba%a4%e8%81%8a%e5%a4%a9%e7%9a%84app%e3%80%82%e8%bf%99%e4%b8%80%e7%b1%bb%e8%81%8a%e5%a4%a9app%e7%9a%84%e7%89%b9%e7%82%b9%e6%98%af%e4%bd%8e%e5%bb%b6%e8%bf%9f%ef%bc%8c%e9%ab%98%e5%8d%b3%e6%97%b6%e3%80%82%e5%8d%b3%e6%97%b6%e6%98%af%e8%bf%99%e9%87%8c%e9%9d%a2%e8%a6%81%e6%b1%82%e6%9c%80%e9%ab%98%e7%9a%84%ef%bc%8c%e5%a6%82%e6%9e%9c%e6%9c%89%e4%b8%80%e4%b8%aa%e7%b4%a7%e6%80%a5%e7%9a%84%e4%ba%8b%e6%83%85%ef%bc%8c%e9%80%9a%e8%bf%87IM%e8%bd%af%e4%bb%b6%e9%80%9a%e7%9f%a5%e4%bd%a0%ef%bc%8c%e5%81%87%e8%ae%be%e7%bd%91%e7%bb%9c%e7%8e%af%e5%a2%83%e8%89%af%e5%a5%bd%e7%9a%84%e6%83%85%e5%86%b5%e4%b8%8b%ef%bc%8c%e8%bf%99%e6%9d%a1message%e8%bf%98%e6%97%a0%e6%b3%95%e7%ab%8b%e5%8d%b3%e9%80%81%e8%be%be%e5%88%b0%e4%bd%a0%e7%9a%84%e5%ae%a2%e6%88%b7%e7%ab%af%e4%b8%8a%ef%bc%8c%e7%b4%a7%e6%80%a5%e7%9a%84%e4%ba%8b%e6%83%85%e9%83%bd%e7%bb%93%e6%9d%9f%e4%ba%86%ef%bc%8c%e4%bd%a0%e6%89%8d%e6%94%b6%e5%88%b0%e6%b6%88%e6%81%af%ef%bc%8c%e9%82%a3%e4%b9%88%e8%bf%99%e4%b8%aa%e8%bd%af%e4%bb%b6%e8%82%af%e5%ae%9a%e6%98%af%e5%a4%b1%e8%b4%a5%e7%9a%84%e3%80%82%0a2.%e5%bc%b9%e5%b9%95%0a%e8%af%b4%e5%88%b0%e8%bf%99%e9%87%8c%ef%bc%8c%e5%a4%a7%e5%ae%b6%e4%b8%80%e5%ae%9a%e9%87%8c%e9%9d%a2%e6%83%b3%e5%88%b0%e4%ba%86A%e7%ab%99%e5%92%8cB%e7%ab%99%e4%ba%86%e3%80%82%e7%a1%ae%e5%ae%9e%ef%bc%8c%e4%bb%96%e4%bb%ac%e7%9a%84%e5%bc%b9%e5%b9%95%e4%b8%80%e7%9b%b4%e6%98%af%e4%b8%80%e7%a7%8d%e7%89%b9%e8%89%b2%e3%80%82%e8%80%8c%e4%b8%94%e5%bc%b9%e5%b9%95%e5%af%b9%e4%ba%8e%e4%b8%80%e4%b8%aa%e8%a7%86%e9%a2%91%e6%9d%a5%e8%af%b4%ef%bc%8c%e5%be%88%e5%8f%af%e8%83%bd%e5%bc%b9%e5%b9%95%e6%89%8d%e6%98%af%e7%b2%be%e5%8d%8e%e3%80%82%e5%8f%91%e5%bc%b9%e5%b9%95%e9%9c%80%e8%a6%81%e5%ae%9e%e6%97%b6%e6%98%be%e7%a4%ba%ef%bc%8c%e4%b9%9f%e9%9c%80%e8%a6%81%e5%92%8c%e8%81%8a%e5%a4%a9%e4%b8%80%e6%a0%b7%ef%bc%8c%e9%9c%80%e8%a6%81%e5%8d%b3%e6%97%b6%e3%80%82%0a3.%e5%a4%9a%e7%8e%a9%e5%ae%b6%e6%b8%b8%e6%88%8f%0a4.%e5%8d%8f%e5%90%8c%e7%bc%96%e8%be%91%0a%e7%8e%b0%e5%9c%a8%e5%be%88%e5%a4%9a%e5%bc%80%e6%ba%90%e9%a1%b9%e7%9b%ae%e9%83%bd%e6%98%af%e5%88%86%e6%95%a3%e5%9c%a8%e4%b8%96%e7%95%8c%e5%90%84%e5%9c%b0%e7%9a%84%e5%bc%80%e5%8f%91%e8%80%85%e4%b8%80%e8%b5%b7%e5%8d%8f%e5%90%8c%e5%bc%80%e5%8f%91%ef%bc%8c%e6%ad%a4%e6%97%b6%e5%b0%b1%e4%bc%9a%e7%94%a8%e5%88%b0%e7%89%88%e6%9c%ac%e6%8e%a7%e5%88%b6%e7%b3%bb%e7%bb%9f%ef%bc%8c%e6%af%94%e5%a6%82Git%ef%bc%8cSVN%e5%8e%bb%e5%90%88%e5%b9%b6%e5%86%b2%e7%aa%81%e3%80%82%e4%bd%86%e6%98%af%e5%a6%82%e6%9e%9c%e6%9c%89%e4%b8%80%e4%bb%bd%e6%96%87%e6%a1%a3%ef%bc%8c%e6%94%af%e6%8c%81%e5%a4%9a%e4%ba%ba%e5%ae%9e%e6%97%b6%e5%9c%a8%e7%ba%bf%e5%8d%8f%e5%90%8c%e7%bc%96%e8%be%91%ef%bc%8c%e9%82%a3%e4%b9%88%e6%ad%a4%e6%97%b6%e5%b0%b1%e4%bc%9a%e7%94%a8%e5%88%b0%e6%af%94%e5%a6%82WebSocket%e4%ba%86%ef%bc%8c%e5%ae%83%e5%8f%af%e4%bb%a5%e4%bf%9d%e8%af%81%e5%90%84%e4%b8%aa%e7%bc%96%e8%be%91%e8%80%85%e9%83%bd%e5%9c%a8%e7%bc%96%e8%be%91%e5%90%8c%e4%b8%80%e4%b8%aa%e6%96%87%e6%a1%a3%ef%bc%8c%e6%ad%a4%e6%97%b6%e4%b8%8d%e9%9c%80%e8%a6%81%e7%94%a8%e5%88%b0Git%ef%bc%8cSVN%e8%bf%99%e4%ba%9b%e7%89%88%e6%9c%ac%e6%8e%a7%e5%88%b6%ef%bc%8c%e5%9b%a0%e4%b8%ba%e5%9c%a8%e5%8d%8f%e5%90%8c%e7%bc%96%e8%be%91%e7%95%8c%e9%9d%a2%e5%b0%b1%e4%bc%9a%e5%ae%9e%e6%97%b6%e7%9c%8b%e5%88%b0%e5%af%b9%e6%96%b9%e7%bc%96%e8%be%91%e4%ba%86%e4%bb%80%e4%b9%88%ef%bc%8c%e8%b0%81%e5%9c%a8%e4%bf%ae%e6%94%b9%e5%93%aa%e4%ba%9b%e6%ae%b5%e8%90%bd%e5%92%8c%e6%96%87%e5%ad%97%e3%80%82%0a5.%e8%82%a1%e7%a5%a8%e5%9f%ba%e9%87%91%e5%ae%9e%e6%97%b6%e6%8a%a5%e4%bb%b7%0a%e9%87%91%e8%9e%8d%e7%95%8c%e7%9e%ac%e6%81%af%e4%b8%87%e5%8f%98%e2%80%94%e2%80%94%e5%87%a0%e4%b9%8e%e6%98%af%e6%af%8f%e6%af%ab%e7%a7%92%e9%83%bd%e5%9c%a8%e5%8f%98%e5%8c%96%e3%80%82%e5%a6%82%e6%9e%9c%e9%87%87%e7%94%a8%e7%9a%84%e7%bd%91%e7%bb%9c%e6%9e%b6%e6%9e%84%e6%97%a0%e6%b3%95%e6%bb%a1%e8%b6%b3%e5%ae%9e%e6%97%b6%e6%80%a7%ef%bc%8c%e9%82%a3%e4%b9%88%e5%b0%b1%e4%bc%9a%e7%bb%99%e5%ae%a2%e6%88%b7%e5%b8%a6%e6%9d%a5%e5%b7%a8%e5%a4%a7%e7%9a%84%e6%8d%9f%e5%a4%b1%e3%80%82%e5%87%a0%e6%af%ab%e7%a7%92%e9%92%b1%e8%82%a1%e7%a5%a8%e5%bc%80%e5%a7%8b%e5%a4%a7%e8%b7%8c%ef%bc%8c%e5%87%a0%e7%a7%92%e4%bb%a5%e5%90%8e%e6%89%8d%e5%88%b7%e6%96%b0%e6%95%b0%e6%8d%ae%ef%bc%8c%e4%b8%80%e7%a7%92%e9%92%9f%e7%9a%84%e6%97%b6%e9%97%b4%e5%86%85%ef%bc%8c%e5%be%88%e5%8f%af%e8%83%bd%e7%94%a8%e6%88%b7%e5%b0%b1%e5%b7%b2%e7%bb%8f%e6%8d%9f%e5%a4%b1%e5%b7%a8%e5%a4%a7%e8%b4%a2%e4%ba%a7%e4%ba%86%e3%80%82%0a6.%e4%bd%93%e8%82%b2%e5%ae%9e%e5%86%b5%e6%9b%b4%e6%96%b0%0a%e5%85%a8%e4%b8%96%e7%95%8c%e7%9a%84%e7%90%83%e8%bf%b7%ef%bc%8c%e4%bd%93%e8%82%b2%e7%88%b1%e5%a5%bd%e8%80%85%e7%89%b9%e5%88%ab%e5%a4%9a%ef%bc%8c%e5%bd%93%e7%84%b6%e5%a4%a7%e5%ae%b6%e5%9c%a8%e5%85%b3%e5%bf%83%e8%87%aa%e5%b7%b1%e5%96%9c%e6%ac%a2%e7%9a%84%e4%bd%93%e8%82%b2%e6%b4%bb%e5%8a%a8%e7%9a%84%e6%97%b6%e5%80%99%ef%bc%8c%e6%af%94%e8%b5%9b%e5%ae%9e%e6%97%b6%e7%9a%84%e8%b5%9b%e5%86%b5%e6%98%af%e4%bb%96%e4%bb%ac%e6%9c%80%e6%9c%80%e5%85%b3%e5%bf%83%e7%9a%84%e4%ba%8b%e6%83%85%e3%80%82%e8%bf%99%e7%b1%bb%e6%96%b0%e9%97%bb%e4%b8%ad%e6%9c%80%e5%a5%bd%e7%9a%84%e4%bd%93%e9%aa%8c%e5%b0%b1%e6%98%af%e5%88%a9%e7%94%a8Websocket%e8%be%be%e5%88%b0%e5%ae%9e%e6%97%b6%e7%9a%84%e6%9b%b4%e6%96%b0%ef%bc%81%0a7.%e8%a7%86%e9%a2%91%e4%bc%9a%e8%ae%ae%2f%e8%81%8a%e5%a4%a9%0a%e8%a7%86%e9%a2%91%e4%bc%9a%e8%ae%ae%e5%b9%b6%e4%b8%8d%e8%83%bd%e4%bb%a3%e6%9b%bf%e5%92%8c%e7%9c%9f%e4%ba%ba%e7%9b%b8%e8%a7%81%ef%bc%8c%e4%bd%86%e6%98%af%e4%bb%96%e8%83%bd%e8%ae%a9%e5%88%86%e5%b8%83%e5%9c%a8%e5%85%a8%e7%90%83%e5%a4%a9%e6%b6%af%e6%b5%b7%e8%a7%92%e7%9a%84%e4%ba%ba%e8%81%9a%e5%9c%a8%e7%94%b5%e8%84%91%e5%89%8d%e4%b8%80%e8%b5%b7%e5%bc%80%e4%bc%9a%e3%80%82%e6%97%a2%e8%83%bd%e8%8a%82%e7%9c%81%e5%a4%a7%e5%ae%b6%e8%81%9a%e5%9c%a8%e4%b8%80%e8%b5%b7%e8%b7%af%e4%b8%8a%e8%8a%b1%e8%b4%b9%e7%9a%84%e6%97%b6%e9%97%b4%ef%bc%8c%e8%ae%a8%e8%ae%ba%e8%81%9a%e4%bc%9a%e5%9c%b0%e7%82%b9%e7%9a%84%e7%ba%a0%e7%bb%93%ef%bc%8c%e8%bf%98%e8%83%bd%e9%9a%8f%e6%97%b6%e9%9a%8f%e5%9c%b0%ef%bc%8c%e5%8f%aa%e8%a6%81%e6%9c%89%e7%bd%91%e7%bb%9c%e5%b0%b1%e5%8f%af%e4%bb%a5%e5%bc%80%e4%bc%9a%e3%80%82%0a8.%e5%9f%ba%e4%ba%8e%e4%bd%8d%e7%bd%ae%e7%9a%84%e5%ba%94%e7%94%a8%0a%e8%b6%8a%e6%9d%a5%e8%b6%8a%e5%a4%9a%e7%9a%84%e5%bc%80%e5%8f%91%e8%80%85%e5%80%9f%e7%94%a8%e7%a7%bb%e5%8a%a8%e8%ae%be%e5%a4%87%e7%9a%84GPS%e5%8a%9f%e8%83%bd%e6%9d%a5%e5%ae%9e%e7%8e%b0%e4%bb%96%e4%bb%ac%e5%9f%ba%e4%ba%8e%e4%bd%8d%e7%bd%ae%e7%9a%84%e7%bd%91%e7%bb%9c%e5%ba%94%e7%94%a8%e3%80%82%e5%a6%82%e6%9e%9c%e4%bd%a0%e4%b8%80%e7%9b%b4%e8%ae%b0%e5%bd%95%e7%94%a8%e6%88%b7%e7%9a%84%e4%bd%8d%e7%bd%ae%28%e6%af%94%e5%a6%82%e8%bf%90%e8%a1%8c%e5%ba%94%e7%94%a8%e6%9d%a5%e8%ae%b0%e5%bd%95%e8%bf%90%e5%8a%a8%e8%bd%a8%e8%bf%b9%29%ef%bc%8c%e4%bd%a0%e5%8f%af%e4%bb%a5%e6%94%b6%e9%9b%86%e5%88%b0%e6%9b%b4%e5%8a%a0%e7%bb%86%e8%87%b4%e5%8c%96%e7%9a%84%e6%95%b0%e6%8d%ae%e3%80%82%0a9.%e5%9c%a8%e7%ba%bf%e6%95%99%e8%82%b2%0a%e5%9c%a8%e7%ba%bf%e6%95%99%e8%82%b2%e8%bf%91%e5%87%a0%e5%b9%b4%e4%b9%9f%e5%8f%91%e5%b1%95%e8%bf%85%e9%80%9f%e3%80%82%e4%bc%98%e7%82%b9%e5%be%88%e5%a4%9a%ef%bc%8c%e5%85%8d%e5%8e%bb%e4%ba%86%e5%9c%ba%e5%9c%b0%e7%9a%84%e9%99%90%e5%88%b6%ef%bc%8c%e8%83%bd%e8%ae%a9%e5%90%8d%e5%b8%88%e7%9a%84%e8%b5%84%e6%ba%90%e5%90%88%e7%90%86%e7%9a%84%e5%88%86%e9%85%8d%e7%bb%99%e5%85%a8%e5%9b%bd%e5%90%84%e5%9c%b0%e6%83%b3%e8%a6%81%e5%ad%a6%e4%b9%a0%e7%9f%a5%e8%af%86%e7%9a%84%e5%90%8c%e5%ad%a6%e6%89%8b%e4%b8%8a%ef%bc%8cWebsocket%e6%98%af%e4%b8%aa%e4%b8%8d%e9%94%99%e7%9a%84%e9%80%89%e6%8b%a9%ef%bc%8c%e5%8f%af%e4%bb%a5%e8%a7%86%e9%a2%91%e8%81%8a%e5%a4%a9%e3%80%81%e5%8d%b3%e6%97%b6%e8%81%8a%e5%a4%a9%e4%bb%a5%e5%8f%8a%e5%85%b6%e4%b8%8e%e5%88%ab%e4%ba%ba%e5%90%88%e4%bd%9c%e4%b8%80%e8%b5%b7%e5%9c%a8%e7%bd%91%e4%b8%8a%e8%ae%a8%e8%ae%ba%e9%97%ae%e9%a2%98%26hellip%3b%0a10.%e6%99%ba%e8%83%bd%e5%ae%b6%e5%b1%85%0a%e8%bf%99%e4%b9%9f%e6%98%af%e6%88%91%e4%b8%80%e6%af%95%e4%b8%9a%e5%8a%a0%e5%85%a5%e7%9a%84%e4%b8%80%e4%b8%aa%e4%bc%9f%e5%a4%a7%e7%9a%84%e7%89%a9%e8%81%94%e7%bd%91%e6%99%ba%e8%83%bd%e5%ae%b6%e5%b1%85%e7%9a%84%e5%85%ac%e5%8f%b8%e3%80%82%e8%80%83%e8%99%91%e5%88%b0%e5%ae%b6%e9%87%8c%e7%9a%84%e6%99%ba%e8%83%bd%e8%ae%be%e5%a4%87%e7%9a%84%e7%8a%b6%e6%80%81%e5%bf%85%e9%a1%bb%e9%9c%80%e8%a6%81%e5%ae%9e%e6%97%b6%e7%9a%84%e5%b1%95%e7%8e%b0%e5%9c%a8%e6%89%8b%e6%9c%baapp%e5%ae%a2%e6%88%b7%e7%ab%af%e4%b8%8a%ef%bc%8c%e6%af%ab%e6%97%a0%e7%96%91%e9%97%ae%e9%80%89%e6%8b%a9%e4%ba%86Websocket%e3%80%82%0a11.%e6%80%bb%e7%bb%93%0a%e4%bb%8e%e4%b8%8a%e9%9d%a2%e6%88%91%e5%88%97%e4%b8%be%e7%9a%84%e8%bf%99%e4%ba%9b%e5%9c%ba%e6%99%af%e6%9d%a5%e7%9c%8b%ef%bc%8c%e4%b8%80%e4%b8%aa%e5%85%b1%e5%90%8c%e7%82%b9%e5%b0%b1%e6%98%af%ef%bc%8c%e9%ab%98%e5%ae%9e%e6%97%b6%e6%80%a7%ef%bc%81%0a%23%23%23%23%23%e4%ba%8c.WebSocket%e8%af%9e%e7%94%9f%e7%94%b1%e6%9d%a5%201.%e6%9c%80%e5%bc%80%e5%a7%8b%e7%9a%84%e8%bd%ae%e8%af%a2Polling%e9%98%b6%e6%ae%b5%0a%e8%bf%99%e7%a7%8d%e6%96%b9%e5%bc%8f%e4%b8%8b%ef%bc%8c%e6%98%af%e4%b8%8d%e9%80%82%e5%90%88%e8%8e%b7%e5%8f%96%e5%ae%9e%e6%97%b6%e4%bf%a1%e6%81%af%e7%9a%84%ef%bc%8c%e5%ae%a2%e6%88%b7%e7%ab%af%e5%92%8c%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%b9%8b%e9%97%b4%e4%bc%9a%e4%b8%80%e7%9b%b4%e8%bf%9b%e8%a1%8c%e8%bf%9e%e6%8e%a5%ef%bc%8c%e6%af%8f%e9%9a%94%e4%b8%80%e6%ae%b5%e6%97%b6%e9%97%b4%e5%b0%b1%e8%af%a2%e9%97%ae%e4%b8%80%e6%ac%a1%e3%80%82%e5%ae%a2%e6%88%b7%e7%ab%af%e4%bc%9a%e8%bd%ae%e8%af%a2%ef%bc%8c%e6%9c%89%e6%b2%a1%e6%9c%89%e6%96%b0%e6%b6%88%e6%81%af%e3%80%82%e8%bf%99%e7%a7%8d%e6%96%b9%e5%bc%8f%e8%bf%9e%e6%8e%a5%e6%95%b0%e4%bc%9a%e5%be%88%e5%a4%9a%ef%bc%8c%e4%b8%80%e4%b8%aa%e6%8e%a5%e5%8f%97%ef%bc%8c%e4%b8%80%e4%b8%aa%e5%8f%91%e9%80%81%e3%80%82%e8%80%8c%e4%b8%94%e6%af%8f%e6%ac%a1%e5%8f%91%e9%80%81%e8%af%b7%e6%b1%82%e9%83%bd%e4%bc%9a%e6%9c%89Http%e7%9a%84Header%ef%bc%8c%e4%bc%9a%e5%be%88%e8%80%97%e6%b5%81%e9%87%8f%ef%bc%8c%e4%b9%9f%e4%bc%9a%e6%b6%88%e8%80%97CPU%e7%9a%84%e5%88%a9%e7%94%a8%e7%8e%87%e3%80%82%0a2.%e6%94%b9%e8%bf%9b%e7%89%88%e7%9a%84%e9%95%bf%e8%bd%ae%e8%af%a2Long%20polling%e9%98%b6%e6%ae%b5%0a%e9%95%bf%e8%bd%ae%e8%af%a2%e6%98%af%e5%af%b9%e8%bd%ae%e8%af%a2%e7%9a%84%e6%94%b9%e8%bf%9b%e7%89%88%ef%bc%8c%e5%ae%a2%e6%88%b7%e7%ab%af%e5%8f%91%e9%80%81HTTP%e7%bb%99%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%b9%8b%e5%90%8e%ef%bc%8c%e6%9c%89%e6%b2%a1%e6%9c%89%e6%96%b0%e6%b6%88%e6%81%af%ef%bc%8c%e5%a6%82%e6%9e%9c%e6%b2%a1%e6%9c%89%e6%96%b0%e6%b6%88%e6%81%af%ef%bc%8c%e5%b0%b1%e4%b8%80%e7%9b%b4%e7%ad%89%e5%be%85%e3%80%82%e5%bd%93%e6%9c%89%e6%96%b0%e6%b6%88%e6%81%af%e7%9a%84%e6%97%b6%e5%80%99%ef%bc%8c%e6%89%8d%e4%bc%9a%e8%bf%94%e5%9b%9e%e7%bb%99%e5%ae%a2%e6%88%b7%e7%ab%af%e3%80%82%e5%9c%a8%e6%9f%90%e7%a7%8d%e7%a8%8b%e5%ba%a6%e4%b8%8a%e5%87%8f%e5%b0%8f%e4%ba%86%e7%bd%91%e7%bb%9c%e5%b8%a6%e5%ae%bd%e5%92%8cCPU%e5%88%a9%e7%94%a8%e7%8e%87%e7%ad%89%e9%97%ae%e9%a2%98%e3%80%82%e4%bd%86%e6%98%af%e8%bf%99%e7%a7%8d%e6%96%b9%e5%bc%8f%e8%bf%98%e6%98%af%e6%9c%89%e4%b8%80%e7%a7%8d%e5%bc%8a%e7%ab%af%ef%bc%9a%e4%be%8b%e5%a6%82%e5%81%87%e8%ae%be%e6%9c%8d%e5%8a%a1%e5%99%a8%e7%ab%af%e7%9a%84%e6%95%b0%e6%8d%ae%e6%9b%b4%e6%96%b0%e9%80%9f%e5%ba%a6%e5%be%88%e5%bf%ab%ef%bc%8c%e6%9c%8d%e5%8a%a1%e5%99%a8%e5%9c%a8%e4%bc%a0%e9%80%81%e4%b8%80%e4%b8%aa%e6%95%b0%e6%8d%ae%e5%8c%85%e7%bb%99%e5%ae%a2%e6%88%b7%e7%ab%af%e5%90%8e%e5%bf%85%e9%a1%bb%e7%ad%89%e5%be%85%e5%ae%a2%e6%88%b7%e7%ab%af%e7%9a%84%e4%b8%8b%e4%b8%80%e4%b8%aaGet%e8%af%b7%e6%b1%82%e5%88%b0%e6%9d%a5%ef%bc%8c%e6%89%8d%e8%83%bd%e4%bc%a0%e9%80%92%e7%ac%ac%e4%ba%8c%e4%b8%aa%e6%9b%b4%e6%96%b0%e7%9a%84%e6%95%b0%e6%8d%ae%e5%8c%85%e7%bb%99%e5%ae%a2%e6%88%b7%e7%ab%af%ef%bc%8c%e9%82%a3%e4%b9%88%e8%bf%99%e6%a0%b7%e7%9a%84%e8%af%9d%ef%bc%8c%e5%ae%a2%e6%88%b7%e7%ab%af%e6%98%be%e7%a4%ba%e5%ae%9e%e6%97%b6%e6%95%b0%e6%8d%ae%e6%9c%80%e5%bf%ab%e7%9a%84%e6%97%b6%e9%97%b4%e4%b8%ba2%c3%97RTT%ef%bc%88%e5%be%80%e8%bf%94%e6%97%b6%e9%97%b4%ef%bc%89%ef%bc%8c%e8%80%8c%e4%b8%94%e5%a6%82%e6%9e%9c%e5%9c%a8%e7%bd%91%e7%bb%9c%e6%8b%a5%e5%a1%9e%e7%9a%84%e6%83%85%e5%86%b5%e4%b8%8b%ef%bc%8c%e8%bf%99%e4%b8%aa%e6%97%b6%e9%97%b4%e7%94%a8%e6%88%b7%e6%98%af%e4%b8%8d%e8%83%bd%e6%8e%a5%e5%8f%97%e7%9a%84%ef%bc%8c%e6%af%94%e5%a6%82%e5%9c%a8%e8%82%a1%e5%b8%82%e7%9a%84%e7%9a%84%e6%8a%a5%e4%bb%b7%e4%b8%8a%e3%80%82%e5%8f%a6%e5%a4%96%ef%bc%8c%e7%94%b1%e4%ba%8ehttp%e6%95%b0%e6%8d%ae%e5%8c%85%e7%9a%84%e5%a4%b4%e9%83%a8%e6%95%b0%e6%8d%ae%e9%87%8f%e5%be%80%e5%be%80%e5%be%88%e5%a4%a7%ef%bc%88%e9%80%9a%e5%b8%b8%e6%9c%89400%e5%a4%9a%e4%b8%aa%e5%ad%97%e8%8a%82%ef%bc%89%ef%bc%8c%e4%bd%86%e6%98%af%e7%9c%9f%e6%ad%a3%e8%a2%ab%e6%9c%8d%e5%8a%a1%e5%99%a8%e9%9c%80%e8%a6%81%e7%9a%84%e6%95%b0%e6%8d%ae%e5%8d%b4%e5%be%88%e5%b0%91%ef%bc%88%e6%9c%89%e6%97%b6%e5%8f%aa%e6%9c%8910%e4%b8%aa%e5%ad%97%e8%8a%82%e5%b7%a6%e5%8f%b3%ef%bc%89%ef%bc%8c%e8%bf%99%e6%a0%b7%e7%9a%84%e6%95%b0%e6%8d%ae%e5%8c%85%e5%9c%a8%e7%bd%91%e7%bb%9c%e4%b8%8a%e5%91%a8%e6%9c%9f%e6%80%a7%e7%9a%84%e4%bc%a0%e8%be%93%ef%bc%8c%e9%9a%be%e5%85%8d%e5%af%b9%e7%bd%91%e7%bb%9c%e5%b8%a6%e5%ae%bd%e6%98%af%e4%b8%80%e7%a7%8d%e6%b5%aa%e8%b4%b9%e3%80%82%0a3.WebSocket%e8%af%9e%e7%94%9f%0a%e7%8e%b0%e5%9c%a8%e6%80%a5%e9%9c%80%e7%9a%84%e9%9c%80%e6%b1%82%e6%98%af%e8%83%bd%e6%94%af%e6%8c%81%e5%ae%a2%e6%88%b7%e7%ab%af%e5%92%8c%e6%9c%8d%e5%8a%a1%e5%99%a8%e7%ab%af%e7%9a%84%e5%8f%8c%e5%90%91%e9%80%9a%e4%bf%a1%ef%bc%8c%e8%80%8c%e4%b8%94%e5%8d%8f%e8%ae%ae%e7%9a%84%e5%a4%b4%e9%83%a8%e5%8f%88%e6%b2%a1%e6%9c%89HTTP%e7%9a%84Header%e9%82%a3%e4%b9%88%e5%a4%a7%ef%bc%8c%e4%ba%8e%e6%98%af%ef%bc%8cWebsocket%e5%b0%b1%e8%af%9e%e7%94%9f%e4%ba%86%ef%bc%81%0a%e4%b8%8a%e5%9b%be%e5%b0%b1%e6%98%afWebsocket%e5%92%8cPolling%e7%9a%84%e5%8c%ba%e5%88%ab%ef%bc%8c%e4%bb%8e%e5%9b%be%e4%b8%ad%e5%8f%af%e4%bb%a5%e7%9c%8b%e5%88%b0Polling%e9%87%8c%e9%9d%a2%e5%ae%a2%e6%88%b7%e7%ab%af%e5%8f%91%e9%80%81%e4%ba%86%e5%a5%bd%e5%a4%9aRequest%ef%bc%8c%e8%80%8c%e4%b8%8b%e5%9b%be%ef%bc%8c%e5%8f%aa%e6%9c%89%e4%b8%80%e4%b8%aaUpgrade%ef%bc%8c%e9%9d%9e%e5%b8%b8%e7%ae%80%e6%b4%81%e9%ab%98%e6%95%88%e3%80%82%e8%87%b3%e4%ba%8e%e6%b6%88%e8%80%97%e6%96%b9%e9%9d%a2%e7%9a%84%e6%af%94%e8%be%83%e5%b0%b1%e8%a6%81%e7%9c%8b%e4%b8%8b%e5%9b%be%e4%ba%86%0a%e4%b8%8a%e5%9b%be%e4%b8%ad%ef%bc%8c%e6%88%91%e4%bb%ac%e5%85%88%e7%9c%8b%e8%93%9d%e8%89%b2%e7%9a%84%e6%9f%b1%e7%8a%b6%e5%9b%be%ef%bc%8c%e6%98%afPolling%e8%bd%ae%e8%af%a2%e6%b6%88%e8%80%97%e7%9a%84%e6%b5%81%e9%87%8f%ef%bc%8c%e8%bf%99%e6%ac%a1%e6%b5%8b%e8%af%95%ef%bc%8cHTTP%e8%af%b7%e6%b1%82%e5%92%8c%e5%93%8d%e5%ba%94%e5%a4%b4%e4%bf%a1%e6%81%af%e5%bc%80%e9%94%80%e6%80%bb%e5%85%b1%e5%8c%85%e6%8b%ac871%e5%ad%97%e8%8a%82%e3%80%82%e5%bd%93%e7%84%b6%e6%af%8f%e6%ac%a1%e6%b5%8b%e8%af%95%e4%b8%8d%e5%90%8c%e7%9a%84%e8%af%b7%e6%b1%82%ef%bc%8c%e5%a4%b4%e7%9a%84%e5%bc%80%e9%94%80%e4%b8%8d%e5%90%8c%e3%80%82%e8%bf%99%e6%ac%a1%e6%b5%8b%e8%af%95%e9%83%bd%e4%bb%a5871%e5%ad%97%e8%8a%82%e7%9a%84%e8%af%b7%e6%b1%82%e6%9d%a5%e6%b5%8b%e8%af%95%e3%80%82%0a%2a%2aUse%20case%20A%3a%2a%2a1%2c000%20clients%20polling%20every%20second%3a%20Network%20throughput%20is%20%28871%20x%201%2c000%29%20%3d%20871%2c000%20bytes%20%3d%206%2c968%2c000%20bits%20per%20second%20%286.6%20Mbps%29%0aUse%20case%20B%3a%2010%2c000%20clients%20polling%20every%20second%3a%20Network%20throughput%20is%20%28871%20x%2010%2c000%29%20%3d%208%2c710%2c000%20bytes%20%3d%2069%2c680%2c000%20bits%20per%20second%20%2866%20Mbps%29"><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fnew.halfrost.com%2fios_weixin_qq_websocket%2f&t=%e5%be%ae%e4%bf%a1%2cQQ%20%e8%bf%99%e7%b1%bb%20IM%20app%20%e6%80%8e%e4%b9%88%e5%81%9a%e2%80%94%e2%80%94%e8%b0%88%e8%b0%88%20Websocket"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu class=icon href=# onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden=true></i>Menu</a>
<a id=toc class=icon href=# onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden=true></i>TOC</a>
<a id=share class=icon href=# onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden=true></i>share</a>
<a id=top style=display:none class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i>Top</a></div></div></div><footer id=footer><div class=footer-left><p class=copyright style=float:left;margin-bottom:0><a href=https://github.com/halfrost/Halfrost-Field class=github-repo style=height:18px><span class=gadget-github></span>Star</a>
Copyright &copy;halfrost 2016 - 2021
<a href=http://www.miit.gov.cn/>鄂ICP备16014744号</a></p><br><p class="copyright statistics" style=margin-bottom:20px><span id=busuanzi_container_site_pv>Cumulative Page Views <span id=busuanzi_value_site_pv></span>| Unique Visitors <span id=busuanzi_value_site_uv></span></span></p></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/main.min.f870a4d110314b9e50e65f8ac982dc1c9c376c8f1a5083d39c62cfc49073f011.js></script><script async src=/prism.js></script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']]},svg:{fontCache:'global'}};</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></html>