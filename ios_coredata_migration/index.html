<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=theme-color content="#FFFFFF"><meta http-equiv=x-ua-compatible content="IE=edge"><title>iOS Core Data 数据迁移 指南 | prometheus</title><meta name=description content="Explore in every moment of the hard thinking"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="iOS Core Data 数据迁移 指南"><meta property="og:description" content="####前言 Core Data是iOS上一个效率比较高的数据库框架，(但是Core Data并不是一种数据库，它底层还是利用Sqlite3来存储数据的)，它可以把数据当成对象来操作，而且开发者并不需要在乎数据在磁盘上面的存储方式。它会把位于NSManagedObject Context里面的托管对象NSManagedObject类的实例或者某个NSManagedObject子类的实例，通过NSManagedObjectModel托管对象模型，把托管对象保存到持久化存储协调器NSPersistentStoreCoordinator持有的一个或者多个持久化存储区中NSPersistentStore中。使用Core Data进行查询的语句都是经过Apple特别优化过的，所以都是效率很高的查询。
当你进行简单的设定，比如说设定某个实体的默认值，设定级联删除的操作，设定数据的验证规则，使用数据的请求模板，这些修改Core Data都会自己完成，不用自己进行数据迁移。那那些操作需要我们进行数据迁移呢？凡是会引起NSManagedObjectModel托管对象模型变化的，都最好进行数据迁移，防止用户升级应用之后就闪退。会引起NSManagedObjectModel托管对象模型变化的有以下几个操作，新增了一张表，新增了一张表里面的一个实体，新增一个实体的一个属性，把一个实体的某个属性迁移到另外一个实体的某个属性里面…………大家应该现在都知道哪些操作需要进行数据迁移了吧。
####小技巧： 进入正题之前，我先说3个调试Core Data里面调试可能你会需要的操作。
1.一般打开app沙盒里面的会有三种类型的文件，sqlite，sqlite-shm,sqlite-wal,后面2者是iOS7之后系统会默认开启一个新的“数据库日志记录模式”(database journaling mode)生成的，sqlite-shm是共享内存(Shared Memory)文件，该文件里面会包含一份sqlite-wal文件的索引，系统会自动生成shm文件，所以删除它，下次运行还会生成。sqlite-wal是预写式日志(Write-Ahead Log)文件，这个文件里面会包含尚未提交的数据库事务，所以看见有这个文件了，就代表数据库里面还有还没有处理完的事务需要提交，所以说如果有sqlite-wal文件，再去打开sqlite文件，很可能最近一次数据库操作还没有执行。
所以在调试的时候，我们需要即时的观察数据库的变化，我们就可以先禁用这个日志记录模式，只需要在建立持久化存储区的时候存入一个参数即可。具体代码如下
NSDictionary *options = @{ NSSQLitePragmasOption: @{@&#34;journal_mode&#34;: @&#34;DELETE&#34;} }; NSError *error = nil; _store = [_coordinator addPersistentStoreWithType:NSSQLiteStoreType configuration:nil URL:[self storeURL] options:options error:&error]; 2.Mac上打开数据库的方式很多，我推荐3个，一个是Firefox里面直接有sqlite的插件，免费的，可以直接安装，也很方便。当然也有不用Firefox的朋友，就像我是Chrome重度使用者，那就推荐2个免费的小的app，一个是sqlitebrowser，一个是sqlite manager，这2个都比较轻量级，都比较好用。
3.如果你想看看Core Data到底底层是如何优化你的查询语句的，这里有一个方法可以看到。
先点击Product ->Scheme ->Edit Scheme
然后再切换到Arguments分页中,在Arguments Passed On Launch里面加入 “- com.apple.CoreData.SQLDebug 3”,重新运行app，下面就会显示Core Data优化过的Sql语句了。
好了，调试信息应该都可以完美显示了，可以开始愉快的进入正文了！
####一.Core Data自带的轻量级的数据迁移 这种迁移可别小看它，在你新建一张表的时候还必须加上它才行，否则会出现如下的错误：
**Failed to add store. Error: Error Domain=NSCocoaErrorDomain Code=134100 &#34;(null)&#34; UserInfo={metadata={** ** NSPersistenceFrameworkVersion = 641;** ** NSStoreModelVersionHashes = {** ** Item = <64288772 72e62096 a8a4914f 83db23c9 13718f81 4417e297 293d0267 79b04acb>;** ** Measurement = <35717f0e 32cae0d4 57325758 58ed0d11 c16563f2 567dac35 de63d5d8 47849cf7>;** ** };** ** NSStoreModelVersionHashesVersion = 3;** ** NSStoreModelVersionIdentifiers = (** ** &#34;&#34;** ** );** ** NSStoreType = SQLite;** ** NSStoreUUID = &#34;9A16746E-0C61-421B-B936-412F0C904FDF&#34;;** ** &#34;_NSAutoVacuumLevel&#34; = 2;** **}, reason=The model used to open the store is incompatible with the one used to create the store}** 错误原因写的比较清楚了，reason=The model used to open the store is incompatible with the one used to create the store，这个是因为我新建了一张表，但是我没有打开轻量级的迁移Option。这里会有人会问了，我新建表从来没有出现这个错误啊？那是因为你们用的第三方框架就已经写好了改Option了。(场外人:这年头谁还自己从0开始写Core Data啊，肯定都用第三方框架啊)那这里我就当讲解原理了哈。如果是自己从0开始写的Core Data的话，这里是应该会报错了，解决办法当然是加上代码，利用Core Data的轻量级迁移，来防止这种找不到存储区的闪退问题"><meta property="og:type" content="article"><meta property="og:url" content="https://new.halfrost.com/ios_coredata_migration/"><meta property="article:published_time" content="2016-05-08T08:06:00+00:00"><meta property="article:modified_time" content="2016-05-08T08:06:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="iOS Core Data 数据迁移 指南"><meta name=twitter:description content="####前言 Core Data是iOS上一个效率比较高的数据库框架，(但是Core Data并不是一种数据库，它底层还是利用Sqlite3来存储数据的)，它可以把数据当成对象来操作，而且开发者并不需要在乎数据在磁盘上面的存储方式。它会把位于NSManagedObject Context里面的托管对象NSManagedObject类的实例或者某个NSManagedObject子类的实例，通过NSManagedObjectModel托管对象模型，把托管对象保存到持久化存储协调器NSPersistentStoreCoordinator持有的一个或者多个持久化存储区中NSPersistentStore中。使用Core Data进行查询的语句都是经过Apple特别优化过的，所以都是效率很高的查询。
当你进行简单的设定，比如说设定某个实体的默认值，设定级联删除的操作，设定数据的验证规则，使用数据的请求模板，这些修改Core Data都会自己完成，不用自己进行数据迁移。那那些操作需要我们进行数据迁移呢？凡是会引起NSManagedObjectModel托管对象模型变化的，都最好进行数据迁移，防止用户升级应用之后就闪退。会引起NSManagedObjectModel托管对象模型变化的有以下几个操作，新增了一张表，新增了一张表里面的一个实体，新增一个实体的一个属性，把一个实体的某个属性迁移到另外一个实体的某个属性里面…………大家应该现在都知道哪些操作需要进行数据迁移了吧。
####小技巧： 进入正题之前，我先说3个调试Core Data里面调试可能你会需要的操作。
1.一般打开app沙盒里面的会有三种类型的文件，sqlite，sqlite-shm,sqlite-wal,后面2者是iOS7之后系统会默认开启一个新的“数据库日志记录模式”(database journaling mode)生成的，sqlite-shm是共享内存(Shared Memory)文件，该文件里面会包含一份sqlite-wal文件的索引，系统会自动生成shm文件，所以删除它，下次运行还会生成。sqlite-wal是预写式日志(Write-Ahead Log)文件，这个文件里面会包含尚未提交的数据库事务，所以看见有这个文件了，就代表数据库里面还有还没有处理完的事务需要提交，所以说如果有sqlite-wal文件，再去打开sqlite文件，很可能最近一次数据库操作还没有执行。
所以在调试的时候，我们需要即时的观察数据库的变化，我们就可以先禁用这个日志记录模式，只需要在建立持久化存储区的时候存入一个参数即可。具体代码如下
NSDictionary *options = @{ NSSQLitePragmasOption: @{@&#34;journal_mode&#34;: @&#34;DELETE&#34;} }; NSError *error = nil; _store = [_coordinator addPersistentStoreWithType:NSSQLiteStoreType configuration:nil URL:[self storeURL] options:options error:&error]; 2.Mac上打开数据库的方式很多，我推荐3个，一个是Firefox里面直接有sqlite的插件，免费的，可以直接安装，也很方便。当然也有不用Firefox的朋友，就像我是Chrome重度使用者，那就推荐2个免费的小的app，一个是sqlitebrowser，一个是sqlite manager，这2个都比较轻量级，都比较好用。
3.如果你想看看Core Data到底底层是如何优化你的查询语句的，这里有一个方法可以看到。
先点击Product ->Scheme ->Edit Scheme
然后再切换到Arguments分页中,在Arguments Passed On Launch里面加入 “- com.apple.CoreData.SQLDebug 3”,重新运行app，下面就会显示Core Data优化过的Sql语句了。
好了，调试信息应该都可以完美显示了，可以开始愉快的进入正文了！
####一.Core Data自带的轻量级的数据迁移 这种迁移可别小看它，在你新建一张表的时候还必须加上它才行，否则会出现如下的错误：
**Failed to add store. Error: Error Domain=NSCocoaErrorDomain Code=134100 &#34;(null)&#34; UserInfo={metadata={** ** NSPersistenceFrameworkVersion = 641;** ** NSStoreModelVersionHashes = {** ** Item = <64288772 72e62096 a8a4914f 83db23c9 13718f81 4417e297 293d0267 79b04acb>;** ** Measurement = <35717f0e 32cae0d4 57325758 58ed0d11 c16563f2 567dac35 de63d5d8 47849cf7>;** ** };** ** NSStoreModelVersionHashesVersion = 3;** ** NSStoreModelVersionIdentifiers = (** ** &#34;&#34;** ** );** ** NSStoreType = SQLite;** ** NSStoreUUID = &#34;9A16746E-0C61-421B-B936-412F0C904FDF&#34;;** ** &#34;_NSAutoVacuumLevel&#34; = 2;** **}, reason=The model used to open the store is incompatible with the one used to create the store}** 错误原因写的比较清楚了，reason=The model used to open the store is incompatible with the one used to create the store，这个是因为我新建了一张表，但是我没有打开轻量级的迁移Option。这里会有人会问了，我新建表从来没有出现这个错误啊？那是因为你们用的第三方框架就已经写好了改Option了。(场外人:这年头谁还自己从0开始写Core Data啊，肯定都用第三方框架啊)那这里我就当讲解原理了哈。如果是自己从0开始写的Core Data的话，这里是应该会报错了，解决办法当然是加上代码，利用Core Data的轻量级迁移，来防止这种找不到存储区的闪退问题"><link rel=stylesheet href=/css/style-white.min.css><link rel=manifest href=/manifest.json><link rel=stylesheet href=/prism.css><link href=/images/apple-touch-icon-60x60.png rel=apple-touch-icon sizes=60x60><link href=/images/apple-touch-icon-76x76.png rel=apple-touch-icon sizes=76x76><link href=/images/apple-touch-icon-120x120.png rel=apple-touch-icon sizes=120x120><link href=/images/apple-touch-icon-152x152.png rel=apple-touch-icon sizes=152x152><link href=/images/apple-touch-icon-180x180.png rel=apple-touch-icon sizes=180x180><link href=/images/apple-touch-icon-512x512.png rel=apple-touch-icon sizes=512x512><link href=/images/apple-touch-icon-1024x1024.png rel=apple-touch-icon sizes=1024x1024><script async>if('serviceWorker'in navigator){navigator.serviceWorker.register("\/serviceworker-v1.min.a64912b78d282eab1ad3715a0943da21616e5f326f8afea27034784ad445043b.js").then(function(){if(navigator.serviceWorker.controller){console.log('Assets cached by the controlling service worker.');}else{console.log('Please reload this page to allow the service worker to handle network operations.');}}).catch(function(error){console.log('ERROR: '+error);});}else{console.log('Service workers are not supported in the current browser.');}</script><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://new.halfrost.com/images/favicon.ico><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-82753806-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="single-max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a><a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a><a id=top-icon-tablet href=# onclick="$('html, body').animate({scrollTop:0},'fast');" style=display:none><i class="fas fa-chevron-up fa-lg"></i></a><span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=https://books.halfrost.com/>Books</a></li><li><a href=https://github.com/halfrost/Halfrost-Field>Github</a></li><li><a href=https://halfrost.me/>About</a></li><li><a href=/index.xml>RSS</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://new.halfrost.com/where_is_forever/><i class="fas fa-chevron-left" aria-hidden=true onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li><li><a class=icon href=https://new.halfrost.com/ios_weixin_qq_websocket/><i class="fas fa-chevron-right" aria-hidden=true onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li><li><a class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast');"><i class="fas fa-chevron-up" aria-hidden=true onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li><li><a class=icon href=#><i class="fas fa-share-alt" aria-hidden=true onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fnew.halfrost.com%2fios_coredata_migration%2f"><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fnew.halfrost.com%2fios_coredata_migration%2f&text=iOS%20Core%20Data%20%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb%20%e6%8c%87%e5%8d%97"><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fnew.halfrost.com%2fios_coredata_migration%2f&title=iOS%20Core%20Data%20%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb%20%e6%8c%87%e5%8d%97"><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fnew.halfrost.com%2fios_coredata_migration%2f&is_video=false&description=iOS%20Core%20Data%20%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb%20%e6%8c%87%e5%8d%97"><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=iOS%20Core%20Data%20%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb%20%e6%8c%87%e5%8d%97&body=Check out this article: https%3a%2f%2fnew.halfrost.com%2fios_coredata_migration%2f"><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fnew.halfrost.com%2fios_coredata_migration%2f&title=iOS%20Core%20Data%20%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb%20%e6%8c%87%e5%8d%97"><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fnew.halfrost.com%2fios_coredata_migration%2f&title=iOS%20Core%20Data%20%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb%20%e6%8c%87%e5%8d%97"><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fnew.halfrost.com%2fios_coredata_migration%2f&title=iOS%20Core%20Data%20%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb%20%e6%8c%87%e5%8d%97"><i class="fab fa-stumbleupon" aria-hidden=true></i></a></li><li><a class=icon href="http://digg.com/submit?url=https%3a%2f%2fnew.halfrost.com%2fios_coredata_migration%2f&title=iOS%20Core%20Data%20%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb%20%e6%8c%87%e5%8d%97"><i class="fab fa-digg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fnew.halfrost.com%2fios_coredata_migration%2f&name=iOS%20Core%20Data%20%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb%20%e6%8c%87%e5%8d%97&description=%23%23%23%23%e5%89%8d%e8%a8%80%20Core%20Data%e6%98%afiOS%e4%b8%8a%e4%b8%80%e4%b8%aa%e6%95%88%e7%8e%87%e6%af%94%e8%be%83%e9%ab%98%e7%9a%84%e6%95%b0%e6%8d%ae%e5%ba%93%e6%a1%86%e6%9e%b6%ef%bc%8c%28%e4%bd%86%e6%98%afCore%20Data%e5%b9%b6%e4%b8%8d%e6%98%af%e4%b8%80%e7%a7%8d%e6%95%b0%e6%8d%ae%e5%ba%93%ef%bc%8c%e5%ae%83%e5%ba%95%e5%b1%82%e8%bf%98%e6%98%af%e5%88%a9%e7%94%a8Sqlite3%e6%9d%a5%e5%ad%98%e5%82%a8%e6%95%b0%e6%8d%ae%e7%9a%84%29%ef%bc%8c%e5%ae%83%e5%8f%af%e4%bb%a5%e6%8a%8a%e6%95%b0%e6%8d%ae%e5%bd%93%e6%88%90%e5%af%b9%e8%b1%a1%e6%9d%a5%e6%93%8d%e4%bd%9c%ef%bc%8c%e8%80%8c%e4%b8%94%e5%bc%80%e5%8f%91%e8%80%85%e5%b9%b6%e4%b8%8d%e9%9c%80%e8%a6%81%e5%9c%a8%e4%b9%8e%e6%95%b0%e6%8d%ae%e5%9c%a8%e7%a3%81%e7%9b%98%e4%b8%8a%e9%9d%a2%e7%9a%84%e5%ad%98%e5%82%a8%e6%96%b9%e5%bc%8f%e3%80%82%e5%ae%83%e4%bc%9a%e6%8a%8a%e4%bd%8d%e4%ba%8eNSManagedObject%20Context%e9%87%8c%e9%9d%a2%e7%9a%84%e6%89%98%e7%ae%a1%e5%af%b9%e8%b1%a1NSManagedObject%e7%b1%bb%e7%9a%84%e5%ae%9e%e4%be%8b%e6%88%96%e8%80%85%e6%9f%90%e4%b8%aaNSManagedObject%e5%ad%90%e7%b1%bb%e7%9a%84%e5%ae%9e%e4%be%8b%ef%bc%8c%e9%80%9a%e8%bf%87NSManagedObjectModel%e6%89%98%e7%ae%a1%e5%af%b9%e8%b1%a1%e6%a8%a1%e5%9e%8b%ef%bc%8c%e6%8a%8a%e6%89%98%e7%ae%a1%e5%af%b9%e8%b1%a1%e4%bf%9d%e5%ad%98%e5%88%b0%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8%e5%8d%8f%e8%b0%83%e5%99%a8NSPersistentStoreCoordinator%e6%8c%81%e6%9c%89%e7%9a%84%e4%b8%80%e4%b8%aa%e6%88%96%e8%80%85%e5%a4%9a%e4%b8%aa%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8%e5%8c%ba%e4%b8%adNSPersistentStore%e4%b8%ad%e3%80%82%e4%bd%bf%e7%94%a8Core%20Data%e8%bf%9b%e8%a1%8c%e6%9f%a5%e8%af%a2%e7%9a%84%e8%af%ad%e5%8f%a5%e9%83%bd%e6%98%af%e7%bb%8f%e8%bf%87Apple%e7%89%b9%e5%88%ab%e4%bc%98%e5%8c%96%e8%bf%87%e7%9a%84%ef%bc%8c%e6%89%80%e4%bb%a5%e9%83%bd%e6%98%af%e6%95%88%e7%8e%87%e5%be%88%e9%ab%98%e7%9a%84%e6%9f%a5%e8%af%a2%e3%80%82%0a%e5%bd%93%e4%bd%a0%e8%bf%9b%e8%a1%8c%e7%ae%80%e5%8d%95%e7%9a%84%e8%ae%be%e5%ae%9a%ef%bc%8c%e6%af%94%e5%a6%82%e8%af%b4%e8%ae%be%e5%ae%9a%e6%9f%90%e4%b8%aa%e5%ae%9e%e4%bd%93%e7%9a%84%e9%bb%98%e8%ae%a4%e5%80%bc%ef%bc%8c%e8%ae%be%e5%ae%9a%e7%ba%a7%e8%81%94%e5%88%a0%e9%99%a4%e7%9a%84%e6%93%8d%e4%bd%9c%ef%bc%8c%e8%ae%be%e5%ae%9a%e6%95%b0%e6%8d%ae%e7%9a%84%e9%aa%8c%e8%af%81%e8%a7%84%e5%88%99%ef%bc%8c%e4%bd%bf%e7%94%a8%e6%95%b0%e6%8d%ae%e7%9a%84%e8%af%b7%e6%b1%82%e6%a8%a1%e6%9d%bf%ef%bc%8c%e8%bf%99%e4%ba%9b%e4%bf%ae%e6%94%b9Core%20Data%e9%83%bd%e4%bc%9a%e8%87%aa%e5%b7%b1%e5%ae%8c%e6%88%90%ef%bc%8c%e4%b8%8d%e7%94%a8%e8%87%aa%e5%b7%b1%e8%bf%9b%e8%a1%8c%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb%e3%80%82%e9%82%a3%e9%82%a3%e4%ba%9b%e6%93%8d%e4%bd%9c%e9%9c%80%e8%a6%81%e6%88%91%e4%bb%ac%e8%bf%9b%e8%a1%8c%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb%e5%91%a2%ef%bc%9f%e5%87%a1%e6%98%af%e4%bc%9a%e5%bc%95%e8%b5%b7NSManagedObjectModel%e6%89%98%e7%ae%a1%e5%af%b9%e8%b1%a1%e6%a8%a1%e5%9e%8b%e5%8f%98%e5%8c%96%e7%9a%84%ef%bc%8c%e9%83%bd%e6%9c%80%e5%a5%bd%e8%bf%9b%e8%a1%8c%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb%ef%bc%8c%e9%98%b2%e6%ad%a2%e7%94%a8%e6%88%b7%e5%8d%87%e7%ba%a7%e5%ba%94%e7%94%a8%e4%b9%8b%e5%90%8e%e5%b0%b1%e9%97%aa%e9%80%80%e3%80%82%e4%bc%9a%e5%bc%95%e8%b5%b7NSManagedObjectModel%e6%89%98%e7%ae%a1%e5%af%b9%e8%b1%a1%e6%a8%a1%e5%9e%8b%e5%8f%98%e5%8c%96%e7%9a%84%e6%9c%89%e4%bb%a5%e4%b8%8b%e5%87%a0%e4%b8%aa%e6%93%8d%e4%bd%9c%ef%bc%8c%e6%96%b0%e5%a2%9e%e4%ba%86%e4%b8%80%e5%bc%a0%e8%a1%a8%ef%bc%8c%e6%96%b0%e5%a2%9e%e4%ba%86%e4%b8%80%e5%bc%a0%e8%a1%a8%e9%87%8c%e9%9d%a2%e7%9a%84%e4%b8%80%e4%b8%aa%e5%ae%9e%e4%bd%93%ef%bc%8c%e6%96%b0%e5%a2%9e%e4%b8%80%e4%b8%aa%e5%ae%9e%e4%bd%93%e7%9a%84%e4%b8%80%e4%b8%aa%e5%b1%9e%e6%80%a7%ef%bc%8c%e6%8a%8a%e4%b8%80%e4%b8%aa%e5%ae%9e%e4%bd%93%e7%9a%84%e6%9f%90%e4%b8%aa%e5%b1%9e%e6%80%a7%e8%bf%81%e7%a7%bb%e5%88%b0%e5%8f%a6%e5%a4%96%e4%b8%80%e4%b8%aa%e5%ae%9e%e4%bd%93%e7%9a%84%e6%9f%90%e4%b8%aa%e5%b1%9e%e6%80%a7%e9%87%8c%e9%9d%a2%e2%80%a6%e2%80%a6%e2%80%a6%e2%80%a6%e5%a4%a7%e5%ae%b6%e5%ba%94%e8%af%a5%e7%8e%b0%e5%9c%a8%e9%83%bd%e7%9f%a5%e9%81%93%e5%93%aa%e4%ba%9b%e6%93%8d%e4%bd%9c%e9%9c%80%e8%a6%81%e8%bf%9b%e8%a1%8c%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb%e4%ba%86%e5%90%a7%e3%80%82%0a%23%23%23%23%e5%b0%8f%e6%8a%80%e5%b7%a7%ef%bc%9a%20%e8%bf%9b%e5%85%a5%e6%ad%a3%e9%a2%98%e4%b9%8b%e5%89%8d%ef%bc%8c%e6%88%91%e5%85%88%e8%af%b43%e4%b8%aa%e8%b0%83%e8%af%95Core%20Data%e9%87%8c%e9%9d%a2%e8%b0%83%e8%af%95%e5%8f%af%e8%83%bd%e4%bd%a0%e4%bc%9a%e9%9c%80%e8%a6%81%e7%9a%84%e6%93%8d%e4%bd%9c%e3%80%82%0a1.%e4%b8%80%e8%88%ac%e6%89%93%e5%bc%80app%e6%b2%99%e7%9b%92%e9%87%8c%e9%9d%a2%e7%9a%84%e4%bc%9a%e6%9c%89%e4%b8%89%e7%a7%8d%e7%b1%bb%e5%9e%8b%e7%9a%84%e6%96%87%e4%bb%b6%ef%bc%8csqlite%ef%bc%8csqlite-shm%2csqlite-wal%2c%e5%90%8e%e9%9d%a22%e8%80%85%e6%98%afiOS7%e4%b9%8b%e5%90%8e%e7%b3%bb%e7%bb%9f%e4%bc%9a%e9%bb%98%e8%ae%a4%e5%bc%80%e5%90%af%e4%b8%80%e4%b8%aa%e6%96%b0%e7%9a%84%e2%80%9c%e6%95%b0%e6%8d%ae%e5%ba%93%e6%97%a5%e5%bf%97%e8%ae%b0%e5%bd%95%e6%a8%a1%e5%bc%8f%e2%80%9d%28database%20journaling%20mode%29%e7%94%9f%e6%88%90%e7%9a%84%ef%bc%8csqlite-shm%e6%98%af%e5%85%b1%e4%ba%ab%e5%86%85%e5%ad%98%28Shared%20Memory%29%e6%96%87%e4%bb%b6%ef%bc%8c%e8%af%a5%e6%96%87%e4%bb%b6%e9%87%8c%e9%9d%a2%e4%bc%9a%e5%8c%85%e5%90%ab%e4%b8%80%e4%bb%bdsqlite-wal%e6%96%87%e4%bb%b6%e7%9a%84%e7%b4%a2%e5%bc%95%ef%bc%8c%e7%b3%bb%e7%bb%9f%e4%bc%9a%e8%87%aa%e5%8a%a8%e7%94%9f%e6%88%90shm%e6%96%87%e4%bb%b6%ef%bc%8c%e6%89%80%e4%bb%a5%e5%88%a0%e9%99%a4%e5%ae%83%ef%bc%8c%e4%b8%8b%e6%ac%a1%e8%bf%90%e8%a1%8c%e8%bf%98%e4%bc%9a%e7%94%9f%e6%88%90%e3%80%82sqlite-wal%e6%98%af%e9%a2%84%e5%86%99%e5%bc%8f%e6%97%a5%e5%bf%97%28Write-Ahead%20Log%29%e6%96%87%e4%bb%b6%ef%bc%8c%e8%bf%99%e4%b8%aa%e6%96%87%e4%bb%b6%e9%87%8c%e9%9d%a2%e4%bc%9a%e5%8c%85%e5%90%ab%e5%b0%9a%e6%9c%aa%e6%8f%90%e4%ba%a4%e7%9a%84%e6%95%b0%e6%8d%ae%e5%ba%93%e4%ba%8b%e5%8a%a1%ef%bc%8c%e6%89%80%e4%bb%a5%e7%9c%8b%e8%a7%81%e6%9c%89%e8%bf%99%e4%b8%aa%e6%96%87%e4%bb%b6%e4%ba%86%ef%bc%8c%e5%b0%b1%e4%bb%a3%e8%a1%a8%e6%95%b0%e6%8d%ae%e5%ba%93%e9%87%8c%e9%9d%a2%e8%bf%98%e6%9c%89%e8%bf%98%e6%b2%a1%e6%9c%89%e5%a4%84%e7%90%86%e5%ae%8c%e7%9a%84%e4%ba%8b%e5%8a%a1%e9%9c%80%e8%a6%81%e6%8f%90%e4%ba%a4%ef%bc%8c%e6%89%80%e4%bb%a5%e8%af%b4%e5%a6%82%e6%9e%9c%e6%9c%89sqlite-wal%e6%96%87%e4%bb%b6%ef%bc%8c%e5%86%8d%e5%8e%bb%e6%89%93%e5%bc%80sqlite%e6%96%87%e4%bb%b6%ef%bc%8c%e5%be%88%e5%8f%af%e8%83%bd%e6%9c%80%e8%bf%91%e4%b8%80%e6%ac%a1%e6%95%b0%e6%8d%ae%e5%ba%93%e6%93%8d%e4%bd%9c%e8%bf%98%e6%b2%a1%e6%9c%89%e6%89%a7%e8%a1%8c%e3%80%82%0a%e6%89%80%e4%bb%a5%e5%9c%a8%e8%b0%83%e8%af%95%e7%9a%84%e6%97%b6%e5%80%99%ef%bc%8c%e6%88%91%e4%bb%ac%e9%9c%80%e8%a6%81%e5%8d%b3%e6%97%b6%e7%9a%84%e8%a7%82%e5%af%9f%e6%95%b0%e6%8d%ae%e5%ba%93%e7%9a%84%e5%8f%98%e5%8c%96%ef%bc%8c%e6%88%91%e4%bb%ac%e5%b0%b1%e5%8f%af%e4%bb%a5%e5%85%88%e7%a6%81%e7%94%a8%e8%bf%99%e4%b8%aa%e6%97%a5%e5%bf%97%e8%ae%b0%e5%bd%95%e6%a8%a1%e5%bc%8f%ef%bc%8c%e5%8f%aa%e9%9c%80%e8%a6%81%e5%9c%a8%e5%bb%ba%e7%ab%8b%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8%e5%8c%ba%e7%9a%84%e6%97%b6%e5%80%99%e5%ad%98%e5%85%a5%e4%b8%80%e4%b8%aa%e5%8f%82%e6%95%b0%e5%8d%b3%e5%8f%af%e3%80%82%e5%85%b7%e4%bd%93%e4%bb%a3%e7%a0%81%e5%a6%82%e4%b8%8b%0aNSDictionary%20%2aoptions%20%3d%20%40%7b%20NSSQLitePragmasOption%3a%20%40%7b%40%26%2334%3bjournal_mode%26%2334%3b%3a%20%40%26%2334%3bDELETE%26%2334%3b%7d%20%7d%3b%20NSError%20%2aerror%20%3d%20nil%3b%20_store%20%3d%20%5b_coordinator%20addPersistentStoreWithType%3aNSSQLiteStoreType%20configuration%3anil%20URL%3a%5bself%20storeURL%5d%20options%3aoptions%20error%3a%26amp%3berror%5d%3b%202.Mac%e4%b8%8a%e6%89%93%e5%bc%80%e6%95%b0%e6%8d%ae%e5%ba%93%e7%9a%84%e6%96%b9%e5%bc%8f%e5%be%88%e5%a4%9a%ef%bc%8c%e6%88%91%e6%8e%a8%e8%8d%903%e4%b8%aa%ef%bc%8c%e4%b8%80%e4%b8%aa%e6%98%afFirefox%e9%87%8c%e9%9d%a2%e7%9b%b4%e6%8e%a5%e6%9c%89sqlite%e7%9a%84%e6%8f%92%e4%bb%b6%ef%bc%8c%e5%85%8d%e8%b4%b9%e7%9a%84%ef%bc%8c%e5%8f%af%e4%bb%a5%e7%9b%b4%e6%8e%a5%e5%ae%89%e8%a3%85%ef%bc%8c%e4%b9%9f%e5%be%88%e6%96%b9%e4%be%bf%e3%80%82%e5%bd%93%e7%84%b6%e4%b9%9f%e6%9c%89%e4%b8%8d%e7%94%a8Firefox%e7%9a%84%e6%9c%8b%e5%8f%8b%ef%bc%8c%e5%b0%b1%e5%83%8f%e6%88%91%e6%98%afChrome%e9%87%8d%e5%ba%a6%e4%bd%bf%e7%94%a8%e8%80%85%ef%bc%8c%e9%82%a3%e5%b0%b1%e6%8e%a8%e8%8d%902%e4%b8%aa%e5%85%8d%e8%b4%b9%e7%9a%84%e5%b0%8f%e7%9a%84app%ef%bc%8c%e4%b8%80%e4%b8%aa%e6%98%afsqlitebrowser%ef%bc%8c%e4%b8%80%e4%b8%aa%e6%98%afsqlite%20manager%ef%bc%8c%e8%bf%992%e4%b8%aa%e9%83%bd%e6%af%94%e8%be%83%e8%bd%bb%e9%87%8f%e7%ba%a7%ef%bc%8c%e9%83%bd%e6%af%94%e8%be%83%e5%a5%bd%e7%94%a8%e3%80%82%0a3.%e5%a6%82%e6%9e%9c%e4%bd%a0%e6%83%b3%e7%9c%8b%e7%9c%8bCore%20Data%e5%88%b0%e5%ba%95%e5%ba%95%e5%b1%82%e6%98%af%e5%a6%82%e4%bd%95%e4%bc%98%e5%8c%96%e4%bd%a0%e7%9a%84%e6%9f%a5%e8%af%a2%e8%af%ad%e5%8f%a5%e7%9a%84%ef%bc%8c%e8%bf%99%e9%87%8c%e6%9c%89%e4%b8%80%e4%b8%aa%e6%96%b9%e6%b3%95%e5%8f%af%e4%bb%a5%e7%9c%8b%e5%88%b0%e3%80%82%0a%e5%85%88%e7%82%b9%e5%87%bbProduct%20-%26gt%3bScheme%20-%26gt%3bEdit%20Scheme%0a%e7%84%b6%e5%90%8e%e5%86%8d%e5%88%87%e6%8d%a2%e5%88%b0Arguments%e5%88%86%e9%a1%b5%e4%b8%ad%2c%e5%9c%a8Arguments%20Passed%20On%20Launch%e9%87%8c%e9%9d%a2%e5%8a%a0%e5%85%a5%20%e2%80%9c-%20com.apple.CoreData.SQLDebug%203%e2%80%9d%2c%e9%87%8d%e6%96%b0%e8%bf%90%e8%a1%8capp%ef%bc%8c%e4%b8%8b%e9%9d%a2%e5%b0%b1%e4%bc%9a%e6%98%be%e7%a4%baCore%20Data%e4%bc%98%e5%8c%96%e8%bf%87%e7%9a%84Sql%e8%af%ad%e5%8f%a5%e4%ba%86%e3%80%82%0a%e5%a5%bd%e4%ba%86%ef%bc%8c%e8%b0%83%e8%af%95%e4%bf%a1%e6%81%af%e5%ba%94%e8%af%a5%e9%83%bd%e5%8f%af%e4%bb%a5%e5%ae%8c%e7%be%8e%e6%98%be%e7%a4%ba%e4%ba%86%ef%bc%8c%e5%8f%af%e4%bb%a5%e5%bc%80%e5%a7%8b%e6%84%89%e5%bf%ab%e7%9a%84%e8%bf%9b%e5%85%a5%e6%ad%a3%e6%96%87%e4%ba%86%ef%bc%81%0a%23%23%23%23%e4%b8%80.Core%20Data%e8%87%aa%e5%b8%a6%e7%9a%84%e8%bd%bb%e9%87%8f%e7%ba%a7%e7%9a%84%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb%20%e8%bf%99%e7%a7%8d%e8%bf%81%e7%a7%bb%e5%8f%af%e5%88%ab%e5%b0%8f%e7%9c%8b%e5%ae%83%ef%bc%8c%e5%9c%a8%e4%bd%a0%e6%96%b0%e5%bb%ba%e4%b8%80%e5%bc%a0%e8%a1%a8%e7%9a%84%e6%97%b6%e5%80%99%e8%bf%98%e5%bf%85%e9%a1%bb%e5%8a%a0%e4%b8%8a%e5%ae%83%e6%89%8d%e8%a1%8c%ef%bc%8c%e5%90%a6%e5%88%99%e4%bc%9a%e5%87%ba%e7%8e%b0%e5%a6%82%e4%b8%8b%e7%9a%84%e9%94%99%e8%af%af%ef%bc%9a%0a%2a%2aFailed%20to%20add%20store.%20Error%3a%20Error%20Domain%3dNSCocoaErrorDomain%20Code%3d134100%20%26%2334%3b%28null%29%26%2334%3b%20UserInfo%3d%7bmetadata%3d%7b%2a%2a%20%2a%2a%c2%a0NSPersistenceFrameworkVersion%20%3d%20641%3b%2a%2a%20%2a%2a%c2%a0NSStoreModelVersionHashes%20%3d%20%7b%2a%2a%20%2a%2a%c2%a0Item%20%3d%20%26lt%3b64288772%2072e62096%20a8a4914f%2083db23c9%2013718f81%204417e297%20293d0267%2079b04acb%26gt%3b%3b%2a%2a%20%2a%2a%c2%a0Measurement%20%3d%20%26lt%3b35717f0e%2032cae0d4%2057325758%2058ed0d11%20c16563f2%20567dac35%20de63d5d8%2047849cf7%26gt%3b%3b%2a%2a%20%2a%2a%c2%a0%7d%3b%2a%2a%20%2a%2a%c2%a0NSStoreModelVersionHashesVersion%20%3d%203%3b%2a%2a%20%2a%2a%c2%a0NSStoreModelVersionIdentifiers%20%3d%20%28%2a%2a%20%2a%2a%c2%a0%26%2334%3b%26%2334%3b%2a%2a%20%2a%2a%c2%a0%29%3b%2a%2a%20%2a%2a%c2%a0NSStoreType%20%3d%20SQLite%3b%2a%2a%20%2a%2a%c2%a0NSStoreUUID%20%3d%20%26%2334%3b9A16746E-0C61-421B-B936-412F0C904FDF%26%2334%3b%3b%2a%2a%20%2a%2a%c2%a0%26%2334%3b_NSAutoVacuumLevel%26%2334%3b%20%3d%202%3b%2a%2a%20%2a%2a%7d%2c%20reason%3dThe%20model%20used%20to%20open%20the%20store%20is%20incompatible%20with%20the%20one%20used%20to%20create%20the%20store%7d%2a%2a%20%e9%94%99%e8%af%af%e5%8e%9f%e5%9b%a0%e5%86%99%e7%9a%84%e6%af%94%e8%be%83%e6%b8%85%e6%a5%9a%e4%ba%86%ef%bc%8creason%3dThe%20model%20used%20to%20open%20the%20store%20is%20incompatible%20with%20the%20one%20used%20to%20create%20the%20store%ef%bc%8c%e8%bf%99%e4%b8%aa%e6%98%af%e5%9b%a0%e4%b8%ba%e6%88%91%e6%96%b0%e5%bb%ba%e4%ba%86%e4%b8%80%e5%bc%a0%e8%a1%a8%ef%bc%8c%e4%bd%86%e6%98%af%e6%88%91%e6%b2%a1%e6%9c%89%e6%89%93%e5%bc%80%e8%bd%bb%e9%87%8f%e7%ba%a7%e7%9a%84%e8%bf%81%e7%a7%bbOption%e3%80%82%e8%bf%99%e9%87%8c%e4%bc%9a%e6%9c%89%e4%ba%ba%e4%bc%9a%e9%97%ae%e4%ba%86%ef%bc%8c%e6%88%91%e6%96%b0%e5%bb%ba%e8%a1%a8%e4%bb%8e%e6%9d%a5%e6%b2%a1%e6%9c%89%e5%87%ba%e7%8e%b0%e8%bf%99%e4%b8%aa%e9%94%99%e8%af%af%e5%95%8a%ef%bc%9f%e9%82%a3%e6%98%af%e5%9b%a0%e4%b8%ba%e4%bd%a0%e4%bb%ac%e7%94%a8%e7%9a%84%e7%ac%ac%e4%b8%89%e6%96%b9%e6%a1%86%e6%9e%b6%e5%b0%b1%e5%b7%b2%e7%bb%8f%e5%86%99%e5%a5%bd%e4%ba%86%e6%94%b9Option%e4%ba%86%e3%80%82%28%e5%9c%ba%e5%a4%96%e4%ba%ba%3a%e8%bf%99%e5%b9%b4%e5%a4%b4%e8%b0%81%e8%bf%98%e8%87%aa%e5%b7%b1%e4%bb%8e0%e5%bc%80%e5%a7%8b%e5%86%99Core%20Data%e5%95%8a%ef%bc%8c%e8%82%af%e5%ae%9a%e9%83%bd%e7%94%a8%e7%ac%ac%e4%b8%89%e6%96%b9%e6%a1%86%e6%9e%b6%e5%95%8a%29%e9%82%a3%e8%bf%99%e9%87%8c%e6%88%91%e5%b0%b1%e5%bd%93%e8%ae%b2%e8%a7%a3%e5%8e%9f%e7%90%86%e4%ba%86%e5%93%88%e3%80%82%e5%a6%82%e6%9e%9c%e6%98%af%e8%87%aa%e5%b7%b1%e4%bb%8e0%e5%bc%80%e5%a7%8b%e5%86%99%e7%9a%84Core%20Data%e7%9a%84%e8%af%9d%ef%bc%8c%e8%bf%99%e9%87%8c%e6%98%af%e5%ba%94%e8%af%a5%e4%bc%9a%e6%8a%a5%e9%94%99%e4%ba%86%ef%bc%8c%e8%a7%a3%e5%86%b3%e5%8a%9e%e6%b3%95%e5%bd%93%e7%84%b6%e6%98%af%e5%8a%a0%e4%b8%8a%e4%bb%a3%e7%a0%81%ef%bc%8c%e5%88%a9%e7%94%a8Core%20Data%e7%9a%84%e8%bd%bb%e9%87%8f%e7%ba%a7%e8%bf%81%e7%a7%bb%ef%bc%8c%e6%9d%a5%e9%98%b2%e6%ad%a2%e8%bf%99%e7%a7%8d%e6%89%be%e4%b8%8d%e5%88%b0%e5%ad%98%e5%82%a8%e5%8c%ba%e7%9a%84%e9%97%aa%e9%80%80%e9%97%ae%e9%a2%98"><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fnew.halfrost.com%2fios_coredata_migration%2f&t=iOS%20Core%20Data%20%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb%20%e6%8c%87%e5%8d%97"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div><div id=toc><nav id=TableOfContents></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">iOS Core Data 数据迁移 指南</h1><div class=meta><div class=postdate><time datetime="2016-05-08 08:06:00 +0000 UTC" itemprop=datePublished>May 08</time></div><div class=article-category><i class="fas fa-archive"></i><a class=category-link href=/categories/ios>iOS</a>
,
<a class=category-link href=/categories/core-data>Core Data</a>
,
<a class=category-link href=/categories/%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB>数据迁移</a>
,
<a class=category-link href=/categories/migration>Migration</a></div><div class=article-tag><i class="fas fa-tag"></i><a class=tag-link href=/tags/ios rel=tag>iOS</a>
,
<a class=tag-link href=/tags/core-data rel=tag>Core Data</a>
,
<a class=tag-link href=/tags/%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB rel=tag>数据迁移</a>
,
<a class=tag-link href=/tags/migration rel=tag>Migration</a></div></div></header><div class=content itemprop=articleBody><p>####前言
Core Data是iOS上一个效率比较高的数据库框架，(但是Core Data并不是一种数据库，它底层还是利用Sqlite3来存储数据的)，它可以把数据当成对象来操作，而且开发者并不需要在乎数据在磁盘上面的存储方式。它会把位于NSManagedObject Context里面的托管对象NSManagedObject类的实例或者某个NSManagedObject子类的实例，通过NSManagedObjectModel托管对象模型，把托管对象保存到持久化存储协调器NSPersistentStoreCoordinator持有的一个或者多个持久化存储区中NSPersistentStore中。使用Core Data进行查询的语句都是经过Apple特别优化过的，所以都是效率很高的查询。</p><p>当你进行简单的设定，比如说设定某个实体的默认值，设定级联删除的操作，设定数据的验证规则，使用数据的请求模板，这些修改Core Data都会自己完成，不用自己进行数据迁移。那那些操作需要我们进行数据迁移呢？凡是会引起NSManagedObjectModel托管对象模型变化的，都最好进行数据迁移，防止用户升级应用之后就闪退。会引起NSManagedObjectModel托管对象模型变化的有以下几个操作，新增了一张表，新增了一张表里面的一个实体，新增一个实体的一个属性，把一个实体的某个属性迁移到另外一个实体的某个属性里面…………大家应该现在都知道哪些操作需要进行数据迁移了吧。</p><p>####小技巧：
进入正题之前，我先说3个调试Core Data里面调试可能你会需要的操作。</p><p>1.一般打开app沙盒里面的会有三种类型的文件，sqlite，sqlite-shm,sqlite-wal,后面2者是iOS7之后系统会默认开启一个新的“数据库日志记录模式”(database journaling mode)生成的，sqlite-shm是共享内存(Shared Memory)文件，该文件里面会包含一份sqlite-wal文件的索引，系统会自动生成shm文件，所以删除它，下次运行还会生成。sqlite-wal是预写式日志(Write-Ahead Log)文件，这个文件里面会包含尚未提交的数据库事务，所以看见有这个文件了，就代表数据库里面还有还没有处理完的事务需要提交，所以说如果有sqlite-wal文件，再去打开sqlite文件，很可能最近一次数据库操作还没有执行。</p><p>所以在调试的时候，我们需要即时的观察数据库的变化，我们就可以先禁用这个日志记录模式，只需要在建立持久化存储区的时候存入一个参数即可。具体代码如下</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objectivec data-lang=objectivec>    NSDictionary <span style=color:#f92672>*</span>options <span style=color:#f92672>=</span>
    <span style=color:#ae81ff>@{</span>
          NSSQLitePragmasOption: <span style=color:#ae81ff>@{</span><span style=color:#e6db74>@&#34;journal_mode&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>@&#34;DELETE&#34;</span><span style=color:#ae81ff>}</span>
     <span style=color:#ae81ff>}</span>;
    
    NSError <span style=color:#f92672>*</span>error <span style=color:#f92672>=</span> nil;
    _store <span style=color:#f92672>=</span> [_coordinator addPersistentStoreWithType:NSSQLiteStoreType
                                        configuration:nil
                                                  URL:[self storeURL]
                                              options:options error:<span style=color:#f92672>&amp;</span>error];
</code></pre></div><p>2.Mac上打开数据库的方式很多，我推荐3个，一个是Firefox里面直接有sqlite的插件，免费的，可以直接安装，也很方便。当然也有不用Firefox的朋友，就像我是Chrome重度使用者，那就推荐2个免费的小的app，一个是sqlitebrowser，一个是sqlite manager，这2个都比较轻量级，都比较好用。</p><p>3.如果你想看看Core Data到底底层是如何优化你的查询语句的，这里有一个方法可以看到。</p><p>先点击Product ->Scheme ->Edit Scheme</p><p><img src=https://img.halfrost.com/Blog/ArticleImage/7_2.png alt></p><p>然后再切换到Arguments分页中,在Arguments Passed On Launch里面加入 “- com.apple.CoreData.SQLDebug 3”,重新运行app，下面就会显示Core Data优化过的Sql语句了。</p><p><img src=https://img.halfrost.com/Blog/ArticleImage/7_3.png alt></p><p>好了，调试信息应该都可以完美显示了，可以开始愉快的进入正文了！</p><p>####一.Core Data自带的轻量级的数据迁移
这种迁移可别小看它，在你新建一张表的时候还必须加上它才行，否则会出现如下的错误：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objectivec data-lang=objectivec><span style=color:#f92672>**</span>Failed to add store. Error: Error Domain<span style=color:#f92672>=</span>NSCocoaErrorDomain Code<span style=color:#f92672>=</span><span style=color:#ae81ff>134100</span> <span style=color:#e6db74>&#34;(null)&#34;</span> UserInfo<span style=color:#f92672>=</span>{metadata<span style=color:#f92672>=</span>{<span style=color:#f92672>**</span>
<span style=color:#f92672>**</span>    NSPersistenceFrameworkVersion <span style=color:#f92672>=</span> <span style=color:#ae81ff>641</span>;<span style=color:#f92672>**</span>
<span style=color:#f92672>**</span>    NSStoreModelVersionHashes <span style=color:#f92672>=</span>     {<span style=color:#f92672>**</span>
<span style=color:#f92672>**</span>        Item <span style=color:#f92672>=</span> <span style=color:#f92672>&lt;</span><span style=color:#ae81ff>64288772</span> <span style=color:#ae81ff>72e62096</span> a8a4914f <span style=color:#ae81ff>83</span>db23c9 <span style=color:#ae81ff>13718f</span><span style=color:#ae81ff>81</span> <span style=color:#ae81ff>4417e297</span> <span style=color:#ae81ff>293</span>d0267 <span style=color:#ae81ff>79</span>b04acb<span style=color:#f92672>&gt;</span>;<span style=color:#f92672>**</span>
<span style=color:#f92672>**</span>        Measurement <span style=color:#f92672>=</span> <span style=color:#f92672>&lt;</span><span style=color:#ae81ff>35717f</span><span style=color:#ae81ff>0</span>e <span style=color:#ae81ff>32</span>cae0d4 <span style=color:#ae81ff>57325758</span> <span style=color:#ae81ff>58</span>ed0d11 c16563f2 <span style=color:#ae81ff>567</span>dac35 de63d5d8 <span style=color:#ae81ff>47849</span>cf7<span style=color:#f92672>&gt;</span>;<span style=color:#f92672>**</span>
<span style=color:#f92672>**</span>    };<span style=color:#f92672>**</span>
<span style=color:#f92672>**</span>    NSStoreModelVersionHashesVersion <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>;<span style=color:#f92672>**</span>
<span style=color:#f92672>**</span>    NSStoreModelVersionIdentifiers <span style=color:#f92672>=</span>     (<span style=color:#f92672>**</span>
<span style=color:#f92672>**</span>        <span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>**</span>
<span style=color:#f92672>**</span>    );<span style=color:#f92672>**</span>
<span style=color:#f92672>**</span>    NSStoreType <span style=color:#f92672>=</span> SQLite;<span style=color:#f92672>**</span>
<span style=color:#f92672>**</span>    NSStoreUUID <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;9A16746E-0C61-421B-B936-412F0C904FDF&#34;</span>;<span style=color:#f92672>**</span>
<span style=color:#f92672>**</span>    <span style=color:#e6db74>&#34;_NSAutoVacuumLevel&#34;</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;<span style=color:#f92672>**</span>
<span style=color:#f92672>**</span>}, reason<span style=color:#f92672>=</span>The model used to open the store is incompatible with the one used to create the store}<span style=color:#f92672>**</span>
</code></pre></div><p>错误原因写的比较清楚了，reason=The model used to open the store is incompatible with the one used to create the store，这个是因为我新建了一张表，但是我没有打开轻量级的迁移Option。这里会有人会问了，我新建表从来没有出现这个错误啊？那是因为你们用的第三方框架就已经写好了改Option了。(场外人:这年头谁还自己从0开始写Core Data啊，肯定都用第三方框架啊)那这里我就当讲解原理了哈。如果是自己从0开始写的Core Data的话，这里是应该会报错了，解决办法当然是加上代码，利用Core Data的轻量级迁移，来防止这种找不到存储区的闪退问题</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objectivec data-lang=objectivec>
NSDictionary <span style=color:#f92672>*</span>options <span style=color:#f92672>=</span>
    <span style=color:#ae81ff>@{</span>
      NSSQLitePragmasOption: <span style=color:#ae81ff>@{</span><span style=color:#e6db74>@&#34;journal_mode&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>@&#34;DELETE&#34;</span><span style=color:#ae81ff>}</span>,
      NSMigratePersistentStoresAutomaticallyOption :<span style=color:#ae81ff>@YES</span>,
      NSInferMappingModelAutomaticallyOption:<span style=color:#ae81ff>@YES</span>
    <span style=color:#ae81ff>}</span>;
    
    NSError <span style=color:#f92672>*</span>error <span style=color:#f92672>=</span> nil;
    _store <span style=color:#f92672>=</span> [_coordinator addPersistentStoreWithType:NSSQLiteStoreType
                                        configuration:nil
                                                  URL:[self storeURL]
                                              options:options error:<span style=color:#f92672>&amp;</span>error];
</code></pre></div><p>这里说一下新增加的2个参数的意义：<br>NSMigratePersistentStoresAutomaticallyOption = YES，那么Core Data会试着把之前低版本的出现不兼容的持久化存储区迁移到新的模型中，这里的例子里，Core Data就能识别出是新表，就会新建出新表的存储区来，上面就不会报上面的error了。</p><p>NSInferMappingModelAutomaticallyOption = YES,这个参数的意义是Core Data会根据自己认为最合理的方式去尝试MappingModel，从源模型实体的某个属性，映射到目标模型实体的某个属性。</p><p>接着我们来看看MagicRecord源码是怎么写的，所以大家才能执行一些操作不会出现我上面说的闪退的问题</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objectivec data-lang=objectivec>
+ (NSDictionary <span style=color:#f92672>*</span>) <span style=color:#a6e22e>MR_autoMigrationOptions</span>;
{
    <span style=color:#75715e>// Adding the journalling mode recommended by apple
</span><span style=color:#75715e></span>    NSMutableDictionary <span style=color:#f92672>*</span>sqliteOptions <span style=color:#f92672>=</span> [NSMutableDictionary dictionary];
    [sqliteOptions setObject:<span style=color:#e6db74>@&#34;WAL&#34;</span> forKey:<span style=color:#e6db74>@&#34;journal_mode&#34;</span>];
    
    NSDictionary <span style=color:#f92672>*</span>options <span style=color:#f92672>=</span> [NSDictionary dictionaryWithObjectsAndKeys:
                             [NSNumber numberWithBool:YES], NSMigratePersistentStoresAutomaticallyOption,
                             [NSNumber numberWithBool:YES], NSInferMappingModelAutomaticallyOption,
                             sqliteOptions, NSSQLitePragmasOption,
                             nil];
    <span style=color:#66d9ef>return</span> options;
}
</code></pre></div><p>上面这一段就是MagicRecord源码里面替大家加的Core Data轻量级的数据迁移的保护了，所以大家不写那2个参数，一样不会报错。(题外话：MagicRecord默认这里是开启了WAL日志记录模式了) 此处如果大家注销掉那两个参数，或者把参数的值设置为NO，再运行一次，新建一张表，就会出现我上面提到的错误了。大家可以实践实践，毕竟实践出真知嘛。</p><p>只要打开上面2个参数，Core Data就会执行自己的轻量级迁移了，当然，在实体属性迁移时候，用该方式不靠谱，之前我觉得它肯定能推断出来，结果后来还是更新后直接闪退报错了，可能是因为表结构太复杂，超过了它简单推断的能力范围了，所以我建议，在进行复杂的实体属性迁移到另一个属性迁移的时候，不要太相信这种方式，还是最好自己Mapping一次。当然，你要是新建一张表的时候，这2个参数是必须要加上的！！！</p><p>####二.Core Data手动创建Mapping文件进行迁移
这种方式比前一种方式要更加精细一些，Mapping文件会指定哪个实体的某个属性迁移到哪个实体的某个属性，这比第一种交给Core Data自己去推断要靠谱一些，这种方法直接指定映射！<br>先说一下，如果复杂的迁移，不加入这个Mapping文件会出现什么样的错误</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objectivec data-lang=objectivec>
<span style=color:#f92672>**</span>Failed to add store. Error: Error Domain<span style=color:#f92672>=</span>NSCocoaErrorDomain Code<span style=color:#f92672>=</span><span style=color:#ae81ff>134140</span> <span style=color:#e6db74>&#34;(null)&#34;</span> UserInfo<span style=color:#f92672>=</span>{destinationModel<span style=color:#f92672>=</span>(<span style=color:#f92672>&lt;</span>NSManagedObjectModel: <span style=color:#ae81ff>0x7f82d4935280</span><span style=color:#f92672>&gt;</span>) isEditable <span style=color:#ae81ff>0</span>, entities {<span style=color:#f92672>**</span>
<span style=color:#f92672>**</span>    Amount <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;(&lt;NSEntityDescription: 0x7f82d4931960&gt;) name Amount, managedObjectClassName NSManagedObject, renamingIdentifier Amount, isAbstract 0, superentity name (null), properties {</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>    qwe = </span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>(&lt;NSAttributeDescription: 0x7f82d4930f40&gt;), name qwe, isOptional 1, isTransient 0, entity Amount, renamingIdentifier qwe, validation predicates (</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n), warnings (</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n), versionHashModifier (null)</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n userInfo {</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n}, attributeType 700 , attributeValueClassName NSString, defaultValue (null)</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>}, subentities {</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>}, userInfo {</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>}, versionHashModifier (null), uniquenessConstraints (</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>)&#34;</span>;<span style=color:#f92672>**</span>
<span style=color:#f92672>**</span>    Item <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;(&lt;NSEntityDescription: 0x7f82d4931a10&gt;) name Item, managedObjectClassName Item, renamingIdentifier Item, isAbstract 0, superentity name (null), properties {</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>    collected = </span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>(&lt;NSAttributeDescription: 0x7f82d4930fd0&gt;), name collected, isOptional 1, isTransient 0, entity Item, renamingIdentifier collected, validation predicates (</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n), warnings (</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n), versionHashModifier (null)</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n userInfo {</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n}, attributeType 800 , attributeValueClassName NSNumber, defaultValue 0</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>    listed = </span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>(&lt;NSAttributeDescription: 0x7f82d4931060&gt;), name listed, isOptional 1, isTransient 0, entity Item, renamingIdentifier listed, validation predicates (</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n), warnings (</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n), versionHashModifier (null)</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n userInfo {</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n}, attributeType 800 , attributeValueClassName NSNumber, defaultValue 1</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>    name = </span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>(&lt;NSAttributeDescription: 0x7f82d49310f0&gt;), name name, isOptional 1, isTransient 0, entity Item, renamingIdentifier name, validation predicates (</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n), warnings (</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n), versionHashModifier (null)</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n userInfo {</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n}, attributeType 700 , attributeValueClassName NSString, defaultValue New Item</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>    photoData = </span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>(&lt;NSAttributeDescription: 0x7f82d4931180&gt;), name photoData, isOptional 1, isTransient 0, entity Item, renamingIdentifier photoData, validation predicates (</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n), warnings (</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n), versionHashModifier (null)</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n userInfo {</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n}, attributeType 1000 , attributeValueClassName NSData, defaultValue (null)</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>    quantity = </span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>(&lt;NSAttributeDescription: 0x7f82d4931210&gt;), name quantity, isOptional 1, isTransient 0, entity Item, renamingIdentifier quantity, validation predicates (</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n), warnings (</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n), versionHashModifier (null)</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n userInfo {</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n}, attributeType 600 , attributeValueClassName NSNumber, defaultValue 1</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>}, subentities {</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>}, userInfo {</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>}, versionHashModifier (null), uniquenessConstraints (</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>)&#34;</span>;<span style=color:#f92672>**</span>
<span style=color:#f92672>**</span>}, fetch request templates {<span style=color:#f92672>**</span>
<span style=color:#f92672>**</span>    Test <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&lt;NSFetchRequest: 0x7f82d49316c0&gt; (entity: Item; predicate: (name CONTAINS </span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>e</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>); sortDescriptors: ((null)); type: NSManagedObjectResultType; )&#34;</span>;<span style=color:#f92672>**</span>
<span style=color:#f92672>**</span>}, sourceModel<span style=color:#f92672>=</span>(<span style=color:#f92672>&lt;</span>NSManagedObjectModel: <span style=color:#ae81ff>0x7f82d488e930</span><span style=color:#f92672>&gt;</span>) isEditable <span style=color:#ae81ff>1</span>, entities {<span style=color:#f92672>**</span>
<span style=color:#f92672>**</span>    Amount <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;(&lt;NSEntityDescription: 0x7f82d488f880&gt;) name Amount, managedObjectClassName NSManagedObject, renamingIdentifier Amount, isAbstract 0, superentity name (null), properties {</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>    abc = </span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>(&lt;NSAttributeDescription: 0x7f82d488f9d0&gt;), name abc, isOptional 1, isTransient 0, entity Amount, renamingIdentifier abc, validation predicates (</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n), warnings (</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n), versionHashModifier (null)</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n userInfo {</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n}, attributeType 700 , attributeValueClassName NSString, defaultValue (null)</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>}, subentities {</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>}, userInfo {</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>}, versionHashModifier (null), uniquenessConstraints (</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>)&#34;</span>;<span style=color:#f92672>**</span>
<span style=color:#f92672>**</span>    Item <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;(&lt;NSEntityDescription: 0x7f82d488fbe0&gt;) name Item, managedObjectClassName NSManagedObject, renamingIdentifier Item, isAbstract 0, superentity name (null), properties {</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>    collected = </span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>(&lt;NSAttributeDescription: 0x7f82d48901c0&gt;), name collected, isOptional 1, isTransient 0, entity Item, renamingIdentifier collected, validation predicates (</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n), warnings (</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n), versionHashModifier (null)</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n userInfo {</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n}, attributeType 800 , attributeValueClassName NSNumber, defaultValue 0</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>    listed = </span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>(&lt;NSAttributeDescription: 0x7f82d488fd20&gt;), name listed, isOptional 1, isTransient 0, entity Item, renamingIdentifier listed, validation predicates (</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n), warnings (</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n), versionHashModifier (null)</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n userInfo {</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n}, attributeType 800 , attributeValueClassName NSNumber, defaultValue 1</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>    name = </span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>(&lt;NSAttributeDescription: 0x7f82d488fdb0&gt;), name name, isOptional 1, isTransient 0, entity Item, renamingIdentifier name, validation predicates (</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n), warnings (</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n), versionHashModifier (null)</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n userInfo {</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n}, attributeType 700 , attributeValueClassName NSString, defaultValue New Item</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>    photoData = </span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>(&lt;NSAttributeDescription: 0x7f82d488fad0&gt;), name photoData, isOptional 1, isTransient 0, entity Item, renamingIdentifier photoData, validation predicates (</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n), warnings (</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n), versionHashModifier (null)</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n userInfo {</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n}, attributeType 1000 , attributeValueClassName NSData, defaultValue (null)</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>    quantity = </span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>(&lt;NSAttributeDescription: 0x7f82d488fc90&gt;), name quantity, isOptional 1, isTransient 0, entity Item, renamingIdentifier quantity, validation predicates (</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n), warnings (</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n), versionHashModifier (null)</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n userInfo {</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n}, attributeType 600 , attributeValueClassName NSNumber, defaultValue 1</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>}, subentities {</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>}, userInfo {</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>}, versionHashModifier (null), uniquenessConstraints (</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>)&#34;</span>;<span style=color:#f92672>**</span>
<span style=color:#f92672>**</span>}, fetch request templates {<span style=color:#f92672>**</span>
<span style=color:#f92672>**</span>    Test <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&lt;NSFetchRequest: 0x7f82d488fa60&gt; (entity: Item; predicate: (name CONTAINS </span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>e</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>); sortDescriptors: ((null)); type: NSManagedObjectResultType; )&#34;</span>;<span style=color:#f92672>**</span>
<span style=color:#f92672>**</span>}, reason<span style=color:#f92672>=</span>Can<span style=color:#960050;background-color:#1e0010>&#39;</span>t find mapping model <span style=color:#66d9ef>for</span> migration}<span style=color:#f92672>**</span>
</code></pre></div><p>直接看最后一行错误的原因Can&rsquo;t find mapping model for migration，这直接说出了错误的原因，那么接下来我们就创建一个Mapping Model文件。</p><p>在你xcdatamodeld相同的文件夹目录下，“New File” ->"Core Data&rdquo;->"Mapping Model&rdquo;</p><p><img src=https://img.halfrost.com/Blog/ArticleImage/7_4.png alt></p><p>选择需要Mapping的源数据库</p><p><img src=https://img.halfrost.com/Blog/ArticleImage/7_5.png alt></p><p>再选择目标数据库</p><p><img src=https://img.halfrost.com/Blog/ArticleImage/7_6.png alt></p><p>接着命名一下Mapping Model文件的名字</p><p><img src=https://img.halfrost.com/Blog/ArticleImage/7_7.png alt></p><p>这里说明一下，名字最好能一眼看上去就能区分出是哪个数据库的版本升级上来的，这里我写的就是ModelV4ToV5，这样一看就知道是V4到V5的升级。</p><p>这里说明一下Mapping文件的重要性，首先，每个版本的数据库之间都最好能加上一个Mapping文件，这样从低版本的数据库升级上来，可以保证每个版本都不会出错，都不会导致用户升级之后就出现闪退的问题。</p><p><img src=https://img.halfrost.com/Blog/ArticleImage/7_8.png alt></p><p>比如上图，每个数据库之间都会对应一个Mapping文件，V0ToV1,V1ToV2,V2ToV3,V3ToV4,V4ToV5,每个Mapping都必须要。</p><p>试想，如果用户实在V3的老版本上，由于appstore的更新规则，每次更新都直接更新到最新，那么用户更新之后就会直接到V5，如果缺少了中间的V3ToV4,V4ToV5，中的任意一个，那么V3的用户都无法升级到V5上来，都会闪退。所以这里就看出了每个版本之间都要加上Mapping文件的重要性了。这样任意低版本的用户，任何时刻都可以通过Mapping文件，随意升级到最新版，而且不会闪退了！</p><p>接下来再说说Mapping文件打开是些什么东西。</p><p><img src=https://img.halfrost.com/Blog/ArticleImage/7_9.png alt></p><p>Mapping文件打开对应的就是Source源实体属性，迁移到Target目标实体属性的映射，上面是属性，下面是关系的映射。$source就是代表的源实体</p><p>写到这里，就可以很清楚的区分一下到目前为止，Core Data轻量级迁移和手动创建Mapping进行迁移，这2种方法的异同点了。我简单总结一下：
1.Core Data轻量级迁移是适用于添加新表，添加新的实体，添加新的实体属性，等简单的，系统能自己推断出来的迁移方式。
2.手动创建Mapping适用于更加复杂的数据迁移</p><p>举个例子吧，假设我最初有一张很抽象的表，叫Object表，用来存储东西的一些属性，里面假设有name，width，height。突然我有一天有新需求了，需要在Object表里面新增几个字段，比如说colour，weight等，由于这个都是简单的新增，不涉及到数据的转移，这时候用轻量级迁移就可以了。</p><p>不过突然有一个程序又有新需求了，需要增加2张表，一个是Human表，一个是Animal表，需要把当初抽象定义的Object表更加具体化。这时就需要把Object里面的人都抽出来，放到新建的Human表里，动物也都抽出来放到新建的Animal表里。由于新建的2张表都会有name属性，如果这个时候进行轻量级的迁移，系统可能推断不出到底哪些name要到Human表里，哪里要Animal表了。再者，还有一些属性在Human表里面有，在Animal表里面没有。这是时候就必须手动添加一个Mapping Model文件了，手动指定哪些属性是源实体的属性，应该映射到目标实体的哪个属性上面去。这种更加精细的迁移方式，就只能用手动添加Mapping Model来完成了，毕竟iOS系统不知道你的需求和想法。</p><p>####三.通过代码实现数据迁移
这个通过代码进行迁移主要是在数据迁移过程中，如果你还想做一些什么其他事情，比如说你想清理一下垃圾数据，实时展示数据迁移的进度，等等，那就需要在这里来实现了。</p><p>首先，我们需要检查一下该存储区存不存在，再把存储区里面的model metadata进行比较，检查一下是否兼容，如果不能兼容，那么就需要我们进行数据迁移了。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objectivec data-lang=objectivec>- (<span style=color:#66d9ef>BOOL</span>)<span style=color:#a6e22e>isMigrationNecessaryForStore:</span>(NSURL<span style=color:#f92672>*</span>)storeUrl
{
    NSLog(<span style=color:#e6db74>@&#34;Running %@ &#39;%@&#39;&#34;</span>, self.<span style=color:#66d9ef>class</span>, NSStringFromSelector(_cmd));
    
    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>[[NSFileManager defaultManager] fileExistsAtPath:[self storeURL].path])
    {
        NSLog(<span style=color:#e6db74>@&#34;SKIPPED MIGRATION: Source database missing.&#34;</span>);
        <span style=color:#66d9ef>return</span> NO;
    }
    
    NSError <span style=color:#f92672>*</span>error <span style=color:#f92672>=</span> nil;
    NSDictionary <span style=color:#f92672>*</span>sourceMetadata <span style=color:#f92672>=</span>
    [NSPersistentStoreCoordinator metadataForPersistentStoreOfType:NSSQLiteStoreType
                                                               URL:storeUrl error:<span style=color:#f92672>&amp;</span>error];
    NSManagedObjectModel <span style=color:#f92672>*</span>destinationModel <span style=color:#f92672>=</span> _coordinator.managedObjectModel;
    
    <span style=color:#66d9ef>if</span> ([destinationModel isConfiguration:nil compatibleWithStoreMetadata:sourceMetadata])
    {
        NSLog(<span style=color:#e6db74>@&#34;SKIPPED MIGRATION: Source is already compatible&#34;</span>);
        <span style=color:#66d9ef>return</span> NO;
    }
    
    <span style=color:#66d9ef>return</span> YES;
}
</code></pre></div><p>当上面函数返回YES，我们就需要合并了，那接下来就是下面的函数了</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objectivec data-lang=objectivec>- (<span style=color:#66d9ef>BOOL</span>)<span style=color:#a6e22e>migrateStore:</span>(NSURL<span style=color:#f92672>*</span>)sourceStore {
    
    NSLog(<span style=color:#e6db74>@&#34;Running %@ &#39;%@&#39;&#34;</span>, self.<span style=color:#66d9ef>class</span>, NSStringFromSelector(_cmd));
    <span style=color:#66d9ef>BOOL</span> success <span style=color:#f92672>=</span> NO;
    NSError <span style=color:#f92672>*</span>error <span style=color:#f92672>=</span> nil;
    
    <span style=color:#75715e>// STEP 1 - 收集 Source源实体, Destination目标实体 和 Mapping Model文件
</span><span style=color:#75715e></span>    NSDictionary <span style=color:#f92672>*</span>sourceMetadata <span style=color:#f92672>=</span> [NSPersistentStoreCoordinator
                                    metadataForPersistentStoreOfType:NSSQLiteStoreType
                                    URL:sourceStore
                                    error:<span style=color:#f92672>&amp;</span>error];
    
    NSManagedObjectModel <span style=color:#f92672>*</span>sourceModel <span style=color:#f92672>=</span>
    [NSManagedObjectModel mergedModelFromBundles:nil
                                forStoreMetadata:sourceMetadata];
    
    NSManagedObjectModel <span style=color:#f92672>*</span>destinModel <span style=color:#f92672>=</span> _model;
    
    NSMappingModel <span style=color:#f92672>*</span>mappingModel <span style=color:#f92672>=</span>
    [NSMappingModel mappingModelFromBundles:nil
                             forSourceModel:sourceModel
                           destinationModel:destinModel];
    
    <span style=color:#75715e>// STEP 2 - 开始执行 migration合并, 前提是 mapping model 不是空，或者存在
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (mappingModel) {
        NSError <span style=color:#f92672>*</span>error <span style=color:#f92672>=</span> nil;
        NSMigrationManager <span style=color:#f92672>*</span>migrationManager <span style=color:#f92672>=</span>
        [[NSMigrationManager alloc] initWithSourceModel:sourceModel
                                       destinationModel:destinModel];
        [migrationManager addObserver:self
                           forKeyPath:<span style=color:#e6db74>@&#34;migrationProgress&#34;</span>
                              options:NSKeyValueObservingOptionNew
                              context:NULL];
        
        NSURL <span style=color:#f92672>*</span>destinStore <span style=color:#f92672>=</span>
        [[self applicationStoresDirectory]
         URLByAppendingPathComponent:<span style=color:#e6db74>@&#34;Temp.sqlite&#34;</span>];
        
        success <span style=color:#f92672>=</span>
        [migrationManager migrateStoreFromURL:sourceStore
                                         type:NSSQLiteStoreType options:nil
                             withMappingModel:mappingModel
                             toDestinationURL:destinStore
                              destinationType:NSSQLiteStoreType
                           destinationOptions:nil
                                        error:<span style=color:#f92672>&amp;</span>error];
        <span style=color:#66d9ef>if</span> (success)
        {
            <span style=color:#75715e>// STEP 3 - 用新的migrated store替换老的store
</span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> ([self replaceStore:sourceStore withStore:destinStore])
            {
                NSLog(<span style=color:#e6db74>@&#34;SUCCESSFULLY MIGRATED %@ to the Current Model&#34;</span>,
                          sourceStore.path);
                [migrationManager removeObserver:self
                                      forKeyPath:<span style=color:#e6db74>@&#34;migrationProgress&#34;</span>];
            }
        }
        <span style=color:#66d9ef>else</span>
        {
            NSLog(<span style=color:#e6db74>@&#34;FAILED MIGRATION: %@&#34;</span>,error);
        }
    }
    <span style=color:#66d9ef>else</span>
    {
        NSLog(<span style=color:#e6db74>@&#34;FAILED MIGRATION: Mapping Model is null&#34;</span>);
    }
    
    <span style=color:#66d9ef>return</span> YES; <span style=color:#75715e>// migration已经完成
</span><span style=color:#75715e></span>}
</code></pre></div><p>上面的函数中，如果迁移进度有变化，会通过观察者，observeValueForKeyPath来告诉用户进度，这里可以监听该进度，如果没有完成，可以来禁止用户执行某些操作</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objectivec data-lang=objectivec>
- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>observeValueForKeyPath:</span>(NSString <span style=color:#f92672>*</span>)keyPath
                      <span style=color:#a6e22e>ofObject:</span>(<span style=color:#66d9ef>id</span>)object
                        <span style=color:#a6e22e>change:</span>(NSDictionary <span style=color:#f92672>*</span>)change
                       <span style=color:#a6e22e>context:</span>(<span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>)context {
    
    <span style=color:#66d9ef>if</span> ([keyPath isEqualToString:<span style=color:#e6db74>@&#34;migrationProgress&#34;</span>]) {
        
        dispatch_async(dispatch_get_main_queue(), <span style=color:#f92672>^</span>{
            
            <span style=color:#66d9ef>float</span> progress <span style=color:#f92672>=</span>
            [[change objectForKey:NSKeyValueChangeNewKey] floatValue];
          
            <span style=color:#66d9ef>int</span> percentage <span style=color:#f92672>=</span> progress <span style=color:#f92672>*</span> <span style=color:#ae81ff>100</span>;
            NSString <span style=color:#f92672>*</span>string <span style=color:#f92672>=</span>
            [NSString stringWithFormat:<span style=color:#e6db74>@&#34;Migration Progress: %i%%&#34;</span>,
             percentage];
            NSLog(<span style=color:#e6db74>@&#34;%@&#34;</span>,string);

        });
    }
}
</code></pre></div><p>当然，这个合并数据迁移的操作肯定是用一个多线程异步的执行，免得造成用户界面卡顿，再加入下面的方法，我们来异步执行</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objectivec data-lang=objectivec>
- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>performBackgroundManagedMigrationForStore:</span>(NSURL<span style=color:#f92672>*</span>)storeURL
{
    NSLog(<span style=color:#e6db74>@&#34;Running %@ &#39;%@&#39;&#34;</span>, self.<span style=color:#66d9ef>class</span>, NSStringFromSelector(_cmd));
    
    dispatch_async(
                   dispatch_get_global_queue( DISPATCH_QUEUE_PRIORITY_BACKGROUND, <span style=color:#ae81ff>0</span>), <span style=color:#f92672>^</span>{
                       <span style=color:#66d9ef>BOOL</span> done <span style=color:#f92672>=</span> [self migrateStore:storeURL];
                       <span style=color:#66d9ef>if</span>(done) {
                           dispatch_async(dispatch_get_main_queue(), <span style=color:#f92672>^</span>{
                               NSError <span style=color:#f92672>*</span>error <span style=color:#f92672>=</span> nil;
                               _store <span style=color:#f92672>=</span>
                               [_coordinator addPersistentStoreWithType:NSSQLiteStoreType
                                                          configuration:nil
                                                                    URL:[self storeURL]
                                                                options:nil
                                                                  error:<span style=color:#f92672>&amp;</span>error];
                               <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>_store) {
                                   NSLog(<span style=color:#e6db74>@&#34;Failed to add a migrated store. Error: %@&#34;</span>,
                                         error);abort();}
                               <span style=color:#66d9ef>else</span> {
                                   NSLog(<span style=color:#e6db74>@&#34;Successfully added a migrated store: %@&#34;</span>,
                                         _store);}
                           });
                       }
                   });
}
</code></pre></div><p>到这里，数据迁移都完成了，不过目前还有一个问题就是，我们应该何时去执行该迁移的操作，更新完毕之后？appDelegate一进来？都不好，最好的方法还是在把当前存储区添加到coordinator之前，我们就执行好数据迁移！</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objectivec data-lang=objectivec>- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>loadStore</span>
{
    NSLog(<span style=color:#e6db74>@&#34;Running %@ &#39;%@&#39;&#34;</span>, self.<span style=color:#66d9ef>class</span>, NSStringFromSelector(_cmd));
    
    <span style=color:#66d9ef>if</span> (_store) {<span style=color:#66d9ef>return</span>;} <span style=color:#75715e>// 不要再次加载了，因为已经加载过了
</span><span style=color:#75715e></span>    
    <span style=color:#66d9ef>BOOL</span> useMigrationManager <span style=color:#f92672>=</span> NO;
    <span style=color:#66d9ef>if</span> (useMigrationManager <span style=color:#f92672>&amp;&amp;</span>
        [self isMigrationNecessaryForStore:[self storeURL]])
    {
        [self performBackgroundManagedMigrationForStore:[self storeURL]];
    }
    <span style=color:#66d9ef>else</span>
    {
        NSDictionary <span style=color:#f92672>*</span>options <span style=color:#f92672>=</span>
        <span style=color:#ae81ff>@{</span>
          NSMigratePersistentStoresAutomaticallyOption:<span style=color:#ae81ff>@YES</span>
          ,NSInferMappingModelAutomaticallyOption:<span style=color:#ae81ff>@YES</span>
          ,NSSQLitePragmasOption: <span style=color:#ae81ff>@{</span><span style=color:#e6db74>@&#34;journal_mode&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>@&#34;DELETE&#34;</span><span style=color:#ae81ff>}</span>
          <span style=color:#ae81ff>}</span>;
        NSError <span style=color:#f92672>*</span>error <span style=color:#f92672>=</span> nil;
        _store <span style=color:#f92672>=</span> [_coordinator addPersistentStoreWithType:NSSQLiteStoreType
                                            configuration:nil
                                                      URL:[self storeURL]
                                                  options:options
                                                    error:<span style=color:#f92672>&amp;</span>error];
        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>_store)
        {
            NSLog(<span style=color:#e6db74>@&#34;Failed to add store. Error: %@&#34;</span>, error);abort();
        }
        <span style=color:#66d9ef>else</span>
        {
            NSLog(<span style=color:#e6db74>@&#34;Successfully added store: %@&#34;</span>, _store);
        }
    }

}
</code></pre></div><p>这样就完成了数据迁移了，并且还能显示出迁移进度，在迁移中还可以自定义一些操作，比如说清理垃圾数据，删除一些不用的表，等等。</p><p>####结束
好了，到此，Core Data数据迁移的几种方式我就和大家分享完了，如果文中有不对的地方，欢迎大家提出来，我们一起交流进步！</p><img src=https://img.halfrost.com/wechat-qr-code.png></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=https://books.halfrost.com/>Books</a></li><li><a href=https://github.com/halfrost/Halfrost-Field>Github</a></li><li><a href=https://halfrost.me/>About</a></li><li><a href=/index.xml>RSS</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents></nav></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fnew.halfrost.com%2fios_coredata_migration%2f"><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fnew.halfrost.com%2fios_coredata_migration%2f&text=iOS%20Core%20Data%20%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb%20%e6%8c%87%e5%8d%97"><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fnew.halfrost.com%2fios_coredata_migration%2f&title=iOS%20Core%20Data%20%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb%20%e6%8c%87%e5%8d%97"><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fnew.halfrost.com%2fios_coredata_migration%2f&is_video=false&description=iOS%20Core%20Data%20%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb%20%e6%8c%87%e5%8d%97"><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=iOS%20Core%20Data%20%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb%20%e6%8c%87%e5%8d%97&body=Check out this article: https%3a%2f%2fnew.halfrost.com%2fios_coredata_migration%2f"><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fnew.halfrost.com%2fios_coredata_migration%2f&title=iOS%20Core%20Data%20%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb%20%e6%8c%87%e5%8d%97"><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fnew.halfrost.com%2fios_coredata_migration%2f&title=iOS%20Core%20Data%20%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb%20%e6%8c%87%e5%8d%97"><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fnew.halfrost.com%2fios_coredata_migration%2f&title=iOS%20Core%20Data%20%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb%20%e6%8c%87%e5%8d%97"><i class="fab fa-stumbleupon fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://digg.com/submit?url=https%3a%2f%2fnew.halfrost.com%2fios_coredata_migration%2f&title=iOS%20Core%20Data%20%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb%20%e6%8c%87%e5%8d%97"><i class="fab fa-digg fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fnew.halfrost.com%2fios_coredata_migration%2f&name=iOS%20Core%20Data%20%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb%20%e6%8c%87%e5%8d%97&description=%23%23%23%23%e5%89%8d%e8%a8%80%20Core%20Data%e6%98%afiOS%e4%b8%8a%e4%b8%80%e4%b8%aa%e6%95%88%e7%8e%87%e6%af%94%e8%be%83%e9%ab%98%e7%9a%84%e6%95%b0%e6%8d%ae%e5%ba%93%e6%a1%86%e6%9e%b6%ef%bc%8c%28%e4%bd%86%e6%98%afCore%20Data%e5%b9%b6%e4%b8%8d%e6%98%af%e4%b8%80%e7%a7%8d%e6%95%b0%e6%8d%ae%e5%ba%93%ef%bc%8c%e5%ae%83%e5%ba%95%e5%b1%82%e8%bf%98%e6%98%af%e5%88%a9%e7%94%a8Sqlite3%e6%9d%a5%e5%ad%98%e5%82%a8%e6%95%b0%e6%8d%ae%e7%9a%84%29%ef%bc%8c%e5%ae%83%e5%8f%af%e4%bb%a5%e6%8a%8a%e6%95%b0%e6%8d%ae%e5%bd%93%e6%88%90%e5%af%b9%e8%b1%a1%e6%9d%a5%e6%93%8d%e4%bd%9c%ef%bc%8c%e8%80%8c%e4%b8%94%e5%bc%80%e5%8f%91%e8%80%85%e5%b9%b6%e4%b8%8d%e9%9c%80%e8%a6%81%e5%9c%a8%e4%b9%8e%e6%95%b0%e6%8d%ae%e5%9c%a8%e7%a3%81%e7%9b%98%e4%b8%8a%e9%9d%a2%e7%9a%84%e5%ad%98%e5%82%a8%e6%96%b9%e5%bc%8f%e3%80%82%e5%ae%83%e4%bc%9a%e6%8a%8a%e4%bd%8d%e4%ba%8eNSManagedObject%20Context%e9%87%8c%e9%9d%a2%e7%9a%84%e6%89%98%e7%ae%a1%e5%af%b9%e8%b1%a1NSManagedObject%e7%b1%bb%e7%9a%84%e5%ae%9e%e4%be%8b%e6%88%96%e8%80%85%e6%9f%90%e4%b8%aaNSManagedObject%e5%ad%90%e7%b1%bb%e7%9a%84%e5%ae%9e%e4%be%8b%ef%bc%8c%e9%80%9a%e8%bf%87NSManagedObjectModel%e6%89%98%e7%ae%a1%e5%af%b9%e8%b1%a1%e6%a8%a1%e5%9e%8b%ef%bc%8c%e6%8a%8a%e6%89%98%e7%ae%a1%e5%af%b9%e8%b1%a1%e4%bf%9d%e5%ad%98%e5%88%b0%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8%e5%8d%8f%e8%b0%83%e5%99%a8NSPersistentStoreCoordinator%e6%8c%81%e6%9c%89%e7%9a%84%e4%b8%80%e4%b8%aa%e6%88%96%e8%80%85%e5%a4%9a%e4%b8%aa%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8%e5%8c%ba%e4%b8%adNSPersistentStore%e4%b8%ad%e3%80%82%e4%bd%bf%e7%94%a8Core%20Data%e8%bf%9b%e8%a1%8c%e6%9f%a5%e8%af%a2%e7%9a%84%e8%af%ad%e5%8f%a5%e9%83%bd%e6%98%af%e7%bb%8f%e8%bf%87Apple%e7%89%b9%e5%88%ab%e4%bc%98%e5%8c%96%e8%bf%87%e7%9a%84%ef%bc%8c%e6%89%80%e4%bb%a5%e9%83%bd%e6%98%af%e6%95%88%e7%8e%87%e5%be%88%e9%ab%98%e7%9a%84%e6%9f%a5%e8%af%a2%e3%80%82%0a%e5%bd%93%e4%bd%a0%e8%bf%9b%e8%a1%8c%e7%ae%80%e5%8d%95%e7%9a%84%e8%ae%be%e5%ae%9a%ef%bc%8c%e6%af%94%e5%a6%82%e8%af%b4%e8%ae%be%e5%ae%9a%e6%9f%90%e4%b8%aa%e5%ae%9e%e4%bd%93%e7%9a%84%e9%bb%98%e8%ae%a4%e5%80%bc%ef%bc%8c%e8%ae%be%e5%ae%9a%e7%ba%a7%e8%81%94%e5%88%a0%e9%99%a4%e7%9a%84%e6%93%8d%e4%bd%9c%ef%bc%8c%e8%ae%be%e5%ae%9a%e6%95%b0%e6%8d%ae%e7%9a%84%e9%aa%8c%e8%af%81%e8%a7%84%e5%88%99%ef%bc%8c%e4%bd%bf%e7%94%a8%e6%95%b0%e6%8d%ae%e7%9a%84%e8%af%b7%e6%b1%82%e6%a8%a1%e6%9d%bf%ef%bc%8c%e8%bf%99%e4%ba%9b%e4%bf%ae%e6%94%b9Core%20Data%e9%83%bd%e4%bc%9a%e8%87%aa%e5%b7%b1%e5%ae%8c%e6%88%90%ef%bc%8c%e4%b8%8d%e7%94%a8%e8%87%aa%e5%b7%b1%e8%bf%9b%e8%a1%8c%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb%e3%80%82%e9%82%a3%e9%82%a3%e4%ba%9b%e6%93%8d%e4%bd%9c%e9%9c%80%e8%a6%81%e6%88%91%e4%bb%ac%e8%bf%9b%e8%a1%8c%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb%e5%91%a2%ef%bc%9f%e5%87%a1%e6%98%af%e4%bc%9a%e5%bc%95%e8%b5%b7NSManagedObjectModel%e6%89%98%e7%ae%a1%e5%af%b9%e8%b1%a1%e6%a8%a1%e5%9e%8b%e5%8f%98%e5%8c%96%e7%9a%84%ef%bc%8c%e9%83%bd%e6%9c%80%e5%a5%bd%e8%bf%9b%e8%a1%8c%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb%ef%bc%8c%e9%98%b2%e6%ad%a2%e7%94%a8%e6%88%b7%e5%8d%87%e7%ba%a7%e5%ba%94%e7%94%a8%e4%b9%8b%e5%90%8e%e5%b0%b1%e9%97%aa%e9%80%80%e3%80%82%e4%bc%9a%e5%bc%95%e8%b5%b7NSManagedObjectModel%e6%89%98%e7%ae%a1%e5%af%b9%e8%b1%a1%e6%a8%a1%e5%9e%8b%e5%8f%98%e5%8c%96%e7%9a%84%e6%9c%89%e4%bb%a5%e4%b8%8b%e5%87%a0%e4%b8%aa%e6%93%8d%e4%bd%9c%ef%bc%8c%e6%96%b0%e5%a2%9e%e4%ba%86%e4%b8%80%e5%bc%a0%e8%a1%a8%ef%bc%8c%e6%96%b0%e5%a2%9e%e4%ba%86%e4%b8%80%e5%bc%a0%e8%a1%a8%e9%87%8c%e9%9d%a2%e7%9a%84%e4%b8%80%e4%b8%aa%e5%ae%9e%e4%bd%93%ef%bc%8c%e6%96%b0%e5%a2%9e%e4%b8%80%e4%b8%aa%e5%ae%9e%e4%bd%93%e7%9a%84%e4%b8%80%e4%b8%aa%e5%b1%9e%e6%80%a7%ef%bc%8c%e6%8a%8a%e4%b8%80%e4%b8%aa%e5%ae%9e%e4%bd%93%e7%9a%84%e6%9f%90%e4%b8%aa%e5%b1%9e%e6%80%a7%e8%bf%81%e7%a7%bb%e5%88%b0%e5%8f%a6%e5%a4%96%e4%b8%80%e4%b8%aa%e5%ae%9e%e4%bd%93%e7%9a%84%e6%9f%90%e4%b8%aa%e5%b1%9e%e6%80%a7%e9%87%8c%e9%9d%a2%e2%80%a6%e2%80%a6%e2%80%a6%e2%80%a6%e5%a4%a7%e5%ae%b6%e5%ba%94%e8%af%a5%e7%8e%b0%e5%9c%a8%e9%83%bd%e7%9f%a5%e9%81%93%e5%93%aa%e4%ba%9b%e6%93%8d%e4%bd%9c%e9%9c%80%e8%a6%81%e8%bf%9b%e8%a1%8c%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb%e4%ba%86%e5%90%a7%e3%80%82%0a%23%23%23%23%e5%b0%8f%e6%8a%80%e5%b7%a7%ef%bc%9a%20%e8%bf%9b%e5%85%a5%e6%ad%a3%e9%a2%98%e4%b9%8b%e5%89%8d%ef%bc%8c%e6%88%91%e5%85%88%e8%af%b43%e4%b8%aa%e8%b0%83%e8%af%95Core%20Data%e9%87%8c%e9%9d%a2%e8%b0%83%e8%af%95%e5%8f%af%e8%83%bd%e4%bd%a0%e4%bc%9a%e9%9c%80%e8%a6%81%e7%9a%84%e6%93%8d%e4%bd%9c%e3%80%82%0a1.%e4%b8%80%e8%88%ac%e6%89%93%e5%bc%80app%e6%b2%99%e7%9b%92%e9%87%8c%e9%9d%a2%e7%9a%84%e4%bc%9a%e6%9c%89%e4%b8%89%e7%a7%8d%e7%b1%bb%e5%9e%8b%e7%9a%84%e6%96%87%e4%bb%b6%ef%bc%8csqlite%ef%bc%8csqlite-shm%2csqlite-wal%2c%e5%90%8e%e9%9d%a22%e8%80%85%e6%98%afiOS7%e4%b9%8b%e5%90%8e%e7%b3%bb%e7%bb%9f%e4%bc%9a%e9%bb%98%e8%ae%a4%e5%bc%80%e5%90%af%e4%b8%80%e4%b8%aa%e6%96%b0%e7%9a%84%e2%80%9c%e6%95%b0%e6%8d%ae%e5%ba%93%e6%97%a5%e5%bf%97%e8%ae%b0%e5%bd%95%e6%a8%a1%e5%bc%8f%e2%80%9d%28database%20journaling%20mode%29%e7%94%9f%e6%88%90%e7%9a%84%ef%bc%8csqlite-shm%e6%98%af%e5%85%b1%e4%ba%ab%e5%86%85%e5%ad%98%28Shared%20Memory%29%e6%96%87%e4%bb%b6%ef%bc%8c%e8%af%a5%e6%96%87%e4%bb%b6%e9%87%8c%e9%9d%a2%e4%bc%9a%e5%8c%85%e5%90%ab%e4%b8%80%e4%bb%bdsqlite-wal%e6%96%87%e4%bb%b6%e7%9a%84%e7%b4%a2%e5%bc%95%ef%bc%8c%e7%b3%bb%e7%bb%9f%e4%bc%9a%e8%87%aa%e5%8a%a8%e7%94%9f%e6%88%90shm%e6%96%87%e4%bb%b6%ef%bc%8c%e6%89%80%e4%bb%a5%e5%88%a0%e9%99%a4%e5%ae%83%ef%bc%8c%e4%b8%8b%e6%ac%a1%e8%bf%90%e8%a1%8c%e8%bf%98%e4%bc%9a%e7%94%9f%e6%88%90%e3%80%82sqlite-wal%e6%98%af%e9%a2%84%e5%86%99%e5%bc%8f%e6%97%a5%e5%bf%97%28Write-Ahead%20Log%29%e6%96%87%e4%bb%b6%ef%bc%8c%e8%bf%99%e4%b8%aa%e6%96%87%e4%bb%b6%e9%87%8c%e9%9d%a2%e4%bc%9a%e5%8c%85%e5%90%ab%e5%b0%9a%e6%9c%aa%e6%8f%90%e4%ba%a4%e7%9a%84%e6%95%b0%e6%8d%ae%e5%ba%93%e4%ba%8b%e5%8a%a1%ef%bc%8c%e6%89%80%e4%bb%a5%e7%9c%8b%e8%a7%81%e6%9c%89%e8%bf%99%e4%b8%aa%e6%96%87%e4%bb%b6%e4%ba%86%ef%bc%8c%e5%b0%b1%e4%bb%a3%e8%a1%a8%e6%95%b0%e6%8d%ae%e5%ba%93%e9%87%8c%e9%9d%a2%e8%bf%98%e6%9c%89%e8%bf%98%e6%b2%a1%e6%9c%89%e5%a4%84%e7%90%86%e5%ae%8c%e7%9a%84%e4%ba%8b%e5%8a%a1%e9%9c%80%e8%a6%81%e6%8f%90%e4%ba%a4%ef%bc%8c%e6%89%80%e4%bb%a5%e8%af%b4%e5%a6%82%e6%9e%9c%e6%9c%89sqlite-wal%e6%96%87%e4%bb%b6%ef%bc%8c%e5%86%8d%e5%8e%bb%e6%89%93%e5%bc%80sqlite%e6%96%87%e4%bb%b6%ef%bc%8c%e5%be%88%e5%8f%af%e8%83%bd%e6%9c%80%e8%bf%91%e4%b8%80%e6%ac%a1%e6%95%b0%e6%8d%ae%e5%ba%93%e6%93%8d%e4%bd%9c%e8%bf%98%e6%b2%a1%e6%9c%89%e6%89%a7%e8%a1%8c%e3%80%82%0a%e6%89%80%e4%bb%a5%e5%9c%a8%e8%b0%83%e8%af%95%e7%9a%84%e6%97%b6%e5%80%99%ef%bc%8c%e6%88%91%e4%bb%ac%e9%9c%80%e8%a6%81%e5%8d%b3%e6%97%b6%e7%9a%84%e8%a7%82%e5%af%9f%e6%95%b0%e6%8d%ae%e5%ba%93%e7%9a%84%e5%8f%98%e5%8c%96%ef%bc%8c%e6%88%91%e4%bb%ac%e5%b0%b1%e5%8f%af%e4%bb%a5%e5%85%88%e7%a6%81%e7%94%a8%e8%bf%99%e4%b8%aa%e6%97%a5%e5%bf%97%e8%ae%b0%e5%bd%95%e6%a8%a1%e5%bc%8f%ef%bc%8c%e5%8f%aa%e9%9c%80%e8%a6%81%e5%9c%a8%e5%bb%ba%e7%ab%8b%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8%e5%8c%ba%e7%9a%84%e6%97%b6%e5%80%99%e5%ad%98%e5%85%a5%e4%b8%80%e4%b8%aa%e5%8f%82%e6%95%b0%e5%8d%b3%e5%8f%af%e3%80%82%e5%85%b7%e4%bd%93%e4%bb%a3%e7%a0%81%e5%a6%82%e4%b8%8b%0aNSDictionary%20%2aoptions%20%3d%20%40%7b%20NSSQLitePragmasOption%3a%20%40%7b%40%26%2334%3bjournal_mode%26%2334%3b%3a%20%40%26%2334%3bDELETE%26%2334%3b%7d%20%7d%3b%20NSError%20%2aerror%20%3d%20nil%3b%20_store%20%3d%20%5b_coordinator%20addPersistentStoreWithType%3aNSSQLiteStoreType%20configuration%3anil%20URL%3a%5bself%20storeURL%5d%20options%3aoptions%20error%3a%26amp%3berror%5d%3b%202.Mac%e4%b8%8a%e6%89%93%e5%bc%80%e6%95%b0%e6%8d%ae%e5%ba%93%e7%9a%84%e6%96%b9%e5%bc%8f%e5%be%88%e5%a4%9a%ef%bc%8c%e6%88%91%e6%8e%a8%e8%8d%903%e4%b8%aa%ef%bc%8c%e4%b8%80%e4%b8%aa%e6%98%afFirefox%e9%87%8c%e9%9d%a2%e7%9b%b4%e6%8e%a5%e6%9c%89sqlite%e7%9a%84%e6%8f%92%e4%bb%b6%ef%bc%8c%e5%85%8d%e8%b4%b9%e7%9a%84%ef%bc%8c%e5%8f%af%e4%bb%a5%e7%9b%b4%e6%8e%a5%e5%ae%89%e8%a3%85%ef%bc%8c%e4%b9%9f%e5%be%88%e6%96%b9%e4%be%bf%e3%80%82%e5%bd%93%e7%84%b6%e4%b9%9f%e6%9c%89%e4%b8%8d%e7%94%a8Firefox%e7%9a%84%e6%9c%8b%e5%8f%8b%ef%bc%8c%e5%b0%b1%e5%83%8f%e6%88%91%e6%98%afChrome%e9%87%8d%e5%ba%a6%e4%bd%bf%e7%94%a8%e8%80%85%ef%bc%8c%e9%82%a3%e5%b0%b1%e6%8e%a8%e8%8d%902%e4%b8%aa%e5%85%8d%e8%b4%b9%e7%9a%84%e5%b0%8f%e7%9a%84app%ef%bc%8c%e4%b8%80%e4%b8%aa%e6%98%afsqlitebrowser%ef%bc%8c%e4%b8%80%e4%b8%aa%e6%98%afsqlite%20manager%ef%bc%8c%e8%bf%992%e4%b8%aa%e9%83%bd%e6%af%94%e8%be%83%e8%bd%bb%e9%87%8f%e7%ba%a7%ef%bc%8c%e9%83%bd%e6%af%94%e8%be%83%e5%a5%bd%e7%94%a8%e3%80%82%0a3.%e5%a6%82%e6%9e%9c%e4%bd%a0%e6%83%b3%e7%9c%8b%e7%9c%8bCore%20Data%e5%88%b0%e5%ba%95%e5%ba%95%e5%b1%82%e6%98%af%e5%a6%82%e4%bd%95%e4%bc%98%e5%8c%96%e4%bd%a0%e7%9a%84%e6%9f%a5%e8%af%a2%e8%af%ad%e5%8f%a5%e7%9a%84%ef%bc%8c%e8%bf%99%e9%87%8c%e6%9c%89%e4%b8%80%e4%b8%aa%e6%96%b9%e6%b3%95%e5%8f%af%e4%bb%a5%e7%9c%8b%e5%88%b0%e3%80%82%0a%e5%85%88%e7%82%b9%e5%87%bbProduct%20-%26gt%3bScheme%20-%26gt%3bEdit%20Scheme%0a%e7%84%b6%e5%90%8e%e5%86%8d%e5%88%87%e6%8d%a2%e5%88%b0Arguments%e5%88%86%e9%a1%b5%e4%b8%ad%2c%e5%9c%a8Arguments%20Passed%20On%20Launch%e9%87%8c%e9%9d%a2%e5%8a%a0%e5%85%a5%20%e2%80%9c-%20com.apple.CoreData.SQLDebug%203%e2%80%9d%2c%e9%87%8d%e6%96%b0%e8%bf%90%e8%a1%8capp%ef%bc%8c%e4%b8%8b%e9%9d%a2%e5%b0%b1%e4%bc%9a%e6%98%be%e7%a4%baCore%20Data%e4%bc%98%e5%8c%96%e8%bf%87%e7%9a%84Sql%e8%af%ad%e5%8f%a5%e4%ba%86%e3%80%82%0a%e5%a5%bd%e4%ba%86%ef%bc%8c%e8%b0%83%e8%af%95%e4%bf%a1%e6%81%af%e5%ba%94%e8%af%a5%e9%83%bd%e5%8f%af%e4%bb%a5%e5%ae%8c%e7%be%8e%e6%98%be%e7%a4%ba%e4%ba%86%ef%bc%8c%e5%8f%af%e4%bb%a5%e5%bc%80%e5%a7%8b%e6%84%89%e5%bf%ab%e7%9a%84%e8%bf%9b%e5%85%a5%e6%ad%a3%e6%96%87%e4%ba%86%ef%bc%81%0a%23%23%23%23%e4%b8%80.Core%20Data%e8%87%aa%e5%b8%a6%e7%9a%84%e8%bd%bb%e9%87%8f%e7%ba%a7%e7%9a%84%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb%20%e8%bf%99%e7%a7%8d%e8%bf%81%e7%a7%bb%e5%8f%af%e5%88%ab%e5%b0%8f%e7%9c%8b%e5%ae%83%ef%bc%8c%e5%9c%a8%e4%bd%a0%e6%96%b0%e5%bb%ba%e4%b8%80%e5%bc%a0%e8%a1%a8%e7%9a%84%e6%97%b6%e5%80%99%e8%bf%98%e5%bf%85%e9%a1%bb%e5%8a%a0%e4%b8%8a%e5%ae%83%e6%89%8d%e8%a1%8c%ef%bc%8c%e5%90%a6%e5%88%99%e4%bc%9a%e5%87%ba%e7%8e%b0%e5%a6%82%e4%b8%8b%e7%9a%84%e9%94%99%e8%af%af%ef%bc%9a%0a%2a%2aFailed%20to%20add%20store.%20Error%3a%20Error%20Domain%3dNSCocoaErrorDomain%20Code%3d134100%20%26%2334%3b%28null%29%26%2334%3b%20UserInfo%3d%7bmetadata%3d%7b%2a%2a%20%2a%2a%c2%a0NSPersistenceFrameworkVersion%20%3d%20641%3b%2a%2a%20%2a%2a%c2%a0NSStoreModelVersionHashes%20%3d%20%7b%2a%2a%20%2a%2a%c2%a0Item%20%3d%20%26lt%3b64288772%2072e62096%20a8a4914f%2083db23c9%2013718f81%204417e297%20293d0267%2079b04acb%26gt%3b%3b%2a%2a%20%2a%2a%c2%a0Measurement%20%3d%20%26lt%3b35717f0e%2032cae0d4%2057325758%2058ed0d11%20c16563f2%20567dac35%20de63d5d8%2047849cf7%26gt%3b%3b%2a%2a%20%2a%2a%c2%a0%7d%3b%2a%2a%20%2a%2a%c2%a0NSStoreModelVersionHashesVersion%20%3d%203%3b%2a%2a%20%2a%2a%c2%a0NSStoreModelVersionIdentifiers%20%3d%20%28%2a%2a%20%2a%2a%c2%a0%26%2334%3b%26%2334%3b%2a%2a%20%2a%2a%c2%a0%29%3b%2a%2a%20%2a%2a%c2%a0NSStoreType%20%3d%20SQLite%3b%2a%2a%20%2a%2a%c2%a0NSStoreUUID%20%3d%20%26%2334%3b9A16746E-0C61-421B-B936-412F0C904FDF%26%2334%3b%3b%2a%2a%20%2a%2a%c2%a0%26%2334%3b_NSAutoVacuumLevel%26%2334%3b%20%3d%202%3b%2a%2a%20%2a%2a%7d%2c%20reason%3dThe%20model%20used%20to%20open%20the%20store%20is%20incompatible%20with%20the%20one%20used%20to%20create%20the%20store%7d%2a%2a%20%e9%94%99%e8%af%af%e5%8e%9f%e5%9b%a0%e5%86%99%e7%9a%84%e6%af%94%e8%be%83%e6%b8%85%e6%a5%9a%e4%ba%86%ef%bc%8creason%3dThe%20model%20used%20to%20open%20the%20store%20is%20incompatible%20with%20the%20one%20used%20to%20create%20the%20store%ef%bc%8c%e8%bf%99%e4%b8%aa%e6%98%af%e5%9b%a0%e4%b8%ba%e6%88%91%e6%96%b0%e5%bb%ba%e4%ba%86%e4%b8%80%e5%bc%a0%e8%a1%a8%ef%bc%8c%e4%bd%86%e6%98%af%e6%88%91%e6%b2%a1%e6%9c%89%e6%89%93%e5%bc%80%e8%bd%bb%e9%87%8f%e7%ba%a7%e7%9a%84%e8%bf%81%e7%a7%bbOption%e3%80%82%e8%bf%99%e9%87%8c%e4%bc%9a%e6%9c%89%e4%ba%ba%e4%bc%9a%e9%97%ae%e4%ba%86%ef%bc%8c%e6%88%91%e6%96%b0%e5%bb%ba%e8%a1%a8%e4%bb%8e%e6%9d%a5%e6%b2%a1%e6%9c%89%e5%87%ba%e7%8e%b0%e8%bf%99%e4%b8%aa%e9%94%99%e8%af%af%e5%95%8a%ef%bc%9f%e9%82%a3%e6%98%af%e5%9b%a0%e4%b8%ba%e4%bd%a0%e4%bb%ac%e7%94%a8%e7%9a%84%e7%ac%ac%e4%b8%89%e6%96%b9%e6%a1%86%e6%9e%b6%e5%b0%b1%e5%b7%b2%e7%bb%8f%e5%86%99%e5%a5%bd%e4%ba%86%e6%94%b9Option%e4%ba%86%e3%80%82%28%e5%9c%ba%e5%a4%96%e4%ba%ba%3a%e8%bf%99%e5%b9%b4%e5%a4%b4%e8%b0%81%e8%bf%98%e8%87%aa%e5%b7%b1%e4%bb%8e0%e5%bc%80%e5%a7%8b%e5%86%99Core%20Data%e5%95%8a%ef%bc%8c%e8%82%af%e5%ae%9a%e9%83%bd%e7%94%a8%e7%ac%ac%e4%b8%89%e6%96%b9%e6%a1%86%e6%9e%b6%e5%95%8a%29%e9%82%a3%e8%bf%99%e9%87%8c%e6%88%91%e5%b0%b1%e5%bd%93%e8%ae%b2%e8%a7%a3%e5%8e%9f%e7%90%86%e4%ba%86%e5%93%88%e3%80%82%e5%a6%82%e6%9e%9c%e6%98%af%e8%87%aa%e5%b7%b1%e4%bb%8e0%e5%bc%80%e5%a7%8b%e5%86%99%e7%9a%84Core%20Data%e7%9a%84%e8%af%9d%ef%bc%8c%e8%bf%99%e9%87%8c%e6%98%af%e5%ba%94%e8%af%a5%e4%bc%9a%e6%8a%a5%e9%94%99%e4%ba%86%ef%bc%8c%e8%a7%a3%e5%86%b3%e5%8a%9e%e6%b3%95%e5%bd%93%e7%84%b6%e6%98%af%e5%8a%a0%e4%b8%8a%e4%bb%a3%e7%a0%81%ef%bc%8c%e5%88%a9%e7%94%a8Core%20Data%e7%9a%84%e8%bd%bb%e9%87%8f%e7%ba%a7%e8%bf%81%e7%a7%bb%ef%bc%8c%e6%9d%a5%e9%98%b2%e6%ad%a2%e8%bf%99%e7%a7%8d%e6%89%be%e4%b8%8d%e5%88%b0%e5%ad%98%e5%82%a8%e5%8c%ba%e7%9a%84%e9%97%aa%e9%80%80%e9%97%ae%e9%a2%98"><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fnew.halfrost.com%2fios_coredata_migration%2f&t=iOS%20Core%20Data%20%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb%20%e6%8c%87%e5%8d%97"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu class=icon href=# onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden=true></i>Menu</a>
<a id=toc class=icon href=# onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden=true></i>TOC</a>
<a id=share class=icon href=# onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden=true></i>share</a>
<a id=top style=display:none class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i>Top</a></div></div></div><footer id=footer><div class=footer-left><p class=copyright style=float:left;margin-bottom:0><a href=https://github.com/halfrost/Halfrost-Field class=github-repo style=height:18px><span class=gadget-github></span>Star</a>
Copyright &copy;halfrost 2016 - 2021
<a href=http://www.miit.gov.cn/>鄂ICP备16014744号</a></p><br><p class="copyright statistics" style=margin-bottom:20px><span id=busuanzi_container_site_pv>Cumulative Page Views <span id=busuanzi_value_site_pv></span>| Unique Visitors <span id=busuanzi_value_site_uv></span></span></p></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/main.min.f870a4d110314b9e50e65f8ac982dc1c9c376c8f1a5083d39c62cfc49073f011.js></script><script async src=/prism.js></script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']]},svg:{fontCache:'global'}};</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></html>