<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=theme-color content="#FFFFFF"><meta http-equiv=x-ua-compatible content="IE=edge"><title>iOS 如何优雅的处理“回调地狱 Callback hell ”(二) —— 使用 Swift | prometheus</title><meta name=description content="Explore in every moment of the hard thinking"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="iOS 如何优雅的处理“回调地狱 Callback hell ”(二) —— 使用 Swift"><meta property="og:description" content="####前言 在上篇中，我谈到了可以用promise来解决Callback hell的问题，这篇我们换一种方式一样可以解决这个问题。
我们先分析一下为何promise能解决多层回调嵌套的问题，经过上篇的分析，我总结也一下几点：
1.promise封装了所有异步操作，把异步操作封装成了一个“盒子”。 2.promise提供了Monad，then相当于flatMap。 3.promise的函数返回对象本身，于是就可形成链式调用
好了，既然这些能优雅的解决callback hell，那么我们只要能做到这些，也一样可以完成任务。到这里大家可能就已经恍然大悟了，Swift就是完成这个任务的最佳语言！Swift支持函数式编程，分分钟就可以完成promise的基本功能。
####一.利用Swift特性处理回调Callback hell
我们还是以上篇的例子来举例，先来描述一下场景： 假设有这样一个提交按钮，当你点击之后，就会提交一次任务。当你点下按钮的那一刻，首先要先判断是否有权限提交，没有权限就弹出错误。有权限提交之后，还要请求一次，判断当前任务是否已经存在，如果存在，弹出错误。如果不存在，这个时候就可以安心提交任务了。
那么代码如下：
func requestAsyncOperation(request : String , success : String -> Void , failure : NSError -> Void) { WebRequestAPI.fetchDataAPI(request, success : { result in WebOtherRequestAPI.fetchOtherDataAPI ( result , success : {OtherResult in [self fulfillData:OtherResult]; let finallyTheParams = self.transformResult(OtherResult) TaskAPI.fetchOtherDataAPI ( finallyTheParams , success : { TaskResult in let finallyTaskResult = self.transformTaskResult(TaskResult) success(finallyTaskResult) }, failure:{ TaskError in failure(TaskError) } ) },failure : { ExistError in failure(ExistError) } ) } , failure : { AuthorityError in failure(AuthorityError) } ) } 接下来我们就来优雅的解决上述看上去不好维护的Callback hell。"><meta property="og:type" content="article"><meta property="og:url" content="https://new.halfrost.com/ios_callback_hell_swift/"><meta property="article:published_time" content="2016-06-22T06:45:00+00:00"><meta property="article:modified_time" content="2016-06-22T06:45:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="iOS 如何优雅的处理“回调地狱 Callback hell ”(二) —— 使用 Swift"><meta name=twitter:description content="####前言 在上篇中，我谈到了可以用promise来解决Callback hell的问题，这篇我们换一种方式一样可以解决这个问题。
我们先分析一下为何promise能解决多层回调嵌套的问题，经过上篇的分析，我总结也一下几点：
1.promise封装了所有异步操作，把异步操作封装成了一个“盒子”。 2.promise提供了Monad，then相当于flatMap。 3.promise的函数返回对象本身，于是就可形成链式调用
好了，既然这些能优雅的解决callback hell，那么我们只要能做到这些，也一样可以完成任务。到这里大家可能就已经恍然大悟了，Swift就是完成这个任务的最佳语言！Swift支持函数式编程，分分钟就可以完成promise的基本功能。
####一.利用Swift特性处理回调Callback hell
我们还是以上篇的例子来举例，先来描述一下场景： 假设有这样一个提交按钮，当你点击之后，就会提交一次任务。当你点下按钮的那一刻，首先要先判断是否有权限提交，没有权限就弹出错误。有权限提交之后，还要请求一次，判断当前任务是否已经存在，如果存在，弹出错误。如果不存在，这个时候就可以安心提交任务了。
那么代码如下：
func requestAsyncOperation(request : String , success : String -> Void , failure : NSError -> Void) { WebRequestAPI.fetchDataAPI(request, success : { result in WebOtherRequestAPI.fetchOtherDataAPI ( result , success : {OtherResult in [self fulfillData:OtherResult]; let finallyTheParams = self.transformResult(OtherResult) TaskAPI.fetchOtherDataAPI ( finallyTheParams , success : { TaskResult in let finallyTaskResult = self.transformTaskResult(TaskResult) success(finallyTaskResult) }, failure:{ TaskError in failure(TaskError) } ) },failure : { ExistError in failure(ExistError) } ) } , failure : { AuthorityError in failure(AuthorityError) } ) } 接下来我们就来优雅的解决上述看上去不好维护的Callback hell。"><link rel=stylesheet href=/css/style-white.min.css><link rel=manifest href=/manifest.json><link rel=stylesheet href=/prism.css><link href=/images/apple-touch-icon-60x60.png rel=apple-touch-icon sizes=60x60><link href=/images/apple-touch-icon-76x76.png rel=apple-touch-icon sizes=76x76><link href=/images/apple-touch-icon-120x120.png rel=apple-touch-icon sizes=120x120><link href=/images/apple-touch-icon-152x152.png rel=apple-touch-icon sizes=152x152><link href=/images/apple-touch-icon-180x180.png rel=apple-touch-icon sizes=180x180><link href=/images/apple-touch-icon-512x512.png rel=apple-touch-icon sizes=512x512><link href=/images/apple-touch-icon-1024x1024.png rel=apple-touch-icon sizes=1024x1024><script async>if('serviceWorker'in navigator){navigator.serviceWorker.register("\/serviceworker-v1.min.a64912b78d282eab1ad3715a0943da21616e5f326f8afea27034784ad445043b.js").then(function(){if(navigator.serviceWorker.controller){console.log('Assets cached by the controlling service worker.');}else{console.log('Please reload this page to allow the service worker to handle network operations.');}}).catch(function(error){console.log('ERROR: '+error);});}else{console.log('Service workers are not supported in the current browser.');}</script><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://new.halfrost.com/images/favicon.ico><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-82753806-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="single-max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a><a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a><a id=top-icon-tablet href=# onclick="$('html, body').animate({scrollTop:0},'fast');" style=display:none><i class="fas fa-chevron-up fa-lg"></i></a><span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=https://books.halfrost.com/>Books</a></li><li><a href=https://github.com/halfrost/Halfrost-Field>Github</a></li><li><a href=https://halfrost.me/>About</a></li><li><a href=/index.xml>RSS</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://new.halfrost.com/jekyll/><i class="fas fa-chevron-left" aria-hidden=true onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li><li><a class=icon href=https://new.halfrost.com/wwdc2016_ios10_notification_new_features/><i class="fas fa-chevron-right" aria-hidden=true onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li><li><a class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast');"><i class="fas fa-chevron-up" aria-hidden=true onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li><li><a class=icon href=#><i class="fas fa-share-alt" aria-hidden=true onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fnew.halfrost.com%2fios_callback_hell_swift%2f"><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fnew.halfrost.com%2fios_callback_hell_swift%2f&text=iOS%20%e5%a6%82%e4%bd%95%e4%bc%98%e9%9b%85%e7%9a%84%e5%a4%84%e7%90%86%e2%80%9c%e5%9b%9e%e8%b0%83%e5%9c%b0%e7%8b%b1%20Callback%20hell%20%e2%80%9d%28%e4%ba%8c%29%20%e2%80%94%e2%80%94%20%e4%bd%bf%e7%94%a8%20Swift"><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fnew.halfrost.com%2fios_callback_hell_swift%2f&title=iOS%20%e5%a6%82%e4%bd%95%e4%bc%98%e9%9b%85%e7%9a%84%e5%a4%84%e7%90%86%e2%80%9c%e5%9b%9e%e8%b0%83%e5%9c%b0%e7%8b%b1%20Callback%20hell%20%e2%80%9d%28%e4%ba%8c%29%20%e2%80%94%e2%80%94%20%e4%bd%bf%e7%94%a8%20Swift"><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fnew.halfrost.com%2fios_callback_hell_swift%2f&is_video=false&description=iOS%20%e5%a6%82%e4%bd%95%e4%bc%98%e9%9b%85%e7%9a%84%e5%a4%84%e7%90%86%e2%80%9c%e5%9b%9e%e8%b0%83%e5%9c%b0%e7%8b%b1%20Callback%20hell%20%e2%80%9d%28%e4%ba%8c%29%20%e2%80%94%e2%80%94%20%e4%bd%bf%e7%94%a8%20Swift"><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=iOS%20%e5%a6%82%e4%bd%95%e4%bc%98%e9%9b%85%e7%9a%84%e5%a4%84%e7%90%86%e2%80%9c%e5%9b%9e%e8%b0%83%e5%9c%b0%e7%8b%b1%20Callback%20hell%20%e2%80%9d%28%e4%ba%8c%29%20%e2%80%94%e2%80%94%20%e4%bd%bf%e7%94%a8%20Swift&body=Check out this article: https%3a%2f%2fnew.halfrost.com%2fios_callback_hell_swift%2f"><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fnew.halfrost.com%2fios_callback_hell_swift%2f&title=iOS%20%e5%a6%82%e4%bd%95%e4%bc%98%e9%9b%85%e7%9a%84%e5%a4%84%e7%90%86%e2%80%9c%e5%9b%9e%e8%b0%83%e5%9c%b0%e7%8b%b1%20Callback%20hell%20%e2%80%9d%28%e4%ba%8c%29%20%e2%80%94%e2%80%94%20%e4%bd%bf%e7%94%a8%20Swift"><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fnew.halfrost.com%2fios_callback_hell_swift%2f&title=iOS%20%e5%a6%82%e4%bd%95%e4%bc%98%e9%9b%85%e7%9a%84%e5%a4%84%e7%90%86%e2%80%9c%e5%9b%9e%e8%b0%83%e5%9c%b0%e7%8b%b1%20Callback%20hell%20%e2%80%9d%28%e4%ba%8c%29%20%e2%80%94%e2%80%94%20%e4%bd%bf%e7%94%a8%20Swift"><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fnew.halfrost.com%2fios_callback_hell_swift%2f&title=iOS%20%e5%a6%82%e4%bd%95%e4%bc%98%e9%9b%85%e7%9a%84%e5%a4%84%e7%90%86%e2%80%9c%e5%9b%9e%e8%b0%83%e5%9c%b0%e7%8b%b1%20Callback%20hell%20%e2%80%9d%28%e4%ba%8c%29%20%e2%80%94%e2%80%94%20%e4%bd%bf%e7%94%a8%20Swift"><i class="fab fa-stumbleupon" aria-hidden=true></i></a></li><li><a class=icon href="http://digg.com/submit?url=https%3a%2f%2fnew.halfrost.com%2fios_callback_hell_swift%2f&title=iOS%20%e5%a6%82%e4%bd%95%e4%bc%98%e9%9b%85%e7%9a%84%e5%a4%84%e7%90%86%e2%80%9c%e5%9b%9e%e8%b0%83%e5%9c%b0%e7%8b%b1%20Callback%20hell%20%e2%80%9d%28%e4%ba%8c%29%20%e2%80%94%e2%80%94%20%e4%bd%bf%e7%94%a8%20Swift"><i class="fab fa-digg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fnew.halfrost.com%2fios_callback_hell_swift%2f&name=iOS%20%e5%a6%82%e4%bd%95%e4%bc%98%e9%9b%85%e7%9a%84%e5%a4%84%e7%90%86%e2%80%9c%e5%9b%9e%e8%b0%83%e5%9c%b0%e7%8b%b1%20Callback%20hell%20%e2%80%9d%28%e4%ba%8c%29%20%e2%80%94%e2%80%94%20%e4%bd%bf%e7%94%a8%20Swift&description=%23%23%23%23%e5%89%8d%e8%a8%80%20%e5%9c%a8%e4%b8%8a%e7%af%87%e4%b8%ad%ef%bc%8c%e6%88%91%e8%b0%88%e5%88%b0%e4%ba%86%e5%8f%af%e4%bb%a5%e7%94%a8promise%e6%9d%a5%e8%a7%a3%e5%86%b3Callback%20hell%e7%9a%84%e9%97%ae%e9%a2%98%ef%bc%8c%e8%bf%99%e7%af%87%e6%88%91%e4%bb%ac%e6%8d%a2%e4%b8%80%e7%a7%8d%e6%96%b9%e5%bc%8f%e4%b8%80%e6%a0%b7%e5%8f%af%e4%bb%a5%e8%a7%a3%e5%86%b3%e8%bf%99%e4%b8%aa%e9%97%ae%e9%a2%98%e3%80%82%0a%e6%88%91%e4%bb%ac%e5%85%88%e5%88%86%e6%9e%90%e4%b8%80%e4%b8%8b%e4%b8%ba%e4%bd%95promise%e8%83%bd%e8%a7%a3%e5%86%b3%e5%a4%9a%e5%b1%82%e5%9b%9e%e8%b0%83%e5%b5%8c%e5%a5%97%e7%9a%84%e9%97%ae%e9%a2%98%ef%bc%8c%e7%bb%8f%e8%bf%87%e4%b8%8a%e7%af%87%e7%9a%84%e5%88%86%e6%9e%90%ef%bc%8c%e6%88%91%e6%80%bb%e7%bb%93%e4%b9%9f%e4%b8%80%e4%b8%8b%e5%87%a0%e7%82%b9%ef%bc%9a%0a1.promise%e5%b0%81%e8%a3%85%e4%ba%86%e6%89%80%e6%9c%89%e5%bc%82%e6%ad%a5%e6%93%8d%e4%bd%9c%ef%bc%8c%e6%8a%8a%e5%bc%82%e6%ad%a5%e6%93%8d%e4%bd%9c%e5%b0%81%e8%a3%85%e6%88%90%e4%ba%86%e4%b8%80%e4%b8%aa%e2%80%9c%e7%9b%92%e5%ad%90%e2%80%9d%e3%80%82%202.promise%e6%8f%90%e4%be%9b%e4%ba%86Monad%ef%bc%8cthen%e7%9b%b8%e5%bd%93%e4%ba%8eflatMap%e3%80%82%203.promise%e7%9a%84%e5%87%bd%e6%95%b0%e8%bf%94%e5%9b%9e%e5%af%b9%e8%b1%a1%e6%9c%ac%e8%ba%ab%ef%bc%8c%e4%ba%8e%e6%98%af%e5%b0%b1%e5%8f%af%e5%bd%a2%e6%88%90%e9%93%be%e5%bc%8f%e8%b0%83%e7%94%a8%0a%e5%a5%bd%e4%ba%86%ef%bc%8c%e6%97%a2%e7%84%b6%e8%bf%99%e4%ba%9b%e8%83%bd%e4%bc%98%e9%9b%85%e7%9a%84%e8%a7%a3%e5%86%b3callback%20hell%ef%bc%8c%e9%82%a3%e4%b9%88%e6%88%91%e4%bb%ac%e5%8f%aa%e8%a6%81%e8%83%bd%e5%81%9a%e5%88%b0%e8%bf%99%e4%ba%9b%ef%bc%8c%e4%b9%9f%e4%b8%80%e6%a0%b7%e5%8f%af%e4%bb%a5%e5%ae%8c%e6%88%90%e4%bb%bb%e5%8a%a1%e3%80%82%e5%88%b0%e8%bf%99%e9%87%8c%e5%a4%a7%e5%ae%b6%e5%8f%af%e8%83%bd%e5%b0%b1%e5%b7%b2%e7%bb%8f%e6%81%8d%e7%84%b6%e5%a4%a7%e6%82%9f%e4%ba%86%ef%bc%8cSwift%e5%b0%b1%e6%98%af%e5%ae%8c%e6%88%90%e8%bf%99%e4%b8%aa%e4%bb%bb%e5%8a%a1%e7%9a%84%e6%9c%80%e4%bd%b3%e8%af%ad%e8%a8%80%ef%bc%81Swift%e6%94%af%e6%8c%81%e5%87%bd%e6%95%b0%e5%bc%8f%e7%bc%96%e7%a8%8b%ef%bc%8c%e5%88%86%e5%88%86%e9%92%9f%e5%b0%b1%e5%8f%af%e4%bb%a5%e5%ae%8c%e6%88%90promise%e7%9a%84%e5%9f%ba%e6%9c%ac%e5%8a%9f%e8%83%bd%e3%80%82%0a%23%23%23%23%e4%b8%80.%e5%88%a9%e7%94%a8Swift%e7%89%b9%e6%80%a7%e5%a4%84%e7%90%86%e5%9b%9e%e8%b0%83Callback%20hell%0a%e6%88%91%e4%bb%ac%e8%bf%98%e6%98%af%e4%bb%a5%e4%b8%8a%e7%af%87%e7%9a%84%e4%be%8b%e5%ad%90%e6%9d%a5%e4%b8%be%e4%be%8b%ef%bc%8c%e5%85%88%e6%9d%a5%e6%8f%8f%e8%bf%b0%e4%b8%80%e4%b8%8b%e5%9c%ba%e6%99%af%ef%bc%9a%20%e5%81%87%e8%ae%be%e6%9c%89%e8%bf%99%e6%a0%b7%e4%b8%80%e4%b8%aa%e6%8f%90%e4%ba%a4%e6%8c%89%e9%92%ae%ef%bc%8c%e5%bd%93%e4%bd%a0%e7%82%b9%e5%87%bb%e4%b9%8b%e5%90%8e%ef%bc%8c%e5%b0%b1%e4%bc%9a%e6%8f%90%e4%ba%a4%e4%b8%80%e6%ac%a1%e4%bb%bb%e5%8a%a1%e3%80%82%e5%bd%93%e4%bd%a0%e7%82%b9%e4%b8%8b%e6%8c%89%e9%92%ae%e7%9a%84%e9%82%a3%e4%b8%80%e5%88%bb%ef%bc%8c%e9%a6%96%e5%85%88%e8%a6%81%e5%85%88%e5%88%a4%e6%96%ad%e6%98%af%e5%90%a6%e6%9c%89%e6%9d%83%e9%99%90%e6%8f%90%e4%ba%a4%ef%bc%8c%e6%b2%a1%e6%9c%89%e6%9d%83%e9%99%90%e5%b0%b1%e5%bc%b9%e5%87%ba%e9%94%99%e8%af%af%e3%80%82%e6%9c%89%e6%9d%83%e9%99%90%e6%8f%90%e4%ba%a4%e4%b9%8b%e5%90%8e%ef%bc%8c%e8%bf%98%e8%a6%81%e8%af%b7%e6%b1%82%e4%b8%80%e6%ac%a1%ef%bc%8c%e5%88%a4%e6%96%ad%e5%bd%93%e5%89%8d%e4%bb%bb%e5%8a%a1%e6%98%af%e5%90%a6%e5%b7%b2%e7%bb%8f%e5%ad%98%e5%9c%a8%ef%bc%8c%e5%a6%82%e6%9e%9c%e5%ad%98%e5%9c%a8%ef%bc%8c%e5%bc%b9%e5%87%ba%e9%94%99%e8%af%af%e3%80%82%e5%a6%82%e6%9e%9c%e4%b8%8d%e5%ad%98%e5%9c%a8%ef%bc%8c%e8%bf%99%e4%b8%aa%e6%97%b6%e5%80%99%e5%b0%b1%e5%8f%af%e4%bb%a5%e5%ae%89%e5%bf%83%e6%8f%90%e4%ba%a4%e4%bb%bb%e5%8a%a1%e4%ba%86%e3%80%82%0a%e9%82%a3%e4%b9%88%e4%bb%a3%e7%a0%81%e5%a6%82%e4%b8%8b%ef%bc%9a%0afunc%20requestAsyncOperation%28request%20%3a%20String%20%2c%20success%20%3a%20String%20-%26gt%3b%20Void%20%2c%20failure%20%3a%20NSError%20-%26gt%3b%20Void%29%20%7b%20WebRequestAPI.fetchDataAPI%28request%2c%20success%20%3a%20%7b%20result%20in%20WebOtherRequestAPI.fetchOtherDataAPI%20%28%20result%20%2c%c2%a0success%20%3a%20%7bOtherResult%20in%20%5bself%20fulfillData%3aOtherResult%5d%3b%20let%20finallyTheParams%20%3d%20self.transformResult%28OtherResult%29%20TaskAPI.fetchOtherDataAPI%20%28%20finallyTheParams%20%2c%20success%20%3a%20%7b%20TaskResult%20in%20let%20finallyTaskResult%20%3d%20self.transformTaskResult%28TaskResult%29%20success%28finallyTaskResult%29%20%7d%2c%20failure%3a%7b%20TaskError%20in%20failure%28TaskError%29%20%7d%20%29%20%7d%2cfailure%20%3a%20%7b%20ExistError%20in%20failure%28ExistError%29%20%7d%20%29%20%7d%20%2c%20failure%20%3a%20%7b%20AuthorityError%20in%20failure%28AuthorityError%29%20%7d%20%29%20%7d%20%e6%8e%a5%e4%b8%8b%e6%9d%a5%e6%88%91%e4%bb%ac%e5%b0%b1%e6%9d%a5%e4%bc%98%e9%9b%85%e7%9a%84%e8%a7%a3%e5%86%b3%e4%b8%8a%e8%bf%b0%e7%9c%8b%e4%b8%8a%e5%8e%bb%e4%b8%8d%e5%a5%bd%e7%bb%b4%e6%8a%a4%e7%9a%84Callback%20hell%e3%80%82"><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fnew.halfrost.com%2fios_callback_hell_swift%2f&t=iOS%20%e5%a6%82%e4%bd%95%e4%bc%98%e9%9b%85%e7%9a%84%e5%a4%84%e7%90%86%e2%80%9c%e5%9b%9e%e8%b0%83%e5%9c%b0%e7%8b%b1%20Callback%20hell%20%e2%80%9d%28%e4%ba%8c%29%20%e2%80%94%e2%80%94%20%e4%bd%bf%e7%94%a8%20Swift"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div><div id=toc><nav id=TableOfContents></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">iOS 如何优雅的处理“回调地狱 Callback hell ”(二) —— 使用 Swift</h1><div class=meta><div class=postdate><time datetime="2016-06-22 06:45:00 +0000 UTC" itemprop=datePublished>Jun 22</time></div><div class=article-category><i class="fas fa-archive"></i><a class=category-link href=/categories/ios>iOS</a>
,
<a class=category-link href=/categories/callback-hell>Callback hell</a>
,
<a class=category-link href=/categories/%E5%9B%9E%E8%B0%83%E5%9C%B0%E7%8B%B1>回调地狱</a>
,
<a class=category-link href=/categories/swift>Swift</a></div><div class=article-tag><i class="fas fa-tag"></i><a class=tag-link href=/tags/ios rel=tag>iOS</a>
,
<a class=tag-link href=/tags/callback-hell rel=tag>Callback hell</a>
,
<a class=tag-link href=/tags/%E5%9B%9E%E8%B0%83%E5%9C%B0%E7%8B%B1 rel=tag>回调地狱</a>
,
<a class=tag-link href=/tags/swift rel=tag>Swift</a></div></div></header><div class=content itemprop=articleBody><p>####前言
在上篇中，我谈到了可以用promise来解决Callback hell的问题，这篇我们换一种方式一样可以解决这个问题。</p><p>我们先分析一下为何promise能解决多层回调嵌套的问题，经过上篇的分析，我总结也一下几点：</p><p>1.promise封装了所有异步操作，把异步操作封装成了一个“盒子”。
2.promise提供了Monad，then相当于flatMap。
3.promise的函数返回对象本身，于是就可形成链式调用</p><p>好了，既然这些能优雅的解决callback hell，那么我们只要能做到这些，也一样可以完成任务。到这里大家可能就已经恍然大悟了，Swift就是完成这个任务的最佳语言！Swift支持函数式编程，分分钟就可以完成promise的基本功能。</p><p>####一.利用Swift特性处理回调Callback hell</p><p>我们还是以上篇的例子来举例，先来描述一下场景：
假设有这样一个提交按钮，当你点击之后，就会提交一次任务。当你点下按钮的那一刻，首先要先判断是否有权限提交，没有权限就弹出错误。有权限提交之后，还要请求一次，判断当前任务是否已经存在，如果存在，弹出错误。如果不存在，这个时候就可以安心提交任务了。</p><p>那么代码如下：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>requestAsyncOperation</span>(request : String , success : String -&gt; Void , failure : NSError -&gt; Void)
{
    WebRequestAPI.fetchDataAPI(request, success : { result <span style=color:#66d9ef>in</span>
        WebOtherRequestAPI.fetchOtherDataAPI ( result ,  success : {OtherResult <span style=color:#66d9ef>in</span>
            [<span style=color:#66d9ef>self</span> fulfillData:OtherResult];
            
            <span style=color:#66d9ef>let</span> finallyTheParams = <span style=color:#66d9ef>self</span>.transformResult(OtherResult)
            TaskAPI.fetchOtherDataAPI ( finallyTheParams , success : { TaskResult <span style=color:#66d9ef>in</span>
                
                <span style=color:#66d9ef>let</span> finallyTaskResult = <span style=color:#66d9ef>self</span>.transformTaskResult(TaskResult)
                
                success(finallyTaskResult)
                },
                failure:{ TaskError <span style=color:#66d9ef>in</span>
                    failure(TaskError)
                }
                
            )
            },failure : { ExistError <span style=color:#66d9ef>in</span>
                failure(ExistError)
            }
        )
        } , failure : { AuthorityError <span style=color:#66d9ef>in</span>
            failure(AuthorityError)
        }
    )
}
</code></pre></div><p>接下来我们就来优雅的解决上述看上去不好维护的Callback hell。</p><p>1.首先我们要封装异步操作，把异步操作封装到Async中，顺带把返回值也一起封装成Result。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift>
<span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>Result</span> &lt;T&gt; {
    <span style=color:#66d9ef>case</span> Success(T)
    <span style=color:#66d9ef>case</span> Failure(ErrorType)
}

<span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Async</span>&lt;T&gt; {
    <span style=color:#66d9ef>let</span> trunk:(Result&lt;T&gt;-&gt;Void)-&gt;Void
    <span style=color:#66d9ef>init</span>(function:(Result&lt;T&gt;-&gt;Void)-&gt;Void) {
        trunk = function
    }
    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>execute</span>(callBack:Result&lt;T&gt;-&gt;Void) {
        trunk(callBack)
    }
}

</code></pre></div><p>2.封装Monad，提供Map和flatMap操作。顺带返回值也返回Async，以方便后面可以继续链式调用。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=color:#75715e>// Monad</span>
<span style=color:#66d9ef>extension</span> <span style=color:#a6e22e>Async</span>{


    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>map</span>&lt;U&gt;(f: T <span style=color:#66d9ef>throws</span>-&gt; U) -&gt; Async&lt;U&gt; {
        <span style=color:#66d9ef>return</span> flatMap{ .unit(<span style=color:#66d9ef>try</span> f($0)) }
    }

    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>flatMap</span>&lt;U&gt;(f:T <span style=color:#66d9ef>throws</span>-&gt; Async&lt;U&gt;) -&gt; Async&lt;U&gt; {
        <span style=color:#66d9ef>return</span> Async&lt;U&gt;{ cont <span style=color:#66d9ef>in</span>
            <span style=color:#66d9ef>self</span>.execute{
                <span style=color:#66d9ef>switch</span> $0.map(f){
                <span style=color:#66d9ef>case</span> .Success(<span style=color:#66d9ef>let</span> async):
                    async.execute(cont)
                <span style=color:#66d9ef>case</span> .Failure(<span style=color:#66d9ef>let</span> error):
                    cont(.Failure(error))
                }
            }
        }
    }
}
</code></pre></div><p>这是我们把异步的过程就封装成一个盒子了，盒子里面有Map，flatMap操作，flatMap对应的其实就是promise的then</p><p>3.我们可以把flatMap名字直接换成then，那么之前那30多行的代码就会简化成下面这样：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift>
<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>requestAsyncOperation</span>(request : String ) -&gt; Async &lt;String&gt;
{
    <span style=color:#66d9ef>return</span> fetchDataAPI(request)
           .then(fetchOtherDataAPI)
           .map(transformResult)
           .then(fetchOtherDataAPI)
           .map(transformTaskResult)
}
</code></pre></div><p>基本上和用promise一样的效果。这样就不用PromiseKit库，利用promise思想的精髓，优雅的完美的处理了回调地狱。这也得益于Swift语言的优点。</p><p>文章至此，虽然已经解决了问题了，不过还没有结束，我们还可以继续再进一步讨论一些东西。</p><p>####二.进一步的讨论
1.@noescape，throws，rethrows关键字
flatMap还有这种写法：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>flatMap</span>&lt;U&gt; (@noescape f: T <span style=color:#66d9ef>throws</span> -&gt; Async&lt;U&gt;)<span style=color:#66d9ef>rethrows</span> -&gt; Async&lt;U&gt; 
</code></pre></div><p>@noescape 从字面上看，就知道是“不会逃走”的意思，这个关键字专门用于修饰函数闭包这种参数类型的，当出现这个参数时，它表示该闭包不会跳出这个函数调用的生命期：即函数调用完之后，这个闭包的生命期也结束了。
在苹果官方文档上是这样写的：</p><blockquote><p>A new @noescape attribute may be used on closure parameters to functions. This indicates that the parameter is only ever called (or passed as an @noescape parameter in a call), which means that it cannot outlive the lifetime of the call. This enables some minor performance optimizations, but more importantly disables the self. requirement in closure arguments.</p></blockquote><p>那什么时候一个闭包参数会跳出函数的生命期呢？</p><p>引用唐巧大神的解释：</p><blockquote><p>在函数实现内，将一个闭包用 dispatch_async
嵌套，这样这个闭包就会在另外一个线程中存在，从而跳出了当前函数的生命期。这样做主要是可以帮助编译器做性能的优化。</p></blockquote><p>throws关键字是代表该闭包可能会抛出异常。
rethrows关键字是代表这个闭包如果抛出异常，仅可能是因为传递给它的闭包的调用导致了异常。</p><p>2.继续说说上面例子里面的Result，和Async一样，我们也可以继续封装Result，也加上map和flatMap方法。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift>
<span style=color:#66d9ef>func</span> ==&lt;T:Equatable&gt;(lhs:Result&lt;T&gt;, rhs:Result&lt;T&gt;) -&gt; Bool{
    <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>case</span> (.Success(<span style=color:#66d9ef>let</span> l), .Success(<span style=color:#66d9ef>let</span> r)) = (lhs, rhs){
        <span style=color:#66d9ef>return</span> l == r
    }
    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
}

<span style=color:#66d9ef>extension</span> <span style=color:#a6e22e>Result</span>{

    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>map</span>&lt;U&gt;(f:T <span style=color:#66d9ef>throws</span>-&gt; U) -&gt; Result&lt;U&gt; {
        <span style=color:#66d9ef>return</span> flatMap{.unit(<span style=color:#66d9ef>try</span> f($0))}
    }

    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>flatMap</span>&lt;U&gt;(f:T <span style=color:#66d9ef>throws</span>-&gt; Result&lt;U&gt;) -&gt; Result&lt;U&gt; {
        <span style=color:#66d9ef>switch</span> <span style=color:#66d9ef>self</span>{
        <span style=color:#66d9ef>case</span> .Success(<span style=color:#66d9ef>let</span> value):
            <span style=color:#66d9ef>do</span>{
                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>try</span> f(value)
            }<span style=color:#66d9ef>catch</span> <span style=color:#66d9ef>let</span> e{
                <span style=color:#66d9ef>return</span> .Failure(e)
            }
        <span style=color:#66d9ef>case</span> .Failure(<span style=color:#66d9ef>let</span> e):
            <span style=color:#66d9ef>return</span> .Failure(e)
        }
    }
}
</code></pre></div><p>3.上面我们已经把Async和Result封装了map方法，所以他们也可以叫做<strong>函子(Functor)</strong>。接下来可以继续封装，把他们都封装成<strong>适用函子(Applicative Functor)<strong>和</strong>单子(Monad)</strong></p><p>**适用函子(Applicative Functor)**根据定义：<br>对于任意一个函子F，如果能支持以下运算，该函子就是一个适用函子：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>pure</span>&lt;A&gt;(value:A) -&gt;F&lt;A&gt;

<span style=color:#66d9ef>func</span> <span style=color:#f92672>&lt;*&gt;&lt;</span>A,B&gt;(f:F&lt;A <span style=color:#f92672>-</span> <span style=color:#f92672>&gt;</span> B&gt;, x:F&lt;A&gt;) -&gt;F&lt;B&gt;
</code></pre></div><p>以Async为例，我们为它加上这两个方法</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift>
<span style=color:#66d9ef>extension</span> <span style=color:#a6e22e>Async</span>{

    <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>unit</span>(x:T) -&gt; Async&lt;T&gt; {
        <span style=color:#66d9ef>return</span> Async{ $0(.Success(x)) }
    }

    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>map</span>&lt;U&gt;(f: T <span style=color:#66d9ef>throws</span>-&gt; U) -&gt; Async&lt;U&gt; {
        <span style=color:#66d9ef>return</span> flatMap{ .unit(<span style=color:#66d9ef>try</span> f($0)) }
    }

    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>flatMap</span>&lt;U&gt;(f:T <span style=color:#66d9ef>throws</span>-&gt; Async&lt;U&gt;) -&gt; Async&lt;U&gt; {
        <span style=color:#66d9ef>return</span> Async&lt;U&gt;{ cont <span style=color:#66d9ef>in</span>
            <span style=color:#66d9ef>self</span>.execute{
                <span style=color:#66d9ef>switch</span> $0.map(f){
                <span style=color:#66d9ef>case</span> .Success(<span style=color:#66d9ef>let</span> async):
                    async.execute(cont)
                <span style=color:#66d9ef>case</span> .Failure(<span style=color:#66d9ef>let</span> error):
                    cont(.Failure(error))
                }
            }
        }
    }

    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>apply</span>&lt;U&gt;(af:Async&lt;T <span style=color:#66d9ef>throws</span>-&gt; U&gt;) -&gt; Async&lt;U&gt; {
        <span style=color:#66d9ef>return</span> af.flatMap(map)
    }
}
</code></pre></div><p>unit和apply就是上面定义中的两个方法。接下来我们在看看Monad的定义。</p><p>**单子(Monad)**根据定义：<br>对于任意一个类型构造体F定义了下面两个函数，它就是一个单子Monad：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>pure</span>&lt;A&gt;(value:A) -&gt;F&lt;A&gt;

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>flatMap</span>&lt;A,B&gt;(x:F&lt;A&gt;)-&gt;(A-&gt;F&lt;B&gt;)-&gt;F&lt;B&gt;
</code></pre></div><p>还是以Async为例，此时的Async已经有了unit和flatMap满足定义了，这个时候，就可以说Async已经是一个Monad了。</p><p>至此，我们就把Async和Result都变成了**适用函子(Applicative Functor)<strong>和</strong>单子(Monad)**了。</p><p>4.再说说运算符。
flatMap函数有时候会被定义为一个运算符&#187;=。由于它会将第一个参数的计算结果绑定到第二个参数的输入上面，这个运算符也会被称为“绑定(bind)”运算.</p><p>为了方便，那我们就把上面的4个操作都定义成运算符吧。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>unit</span>&lt;T&gt; (x:T) -&gt; Async&lt;T&gt; {
    <span style=color:#66d9ef>return</span> Async{$0(.Success(x))}
}

<span style=color:#66d9ef>func</span> <span style=color:#f92672>&lt;^&gt;</span> &lt;T, U&gt; (f: T <span style=color:#66d9ef>throws</span>-&gt; U, async: Async&lt;T&gt;) -&gt; Async&lt;U&gt; {
    <span style=color:#66d9ef>return</span> async.map(f)
}

<span style=color:#66d9ef>func</span> <span style=color:#f92672>&gt;&gt;=</span> &lt;T, U&gt; (async:Async&lt;T&gt;, f:T <span style=color:#66d9ef>throws</span>-&gt; Async&lt;U&gt;) -&gt; Async&lt;U&gt; {
    <span style=color:#66d9ef>return</span> async.flatMap(f)
}

<span style=color:#66d9ef>func</span> <span style=color:#f92672>&lt;*&gt;</span> &lt;T, U&gt; (af: Async&lt;T <span style=color:#66d9ef>throws</span>-&gt; U&gt;, async:Async&lt;T&gt;) -&gt; Async&lt;U&gt; {
    <span style=color:#66d9ef>return</span> async.apply(af)
}
</code></pre></div><p>按照顺序，第二个对应的就是原来的map函数，第三个对应的就是原来的flatMap函数。</p><p>5.说到运算符，我们这里还可以继续回到文章最开始的地方去讨论一下那段回调地狱的代码。上面我们通过map和flatMap成功的展开了Callback hell，其实这里还有另外一个方法可以解决问题，那就是用自定义运算符。这里我们用不到适用函子的&lt;*>，有些问题就可能用到它。还是回到上述问题，这里我们用Monad里面的运算符来解决回调地狱。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift>
<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>requestAsyncOperation</span>(request : String ) -&gt; Async &lt;String&gt;
{
    <span style=color:#66d9ef>return</span> fetchDataAPI(request) <span style=color:#f92672>&gt;&gt;=</span> (fetchOtherDataAPI) <span style=color:#f92672>&lt;^&gt;</span>(transformResult) <span style=color:#f92672>&gt;&gt;=</span> (fetchOtherDataAPI) <span style=color:#f92672>&lt;^&gt;</span> (transformTaskResult)
}
</code></pre></div><p>通过运算符，最终原来的40多行代码变成了最后一行了！当然，我们中间封装了一些操作。</p><p>####三.总结
经过上篇和本篇的讨论，优雅的处理"回调地狱Callback hell"的方法有以下几种:<br>1.使用PromiseKit
2.使用Swift的map和flatMap封装异步操作(思想和promise差不多)
3.使用Swift自定义运算符展开回调嵌套</p><p>目前为止，我能想到的处理方法还有2种：<br>4.使用Reactive cocoa
5.使用RxSwift</p><p>下篇或者下下篇可能应该就是讨论RAC和RxSwift如果优雅的处理回调地狱了。如果大家还有什么其他方法能优雅的解决这个问题，也欢迎大家提出来，一起讨论，相互学习！</p><img src=https://img.halfrost.com/wechat-qr-code.png></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=https://books.halfrost.com/>Books</a></li><li><a href=https://github.com/halfrost/Halfrost-Field>Github</a></li><li><a href=https://halfrost.me/>About</a></li><li><a href=/index.xml>RSS</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents></nav></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fnew.halfrost.com%2fios_callback_hell_swift%2f"><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fnew.halfrost.com%2fios_callback_hell_swift%2f&text=iOS%20%e5%a6%82%e4%bd%95%e4%bc%98%e9%9b%85%e7%9a%84%e5%a4%84%e7%90%86%e2%80%9c%e5%9b%9e%e8%b0%83%e5%9c%b0%e7%8b%b1%20Callback%20hell%20%e2%80%9d%28%e4%ba%8c%29%20%e2%80%94%e2%80%94%20%e4%bd%bf%e7%94%a8%20Swift"><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fnew.halfrost.com%2fios_callback_hell_swift%2f&title=iOS%20%e5%a6%82%e4%bd%95%e4%bc%98%e9%9b%85%e7%9a%84%e5%a4%84%e7%90%86%e2%80%9c%e5%9b%9e%e8%b0%83%e5%9c%b0%e7%8b%b1%20Callback%20hell%20%e2%80%9d%28%e4%ba%8c%29%20%e2%80%94%e2%80%94%20%e4%bd%bf%e7%94%a8%20Swift"><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fnew.halfrost.com%2fios_callback_hell_swift%2f&is_video=false&description=iOS%20%e5%a6%82%e4%bd%95%e4%bc%98%e9%9b%85%e7%9a%84%e5%a4%84%e7%90%86%e2%80%9c%e5%9b%9e%e8%b0%83%e5%9c%b0%e7%8b%b1%20Callback%20hell%20%e2%80%9d%28%e4%ba%8c%29%20%e2%80%94%e2%80%94%20%e4%bd%bf%e7%94%a8%20Swift"><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=iOS%20%e5%a6%82%e4%bd%95%e4%bc%98%e9%9b%85%e7%9a%84%e5%a4%84%e7%90%86%e2%80%9c%e5%9b%9e%e8%b0%83%e5%9c%b0%e7%8b%b1%20Callback%20hell%20%e2%80%9d%28%e4%ba%8c%29%20%e2%80%94%e2%80%94%20%e4%bd%bf%e7%94%a8%20Swift&body=Check out this article: https%3a%2f%2fnew.halfrost.com%2fios_callback_hell_swift%2f"><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fnew.halfrost.com%2fios_callback_hell_swift%2f&title=iOS%20%e5%a6%82%e4%bd%95%e4%bc%98%e9%9b%85%e7%9a%84%e5%a4%84%e7%90%86%e2%80%9c%e5%9b%9e%e8%b0%83%e5%9c%b0%e7%8b%b1%20Callback%20hell%20%e2%80%9d%28%e4%ba%8c%29%20%e2%80%94%e2%80%94%20%e4%bd%bf%e7%94%a8%20Swift"><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fnew.halfrost.com%2fios_callback_hell_swift%2f&title=iOS%20%e5%a6%82%e4%bd%95%e4%bc%98%e9%9b%85%e7%9a%84%e5%a4%84%e7%90%86%e2%80%9c%e5%9b%9e%e8%b0%83%e5%9c%b0%e7%8b%b1%20Callback%20hell%20%e2%80%9d%28%e4%ba%8c%29%20%e2%80%94%e2%80%94%20%e4%bd%bf%e7%94%a8%20Swift"><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fnew.halfrost.com%2fios_callback_hell_swift%2f&title=iOS%20%e5%a6%82%e4%bd%95%e4%bc%98%e9%9b%85%e7%9a%84%e5%a4%84%e7%90%86%e2%80%9c%e5%9b%9e%e8%b0%83%e5%9c%b0%e7%8b%b1%20Callback%20hell%20%e2%80%9d%28%e4%ba%8c%29%20%e2%80%94%e2%80%94%20%e4%bd%bf%e7%94%a8%20Swift"><i class="fab fa-stumbleupon fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://digg.com/submit?url=https%3a%2f%2fnew.halfrost.com%2fios_callback_hell_swift%2f&title=iOS%20%e5%a6%82%e4%bd%95%e4%bc%98%e9%9b%85%e7%9a%84%e5%a4%84%e7%90%86%e2%80%9c%e5%9b%9e%e8%b0%83%e5%9c%b0%e7%8b%b1%20Callback%20hell%20%e2%80%9d%28%e4%ba%8c%29%20%e2%80%94%e2%80%94%20%e4%bd%bf%e7%94%a8%20Swift"><i class="fab fa-digg fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fnew.halfrost.com%2fios_callback_hell_swift%2f&name=iOS%20%e5%a6%82%e4%bd%95%e4%bc%98%e9%9b%85%e7%9a%84%e5%a4%84%e7%90%86%e2%80%9c%e5%9b%9e%e8%b0%83%e5%9c%b0%e7%8b%b1%20Callback%20hell%20%e2%80%9d%28%e4%ba%8c%29%20%e2%80%94%e2%80%94%20%e4%bd%bf%e7%94%a8%20Swift&description=%23%23%23%23%e5%89%8d%e8%a8%80%20%e5%9c%a8%e4%b8%8a%e7%af%87%e4%b8%ad%ef%bc%8c%e6%88%91%e8%b0%88%e5%88%b0%e4%ba%86%e5%8f%af%e4%bb%a5%e7%94%a8promise%e6%9d%a5%e8%a7%a3%e5%86%b3Callback%20hell%e7%9a%84%e9%97%ae%e9%a2%98%ef%bc%8c%e8%bf%99%e7%af%87%e6%88%91%e4%bb%ac%e6%8d%a2%e4%b8%80%e7%a7%8d%e6%96%b9%e5%bc%8f%e4%b8%80%e6%a0%b7%e5%8f%af%e4%bb%a5%e8%a7%a3%e5%86%b3%e8%bf%99%e4%b8%aa%e9%97%ae%e9%a2%98%e3%80%82%0a%e6%88%91%e4%bb%ac%e5%85%88%e5%88%86%e6%9e%90%e4%b8%80%e4%b8%8b%e4%b8%ba%e4%bd%95promise%e8%83%bd%e8%a7%a3%e5%86%b3%e5%a4%9a%e5%b1%82%e5%9b%9e%e8%b0%83%e5%b5%8c%e5%a5%97%e7%9a%84%e9%97%ae%e9%a2%98%ef%bc%8c%e7%bb%8f%e8%bf%87%e4%b8%8a%e7%af%87%e7%9a%84%e5%88%86%e6%9e%90%ef%bc%8c%e6%88%91%e6%80%bb%e7%bb%93%e4%b9%9f%e4%b8%80%e4%b8%8b%e5%87%a0%e7%82%b9%ef%bc%9a%0a1.promise%e5%b0%81%e8%a3%85%e4%ba%86%e6%89%80%e6%9c%89%e5%bc%82%e6%ad%a5%e6%93%8d%e4%bd%9c%ef%bc%8c%e6%8a%8a%e5%bc%82%e6%ad%a5%e6%93%8d%e4%bd%9c%e5%b0%81%e8%a3%85%e6%88%90%e4%ba%86%e4%b8%80%e4%b8%aa%e2%80%9c%e7%9b%92%e5%ad%90%e2%80%9d%e3%80%82%202.promise%e6%8f%90%e4%be%9b%e4%ba%86Monad%ef%bc%8cthen%e7%9b%b8%e5%bd%93%e4%ba%8eflatMap%e3%80%82%203.promise%e7%9a%84%e5%87%bd%e6%95%b0%e8%bf%94%e5%9b%9e%e5%af%b9%e8%b1%a1%e6%9c%ac%e8%ba%ab%ef%bc%8c%e4%ba%8e%e6%98%af%e5%b0%b1%e5%8f%af%e5%bd%a2%e6%88%90%e9%93%be%e5%bc%8f%e8%b0%83%e7%94%a8%0a%e5%a5%bd%e4%ba%86%ef%bc%8c%e6%97%a2%e7%84%b6%e8%bf%99%e4%ba%9b%e8%83%bd%e4%bc%98%e9%9b%85%e7%9a%84%e8%a7%a3%e5%86%b3callback%20hell%ef%bc%8c%e9%82%a3%e4%b9%88%e6%88%91%e4%bb%ac%e5%8f%aa%e8%a6%81%e8%83%bd%e5%81%9a%e5%88%b0%e8%bf%99%e4%ba%9b%ef%bc%8c%e4%b9%9f%e4%b8%80%e6%a0%b7%e5%8f%af%e4%bb%a5%e5%ae%8c%e6%88%90%e4%bb%bb%e5%8a%a1%e3%80%82%e5%88%b0%e8%bf%99%e9%87%8c%e5%a4%a7%e5%ae%b6%e5%8f%af%e8%83%bd%e5%b0%b1%e5%b7%b2%e7%bb%8f%e6%81%8d%e7%84%b6%e5%a4%a7%e6%82%9f%e4%ba%86%ef%bc%8cSwift%e5%b0%b1%e6%98%af%e5%ae%8c%e6%88%90%e8%bf%99%e4%b8%aa%e4%bb%bb%e5%8a%a1%e7%9a%84%e6%9c%80%e4%bd%b3%e8%af%ad%e8%a8%80%ef%bc%81Swift%e6%94%af%e6%8c%81%e5%87%bd%e6%95%b0%e5%bc%8f%e7%bc%96%e7%a8%8b%ef%bc%8c%e5%88%86%e5%88%86%e9%92%9f%e5%b0%b1%e5%8f%af%e4%bb%a5%e5%ae%8c%e6%88%90promise%e7%9a%84%e5%9f%ba%e6%9c%ac%e5%8a%9f%e8%83%bd%e3%80%82%0a%23%23%23%23%e4%b8%80.%e5%88%a9%e7%94%a8Swift%e7%89%b9%e6%80%a7%e5%a4%84%e7%90%86%e5%9b%9e%e8%b0%83Callback%20hell%0a%e6%88%91%e4%bb%ac%e8%bf%98%e6%98%af%e4%bb%a5%e4%b8%8a%e7%af%87%e7%9a%84%e4%be%8b%e5%ad%90%e6%9d%a5%e4%b8%be%e4%be%8b%ef%bc%8c%e5%85%88%e6%9d%a5%e6%8f%8f%e8%bf%b0%e4%b8%80%e4%b8%8b%e5%9c%ba%e6%99%af%ef%bc%9a%20%e5%81%87%e8%ae%be%e6%9c%89%e8%bf%99%e6%a0%b7%e4%b8%80%e4%b8%aa%e6%8f%90%e4%ba%a4%e6%8c%89%e9%92%ae%ef%bc%8c%e5%bd%93%e4%bd%a0%e7%82%b9%e5%87%bb%e4%b9%8b%e5%90%8e%ef%bc%8c%e5%b0%b1%e4%bc%9a%e6%8f%90%e4%ba%a4%e4%b8%80%e6%ac%a1%e4%bb%bb%e5%8a%a1%e3%80%82%e5%bd%93%e4%bd%a0%e7%82%b9%e4%b8%8b%e6%8c%89%e9%92%ae%e7%9a%84%e9%82%a3%e4%b8%80%e5%88%bb%ef%bc%8c%e9%a6%96%e5%85%88%e8%a6%81%e5%85%88%e5%88%a4%e6%96%ad%e6%98%af%e5%90%a6%e6%9c%89%e6%9d%83%e9%99%90%e6%8f%90%e4%ba%a4%ef%bc%8c%e6%b2%a1%e6%9c%89%e6%9d%83%e9%99%90%e5%b0%b1%e5%bc%b9%e5%87%ba%e9%94%99%e8%af%af%e3%80%82%e6%9c%89%e6%9d%83%e9%99%90%e6%8f%90%e4%ba%a4%e4%b9%8b%e5%90%8e%ef%bc%8c%e8%bf%98%e8%a6%81%e8%af%b7%e6%b1%82%e4%b8%80%e6%ac%a1%ef%bc%8c%e5%88%a4%e6%96%ad%e5%bd%93%e5%89%8d%e4%bb%bb%e5%8a%a1%e6%98%af%e5%90%a6%e5%b7%b2%e7%bb%8f%e5%ad%98%e5%9c%a8%ef%bc%8c%e5%a6%82%e6%9e%9c%e5%ad%98%e5%9c%a8%ef%bc%8c%e5%bc%b9%e5%87%ba%e9%94%99%e8%af%af%e3%80%82%e5%a6%82%e6%9e%9c%e4%b8%8d%e5%ad%98%e5%9c%a8%ef%bc%8c%e8%bf%99%e4%b8%aa%e6%97%b6%e5%80%99%e5%b0%b1%e5%8f%af%e4%bb%a5%e5%ae%89%e5%bf%83%e6%8f%90%e4%ba%a4%e4%bb%bb%e5%8a%a1%e4%ba%86%e3%80%82%0a%e9%82%a3%e4%b9%88%e4%bb%a3%e7%a0%81%e5%a6%82%e4%b8%8b%ef%bc%9a%0afunc%20requestAsyncOperation%28request%20%3a%20String%20%2c%20success%20%3a%20String%20-%26gt%3b%20Void%20%2c%20failure%20%3a%20NSError%20-%26gt%3b%20Void%29%20%7b%20WebRequestAPI.fetchDataAPI%28request%2c%20success%20%3a%20%7b%20result%20in%20WebOtherRequestAPI.fetchOtherDataAPI%20%28%20result%20%2c%c2%a0success%20%3a%20%7bOtherResult%20in%20%5bself%20fulfillData%3aOtherResult%5d%3b%20let%20finallyTheParams%20%3d%20self.transformResult%28OtherResult%29%20TaskAPI.fetchOtherDataAPI%20%28%20finallyTheParams%20%2c%20success%20%3a%20%7b%20TaskResult%20in%20let%20finallyTaskResult%20%3d%20self.transformTaskResult%28TaskResult%29%20success%28finallyTaskResult%29%20%7d%2c%20failure%3a%7b%20TaskError%20in%20failure%28TaskError%29%20%7d%20%29%20%7d%2cfailure%20%3a%20%7b%20ExistError%20in%20failure%28ExistError%29%20%7d%20%29%20%7d%20%2c%20failure%20%3a%20%7b%20AuthorityError%20in%20failure%28AuthorityError%29%20%7d%20%29%20%7d%20%e6%8e%a5%e4%b8%8b%e6%9d%a5%e6%88%91%e4%bb%ac%e5%b0%b1%e6%9d%a5%e4%bc%98%e9%9b%85%e7%9a%84%e8%a7%a3%e5%86%b3%e4%b8%8a%e8%bf%b0%e7%9c%8b%e4%b8%8a%e5%8e%bb%e4%b8%8d%e5%a5%bd%e7%bb%b4%e6%8a%a4%e7%9a%84Callback%20hell%e3%80%82"><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fnew.halfrost.com%2fios_callback_hell_swift%2f&t=iOS%20%e5%a6%82%e4%bd%95%e4%bc%98%e9%9b%85%e7%9a%84%e5%a4%84%e7%90%86%e2%80%9c%e5%9b%9e%e8%b0%83%e5%9c%b0%e7%8b%b1%20Callback%20hell%20%e2%80%9d%28%e4%ba%8c%29%20%e2%80%94%e2%80%94%20%e4%bd%bf%e7%94%a8%20Swift"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu class=icon href=# onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden=true></i>Menu</a>
<a id=toc class=icon href=# onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden=true></i>TOC</a>
<a id=share class=icon href=# onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden=true></i>share</a>
<a id=top style=display:none class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i>Top</a></div></div></div><footer id=footer><div class=footer-left><p class=copyright style=float:left;margin-bottom:0><a href=https://github.com/halfrost/Halfrost-Field class=github-repo style=height:18px><span class=gadget-github></span>Star</a>
Copyright &copy;halfrost 2016 - 2021
<a href=http://www.miit.gov.cn/>鄂ICP备16014744号</a></p><br><p class="copyright statistics" style=margin-bottom:20px><span id=busuanzi_container_site_pv>Cumulative Page Views <span id=busuanzi_value_site_pv></span>| Unique Visitors <span id=busuanzi_value_site_uv></span></span></p></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/main.min.f870a4d110314b9e50e65f8ac982dc1c9c376c8f1a5083d39c62cfc49073f011.js></script><script async src=/prism.js></script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']]},svg:{fontCache:'global'}};</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></html>