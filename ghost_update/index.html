<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=theme-color content="#FFFFFF"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Ghost 博客升级指南 | prometheus</title><meta name=description content="Explore in every moment of the hard thinking"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="Ghost 博客升级指南"><meta property="og:description" content="在笔者一开始建站的时候，用的 Ghost 版本就是 0.7.4 中文版。这个非常早期的版本也有不少 hack 的玩法。直到最近周围有朋友也在玩 Ghost 的时候，我发现最新版很多新功能非常吸引我：比如最新版早就支持了 markdown 插入表格，也能支持 LateX。关于不支持 markdown 插入表格这个比较痛苦，之前表格的替代方法是在 github 上发布完文章以后截图，然后把图片传到 Ghost 上。
既然几年过去了，要升级就直接升级到最新版吧。截止到这篇文章的时间，当前最新版是 Ghost 1.24.8 。接下来写一些升级指南，如果也有和我一样用 Ghost 0.7.4 中文版的想升级到最新版，可以看看笔者的升级之路。
准备工作 准备工作当前是备份老版本的配置和数据。这里列一个需要备份的清单：
 数据库文件 通过 Ghost 后台管理系统，导出所有博文数据，其实就是从 MySQL 中导出的 JSON 文件。 主题文件 ghost/content/themes/ 服务器端 Ghost 的配置文件 config.js Nginx 下的 ghost.conf 配置文件 服务器上的 Ghost 整个文件夹 备份整个文件夹是可选的，是为了防止出错可以回退，丢数据可以找回。  开始升级 Ghost 在 V1.XX 以后改动比较大，因为加入了很多方便的脚手架工具，比如 Ghost、Ghost-CLI 等等。从 0.7.4 升级上来算是一次 breaking，所以 Ghost 这些工具都需要新装。
 Ghost is a fully open source, hackable platform for building and running a modern online publication."><meta property="og:type" content="article"><meta property="og:url" content="https://new.halfrost.com/ghost_update/"><meta property="article:published_time" content="2018-06-23T02:58:00+00:00"><meta property="article:modified_time" content="2018-06-23T02:58:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Ghost 博客升级指南"><meta name=twitter:description content="在笔者一开始建站的时候，用的 Ghost 版本就是 0.7.4 中文版。这个非常早期的版本也有不少 hack 的玩法。直到最近周围有朋友也在玩 Ghost 的时候，我发现最新版很多新功能非常吸引我：比如最新版早就支持了 markdown 插入表格，也能支持 LateX。关于不支持 markdown 插入表格这个比较痛苦，之前表格的替代方法是在 github 上发布完文章以后截图，然后把图片传到 Ghost 上。
既然几年过去了，要升级就直接升级到最新版吧。截止到这篇文章的时间，当前最新版是 Ghost 1.24.8 。接下来写一些升级指南，如果也有和我一样用 Ghost 0.7.4 中文版的想升级到最新版，可以看看笔者的升级之路。
准备工作 准备工作当前是备份老版本的配置和数据。这里列一个需要备份的清单：
 数据库文件 通过 Ghost 后台管理系统，导出所有博文数据，其实就是从 MySQL 中导出的 JSON 文件。 主题文件 ghost/content/themes/ 服务器端 Ghost 的配置文件 config.js Nginx 下的 ghost.conf 配置文件 服务器上的 Ghost 整个文件夹 备份整个文件夹是可选的，是为了防止出错可以回退，丢数据可以找回。  开始升级 Ghost 在 V1.XX 以后改动比较大，因为加入了很多方便的脚手架工具，比如 Ghost、Ghost-CLI 等等。从 0.7.4 升级上来算是一次 breaking，所以 Ghost 这些工具都需要新装。
 Ghost is a fully open source, hackable platform for building and running a modern online publication."><link rel=stylesheet href=/css/style-white.min.css><link rel=manifest href=/manifest.json><link rel=stylesheet href=/prism.css><link href=/images/apple-touch-icon-60x60.png rel=apple-touch-icon sizes=60x60><link href=/images/apple-touch-icon-76x76.png rel=apple-touch-icon sizes=76x76><link href=/images/apple-touch-icon-120x120.png rel=apple-touch-icon sizes=120x120><link href=/images/apple-touch-icon-152x152.png rel=apple-touch-icon sizes=152x152><link href=/images/apple-touch-icon-180x180.png rel=apple-touch-icon sizes=180x180><link href=/images/apple-touch-icon-512x512.png rel=apple-touch-icon sizes=512x512><link href=/images/apple-touch-icon-1024x1024.png rel=apple-touch-icon sizes=1024x1024><script async>if('serviceWorker'in navigator){navigator.serviceWorker.register("\/serviceworker-v1.min.a64912b78d282eab1ad3715a0943da21616e5f326f8afea27034784ad445043b.js").then(function(){if(navigator.serviceWorker.controller){console.log('Assets cached by the controlling service worker.');}else{console.log('Please reload this page to allow the service worker to handle network operations.');}}).catch(function(error){console.log('ERROR: '+error);});}else{console.log('Service workers are not supported in the current browser.');}</script><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://new.halfrost.com/images/favicon.ico><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-82753806-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="single-max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a><a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a><a id=top-icon-tablet href=# onclick="$('html, body').animate({scrollTop:0},'fast');" style=display:none><i class="fas fa-chevron-up fa-lg"></i></a><span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=https://books.halfrost.com/>Books</a></li><li><a href=https://github.com/halfrost/Halfrost-Field>Github</a></li><li><a href=https://halfrost.me/>About</a></li><li><a href=/index.xml>RSS</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://new.halfrost.com/flatbuffers_flexbuffers/><i class="fas fa-chevron-left" aria-hidden=true onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li><li><a class=icon href=https://new.halfrost.com/ghost_feature/><i class="fas fa-chevron-right" aria-hidden=true onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li><li><a class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast');"><i class="fas fa-chevron-up" aria-hidden=true onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li><li><a class=icon href=#><i class="fas fa-share-alt" aria-hidden=true onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fnew.halfrost.com%2fghost_update%2f"><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fnew.halfrost.com%2fghost_update%2f&text=Ghost%20%e5%8d%9a%e5%ae%a2%e5%8d%87%e7%ba%a7%e6%8c%87%e5%8d%97"><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fnew.halfrost.com%2fghost_update%2f&title=Ghost%20%e5%8d%9a%e5%ae%a2%e5%8d%87%e7%ba%a7%e6%8c%87%e5%8d%97"><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fnew.halfrost.com%2fghost_update%2f&is_video=false&description=Ghost%20%e5%8d%9a%e5%ae%a2%e5%8d%87%e7%ba%a7%e6%8c%87%e5%8d%97"><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Ghost%20%e5%8d%9a%e5%ae%a2%e5%8d%87%e7%ba%a7%e6%8c%87%e5%8d%97&body=Check out this article: https%3a%2f%2fnew.halfrost.com%2fghost_update%2f"><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fnew.halfrost.com%2fghost_update%2f&title=Ghost%20%e5%8d%9a%e5%ae%a2%e5%8d%87%e7%ba%a7%e6%8c%87%e5%8d%97"><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fnew.halfrost.com%2fghost_update%2f&title=Ghost%20%e5%8d%9a%e5%ae%a2%e5%8d%87%e7%ba%a7%e6%8c%87%e5%8d%97"><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fnew.halfrost.com%2fghost_update%2f&title=Ghost%20%e5%8d%9a%e5%ae%a2%e5%8d%87%e7%ba%a7%e6%8c%87%e5%8d%97"><i class="fab fa-stumbleupon" aria-hidden=true></i></a></li><li><a class=icon href="http://digg.com/submit?url=https%3a%2f%2fnew.halfrost.com%2fghost_update%2f&title=Ghost%20%e5%8d%9a%e5%ae%a2%e5%8d%87%e7%ba%a7%e6%8c%87%e5%8d%97"><i class="fab fa-digg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fnew.halfrost.com%2fghost_update%2f&name=Ghost%20%e5%8d%9a%e5%ae%a2%e5%8d%87%e7%ba%a7%e6%8c%87%e5%8d%97&description=%e5%9c%a8%e7%ac%94%e8%80%85%e4%b8%80%e5%bc%80%e5%a7%8b%e5%bb%ba%e7%ab%99%e7%9a%84%e6%97%b6%e5%80%99%ef%bc%8c%e7%94%a8%e7%9a%84%20Ghost%20%e7%89%88%e6%9c%ac%e5%b0%b1%e6%98%af%200.7.4%20%e4%b8%ad%e6%96%87%e7%89%88%e3%80%82%e8%bf%99%e4%b8%aa%e9%9d%9e%e5%b8%b8%e6%97%a9%e6%9c%9f%e7%9a%84%e7%89%88%e6%9c%ac%e4%b9%9f%e6%9c%89%e4%b8%8d%e5%b0%91%20hack%20%e7%9a%84%e7%8e%a9%e6%b3%95%e3%80%82%e7%9b%b4%e5%88%b0%e6%9c%80%e8%bf%91%e5%91%a8%e5%9b%b4%e6%9c%89%e6%9c%8b%e5%8f%8b%e4%b9%9f%e5%9c%a8%e7%8e%a9%20Ghost%20%e7%9a%84%e6%97%b6%e5%80%99%ef%bc%8c%e6%88%91%e5%8f%91%e7%8e%b0%e6%9c%80%e6%96%b0%e7%89%88%e5%be%88%e5%a4%9a%e6%96%b0%e5%8a%9f%e8%83%bd%e9%9d%9e%e5%b8%b8%e5%90%b8%e5%bc%95%e6%88%91%ef%bc%9a%e6%af%94%e5%a6%82%e6%9c%80%e6%96%b0%e7%89%88%e6%97%a9%e5%b0%b1%e6%94%af%e6%8c%81%e4%ba%86%20markdown%20%e6%8f%92%e5%85%a5%e8%a1%a8%e6%a0%bc%ef%bc%8c%e4%b9%9f%e8%83%bd%e6%94%af%e6%8c%81%20LateX%e3%80%82%e5%85%b3%e4%ba%8e%e4%b8%8d%e6%94%af%e6%8c%81%20markdown%20%e6%8f%92%e5%85%a5%e8%a1%a8%e6%a0%bc%e8%bf%99%e4%b8%aa%e6%af%94%e8%be%83%e7%97%9b%e8%8b%a6%ef%bc%8c%e4%b9%8b%e5%89%8d%e8%a1%a8%e6%a0%bc%e7%9a%84%e6%9b%bf%e4%bb%a3%e6%96%b9%e6%b3%95%e6%98%af%e5%9c%a8%20github%20%e4%b8%8a%e5%8f%91%e5%b8%83%e5%ae%8c%e6%96%87%e7%ab%a0%e4%bb%a5%e5%90%8e%e6%88%aa%e5%9b%be%ef%bc%8c%e7%84%b6%e5%90%8e%e6%8a%8a%e5%9b%be%e7%89%87%e4%bc%a0%e5%88%b0%20Ghost%20%e4%b8%8a%e3%80%82%0a%e6%97%a2%e7%84%b6%e5%87%a0%e5%b9%b4%e8%bf%87%e5%8e%bb%e4%ba%86%ef%bc%8c%e8%a6%81%e5%8d%87%e7%ba%a7%e5%b0%b1%e7%9b%b4%e6%8e%a5%e5%8d%87%e7%ba%a7%e5%88%b0%e6%9c%80%e6%96%b0%e7%89%88%e5%90%a7%e3%80%82%e6%88%aa%e6%ad%a2%e5%88%b0%e8%bf%99%e7%af%87%e6%96%87%e7%ab%a0%e7%9a%84%e6%97%b6%e9%97%b4%ef%bc%8c%e5%bd%93%e5%89%8d%e6%9c%80%e6%96%b0%e7%89%88%e6%98%af%20Ghost%201.24.8%20%e3%80%82%e6%8e%a5%e4%b8%8b%e6%9d%a5%e5%86%99%e4%b8%80%e4%ba%9b%e5%8d%87%e7%ba%a7%e6%8c%87%e5%8d%97%ef%bc%8c%e5%a6%82%e6%9e%9c%e4%b9%9f%e6%9c%89%e5%92%8c%e6%88%91%e4%b8%80%e6%a0%b7%e7%94%a8%20Ghost%200.7.4%20%e4%b8%ad%e6%96%87%e7%89%88%e7%9a%84%e6%83%b3%e5%8d%87%e7%ba%a7%e5%88%b0%e6%9c%80%e6%96%b0%e7%89%88%ef%bc%8c%e5%8f%af%e4%bb%a5%e7%9c%8b%e7%9c%8b%e7%ac%94%e8%80%85%e7%9a%84%e5%8d%87%e7%ba%a7%e4%b9%8b%e8%b7%af%e3%80%82%0a%e5%87%86%e5%a4%87%e5%b7%a5%e4%bd%9c%20%e5%87%86%e5%a4%87%e5%b7%a5%e4%bd%9c%e5%bd%93%e5%89%8d%e6%98%af%e5%a4%87%e4%bb%bd%e8%80%81%e7%89%88%e6%9c%ac%e7%9a%84%e9%85%8d%e7%bd%ae%e5%92%8c%e6%95%b0%e6%8d%ae%e3%80%82%e8%bf%99%e9%87%8c%e5%88%97%e4%b8%80%e4%b8%aa%e9%9c%80%e8%a6%81%e5%a4%87%e4%bb%bd%e7%9a%84%e6%b8%85%e5%8d%95%ef%bc%9a%0a%20%e6%95%b0%e6%8d%ae%e5%ba%93%e6%96%87%e4%bb%b6%20%e9%80%9a%e8%bf%87%20Ghost%20%e5%90%8e%e5%8f%b0%e7%ae%a1%e7%90%86%e7%b3%bb%e7%bb%9f%ef%bc%8c%e5%af%bc%e5%87%ba%e6%89%80%e6%9c%89%e5%8d%9a%e6%96%87%e6%95%b0%e6%8d%ae%ef%bc%8c%e5%85%b6%e5%ae%9e%e5%b0%b1%e6%98%af%e4%bb%8e%20MySQL%20%e4%b8%ad%e5%af%bc%e5%87%ba%e7%9a%84%20JSON%20%e6%96%87%e4%bb%b6%e3%80%82%20%e4%b8%bb%e9%a2%98%e6%96%87%e4%bb%b6%20ghost%2fcontent%2fthemes%2f%20%e6%9c%8d%e5%8a%a1%e5%99%a8%e7%ab%af%20Ghost%20%e7%9a%84%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%20config.js%20Nginx%20%e4%b8%8b%e7%9a%84%20ghost.conf%20%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%20%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%b8%8a%e7%9a%84%20Ghost%20%e6%95%b4%e4%b8%aa%e6%96%87%e4%bb%b6%e5%a4%b9%20%e5%a4%87%e4%bb%bd%e6%95%b4%e4%b8%aa%e6%96%87%e4%bb%b6%e5%a4%b9%e6%98%af%e5%8f%af%e9%80%89%e7%9a%84%ef%bc%8c%e6%98%af%e4%b8%ba%e4%ba%86%e9%98%b2%e6%ad%a2%e5%87%ba%e9%94%99%e5%8f%af%e4%bb%a5%e5%9b%9e%e9%80%80%ef%bc%8c%e4%b8%a2%e6%95%b0%e6%8d%ae%e5%8f%af%e4%bb%a5%e6%89%be%e5%9b%9e%e3%80%82%20%20%e5%bc%80%e5%a7%8b%e5%8d%87%e7%ba%a7%20Ghost%20%e5%9c%a8%20V1.XX%20%e4%bb%a5%e5%90%8e%e6%94%b9%e5%8a%a8%e6%af%94%e8%be%83%e5%a4%a7%ef%bc%8c%e5%9b%a0%e4%b8%ba%e5%8a%a0%e5%85%a5%e4%ba%86%e5%be%88%e5%a4%9a%e6%96%b9%e4%be%bf%e7%9a%84%e8%84%9a%e6%89%8b%e6%9e%b6%e5%b7%a5%e5%85%b7%ef%bc%8c%e6%af%94%e5%a6%82%20Ghost%e3%80%81Ghost-CLI%20%e7%ad%89%e7%ad%89%e3%80%82%e4%bb%8e%200.7.4%20%e5%8d%87%e7%ba%a7%e4%b8%8a%e6%9d%a5%e7%ae%97%e6%98%af%e4%b8%80%e6%ac%a1%20breaking%ef%bc%8c%e6%89%80%e4%bb%a5%20Ghost%20%e8%bf%99%e4%ba%9b%e5%b7%a5%e5%85%b7%e9%83%bd%e9%9c%80%e8%a6%81%e6%96%b0%e8%a3%85%e3%80%82%0a%20Ghost%20is%20a%20fully%20open%20source%2c%20hackable%20platform%20for%20building%20and%20running%20a%20modern%20online%20publication."><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fnew.halfrost.com%2fghost_update%2f&t=Ghost%20%e5%8d%9a%e5%ae%a2%e5%8d%87%e7%ba%a7%e6%8c%87%e5%8d%97"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div><div id=toc><nav id=TableOfContents><ul><li><a href=#准备工作>准备工作</a></li><li><a href=#开始升级>开始升级</a><ul><li><a href=#环境配置>环境配置</a><ul><li><a href=#1-环境依赖>1. 环境依赖</a></li><li><a href=#2-设置-swap-分区>2. 设置 Swap 分区</a></li><li><a href=#3-检查-nodejs>3. 检查 Node.js</a></li><li><a href=#4-检查-mysql>4. 检查 MySQL</a></li><li><a href=#5-检查-nginx>5. 检查 nginx</a></li></ul></li><li><a href=#开始安装>开始安装</a><ul><li><a href=#1-安装-ghost-cli>1. 安装 Ghost-CLI</a></li><li><a href=#2-创建新用户>2. 创建新用户</a></li><li><a href=#3-配置-ghost>3. 配置 Ghost</a></li><li><a href=#4-安装-ghost>4. 安装 Ghost</a></li><li><a href=#5-设置-nginx>5. 设置 nginx</a></li><li><a href=#6-ghost-其他配置>6. ghost 其他配置</a></li></ul></li></ul></li><li><a href=#测试>测试</a></li><li><a href=#遇到的问题>遇到的问题</a><ul><li><a href=#node找不到命令>node：找不到命令</a></li><li><a href=#server-限制上传文件大小>server 限制上传文件大小</a></li><li><a href=#user-locked>user locked</a></li><li><a href=#emoji-升级>emoji 升级</a></li><li><a href=#权限问题>权限问题</a></li></ul></li></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">Ghost 博客升级指南</h1><div class=meta><div class=postdate><time datetime="2018-06-23 02:58:00 +0000 UTC" itemprop=datePublished>Jun 23</time></div><div class=article-category><i class="fas fa-archive"></i><a class=category-link href=/categories/ghost>Ghost</a></div><div class=article-tag><i class="fas fa-tag"></i><a class=tag-link href=/tags/ghost rel=tag>Ghost</a></div></div></header><div class=content itemprop=articleBody><p>在笔者一开始建站的时候，用的 Ghost 版本就是 0.7.4 中文版。这个非常早期的版本也有不少 hack 的玩法。直到最近周围有朋友也在玩 Ghost 的时候，我发现最新版很多新功能非常吸引我：比如最新版早就支持了 markdown 插入表格，也能支持 LateX。关于不支持 markdown 插入表格这个比较痛苦，之前表格的替代方法是在 github 上发布完文章以后截图，然后把图片传到 Ghost 上。</p><p>既然几年过去了，要升级就直接升级到最新版吧。截止到这篇文章的时间，当前最新版是 Ghost 1.24.8 。接下来写一些升级指南，如果也有和我一样用 Ghost 0.7.4 中文版的想升级到最新版，可以看看笔者的升级之路。</p><h2 id=准备工作>准备工作</h2><p>准备工作当前是备份老版本的配置和数据。这里列一个需要备份的清单：</p><ul><li>数据库文件
通过 Ghost 后台管理系统，导出所有博文数据，其实就是从 MySQL 中导出的 JSON 文件。</li><li>主题文件 ghost/content/themes/</li><li>服务器端 Ghost 的配置文件 config.js</li><li>Nginx 下的 ghost.conf 配置文件</li><li>服务器上的 Ghost 整个文件夹
备份整个文件夹是可选的，是为了防止出错可以回退，丢数据可以找回。</li></ul><h2 id=开始升级>开始升级</h2><p>Ghost 在 V1.XX 以后改动比较大，因为加入了很多方便的脚手架工具，比如 Ghost、Ghost-CLI 等等。从 0.7.4 升级上来算是一次 breaking，所以 Ghost 这些工具都需要新装。</p><blockquote><p>Ghost is a fully open source, hackable platform for building and running a modern online publication.</p></blockquote><p>安装 Ghost 最新版之前请先阅读官方文档：<br><a href=https://docs.ghost.org/v1.0.0/docs/getting-started-guide>getting-started-guide</a>
<a href=https://docs.ghost.org/docs/install>Install & Setup (production)</a></p><p>接下来的文章基本也就是这份英文文档里面的步骤，只不过加了一些自己遇到的问题，行文会把遇到问题的先后顺序和安装的顺序保持一致，希望能给读者一些升级上的帮助。</p><h3 id=环境配置>环境配置</h3><h4 id=1-环境依赖>1. 环境依赖</h4><ul><li>至少 1 GB 为内存（或者设置 swap 分区）</li><li>Systemd （CentOS 7 自带）</li><li>Node.js ( v8.9+, v6.9+, v4.5+ )</li><li>MySQL （或者 sqlite3）</li><li>nginx（如果需要配置 SSL 使用 https，则 nginx >= 1.9.5）</li><li>一个非 root 且拥有 sudo 权限的用户（用户名也不能为 ghost ）<strong>这一点非常重要，下面会强调这个特殊用户</strong>。</li></ul><h4 id=2-设置-swap-分区>2. 设置 Swap 分区</h4><p>Swap 分区的用处是当物理内存不够用的时候，系统会把数据放到 swap 中，所以 swap 起到了一个虚拟内存的作用。Ghost 需要至少 1GB 物理内存，否则会报错，可以通过设置 swap 分区解决（大于等于 1GB 可不用设置）。</p><p>查看主机物理内存和虚拟内存：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ free
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=color:#960050;background-color:#1e0010>total</span> <span style=color:#960050;background-color:#1e0010>used</span> <span style=color:#960050;background-color:#1e0010>free</span> <span style=color:#960050;background-color:#1e0010>shared</span> <span style=color:#960050;background-color:#1e0010>buff/cache</span> <span style=color:#960050;background-color:#1e0010>available</span>

<span style=color:#a6e22e>Mem</span><span style=color:#f92672>:</span> 1016168 100360 293520 356 622288 746024

<span style=color:#a6e22e>Swap</span><span style=color:#f92672>:</span> 0 0 0

</code></pre></div><p>在 /var/swap 创建 1024k 个 1k 大小的空文件：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ dd <span style=color:#66d9ef>if</span><span style=color:#f92672>=</span>/dev/zero of<span style=color:#f92672>=</span>/var/swap bs<span style=color:#f92672>=</span>1k count<span style=color:#f92672>=</span>1024k
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=color:#960050;background-color:#1e0010>1048576+0</span> <span style=color:#960050;background-color:#1e0010>records</span> <span style=color:#960050;background-color:#1e0010>in</span>
<span style=color:#960050;background-color:#1e0010>1048576+0</span> <span style=color:#960050;background-color:#1e0010>records</span> <span style=color:#960050;background-color:#1e0010>out</span>
<span style=color:#960050;background-color:#1e0010>1073741824</span> <span style=color:#960050;background-color:#1e0010>bytes</span> <span style=color:#960050;background-color:#1e0010>(1.1</span> <span style=color:#960050;background-color:#1e0010>GB)</span> <span style=color:#960050;background-color:#1e0010>copied,</span> <span style=color:#960050;background-color:#1e0010>18.4951</span> <span style=color:#960050;background-color:#1e0010>s,</span> <span style=color:#960050;background-color:#1e0010>58.1</span> <span style=color:#960050;background-color:#1e0010>MB/s</span>
</code></pre></div><p>创建 swap 分区：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ mkswap /var/swap
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=color:#960050;background-color:#1e0010>Setting</span> <span style=color:#960050;background-color:#1e0010>up</span> <span style=color:#960050;background-color:#1e0010>swapspace</span> <span style=color:#960050;background-color:#1e0010>version</span> <span style=color:#960050;background-color:#1e0010>1,</span> size <span style=color:#f92672>=</span> <span style=color:#ae81ff>1048572</span> KiB
<span style=color:#960050;background-color:#1e0010>no</span> <span style=color:#960050;background-color:#1e0010>label,</span> UUID<span style=color:#f92672>=</span>9a1b4bf2-cc39-4ab7-8dd9-9e0f25d0695d
</code></pre></div><p>启用 swap 分区：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ swapon /var/swap
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=color:#a6e22e>swapon</span><span style=color:#f92672>:</span> /var/swap: insecure permissions 0644, 0600 suggested.
</code></pre></div><p>写入分区信息：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ echo <span style=color:#e6db74>&#39;/var/swap swap swap default 0 0&#39;</span> &gt;&gt; /etc/fstab
</code></pre></div><p>再次查看 swap 分区大小：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ free
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=color:#960050;background-color:#1e0010>total</span> <span style=color:#960050;background-color:#1e0010>used</span> <span style=color:#960050;background-color:#1e0010>free</span> <span style=color:#960050;background-color:#1e0010>shared</span> <span style=color:#960050;background-color:#1e0010>buff/cache</span> <span style=color:#960050;background-color:#1e0010>available</span>
<span style=color:#a6e22e>Mem</span><span style=color:#f92672>:</span> 1016168 100360 293520 356 622288 746024
<span style=color:#a6e22e>Swap</span><span style=color:#f92672>:</span> 1048572 0 1048572
</code></pre></div><h4 id=3-检查-nodejs>3. 检查 Node.js</h4><p>查看安装的 node.js 版本号：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ node -v
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=color:#960050;background-color:#1e0010>v8.11.3</span>
</code></pre></div><p>注意： Ghost 最新版支持的 Node.js 的版本为 v8.9+, v6.9+, v4.5+ 。</p><p>查看 node.js 安装路径：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo which node
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=color:#960050;background-color:#1e0010>/bin/node</span>
</code></pre></div><p><strong>注意</strong>：Node.js 需要安装在系统路径，比如 /usr/bin/node 或者 /usr/local/bin/node 等。不推荐使用 nvm 来管理 node.js，nvm 会把 node.js 安装在 /root 或者 /home 等用户路径，依靠建立软链的方式是不行的。如果一定要用 nvm，可以使用 nvm 将 node.js 安装在系统路径中（见 Install system-wide Node.js with NVM: the painless way）。</p><h4 id=4-检查-mysql>4. 检查 MySQL</h4><p>查看 MySQL 版本：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ mysqld -V
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=color:#960050;background-color:#1e0010>mysqld</span> <span style=color:#960050;background-color:#1e0010>Ver</span> <span style=color:#960050;background-color:#1e0010>5.7.22</span> <span style=color:#960050;background-color:#1e0010>for</span> <span style=color:#960050;background-color:#1e0010>Linux</span> <span style=color:#960050;background-color:#1e0010>on</span> <span style=color:#960050;background-color:#1e0010>x86_64</span> <span style=color:#960050;background-color:#1e0010>(MySQL</span> <span style=color:#960050;background-color:#1e0010>Community</span> <span style=color:#960050;background-color:#1e0010>Server</span> <span style=color:#960050;background-color:#1e0010>(GPL))</span>
</code></pre></div><p>注意： 推荐使用 MySQL 5.7.x 版本，不要使用 8.x 版本，否则 Ghost 将连接 MySQL 出错。</p><p>检查 MySQL 服务是否正在运行：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ systemctl is-active mysqld
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=color:#960050;background-color:#1e0010>active</span>
</code></pre></div><p>使用 MySQL root 用户登陆 MySQL：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ mysql -u root -p -h localhost
</code></pre></div><p>输入 MySQL root 用户密码：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=color:#960050;background-color:#1e0010>Welcome</span> <span style=color:#960050;background-color:#1e0010>to</span> <span style=color:#960050;background-color:#1e0010>the</span> <span style=color:#960050;background-color:#1e0010>MySQL</span> <span style=color:#960050;background-color:#1e0010>monitor.</span> <span style=color:#960050;background-color:#1e0010>Commands</span> <span style=color:#960050;background-color:#1e0010>end</span> <span style=color:#960050;background-color:#1e0010>with</span> <span style=color:#960050;background-color:#1e0010>;</span> <span style=color:#960050;background-color:#1e0010>or</span> <span style=color:#960050;background-color:#1e0010>\g.</span>
<span style=color:#960050;background-color:#1e0010>Your</span> <span style=color:#960050;background-color:#1e0010>MySQL</span> <span style=color:#960050;background-color:#1e0010>connection</span> <span style=color:#960050;background-color:#1e0010>id</span> <span style=color:#960050;background-color:#1e0010>is</span> <span style=color:#960050;background-color:#1e0010>2</span>
<span style=color:#a6e22e>Server version</span><span style=color:#f92672>:</span> 5.7.22

<span style=color:#960050;background-color:#1e0010>Copyright</span> <span style=color:#960050;background-color:#1e0010>(c)</span> <span style=color:#960050;background-color:#1e0010>2000,</span> <span style=color:#960050;background-color:#1e0010>2018,</span> <span style=color:#960050;background-color:#1e0010>Oracle</span> <span style=color:#960050;background-color:#1e0010>and/or</span> <span style=color:#960050;background-color:#1e0010>its</span> <span style=color:#960050;background-color:#1e0010>affiliates.</span> <span style=color:#960050;background-color:#1e0010>All</span> <span style=color:#960050;background-color:#1e0010>rights</span> <span style=color:#960050;background-color:#1e0010>reserved.</span>

<span style=color:#960050;background-color:#1e0010>Oracle</span> <span style=color:#960050;background-color:#1e0010>is</span> <span style=color:#960050;background-color:#1e0010>a</span> <span style=color:#960050;background-color:#1e0010>registered</span> <span style=color:#960050;background-color:#1e0010>trademark</span> <span style=color:#960050;background-color:#1e0010>of</span> <span style=color:#960050;background-color:#1e0010>Oracle</span> <span style=color:#960050;background-color:#1e0010>Corporation</span> <span style=color:#960050;background-color:#1e0010>and/or</span> <span style=color:#960050;background-color:#1e0010>its</span>
<span style=color:#960050;background-color:#1e0010>affiliates.</span> <span style=color:#960050;background-color:#1e0010>Other</span> <span style=color:#960050;background-color:#1e0010>names</span> <span style=color:#960050;background-color:#1e0010>may</span> <span style=color:#960050;background-color:#1e0010>be</span> <span style=color:#960050;background-color:#1e0010>trademarks</span> <span style=color:#960050;background-color:#1e0010>of</span> <span style=color:#960050;background-color:#1e0010>their</span> <span style=color:#960050;background-color:#1e0010>respective</span>
<span style=color:#960050;background-color:#1e0010>owners.</span>

<span style=color:#960050;background-color:#1e0010>Type</span> <span style=color:#e6db74>&#39;help;&#39;</span> <span style=color:#960050;background-color:#1e0010>or</span> <span style=color:#e6db74>&#39;\h&#39;</span> <span style=color:#960050;background-color:#1e0010>for</span> <span style=color:#960050;background-color:#1e0010>help.</span> <span style=color:#960050;background-color:#1e0010>Type</span> <span style=color:#e6db74>&#39;\c&#39;</span> <span style=color:#960050;background-color:#1e0010>to</span> <span style=color:#960050;background-color:#1e0010>clear</span> <span style=color:#960050;background-color:#1e0010>the</span> <span style=color:#960050;background-color:#1e0010>current</span> <span style=color:#960050;background-color:#1e0010>input</span> <span style=color:#960050;background-color:#1e0010>statement.</span>

<span style=color:#960050;background-color:#1e0010>mysql&gt;</span>

</code></pre></div><p>确保可以 root 用户可以正常登陆 MySQL 即可。</p><p>由于我们是升级 Ghost，Mysql 这里其实原来配置都有，这一小节只需要检验一下账户是否还可以用就可以了。</p><h4 id=5-检查-nginx>5. 检查 nginx</h4><p>检查 nginx 版本：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ nginx -v
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=color:#a6e22e>nginx version</span><span style=color:#f92672>:</span> nginx/1.15.0
</code></pre></div><p>注意： 如果需要配置 SSL 使用 https，则 nginx 版本需要大于等于 1.9.5。</p><p>检查 nginx 服务是否正在运行：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ systemctl is-active nginx
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=color:#960050;background-color:#1e0010>active</span>
</code></pre></div><p>使用 IP 地址确认可以访问到 nginx 的欢迎页面，或者自己修改后的欢迎页面。</p><h3 id=开始安装>开始安装</h3><h4 id=1-安装-ghost-cli>1. 安装 Ghost-CLI</h4><p>Ghost-CLI 可以方便对未来的 Ghost 状态管理，升级。装上 Ghost-CLI 以后，之后的版本升级只需要 <code>ghost update</code> 一下就可以了。所以本次 breaking update 只需要痛这一次。</p><p>使用 npm 全局安装 ghost-cli ：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo npm i -g ghost-cli
</code></pre></div><p>查看安装的 ghost-cli 版本：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ ghost -v
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=color:#a6e22e>Ghost-CLI version</span><span style=color:#f92672>:</span> 1.8.1
</code></pre></div><h4 id=2-创建新用户>2. 创建新用户</h4><p>注意： 如果已有拥有 sudo 权限的非 root 用户，跳过此步骤。</p><p>新建一个用户：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ adduser &lt;user&gt;
</code></pre></div><p>注意：<code>&lt;user></code> 为新建用户的用户名。注意这个名字不能为 ghost，因为 Ghost 会创建一个叫 ghost 的用户。</p><p>设置用户密码：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ passwd &lt;user&gt;
</code></pre></div><p>输入两遍用户密码。</p><p>赋予 /etc/sudoers 文件写权限：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ chmod -v u+w /etc/sudoers
</code></pre></div><p>编辑文件：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ vim /etc/sudoers
</code></pre></div><p>找到：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=color:#75715e>## Allow root to run any commands anywhere
</span><span style=color:#75715e></span><span style=color:#960050;background-color:#1e0010>root</span>    ALL<span style=color:#f92672>=(</span>ALL<span style=color:#f92672>)</span>       ALL
</code></pre></div><p>在下面添加：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=color:#75715e># 该用户在使用 sudo 命令时不需要输入密码
</span><span style=color:#75715e></span><span style=color:#a6e22e>&lt;user&gt;    ALL=(ALL)       NOPASSWD</span><span style=color:#f92672>:</span>ALL
<span style=color:#75715e># or 该用户在使用 sudo 命令时需要输入密码
</span><span style=color:#75715e></span><span style=color:#960050;background-color:#1e0010>&lt;user&gt;</span>    ALL<span style=color:#f92672>=(</span>ALL<span style=color:#f92672>)</span>       ALL
</code></pre></div><p>保存退出，并恢复 /etc/sudoers 文件权限：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ chmod -v u-w /etc/sudoers
</code></pre></div><h4 id=3-配置-ghost>3. 配置 Ghost</h4><p>创建目录
切换到一个非 root 且拥有 sudo 权限的用户，且用户名不为 ghost 的其他用户：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ su - &lt;user&gt;
</code></pre></div><p>注意： ghost-cli 会创建一个用户名为 ghost 的系统用户和用户组来自动运行 Ghost。</p><p>创建网站目录并设置权限：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo mkdir -p /var/www/ghost
$ sudo chown &lt;user&gt;:&lt;user&gt; /var/www/ghost
$ sudo chmod <span style=color:#ae81ff>775</span> /var/www/ghost
</code></pre></div><p>注意：<code>&lt;user></code> 为当前登陆的非 root 用的的用户名。</p><p>进入到网站目录：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ cd /var/www/ghost
</code></pre></div><h4 id=4-安装-ghost>4. 安装 Ghost</h4><p>由于我们是直接在生产环境上升级，所以用的是 Mysql 数据库。如果是 local 环境，用的是 sqlite3 数据库。</p><p>在当前目录跳过系统检查，使用 MySQL 作为数据库来安装 Ghost。</p><p>虽然官方文档上写的推荐 OS 是 Ubuntu 16.04，不过 CentOS 一样可以安装，只要加上 <code>--no-stack</code> 参数即可。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ ghost install --no-stack
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Checking</span> <span style=color:#960050;background-color:#1e0010>system</span> <span style=color:#960050;background-color:#1e0010>Node.js</span> <span style=color:#960050;background-color:#1e0010>version</span>
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Checking</span> <span style=color:#960050;background-color:#1e0010>logged</span> <span style=color:#960050;background-color:#1e0010>in</span> <span style=color:#960050;background-color:#1e0010>user</span>
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Checking</span> <span style=color:#960050;background-color:#1e0010>current</span> <span style=color:#960050;background-color:#1e0010>folder</span> <span style=color:#960050;background-color:#1e0010>permissions</span>
<span style=color:#960050;background-color:#1e0010>ℹ</span> <span style=color:#960050;background-color:#1e0010>Checking</span> <span style=color:#960050;background-color:#1e0010>operating</span> <span style=color:#960050;background-color:#1e0010>system</span> <span style=color:#960050;background-color:#1e0010>compatibility</span> <span style=color:#960050;background-color:#1e0010>[skipped]</span>
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Checking</span> <span style=color:#960050;background-color:#1e0010>for</span> <span style=color:#960050;background-color:#1e0010>a</span> <span style=color:#960050;background-color:#1e0010>MySQL</span> <span style=color:#960050;background-color:#1e0010>installation</span>
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Checking</span> <span style=color:#960050;background-color:#1e0010>memory</span> <span style=color:#960050;background-color:#1e0010>availability</span>
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Checking</span> <span style=color:#960050;background-color:#1e0010>for</span> <span style=color:#960050;background-color:#1e0010>latest</span> <span style=color:#960050;background-color:#1e0010>Ghost</span> <span style=color:#960050;background-color:#1e0010>version</span>
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Setting</span> <span style=color:#960050;background-color:#1e0010>up</span> <span style=color:#960050;background-color:#1e0010>install</span> <span style=color:#960050;background-color:#1e0010>directory</span>
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Downloading</span> <span style=color:#960050;background-color:#1e0010>and</span> <span style=color:#960050;background-color:#1e0010>installing</span> <span style=color:#960050;background-color:#1e0010>Ghost</span> <span style=color:#960050;background-color:#1e0010>v1.24.8</span>
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Finishing</span> <span style=color:#960050;background-color:#1e0010>install</span> <span style=color:#960050;background-color:#1e0010>process</span>
<span style=color:#a6e22e>? Enter your blog URL</span><span style=color:#f92672>:</span> (http://localhost:2368)
</code></pre></div><p>输入自己网站完整访问路径 <a href=https://halfrost.com>https://halfrost.com</a></p><p>回车：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=color:#a6e22e>? Enter your blog URL</span><span style=color:#f92672>:</span> [https://halfrost.com](https://halfrost.com)
<span style=color:#a6e22e>? Enter your MySQL hostname</span><span style=color:#f92672>:</span> (localhost)
</code></pre></div><p>输入 MySQL 的登陆地址，本机登陆就是 localhost 直接回车即可：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=color:#a6e22e>? Enter your MySQL hostname</span><span style=color:#f92672>:</span> localhost
<span style=color:#a6e22e>? Enter your MySQL username</span><span style=color:#f92672>:</span>
</code></pre></div><p>输入 root：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=color:#a6e22e>? Enter your MySQL username</span><span style=color:#f92672>:</span> root
<span style=color:#a6e22e>? Enter your MySQL password</span><span style=color:#f92672>:</span> [input is hidden]
</code></pre></div><p>输入 MySQL 的 root 用户密码：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=color:#a6e22e>? Enter your MySQL password</span><span style=color:#f92672>:</span> [hidden]
<span style=color:#a6e22e>? Enter your Ghost database name</span><span style=color:#f92672>:</span>
</code></pre></div><p>输入要创建的数据库的名称，回车直接使用默认的：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Configuring</span> <span style=color:#960050;background-color:#1e0010>Ghost</span>
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Setting</span> <span style=color:#960050;background-color:#1e0010>up</span> <span style=color:#960050;background-color:#1e0010>instance</span>
<span style=color:#a6e22e>Running sudo command</span><span style=color:#f92672>:</span> chown -R ghost:ghost /var/www/ghost/content
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Setting</span> <span style=color:#960050;background-color:#1e0010>up</span> <span style=color:#e6db74>&#34;ghost&#34;</span> <span style=color:#960050;background-color:#1e0010>system</span> <span style=color:#960050;background-color:#1e0010>user</span>
<span style=color:#960050;background-color:#1e0010>?</span> <span style=color:#960050;background-color:#1e0010>Do</span> <span style=color:#960050;background-color:#1e0010>you</span> <span style=color:#960050;background-color:#1e0010>wish</span> <span style=color:#960050;background-color:#1e0010>to</span> <span style=color:#960050;background-color:#1e0010>set</span> <span style=color:#960050;background-color:#1e0010>up</span> <span style=color:#e6db74>&#34;ghost&#34;</span> <span style=color:#960050;background-color:#1e0010>mysql</span> <span style=color:#960050;background-color:#1e0010>user?</span> <span style=color:#960050;background-color:#1e0010>(Y/n)</span>
</code></pre></div><p>回车确认自动创建 MySQL 用户：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=color:#960050;background-color:#1e0010>?</span> <span style=color:#960050;background-color:#1e0010>Do</span> <span style=color:#960050;background-color:#1e0010>you</span> <span style=color:#960050;background-color:#1e0010>wish</span> <span style=color:#960050;background-color:#1e0010>to</span> <span style=color:#960050;background-color:#1e0010>set</span> <span style=color:#960050;background-color:#1e0010>up</span> <span style=color:#e6db74>&#34;ghost&#34;</span> <span style=color:#960050;background-color:#1e0010>mysql</span> <span style=color:#960050;background-color:#1e0010>user?</span> <span style=color:#960050;background-color:#1e0010>Yes</span>
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Setting</span> <span style=color:#960050;background-color:#1e0010>up</span> <span style=color:#e6db74>&#34;ghost&#34;</span> <span style=color:#960050;background-color:#1e0010>mysql</span> <span style=color:#960050;background-color:#1e0010>user</span>
<span style=color:#960050;background-color:#1e0010>?</span> <span style=color:#960050;background-color:#1e0010>Do</span> <span style=color:#960050;background-color:#1e0010>you</span> <span style=color:#960050;background-color:#1e0010>wish</span> <span style=color:#960050;background-color:#1e0010>to</span> <span style=color:#960050;background-color:#1e0010>set</span> <span style=color:#960050;background-color:#1e0010>up</span> <span style=color:#960050;background-color:#1e0010>Nginx?</span> <span style=color:#960050;background-color:#1e0010>(Y/n)</span>
</code></pre></div><p>直接回车确定自动设置 nginx：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=color:#960050;background-color:#1e0010>?</span> <span style=color:#960050;background-color:#1e0010>Do</span> <span style=color:#960050;background-color:#1e0010>you</span> <span style=color:#960050;background-color:#1e0010>wish</span> <span style=color:#960050;background-color:#1e0010>to</span> <span style=color:#960050;background-color:#1e0010>set</span> <span style=color:#960050;background-color:#1e0010>up</span> <span style=color:#960050;background-color:#1e0010>Nginx?</span> <span style=color:#960050;background-color:#1e0010>Yes</span>
<span style=color:#960050;background-color:#1e0010>Nginx</span> <span style=color:#960050;background-color:#1e0010>is</span> <span style=color:#960050;background-color:#1e0010>not</span> <span style=color:#960050;background-color:#1e0010>installed.</span> <span style=color:#960050;background-color:#1e0010>Skipping</span> <span style=color:#960050;background-color:#1e0010>Nginx</span> <span style=color:#960050;background-color:#1e0010>setup.</span>
<span style=color:#960050;background-color:#1e0010>ℹ</span> <span style=color:#960050;background-color:#1e0010>Setting</span> <span style=color:#960050;background-color:#1e0010>up</span> <span style=color:#960050;background-color:#1e0010>Nginx</span> <span style=color:#960050;background-color:#1e0010>[skipped]</span>
<span style=color:#960050;background-color:#1e0010>Task</span> <span style=color:#960050;background-color:#1e0010>ssl</span> <span style=color:#960050;background-color:#1e0010>depends</span> <span style=color:#960050;background-color:#1e0010>on</span> <span style=color:#960050;background-color:#1e0010>the</span> <span style=color:#e6db74>&#39;nginx&#39;</span> <span style=color:#960050;background-color:#1e0010>stage,</span> <span style=color:#960050;background-color:#1e0010>which</span> <span style=color:#960050;background-color:#1e0010>was</span> <span style=color:#960050;background-color:#1e0010>skipped.</span>
<span style=color:#960050;background-color:#1e0010>ℹ</span> <span style=color:#960050;background-color:#1e0010>Setting</span> <span style=color:#960050;background-color:#1e0010>up</span> <span style=color:#960050;background-color:#1e0010>SSL</span> <span style=color:#960050;background-color:#1e0010>[skipped]</span>
<span style=color:#960050;background-color:#1e0010>?</span> <span style=color:#960050;background-color:#1e0010>Do</span> <span style=color:#960050;background-color:#1e0010>you</span> <span style=color:#960050;background-color:#1e0010>wish</span> <span style=color:#960050;background-color:#1e0010>to</span> <span style=color:#960050;background-color:#1e0010>set</span> <span style=color:#960050;background-color:#1e0010>up</span> <span style=color:#960050;background-color:#1e0010>Systemd?</span> <span style=color:#960050;background-color:#1e0010>(Y/n)</span>
</code></pre></div><p>发现 Ghost-CLI 在 CentOS 上依然不识别已安装的 nginx，后面自己手动设置。</p><p>直接回车确实自动设置系统服务：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=color:#960050;background-color:#1e0010>?</span> <span style=color:#960050;background-color:#1e0010>Do</span> <span style=color:#960050;background-color:#1e0010>you</span> <span style=color:#960050;background-color:#1e0010>wish</span> <span style=color:#960050;background-color:#1e0010>to</span> <span style=color:#960050;background-color:#1e0010>set</span> <span style=color:#960050;background-color:#1e0010>up</span> <span style=color:#960050;background-color:#1e0010>Systemd?</span> <span style=color:#960050;background-color:#1e0010>Yes</span>
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Creating</span> <span style=color:#960050;background-color:#1e0010>systemd</span> <span style=color:#960050;background-color:#1e0010>service</span> <span style=color:#960050;background-color:#1e0010>file</span> <span style=color:#960050;background-color:#1e0010>at</span> <span style=color:#960050;background-color:#1e0010>/var/www/ghost/system/files/ghost_halfrost-com.service</span>
<span style=color:#a6e22e>Running sudo command</span><span style=color:#f92672>:</span> ln -sf /var/www/ghost/system/files/ghost_halfrost-com.service /lib/systemd/system/ghost_halfrost-com.service
<span style=color:#a6e22e>Running sudo command</span><span style=color:#f92672>:</span> systemctl daemon-reload
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Setting</span> <span style=color:#960050;background-color:#1e0010>up</span> <span style=color:#960050;background-color:#1e0010>Systemd</span>
<span style=color:#a6e22e>Running sudo command</span><span style=color:#f92672>:</span> /var/www/ghost/current/node_modules/.bin/knex-migrator-migrate --init --mgpath /var/www/ghost/current
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Running</span> <span style=color:#960050;background-color:#1e0010>database</span> <span style=color:#960050;background-color:#1e0010>migrations</span>
<span style=color:#960050;background-color:#1e0010>?</span> <span style=color:#960050;background-color:#1e0010>Do</span> <span style=color:#960050;background-color:#1e0010>you</span> <span style=color:#960050;background-color:#1e0010>want</span> <span style=color:#960050;background-color:#1e0010>to</span> <span style=color:#960050;background-color:#1e0010>start</span> <span style=color:#960050;background-color:#1e0010>Ghost?</span> <span style=color:#960050;background-color:#1e0010>(Y/n)</span>
</code></pre></div><p>现在如果启动，是启动不起来的，因为 nginx 的配置是老版本的，新版本的配置字段有变更。</p><h4 id=5-设置-nginx>5. 设置 nginx</h4><p>新建配置文件：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo vim /etc/nginx/conf.d/ghost.conf
</code></pre></div><p>写入配置，下面是我的配置，只是举个例子：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=color:#960050;background-color:#1e0010>server</span> <span style=color:#960050;background-color:#1e0010>{</span>  
    <span style=color:#960050;background-color:#1e0010>listen</span> <span style=color:#960050;background-color:#1e0010>443</span> <span style=color:#960050;background-color:#1e0010>default_server</span> <span style=color:#960050;background-color:#1e0010>ssl</span> <span style=color:#960050;background-color:#1e0010>http2;</span>
    <span style=color:#960050;background-color:#1e0010>server_name</span> <span style=color:#960050;background-color:#1e0010>halfrost.com</span> <span style=color:#960050;background-color:#1e0010>www.halfrost.com;</span>
    
    <span style=color:#960050;background-color:#1e0010>add_header</span> <span style=color:#960050;background-color:#1e0010>Strict-Transport-Security</span> <span style=color:#e6db74>&#34;max-age=63072000; includeSubdomains; preload&#34;</span><span style=color:#960050;background-color:#1e0010>;</span>
    <span style=color:#960050;background-color:#1e0010>add_header</span> <span style=color:#960050;background-color:#1e0010>X-Frame-Options</span> <span style=color:#960050;background-color:#1e0010>DENY;</span>
    <span style=color:#960050;background-color:#1e0010>add_header</span> <span style=color:#960050;background-color:#1e0010>X-Content-Type-Options</span> <span style=color:#960050;background-color:#1e0010>nosniff;</span>
    <span style=color:#960050;background-color:#1e0010>add_header</span> <span style=color:#960050;background-color:#1e0010>X-Xss-Protection</span> <span style=color:#960050;background-color:#1e0010>1;</span>

    <span style=color:#960050;background-color:#1e0010>ssl</span> <span style=color:#960050;background-color:#1e0010>on;</span>
    <span style=color:#960050;background-color:#1e0010>ssl_certificate</span> <span style=color:#960050;background-color:#1e0010>/etc/letsencrypt/live/halfrost.com/fullchain.pem;</span> <span style=color:#75715e># managed by Certbot
</span><span style=color:#75715e></span>    ssl_certificate_key /etc/letsencrypt/live/halfrost.com/privkey.pem; <span style=color:#75715e># managed by Certbot</span>
    ssl_prefer_server_ciphers on;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers <span style=color:#e6db74>&#34;ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4&#34;</span>;

    location / <span style=color:#f92672>{</span>
        proxy_set_header   X-Real-IP $remote_addr;
        proxy_set_header   Host      $http_host;
        proxy_pass         http://127.0.0.1:2368;
    <span style=color:#f92672>}</span>

<span style=color:#960050;background-color:#1e0010>}</span>


<span style=color:#960050;background-color:#1e0010>server</span> <span style=color:#960050;background-color:#1e0010>{</span>  
        <span style=color:#960050;background-color:#1e0010>listen</span> <span style=color:#960050;background-color:#1e0010>80;</span>
        <span style=color:#960050;background-color:#1e0010>server_name</span> <span style=color:#960050;background-color:#1e0010>halfrost.com</span> <span style=color:#960050;background-color:#1e0010>www.halfrost.com;</span>
	<span style=color:#a6e22e>rewrite ^(.*)  https</span><span style=color:#f92672>:</span>//$server_name$1;

        <span style=color:#75715e>#if ($http_user_agent !~* baidu.com){</span> 
        <span style=color:#75715e>#        return 301 https://$host$request_uri;</span>
	<span style=color:#75715e>#}</span>

	location /.well-known/acme-challenge/ <span style=color:#f92672>{</span>
            	alias /var/www/halfrost.com/.well-known/acme-challenge/;
            	try_files $uri <span style=color:#f92672>=</span>404;
        <span style=color:#f92672>}</span>

        location / <span style=color:#f92672>{</span>
                proxy_set_header   X-Real-IP $remote_addr;
                proxy_set_header   Host      $http_host;
                proxy_pass         http://127.0.0.1:2368;
                client_max_body_size 35m;
        <span style=color:#f92672>}</span>
<span style=color:#960050;background-color:#1e0010>}</span>

</code></pre></div><p>注意： 修改 server_name 字段为自己解析的域名，多个域名空格隔开。</p><p>保存退出，重启 nginx 服务：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo systemctl restart nginx
</code></pre></div><h4 id=6-ghost-其他配置>6. ghost 其他配置</h4><p>在 /var/www/ghost/ 文件夹下面有一个 <code>config.production.json</code> 文件，这文件是对 ghost 的一些配置。这里可以列举一下我的配置：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=color:#960050;background-color:#1e0010>{</span>
  <span style=color:#e6db74>&#34;url&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;http://halfrost.com&#34;</span><span style=color:#960050;background-color:#1e0010>,</span>
  <span style=color:#e6db74>&#34;server&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#960050;background-color:#1e0010>{</span>
    <span style=color:#e6db74>&#34;port&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#960050;background-color:#1e0010>2368,</span>
    <span style=color:#e6db74>&#34;host&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;127.0.0.1&#34;</span>
  <span style=color:#960050;background-color:#1e0010>},</span>
  <span style=color:#e6db74>&#34;mail&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#960050;background-color:#1e0010>{</span>
    <span style=color:#e6db74>&#34;transport&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;SMTP&#34;</span><span style=color:#960050;background-color:#1e0010>,</span>
    <span style=color:#e6db74>&#34;from&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;halfrost@halfrost.com&#34;</span><span style=color:#960050;background-color:#1e0010>,</span>
    <span style=color:#e6db74>&#34;options&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#960050;background-color:#1e0010>{</span>
	 <span style=color:#e6db74>&#34;host&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;smtp.qq.com&#34;</span><span style=color:#960050;background-color:#1e0010>,</span>
     	 <span style=color:#e6db74>&#34;secureConnection&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#960050;background-color:#1e0010>true,</span>
         <span style=color:#e6db74>&#34;port&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#960050;background-color:#1e0010>465,</span>
         <span style=color:#e6db74>&#34;auth&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#960050;background-color:#1e0010>{</span>
              <span style=color:#e6db74>&#34;user&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;707176544@qq.com&#34;</span><span style=color:#960050;background-color:#1e0010>,</span>
              <span style=color:#e6db74>&#34;pass&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;XXXX&#34;</span>
       	  <span style=color:#960050;background-color:#1e0010>}</span>
     <span style=color:#960050;background-color:#1e0010>}</span>
  <span style=color:#960050;background-color:#1e0010>},</span>
  <span style=color:#e6db74>&#34;database&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#960050;background-color:#1e0010>{</span>
    <span style=color:#e6db74>&#34;client&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;mysql&#34;</span><span style=color:#960050;background-color:#1e0010>,</span>
    <span style=color:#e6db74>&#34;connection&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#960050;background-color:#1e0010>{</span>
      <span style=color:#e6db74>&#34;host&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;127.0.0.1&#34;</span><span style=color:#960050;background-color:#1e0010>,</span>
      <span style=color:#e6db74>&#34;user&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;ghost&#34;</span><span style=color:#960050;background-color:#1e0010>,</span>
      <span style=color:#e6db74>&#34;password&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;XXXX&#34;</span><span style=color:#960050;background-color:#1e0010>,</span>
      <span style=color:#e6db74>&#34;database&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;XXXX&#34;</span>
    <span style=color:#960050;background-color:#1e0010>}</span>
  <span style=color:#960050;background-color:#1e0010>},</span>
  <span style=color:#e6db74>&#34;storage&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#960050;background-color:#1e0010>{</span>
    <span style=color:#e6db74>&#34;active&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;qn-store&#34;</span><span style=color:#960050;background-color:#1e0010>,</span>
    <span style=color:#e6db74>&#34;qn-store&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#960050;background-color:#1e0010>{</span>
      <span style=color:#e6db74>&#34;accessKey&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;XXXX&#34;</span><span style=color:#960050;background-color:#1e0010>,</span>
      <span style=color:#e6db74>&#34;secretKey&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;XXXX&#34;</span><span style=color:#960050;background-color:#1e0010>,</span>
      <span style=color:#e6db74>&#34;bucket&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;XXXX&#34;</span><span style=color:#960050;background-color:#1e0010>,</span>
      <span style=color:#e6db74>&#34;origin&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;XXXX&#34;</span><span style=color:#960050;background-color:#1e0010>,</span>
      <span style=color:#e6db74>&#34;fileKey&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#960050;background-color:#1e0010>{</span>
        <span style=color:#e6db74>&#34;safeString&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#960050;background-color:#1e0010>true,</span>
        <span style=color:#e6db74>&#34;prefix&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;[Blog/ArticleTitleImage/]&#34;</span><span style=color:#960050;background-color:#1e0010>,</span>
	<span style=color:#e6db74>&#34;suffix&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;&#34;</span><span style=color:#960050;background-color:#1e0010>,</span>
	<span style=color:#e6db74>&#34;extname&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#960050;background-color:#1e0010>true</span>
      <span style=color:#960050;background-color:#1e0010>}</span>
    <span style=color:#960050;background-color:#1e0010>}</span>
  <span style=color:#960050;background-color:#1e0010>},</span>
  <span style=color:#e6db74>&#34;logging&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#960050;background-color:#1e0010>{</span>
    <span style=color:#e6db74>&#34;transports&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#960050;background-color:#1e0010>[</span>
      <span style=color:#e6db74>&#34;file&#34;</span><span style=color:#960050;background-color:#1e0010>,</span>
      <span style=color:#e6db74>&#34;stdout&#34;</span>
    <span style=color:#960050;background-color:#1e0010>]</span>
  <span style=color:#960050;background-color:#1e0010>},</span>
  <span style=color:#e6db74>&#34;process&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;systemd&#34;</span><span style=color:#960050;background-color:#1e0010>,</span>
  <span style=color:#e6db74>&#34;paths&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#960050;background-color:#1e0010>{</span>
    <span style=color:#e6db74>&#34;contentPath&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;/var/www/ghost/content&#34;</span>
  <span style=color:#960050;background-color:#1e0010>}</span>
<span style=color:#960050;background-color:#1e0010>}</span>

</code></pre></div><p>上面的配置字段比老版本变化了很多，虽然设置项基本没变，但是格式都有变化。</p><p>可以设置邮件，数据库，CDN 存储，日志文件地址，contentPath。</p><h2 id=测试>测试</h2><p>启动当前网站服务：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo systemctl start ghost_halfrost-com
</code></pre></div><p>查看服务状态：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo systemctl status ghost_halfrost-com
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=color:#a6e22e>● ghost_halfrost-com.service - Ghost systemd service for blog</span><span style=color:#f92672>:</span> halfrost-com
   Loaded: loaded <span style=color:#f92672>(</span>/var/www/ghost/system/files/ghost_halfrost-com.service; enabled; vendor preset: disabled<span style=color:#f92672>)</span>
   Active: active <span style=color:#f92672>(</span>running<span style=color:#f92672>)</span> since 日 2018-07-15 14:40:07 CST; 8h ago
     Docs: https://docs.ghost.org
 Main PID: <span style=color:#ae81ff>454</span> <span style=color:#f92672>(</span>ghost run<span style=color:#f92672>)</span>
   Memory: 218.7M
   CGroup: /system.slice/ghost_halfrost-com.service
           ├─454 ghost run
           └─829 /usr/local/bin/node current/index.js

</code></pre></div><p>注意： 不要使用 ghost start 启动，该命令在 CentOS 7 上会因为服务检查返回值为 unknown 而出错。</p><p>使用绑定的域名尝试访问自己的网站，访问 <code>http://&lt;domain>/ghost</code> 注册管理员账号。</p><p>可正常访问，则将该服务设置为开机启动：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo systemctl enable ghost_halfrost-com
</code></pre></div><h2 id=遇到的问题>遇到的问题</h2><p>如果按照上面的步骤升级完 Ghost，没有出现问题，那么恭喜你，可以愉快的离开本文了。如果遇到了问题，请继续往下看。</p><p>Ghost 官方提供了一个错误手册 <a href=https://docs.ghost.org/docs/troubleshooting>troubleshooting</a>，遇到问题可以先来查看这个手册。</p><p>接下来分享几个我在升级过程中遇到的问题。</p><h3 id=node找不到命令>node：找不到命令</h3><p>这个问题会出现在 Ghost 安装以后，当非 root 且拥有 sudo 权限的用户调用 node 相关的方法，就会出现这个错误。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo -u ghost node -v
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Makefile data-lang=Makefile><span style=color:#960050;background-color:#1e0010>sudo：node：找不到命令</span>
</code></pre></div><p>遇到这个问题的时候，笔者比较懵。因为非 root 且拥有 sudo 权限的用户笔者也创建了，node 也是全局安装的。按理来说不应该出现这个问题。在网上查了很久，才发现这个问题的原因。</p><p>原来在 CentOS 上，全局安装完 node，默认的路径在 <code>/usr/local/bin/node</code>，而 Ghost 可能按照 Linux 的路径，只认 <code>/usr/bin/node</code>。所以这里需要添加软链解决这个问题。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo ln -s /usr/local/bin/node /usr/bin/node
</code></pre></div><p>检查</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo -u ghost node -v
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Makefile data-lang=Makefile><span style=color:#960050;background-color:#1e0010>v8.11.3</span>
</code></pre></div><p>成功输出版本号，代表成功了。</p><h3 id=server-限制上传文件大小>server 限制上传文件大小</h3><p>比如上传一个 10MB 的高清图片，会报一个错误，server 限制了文件大小。这个限制是 nginx 上限制的。默认是 5MB，超过这个大小都不允许。</p><p>那么我们就需要提高 nginx 限制，先找到 nginx 的配置文件。配置文件在 <code>/etc/nginx/nginx.conf</code>。(<code>nginx.conf</code> 的原始权限是 -rw-r—r—，0644)</p><p>我们需要先修改文件的权限：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ cd /etc/nginx
$ chmod <span style=color:#ae81ff>777</span> nginx.conf
</code></pre></div><p>在这个文件中，添加 <code>client_max_body_size</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ vim nginx.conf
</code></pre></div><p>添加 <code>client_max_body_size 10m;</code></p><p>最后还原文件权限，重启 nginx 服务。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ chmod <span style=color:#ae81ff>644</span> nginx.conf
$ service nginx restart
</code></pre></div><h3 id=user-locked>user locked</h3><p>如果从老版本的 Ghost 备份的数据库文件 JSON 导入到最新版的 Ghost 的时候，会遇到用户被 locked 的问题。这个可能是 Ghost 出于安全的考虑。</p><p>笔者在 Ghost 后台找了很久，也没有发现能直接更改这个状态的地方。无奈，最终在数据库里面找到了，更改过后就好了。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ mysql -u ghost -p
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Makefile data-lang=Makefile><span style=color:#a6e22e>Enter password</span><span style=color:#f92672>:</span>

<span style=color:#960050;background-color:#1e0010>Welcome</span> <span style=color:#960050;background-color:#1e0010>to</span> <span style=color:#960050;background-color:#1e0010>the</span> <span style=color:#960050;background-color:#1e0010>MySQL</span> <span style=color:#960050;background-color:#1e0010>monitor.</span>  <span style=color:#960050;background-color:#1e0010>Commands</span> <span style=color:#960050;background-color:#1e0010>end</span> <span style=color:#960050;background-color:#1e0010>with</span> <span style=color:#960050;background-color:#1e0010>;</span> <span style=color:#960050;background-color:#1e0010>or</span> <span style=color:#960050;background-color:#1e0010>\g.</span>
<span style=color:#960050;background-color:#1e0010>Your</span> <span style=color:#960050;background-color:#1e0010>MySQL</span> <span style=color:#960050;background-color:#1e0010>connection</span> <span style=color:#960050;background-color:#1e0010>id</span> <span style=color:#960050;background-color:#1e0010>is</span> <span style=color:#960050;background-color:#1e0010>267</span>
<span style=color:#a6e22e>Server version</span><span style=color:#f92672>:</span> 5.7.37 MySQL Community Server (GPL)

<span style=color:#960050;background-color:#1e0010>Copyright</span> <span style=color:#960050;background-color:#1e0010>(c)</span> <span style=color:#960050;background-color:#1e0010>2000,</span> <span style=color:#960050;background-color:#1e0010>2017,</span> <span style=color:#960050;background-color:#1e0010>Oracle</span> <span style=color:#960050;background-color:#1e0010>and/or</span> <span style=color:#960050;background-color:#1e0010>its</span> <span style=color:#960050;background-color:#1e0010>affiliates.</span> <span style=color:#960050;background-color:#1e0010>All</span> <span style=color:#960050;background-color:#1e0010>rights</span> <span style=color:#960050;background-color:#1e0010>reserved.</span>

<span style=color:#960050;background-color:#1e0010>Oracle</span> <span style=color:#960050;background-color:#1e0010>is</span> <span style=color:#960050;background-color:#1e0010>a</span> <span style=color:#960050;background-color:#1e0010>registered</span> <span style=color:#960050;background-color:#1e0010>trademark</span> <span style=color:#960050;background-color:#1e0010>of</span> <span style=color:#960050;background-color:#1e0010>Oracle</span> <span style=color:#960050;background-color:#1e0010>Corporation</span> <span style=color:#960050;background-color:#1e0010>and/or</span> <span style=color:#960050;background-color:#1e0010>its</span>
<span style=color:#960050;background-color:#1e0010>affiliates.</span> <span style=color:#960050;background-color:#1e0010>Other</span> <span style=color:#960050;background-color:#1e0010>names</span> <span style=color:#960050;background-color:#1e0010>may</span> <span style=color:#960050;background-color:#1e0010>be</span> <span style=color:#960050;background-color:#1e0010>trademarks</span> <span style=color:#960050;background-color:#1e0010>of</span> <span style=color:#960050;background-color:#1e0010>their</span> <span style=color:#960050;background-color:#1e0010>respective</span>
<span style=color:#960050;background-color:#1e0010>owners.</span>

<span style=color:#960050;background-color:#1e0010>Type</span> <span style=color:#e6db74>&#39;help;&#39;</span> <span style=color:#960050;background-color:#1e0010>or</span> <span style=color:#e6db74>&#39;\h&#39;</span> <span style=color:#960050;background-color:#1e0010>for</span> <span style=color:#960050;background-color:#1e0010>help.</span> <span style=color:#960050;background-color:#1e0010>Type</span> <span style=color:#e6db74>&#39;\c&#39;</span> <span style=color:#960050;background-color:#1e0010>to</span> <span style=color:#960050;background-color:#1e0010>clear</span> <span style=color:#960050;background-color:#1e0010>the</span> <span style=color:#960050;background-color:#1e0010>current</span> <span style=color:#960050;background-color:#1e0010>input</span> <span style=color:#960050;background-color:#1e0010>statement.</span>

<span style=color:#960050;background-color:#1e0010>mysql&gt;</span>
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>mysql&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| ghost              |
| newghost           |
+--------------------+
<span style=color:#ae81ff>3</span> rows in set <span style=color:#f92672>(</span>0.00 sec<span style=color:#f92672>)</span>

mysql&gt; show tables;
+------------------------+
| Tables_in_newghost     |
+------------------------+
| accesstokens           |
| app_fields             |
| app_settings           |
| apps                   |
| brute                  |
| client_trusted_domains |
| clients                |
| invites                |
| migrations             |
| migrations_lock        |
| permissions            |
| permissions_apps       |
| permissions_roles      |
| permissions_users      |
| posts                  |
| posts_authors          |
| posts_tags             |
| refreshtokens          |
| roles                  |
| roles_users            |
| settings               |
| subscribers            |
| tags                   |
| users                  |
| webhooks               |
+------------------------+
<span style=color:#ae81ff>25</span> rows in set <span style=color:#f92672>(</span>0.00 sec<span style=color:#f92672>)</span>

mysql&gt; show create table users;
| users | CREATE TABLE <span style=color:#e6db74>`</span>users<span style=color:#e6db74>`</span> <span style=color:#f92672>(</span>
  <span style=color:#e6db74>`</span>id<span style=color:#e6db74>`</span> varchar<span style=color:#f92672>(</span>24<span style=color:#f92672>)</span> NOT NULL,
  <span style=color:#e6db74>`</span>name<span style=color:#e6db74>`</span> varchar<span style=color:#f92672>(</span>191<span style=color:#f92672>)</span> NOT NULL,
  <span style=color:#e6db74>`</span>slug<span style=color:#e6db74>`</span> varchar<span style=color:#f92672>(</span>191<span style=color:#f92672>)</span> NOT NULL,
  <span style=color:#e6db74>`</span>ghost_auth_access_token<span style=color:#e6db74>`</span> varchar<span style=color:#f92672>(</span>32<span style=color:#f92672>)</span> DEFAULT NULL,
  <span style=color:#e6db74>`</span>ghost_auth_id<span style=color:#e6db74>`</span> varchar<span style=color:#f92672>(</span>24<span style=color:#f92672>)</span> DEFAULT NULL,
  <span style=color:#e6db74>`</span>password<span style=color:#e6db74>`</span> varchar<span style=color:#f92672>(</span>60<span style=color:#f92672>)</span> NOT NULL,
  <span style=color:#e6db74>`</span>email<span style=color:#e6db74>`</span> varchar<span style=color:#f92672>(</span>191<span style=color:#f92672>)</span> NOT NULL,
  <span style=color:#e6db74>`</span>profile_image<span style=color:#e6db74>`</span> varchar<span style=color:#f92672>(</span>2000<span style=color:#f92672>)</span> DEFAULT NULL,
  <span style=color:#e6db74>`</span>cover_image<span style=color:#e6db74>`</span> varchar<span style=color:#f92672>(</span>2000<span style=color:#f92672>)</span> DEFAULT NULL,
  <span style=color:#e6db74>`</span>bio<span style=color:#e6db74>`</span> text,
  <span style=color:#e6db74>`</span>website<span style=color:#e6db74>`</span> varchar<span style=color:#f92672>(</span>2000<span style=color:#f92672>)</span> DEFAULT NULL,
  <span style=color:#e6db74>`</span>location<span style=color:#e6db74>`</span> text,
  <span style=color:#e6db74>`</span>facebook<span style=color:#e6db74>`</span> varchar<span style=color:#f92672>(</span>2000<span style=color:#f92672>)</span> DEFAULT NULL,
  <span style=color:#e6db74>`</span>twitter<span style=color:#e6db74>`</span> varchar<span style=color:#f92672>(</span>2000<span style=color:#f92672>)</span> DEFAULT NULL,
  <span style=color:#e6db74>`</span>accessibility<span style=color:#e6db74>`</span> text,
  <span style=color:#e6db74>`</span>status<span style=color:#e6db74>`</span> varchar<span style=color:#f92672>(</span>50<span style=color:#f92672>)</span> NOT NULL DEFAULT <span style=color:#e6db74>&#39;active&#39;</span>,
  <span style=color:#e6db74>`</span>locale<span style=color:#e6db74>`</span> varchar<span style=color:#f92672>(</span>6<span style=color:#f92672>)</span> DEFAULT NULL,
  <span style=color:#e6db74>`</span>visibility<span style=color:#e6db74>`</span> varchar<span style=color:#f92672>(</span>50<span style=color:#f92672>)</span> NOT NULL DEFAULT <span style=color:#e6db74>&#39;public&#39;</span>,
  <span style=color:#e6db74>`</span>meta_title<span style=color:#e6db74>`</span> varchar<span style=color:#f92672>(</span>2000<span style=color:#f92672>)</span> DEFAULT NULL,
  <span style=color:#e6db74>`</span>meta_description<span style=color:#e6db74>`</span> varchar<span style=color:#f92672>(</span>2000<span style=color:#f92672>)</span> DEFAULT NULL,
  <span style=color:#e6db74>`</span>tour<span style=color:#e6db74>`</span> text,
  <span style=color:#e6db74>`</span>last_seen<span style=color:#e6db74>`</span> datetime DEFAULT NULL,
  <span style=color:#e6db74>`</span>created_at<span style=color:#e6db74>`</span> datetime NOT NULL,
  <span style=color:#e6db74>`</span>created_by<span style=color:#e6db74>`</span> varchar<span style=color:#f92672>(</span>24<span style=color:#f92672>)</span> NOT NULL,
  <span style=color:#e6db74>`</span>updated_at<span style=color:#e6db74>`</span> datetime DEFAULT NULL,
  <span style=color:#e6db74>`</span>updated_by<span style=color:#e6db74>`</span> varchar<span style=color:#f92672>(</span>24<span style=color:#f92672>)</span> DEFAULT NULL,
  PRIMARY KEY <span style=color:#f92672>(</span><span style=color:#e6db74>`</span>id<span style=color:#e6db74>`</span><span style=color:#f92672>)</span>,
  UNIQUE KEY <span style=color:#e6db74>`</span>users_slug_unique<span style=color:#e6db74>`</span> <span style=color:#f92672>(</span><span style=color:#e6db74>`</span>slug<span style=color:#e6db74>`</span><span style=color:#f92672>)</span>,
  UNIQUE KEY <span style=color:#e6db74>`</span>users_email_unique<span style=color:#e6db74>`</span> <span style=color:#f92672>(</span><span style=color:#e6db74>`</span>email<span style=color:#e6db74>`</span><span style=color:#f92672>)</span>
<span style=color:#f92672>)</span> ENGINE<span style=color:#f92672>=</span>InnoDB DEFAULT CHARSET<span style=color:#f92672>=</span>utf8mb4 |
</code></pre></div><p>在 users 表中有一个 status 字段，把对应的用户这个字段改成 active 即可。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>mysql&gt; update users set status <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;active&#34;</span>;
</code></pre></div><h3 id=emoji-升级>emoji 升级</h3><p>在老版本的 Ghost 中，数据库默认是 utf8 的编码，所以不能支持 emoji 表情。最新版的 Ghost 默认创建的表就是支持 emoji 的 utf8mb4 编码。🙄😏</p><h3 id=权限问题>权限问题</h3><p>在安装完最新版的 Ghost 以后，还是有一些额外的问题，比如权限问题。那只能一一解决咯。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ ghost doctor
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Makefile data-lang=Makefile><span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Checking</span> <span style=color:#960050;background-color:#1e0010>system</span> <span style=color:#960050;background-color:#1e0010>Node.js</span> <span style=color:#960050;background-color:#1e0010>version</span>
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Checking</span> <span style=color:#960050;background-color:#1e0010>logged</span> <span style=color:#960050;background-color:#1e0010>in</span> <span style=color:#960050;background-color:#1e0010>user</span>
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Ensuring</span> <span style=color:#960050;background-color:#1e0010>user</span> <span style=color:#960050;background-color:#1e0010>is</span> <span style=color:#960050;background-color:#1e0010>not</span> <span style=color:#960050;background-color:#1e0010>logged</span> <span style=color:#960050;background-color:#1e0010>in</span> <span style=color:#960050;background-color:#1e0010>as</span> <span style=color:#960050;background-color:#1e0010>ghost</span> <span style=color:#960050;background-color:#1e0010>user</span>
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Checking</span> <span style=color:#960050;background-color:#1e0010>if</span> <span style=color:#960050;background-color:#1e0010>logged</span> <span style=color:#960050;background-color:#1e0010>in</span> <span style=color:#960050;background-color:#1e0010>user</span> <span style=color:#960050;background-color:#1e0010>is</span> <span style=color:#960050;background-color:#1e0010>directory</span> <span style=color:#960050;background-color:#1e0010>owner</span>
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Checking</span> <span style=color:#960050;background-color:#1e0010>current</span> <span style=color:#960050;background-color:#1e0010>folder</span> <span style=color:#960050;background-color:#1e0010>permissions</span>
<span style=color:#a6e22e>System checks failed with message</span><span style=color:#f92672>:</span> &#39;Linux version is not Ubuntu 16&#39;
<span style=color:#960050;background-color:#1e0010>Some</span> <span style=color:#960050;background-color:#1e0010>features</span> <span style=color:#960050;background-color:#1e0010>of</span> <span style=color:#960050;background-color:#1e0010>Ghost-CLI</span> <span style=color:#960050;background-color:#1e0010>may</span> <span style=color:#960050;background-color:#1e0010>not</span> <span style=color:#960050;background-color:#1e0010>work</span> <span style=color:#960050;background-color:#1e0010>without</span> <span style=color:#960050;background-color:#1e0010>additional</span> <span style=color:#960050;background-color:#1e0010>configuration.</span>
<span style=color:#960050;background-color:#1e0010>For</span> <span style=color:#960050;background-color:#1e0010>local</span> <span style=color:#960050;background-color:#1e0010>installs</span> <span style=color:#960050;background-color:#1e0010>we</span> <span style=color:#960050;background-color:#1e0010>recommend</span> <span style=color:#960050;background-color:#1e0010>using</span> <span style=color:#960050;background-color:#1e0010>`ghost</span> <span style=color:#960050;background-color:#1e0010>install</span> <span style=color:#960050;background-color:#1e0010>local`</span> <span style=color:#960050;background-color:#1e0010>instead.</span>
<span style=color:#960050;background-color:#1e0010>?</span> <span style=color:#960050;background-color:#1e0010>Continue</span> <span style=color:#960050;background-color:#1e0010>anyway?</span> <span style=color:#960050;background-color:#1e0010>Yes</span>
<span style=color:#960050;background-color:#1e0010>ℹ</span> <span style=color:#960050;background-color:#1e0010>Checking</span> <span style=color:#960050;background-color:#1e0010>operating</span> <span style=color:#960050;background-color:#1e0010>system</span> <span style=color:#960050;background-color:#1e0010>compatibility</span> <span style=color:#960050;background-color:#1e0010>[skipped]</span>
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Checking</span> <span style=color:#960050;background-color:#1e0010>for</span> <span style=color:#960050;background-color:#1e0010>a</span> <span style=color:#960050;background-color:#1e0010>MySQL</span> <span style=color:#960050;background-color:#1e0010>installation</span>
<span style=color:#a6e22e>Running sudo command</span><span style=color:#f92672>:</span> systemctl is-active ghost_halfrost-com
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Validating</span> <span style=color:#960050;background-color:#1e0010>config</span>
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Checking</span> <span style=color:#960050;background-color:#1e0010>folder</span> <span style=color:#960050;background-color:#1e0010>permissions</span>
<span style=color:#960050;background-color:#1e0010>✖</span> <span style=color:#960050;background-color:#1e0010>Checking</span> <span style=color:#960050;background-color:#1e0010>file</span> <span style=color:#960050;background-color:#1e0010>permissions</span>
<span style=color:#960050;background-color:#1e0010>✖</span> <span style=color:#960050;background-color:#1e0010>Checking</span> <span style=color:#960050;background-color:#1e0010>content</span> <span style=color:#960050;background-color:#1e0010>folder</span> <span style=color:#960050;background-color:#1e0010>ownership</span>
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Checking</span> <span style=color:#960050;background-color:#1e0010>memory</span> <span style=color:#960050;background-color:#1e0010>availability</span>
<span style=color:#960050;background-color:#1e0010>One</span> <span style=color:#960050;background-color:#1e0010>or</span> <span style=color:#960050;background-color:#1e0010>more</span> <span style=color:#960050;background-color:#1e0010>errors</span> <span style=color:#960050;background-color:#1e0010>occurred.</span>

<span style=color:#960050;background-color:#1e0010>1)</span> <span style=color:#960050;background-color:#1e0010>Checking</span> <span style=color:#960050;background-color:#1e0010>file</span> <span style=color:#960050;background-color:#1e0010>permissions</span>

<span style=color:#a6e22e>Message</span><span style=color:#f92672>:</span> Your installation folder contains some directories or files with incorrect permissions:
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/boo-master/assets/fonts/casper-icons.svg</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/boo-master/assets/fonts/casper-icons.woff</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/boo-master/assets/fonts/casper-icons.eot</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/boo-master/assets/fonts/casper-icons.ttf</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/yasuko-----2/author.hbs</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/yasuko-----2/default.hbs</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/yasuko-----2/LICENSE</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/yasuko-----2/gulpfile.js</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/yasuko-----2/page.hbs</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/yasuko-----2/assets/js/dev.min.js</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/yasuko-----2/assets/js/webfont.js</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/yasuko-----2/assets/js/jquery.fitvids.js</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/yasuko-----2/assets/js/prism.js</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/yasuko-----2/assets/js/lazy.js</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/yasuko-----2/assets/js/all.min.js</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/yasuko-----2/assets/js/index.js</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/yasuko-----2/assets/css/uncompressed.css</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/yasuko-----2/assets/css/dev.min.css</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/yasuko-----2/assets/css/all.min.css</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/yasuko-----2/assets/css/screen.css</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/yasuko-----2/assets/css/font_.min.css</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/yasuko-----2/index.hbs</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/yasuko-----2/partials/navigation.hbs</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/yasuko-----2/partials/loop.hbs</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/yasuko-----2/package.json</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/yasuko-----2/post.hbs</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/yasuko-----2/tag.hbs</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/yasuko-----2/README.md</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/odin-master/assets/fonts/casper-icons.svg</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/odin-master/assets/fonts/casper-icons.woff</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/odin-master/assets/fonts/casper-icons.eot</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/odin-master/assets/fonts/casper-icons.ttf</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/odin-master/assets/js/rrssb.min.js</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/themes/odin-master/assets/css/rrssb.css</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./node_modules/os-name/cli.js</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./node_modules/mime/src/build.js</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./node_modules/mime/cli.js</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./node_modules/semver/bin/semver</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./node_modules/osx-release/cli.js</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./node_modules/mkdirp/bin/cmd.js</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./node_modules/escodegen/bin/escodegen.js</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./node_modules/escodegen/bin/esgenerate.js</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./node_modules/esprima/bin/esvalidate.js</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./node_modules/esprima/bin/esparse.js</span>
<span style=color:#960050;background-color:#1e0010>Run</span> <span style=color:#960050;background-color:#1e0010>sudo</span> <span style=color:#960050;background-color:#1e0010>find</span> <span style=color:#960050;background-color:#1e0010>./</span> <span style=color:#960050;background-color:#1e0010>!</span> <span style=color:#960050;background-color:#1e0010>-path</span> <span style=color:#e6db74>&#34;./versions/*&#34;</span> <span style=color:#960050;background-color:#1e0010>-type</span> <span style=color:#960050;background-color:#1e0010>f</span> <span style=color:#960050;background-color:#1e0010>-exec</span> <span style=color:#960050;background-color:#1e0010>chmod</span> <span style=color:#960050;background-color:#1e0010>664</span> <span style=color:#960050;background-color:#1e0010>{}</span> <span style=color:#960050;background-color:#1e0010>\;</span> <span style=color:#960050;background-color:#1e0010>and</span> <span style=color:#960050;background-color:#1e0010>try</span> <span style=color:#960050;background-color:#1e0010>again.</span>


<span style=color:#960050;background-color:#1e0010>2)</span> <span style=color:#960050;background-color:#1e0010>Checking</span> <span style=color:#960050;background-color:#1e0010>content</span> <span style=color:#960050;background-color:#1e0010>folder</span> <span style=color:#960050;background-color:#1e0010>ownership</span>

<span style=color:#a6e22e>Message</span><span style=color:#f92672>:</span> Your installation folder contains some directories or files with incorrect permissions:
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/adapters</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/adapters/storage</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/adapters/storage/qn-store</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/adapters/storage/qn-store/LICENSE</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/adapters/storage/qn-store/lib</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/adapters/storage/qn-store/lib/getHash.js</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/adapters/storage/qn-store/package.json</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/adapters/storage/qn-store/index.js</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/adapters/storage/qn-store/.npmignore</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>./content/adapters/storage/qn-store/README.md</span>
<span style=color:#a6e22e>Run sudo chown -R ghost</span><span style=color:#f92672>:</span>ghost ./content and try again.

<span style=color:#a6e22e>Debug Information</span><span style=color:#f92672>:</span>
    OS: CentOS, v7.3.1611
    Node Version: v8.11.3
    Ghost-CLI Version: 1.8.1
    Environment: production
    Command: <span style=color:#e6db74>&#39;ghost doctor&#39;</span>

<span style=color:#960050;background-color:#1e0010>Try</span> <span style=color:#960050;background-color:#1e0010>running</span> <span style=color:#960050;background-color:#1e0010>ghost</span> <span style=color:#960050;background-color:#1e0010>doctor</span> <span style=color:#960050;background-color:#1e0010>to</span> <span style=color:#960050;background-color:#1e0010>check</span> <span style=color:#960050;background-color:#1e0010>your</span> <span style=color:#960050;background-color:#1e0010>system</span> <span style=color:#960050;background-color:#1e0010>for</span> <span style=color:#960050;background-color:#1e0010>known</span> <span style=color:#960050;background-color:#1e0010>issues.</span>

<span style=color:#a6e22e>Please refer to https</span><span style=color:#f92672>:</span>//docs.ghost.org/v1/docs/troubleshooting<span style=color:#75715e>#section-cli-errors for troubleshooting.
</span><span style=color:#75715e></span>
</code></pre></div><p>从报错来看，都是因为文件权限的原因。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo find ./ ! -path <span style=color:#e6db74>&#34;./versions/*&#34;</span> -type f -exec chmod <span style=color:#ae81ff>664</span> <span style=color:#f92672>{}</span> <span style=color:#ae81ff>\;</span>
$ sudo chown -R ghost:ghost ./content
</code></pre></div><p>更改权限以后再次执行 <code>ghost doctor</code>，所有问题都解决了。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ ghost doctor
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Makefile data-lang=Makefile><span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Checking</span> <span style=color:#960050;background-color:#1e0010>system</span> <span style=color:#960050;background-color:#1e0010>Node.js</span> <span style=color:#960050;background-color:#1e0010>version</span>
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Checking</span> <span style=color:#960050;background-color:#1e0010>logged</span> <span style=color:#960050;background-color:#1e0010>in</span> <span style=color:#960050;background-color:#1e0010>user</span>
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Ensuring</span> <span style=color:#960050;background-color:#1e0010>user</span> <span style=color:#960050;background-color:#1e0010>is</span> <span style=color:#960050;background-color:#1e0010>not</span> <span style=color:#960050;background-color:#1e0010>logged</span> <span style=color:#960050;background-color:#1e0010>in</span> <span style=color:#960050;background-color:#1e0010>as</span> <span style=color:#960050;background-color:#1e0010>ghost</span> <span style=color:#960050;background-color:#1e0010>user</span>
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Checking</span> <span style=color:#960050;background-color:#1e0010>if</span> <span style=color:#960050;background-color:#1e0010>logged</span> <span style=color:#960050;background-color:#1e0010>in</span> <span style=color:#960050;background-color:#1e0010>user</span> <span style=color:#960050;background-color:#1e0010>is</span> <span style=color:#960050;background-color:#1e0010>directory</span> <span style=color:#960050;background-color:#1e0010>owner</span>
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Checking</span> <span style=color:#960050;background-color:#1e0010>current</span> <span style=color:#960050;background-color:#1e0010>folder</span> <span style=color:#960050;background-color:#1e0010>permissions</span>
<span style=color:#a6e22e>System checks failed with message</span><span style=color:#f92672>:</span> &#39;Linux version is not Ubuntu 16&#39;
<span style=color:#960050;background-color:#1e0010>Some</span> <span style=color:#960050;background-color:#1e0010>features</span> <span style=color:#960050;background-color:#1e0010>of</span> <span style=color:#960050;background-color:#1e0010>Ghost-CLI</span> <span style=color:#960050;background-color:#1e0010>may</span> <span style=color:#960050;background-color:#1e0010>not</span> <span style=color:#960050;background-color:#1e0010>work</span> <span style=color:#960050;background-color:#1e0010>without</span> <span style=color:#960050;background-color:#1e0010>additional</span> <span style=color:#960050;background-color:#1e0010>configuration.</span>
<span style=color:#960050;background-color:#1e0010>For</span> <span style=color:#960050;background-color:#1e0010>local</span> <span style=color:#960050;background-color:#1e0010>installs</span> <span style=color:#960050;background-color:#1e0010>we</span> <span style=color:#960050;background-color:#1e0010>recommend</span> <span style=color:#960050;background-color:#1e0010>using</span> <span style=color:#960050;background-color:#1e0010>`ghost</span> <span style=color:#960050;background-color:#1e0010>install</span> <span style=color:#960050;background-color:#1e0010>local`</span> <span style=color:#960050;background-color:#1e0010>instead.</span>
<span style=color:#960050;background-color:#1e0010>?</span> <span style=color:#960050;background-color:#1e0010>Continue</span> <span style=color:#960050;background-color:#1e0010>anyway?</span> <span style=color:#960050;background-color:#1e0010>Yes</span>
<span style=color:#960050;background-color:#1e0010>ℹ</span> <span style=color:#960050;background-color:#1e0010>Checking</span> <span style=color:#960050;background-color:#1e0010>operating</span> <span style=color:#960050;background-color:#1e0010>system</span> <span style=color:#960050;background-color:#1e0010>compatibility</span> <span style=color:#960050;background-color:#1e0010>[skipped]</span>
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Checking</span> <span style=color:#960050;background-color:#1e0010>for</span> <span style=color:#960050;background-color:#1e0010>a</span> <span style=color:#960050;background-color:#1e0010>MySQL</span> <span style=color:#960050;background-color:#1e0010>installation</span>
<span style=color:#a6e22e>Running sudo command</span><span style=color:#f92672>:</span> systemctl is-active ghost_halfrost-com
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Validating</span> <span style=color:#960050;background-color:#1e0010>config</span>
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Checking</span> <span style=color:#960050;background-color:#1e0010>folder</span> <span style=color:#960050;background-color:#1e0010>permissions</span>
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Checking</span> <span style=color:#960050;background-color:#1e0010>file</span> <span style=color:#960050;background-color:#1e0010>permissions</span>
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Checking</span> <span style=color:#960050;background-color:#1e0010>content</span> <span style=color:#960050;background-color:#1e0010>folder</span> <span style=color:#960050;background-color:#1e0010>ownership</span>
<span style=color:#960050;background-color:#1e0010>✔</span> <span style=color:#960050;background-color:#1e0010>Checking</span> <span style=color:#960050;background-color:#1e0010>memory</span> <span style=color:#960050;background-color:#1e0010>availability</span>
</code></pre></div><hr><p>Reference：</p><p><a href=https://docs.ghost.org/v1.0.0/docs/getting-started-guide>getting-started-guide</a>
<a href=https://docs.ghost.org/v1.0.0/docs/cli-install>cli-install</a><br><a href=https://docs.ghost.org/docs/install>Install & Setup (production)</a><br><a href=https://docs.ghost.org/docs/troubleshooting>troubleshooting</a><br><a href=https://briankoopman.com/unlock-ghost-account/>Unlock Your Locked Ghost Account</a></p><blockquote><p>GitHub Repo：<a href=https://github.com/halfrost/Halfrost-Field>Halfrost-Field</a></p><p>Follow: <a href=https://github.com/halfrost>halfrost · GitHub</a></p><p>Source: <a href=https://halfrost.com/ghost_update/>https://halfrost.com/ghost_update/</a></p></blockquote><img src=https://img.halfrost.com/wechat-qr-code.png></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=https://books.halfrost.com/>Books</a></li><li><a href=https://github.com/halfrost/Halfrost-Field>Github</a></li><li><a href=https://halfrost.me/>About</a></li><li><a href=/index.xml>RSS</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents><ul><li><a href=#准备工作>准备工作</a></li><li><a href=#开始升级>开始升级</a><ul><li><a href=#环境配置>环境配置</a><ul><li><a href=#1-环境依赖>1. 环境依赖</a></li><li><a href=#2-设置-swap-分区>2. 设置 Swap 分区</a></li><li><a href=#3-检查-nodejs>3. 检查 Node.js</a></li><li><a href=#4-检查-mysql>4. 检查 MySQL</a></li><li><a href=#5-检查-nginx>5. 检查 nginx</a></li></ul></li><li><a href=#开始安装>开始安装</a><ul><li><a href=#1-安装-ghost-cli>1. 安装 Ghost-CLI</a></li><li><a href=#2-创建新用户>2. 创建新用户</a></li><li><a href=#3-配置-ghost>3. 配置 Ghost</a></li><li><a href=#4-安装-ghost>4. 安装 Ghost</a></li><li><a href=#5-设置-nginx>5. 设置 nginx</a></li><li><a href=#6-ghost-其他配置>6. ghost 其他配置</a></li></ul></li></ul></li><li><a href=#测试>测试</a></li><li><a href=#遇到的问题>遇到的问题</a><ul><li><a href=#node找不到命令>node：找不到命令</a></li><li><a href=#server-限制上传文件大小>server 限制上传文件大小</a></li><li><a href=#user-locked>user locked</a></li><li><a href=#emoji-升级>emoji 升级</a></li><li><a href=#权限问题>权限问题</a></li></ul></li></ul></nav></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fnew.halfrost.com%2fghost_update%2f"><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fnew.halfrost.com%2fghost_update%2f&text=Ghost%20%e5%8d%9a%e5%ae%a2%e5%8d%87%e7%ba%a7%e6%8c%87%e5%8d%97"><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fnew.halfrost.com%2fghost_update%2f&title=Ghost%20%e5%8d%9a%e5%ae%a2%e5%8d%87%e7%ba%a7%e6%8c%87%e5%8d%97"><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fnew.halfrost.com%2fghost_update%2f&is_video=false&description=Ghost%20%e5%8d%9a%e5%ae%a2%e5%8d%87%e7%ba%a7%e6%8c%87%e5%8d%97"><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Ghost%20%e5%8d%9a%e5%ae%a2%e5%8d%87%e7%ba%a7%e6%8c%87%e5%8d%97&body=Check out this article: https%3a%2f%2fnew.halfrost.com%2fghost_update%2f"><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fnew.halfrost.com%2fghost_update%2f&title=Ghost%20%e5%8d%9a%e5%ae%a2%e5%8d%87%e7%ba%a7%e6%8c%87%e5%8d%97"><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fnew.halfrost.com%2fghost_update%2f&title=Ghost%20%e5%8d%9a%e5%ae%a2%e5%8d%87%e7%ba%a7%e6%8c%87%e5%8d%97"><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fnew.halfrost.com%2fghost_update%2f&title=Ghost%20%e5%8d%9a%e5%ae%a2%e5%8d%87%e7%ba%a7%e6%8c%87%e5%8d%97"><i class="fab fa-stumbleupon fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://digg.com/submit?url=https%3a%2f%2fnew.halfrost.com%2fghost_update%2f&title=Ghost%20%e5%8d%9a%e5%ae%a2%e5%8d%87%e7%ba%a7%e6%8c%87%e5%8d%97"><i class="fab fa-digg fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fnew.halfrost.com%2fghost_update%2f&name=Ghost%20%e5%8d%9a%e5%ae%a2%e5%8d%87%e7%ba%a7%e6%8c%87%e5%8d%97&description=%e5%9c%a8%e7%ac%94%e8%80%85%e4%b8%80%e5%bc%80%e5%a7%8b%e5%bb%ba%e7%ab%99%e7%9a%84%e6%97%b6%e5%80%99%ef%bc%8c%e7%94%a8%e7%9a%84%20Ghost%20%e7%89%88%e6%9c%ac%e5%b0%b1%e6%98%af%200.7.4%20%e4%b8%ad%e6%96%87%e7%89%88%e3%80%82%e8%bf%99%e4%b8%aa%e9%9d%9e%e5%b8%b8%e6%97%a9%e6%9c%9f%e7%9a%84%e7%89%88%e6%9c%ac%e4%b9%9f%e6%9c%89%e4%b8%8d%e5%b0%91%20hack%20%e7%9a%84%e7%8e%a9%e6%b3%95%e3%80%82%e7%9b%b4%e5%88%b0%e6%9c%80%e8%bf%91%e5%91%a8%e5%9b%b4%e6%9c%89%e6%9c%8b%e5%8f%8b%e4%b9%9f%e5%9c%a8%e7%8e%a9%20Ghost%20%e7%9a%84%e6%97%b6%e5%80%99%ef%bc%8c%e6%88%91%e5%8f%91%e7%8e%b0%e6%9c%80%e6%96%b0%e7%89%88%e5%be%88%e5%a4%9a%e6%96%b0%e5%8a%9f%e8%83%bd%e9%9d%9e%e5%b8%b8%e5%90%b8%e5%bc%95%e6%88%91%ef%bc%9a%e6%af%94%e5%a6%82%e6%9c%80%e6%96%b0%e7%89%88%e6%97%a9%e5%b0%b1%e6%94%af%e6%8c%81%e4%ba%86%20markdown%20%e6%8f%92%e5%85%a5%e8%a1%a8%e6%a0%bc%ef%bc%8c%e4%b9%9f%e8%83%bd%e6%94%af%e6%8c%81%20LateX%e3%80%82%e5%85%b3%e4%ba%8e%e4%b8%8d%e6%94%af%e6%8c%81%20markdown%20%e6%8f%92%e5%85%a5%e8%a1%a8%e6%a0%bc%e8%bf%99%e4%b8%aa%e6%af%94%e8%be%83%e7%97%9b%e8%8b%a6%ef%bc%8c%e4%b9%8b%e5%89%8d%e8%a1%a8%e6%a0%bc%e7%9a%84%e6%9b%bf%e4%bb%a3%e6%96%b9%e6%b3%95%e6%98%af%e5%9c%a8%20github%20%e4%b8%8a%e5%8f%91%e5%b8%83%e5%ae%8c%e6%96%87%e7%ab%a0%e4%bb%a5%e5%90%8e%e6%88%aa%e5%9b%be%ef%bc%8c%e7%84%b6%e5%90%8e%e6%8a%8a%e5%9b%be%e7%89%87%e4%bc%a0%e5%88%b0%20Ghost%20%e4%b8%8a%e3%80%82%0a%e6%97%a2%e7%84%b6%e5%87%a0%e5%b9%b4%e8%bf%87%e5%8e%bb%e4%ba%86%ef%bc%8c%e8%a6%81%e5%8d%87%e7%ba%a7%e5%b0%b1%e7%9b%b4%e6%8e%a5%e5%8d%87%e7%ba%a7%e5%88%b0%e6%9c%80%e6%96%b0%e7%89%88%e5%90%a7%e3%80%82%e6%88%aa%e6%ad%a2%e5%88%b0%e8%bf%99%e7%af%87%e6%96%87%e7%ab%a0%e7%9a%84%e6%97%b6%e9%97%b4%ef%bc%8c%e5%bd%93%e5%89%8d%e6%9c%80%e6%96%b0%e7%89%88%e6%98%af%20Ghost%201.24.8%20%e3%80%82%e6%8e%a5%e4%b8%8b%e6%9d%a5%e5%86%99%e4%b8%80%e4%ba%9b%e5%8d%87%e7%ba%a7%e6%8c%87%e5%8d%97%ef%bc%8c%e5%a6%82%e6%9e%9c%e4%b9%9f%e6%9c%89%e5%92%8c%e6%88%91%e4%b8%80%e6%a0%b7%e7%94%a8%20Ghost%200.7.4%20%e4%b8%ad%e6%96%87%e7%89%88%e7%9a%84%e6%83%b3%e5%8d%87%e7%ba%a7%e5%88%b0%e6%9c%80%e6%96%b0%e7%89%88%ef%bc%8c%e5%8f%af%e4%bb%a5%e7%9c%8b%e7%9c%8b%e7%ac%94%e8%80%85%e7%9a%84%e5%8d%87%e7%ba%a7%e4%b9%8b%e8%b7%af%e3%80%82%0a%e5%87%86%e5%a4%87%e5%b7%a5%e4%bd%9c%20%e5%87%86%e5%a4%87%e5%b7%a5%e4%bd%9c%e5%bd%93%e5%89%8d%e6%98%af%e5%a4%87%e4%bb%bd%e8%80%81%e7%89%88%e6%9c%ac%e7%9a%84%e9%85%8d%e7%bd%ae%e5%92%8c%e6%95%b0%e6%8d%ae%e3%80%82%e8%bf%99%e9%87%8c%e5%88%97%e4%b8%80%e4%b8%aa%e9%9c%80%e8%a6%81%e5%a4%87%e4%bb%bd%e7%9a%84%e6%b8%85%e5%8d%95%ef%bc%9a%0a%20%e6%95%b0%e6%8d%ae%e5%ba%93%e6%96%87%e4%bb%b6%20%e9%80%9a%e8%bf%87%20Ghost%20%e5%90%8e%e5%8f%b0%e7%ae%a1%e7%90%86%e7%b3%bb%e7%bb%9f%ef%bc%8c%e5%af%bc%e5%87%ba%e6%89%80%e6%9c%89%e5%8d%9a%e6%96%87%e6%95%b0%e6%8d%ae%ef%bc%8c%e5%85%b6%e5%ae%9e%e5%b0%b1%e6%98%af%e4%bb%8e%20MySQL%20%e4%b8%ad%e5%af%bc%e5%87%ba%e7%9a%84%20JSON%20%e6%96%87%e4%bb%b6%e3%80%82%20%e4%b8%bb%e9%a2%98%e6%96%87%e4%bb%b6%20ghost%2fcontent%2fthemes%2f%20%e6%9c%8d%e5%8a%a1%e5%99%a8%e7%ab%af%20Ghost%20%e7%9a%84%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%20config.js%20Nginx%20%e4%b8%8b%e7%9a%84%20ghost.conf%20%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%20%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%b8%8a%e7%9a%84%20Ghost%20%e6%95%b4%e4%b8%aa%e6%96%87%e4%bb%b6%e5%a4%b9%20%e5%a4%87%e4%bb%bd%e6%95%b4%e4%b8%aa%e6%96%87%e4%bb%b6%e5%a4%b9%e6%98%af%e5%8f%af%e9%80%89%e7%9a%84%ef%bc%8c%e6%98%af%e4%b8%ba%e4%ba%86%e9%98%b2%e6%ad%a2%e5%87%ba%e9%94%99%e5%8f%af%e4%bb%a5%e5%9b%9e%e9%80%80%ef%bc%8c%e4%b8%a2%e6%95%b0%e6%8d%ae%e5%8f%af%e4%bb%a5%e6%89%be%e5%9b%9e%e3%80%82%20%20%e5%bc%80%e5%a7%8b%e5%8d%87%e7%ba%a7%20Ghost%20%e5%9c%a8%20V1.XX%20%e4%bb%a5%e5%90%8e%e6%94%b9%e5%8a%a8%e6%af%94%e8%be%83%e5%a4%a7%ef%bc%8c%e5%9b%a0%e4%b8%ba%e5%8a%a0%e5%85%a5%e4%ba%86%e5%be%88%e5%a4%9a%e6%96%b9%e4%be%bf%e7%9a%84%e8%84%9a%e6%89%8b%e6%9e%b6%e5%b7%a5%e5%85%b7%ef%bc%8c%e6%af%94%e5%a6%82%20Ghost%e3%80%81Ghost-CLI%20%e7%ad%89%e7%ad%89%e3%80%82%e4%bb%8e%200.7.4%20%e5%8d%87%e7%ba%a7%e4%b8%8a%e6%9d%a5%e7%ae%97%e6%98%af%e4%b8%80%e6%ac%a1%20breaking%ef%bc%8c%e6%89%80%e4%bb%a5%20Ghost%20%e8%bf%99%e4%ba%9b%e5%b7%a5%e5%85%b7%e9%83%bd%e9%9c%80%e8%a6%81%e6%96%b0%e8%a3%85%e3%80%82%0a%20Ghost%20is%20a%20fully%20open%20source%2c%20hackable%20platform%20for%20building%20and%20running%20a%20modern%20online%20publication."><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fnew.halfrost.com%2fghost_update%2f&t=Ghost%20%e5%8d%9a%e5%ae%a2%e5%8d%87%e7%ba%a7%e6%8c%87%e5%8d%97"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu class=icon href=# onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden=true></i>Menu</a>
<a id=toc class=icon href=# onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden=true></i>TOC</a>
<a id=share class=icon href=# onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden=true></i>share</a>
<a id=top style=display:none class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i>Top</a></div></div></div><footer id=footer><div class=footer-left><p class=copyright style=float:left;margin-bottom:0><a href=https://github.com/halfrost/Halfrost-Field class=github-repo style=height:18px><span class=gadget-github></span>Star</a>
Copyright &copy;halfrost 2016 - 2021
<a href=http://www.miit.gov.cn/>鄂ICP备16014744号</a></p><br><p class="copyright statistics" style=margin-bottom:20px><span id=busuanzi_container_site_pv>Cumulative Page Views <span id=busuanzi_value_site_pv></span>| Unique Visitors <span id=busuanzi_value_site_uv></span></span></p></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/main.min.f870a4d110314b9e50e65f8ac982dc1c9c376c8f1a5083d39c62cfc49073f011.js></script><script async src=/prism.js></script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']]},svg:{fontCache:'global'}};</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></html>