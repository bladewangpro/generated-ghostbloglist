<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=theme-color content="#FFFFFF"><meta http-equiv=x-ua-compatible content="IE=edge"><title>博客跑分优化 | prometheus</title><meta name=description content="Explore in every moment of the hard thinking"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="博客跑分优化"><meta property="og:description" content="本篇文章会持续更新，因为优化无止境。
本文会罗列目前已经优化过的点。从开始页面略卡顿，到最后跑满分，笔者在这里都会一一展现出来。
起点 博客页面优化从 Chrome 的 Performance 开始。
从上图中可以看到页面前 550ms 都是空白，时间耗在了加载 JS 的过程上了。这段是 Disqus 的脚本和 Google 统计脚本。
笔者优化的原则是：必须要加载的 pre-load，不必须加载的并且未出现在屏幕里面的 lazy-load。
优化的思路很简单，在 DOM 渲染之前，去掉上图中大长条的黄色的矩形，这段时间是加载 JS 的时间，阻塞页面渲染了。笔者在页面渲染的时候不会加载 Disqus 脚本，只在博文页面用的时候，点击按钮的时候才会 lazy-load 加载脚本。
至于 Google 统计脚本，需要用最新的 gtag 的异步版本，并且加上 async 标志就可以解决。当然如果想彻底异步这段统计的代码，需要服务端做一些改造。
这里可以参考这两篇文章《优化 Google Analytics 异步加载来提高你的网站速度》、《服务端使用 Google Analytics》。
如果还有百度统计的脚本的话，将 baidu 统计生成的代码移入网站，将 type 设置为 test 等非 mime/type 类型，这样浏览器便不会解析这段 script，baidu 统计却也能校验通过：
<script type=&#34;text/test&#34;> var _hmt = _hmt || []; (function() { var hm = document.createElement(&#34;script&#34;); hm.src = &#34;https://hm.baidu.com/hm.js?XXXX&#34;; var s = document."><meta property="og:type" content="article"><meta property="og:url" content="https://new.halfrost.com/ghost_fast/"><meta property="article:published_time" content="2018-07-07T15:46:00+00:00"><meta property="article:modified_time" content="2018-07-07T15:46:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="博客跑分优化"><meta name=twitter:description content="本篇文章会持续更新，因为优化无止境。
本文会罗列目前已经优化过的点。从开始页面略卡顿，到最后跑满分，笔者在这里都会一一展现出来。
起点 博客页面优化从 Chrome 的 Performance 开始。
从上图中可以看到页面前 550ms 都是空白，时间耗在了加载 JS 的过程上了。这段是 Disqus 的脚本和 Google 统计脚本。
笔者优化的原则是：必须要加载的 pre-load，不必须加载的并且未出现在屏幕里面的 lazy-load。
优化的思路很简单，在 DOM 渲染之前，去掉上图中大长条的黄色的矩形，这段时间是加载 JS 的时间，阻塞页面渲染了。笔者在页面渲染的时候不会加载 Disqus 脚本，只在博文页面用的时候，点击按钮的时候才会 lazy-load 加载脚本。
至于 Google 统计脚本，需要用最新的 gtag 的异步版本，并且加上 async 标志就可以解决。当然如果想彻底异步这段统计的代码，需要服务端做一些改造。
这里可以参考这两篇文章《优化 Google Analytics 异步加载来提高你的网站速度》、《服务端使用 Google Analytics》。
如果还有百度统计的脚本的话，将 baidu 统计生成的代码移入网站，将 type 设置为 test 等非 mime/type 类型，这样浏览器便不会解析这段 script，baidu 统计却也能校验通过：
<script type=&#34;text/test&#34;> var _hmt = _hmt || []; (function() { var hm = document.createElement(&#34;script&#34;); hm.src = &#34;https://hm.baidu.com/hm.js?XXXX&#34;; var s = document."><link rel=stylesheet href=/css/style-white.min.css><link rel=manifest href=/manifest.json><link rel=stylesheet href=/prism.css><link href=/images/apple-touch-icon-60x60.png rel=apple-touch-icon sizes=60x60><link href=/images/apple-touch-icon-76x76.png rel=apple-touch-icon sizes=76x76><link href=/images/apple-touch-icon-120x120.png rel=apple-touch-icon sizes=120x120><link href=/images/apple-touch-icon-152x152.png rel=apple-touch-icon sizes=152x152><link href=/images/apple-touch-icon-180x180.png rel=apple-touch-icon sizes=180x180><link href=/images/apple-touch-icon-512x512.png rel=apple-touch-icon sizes=512x512><link href=/images/apple-touch-icon-1024x1024.png rel=apple-touch-icon sizes=1024x1024><script async>if('serviceWorker'in navigator){navigator.serviceWorker.register("\/serviceworker-v1.min.a64912b78d282eab1ad3715a0943da21616e5f326f8afea27034784ad445043b.js").then(function(){if(navigator.serviceWorker.controller){console.log('Assets cached by the controlling service worker.');}else{console.log('Please reload this page to allow the service worker to handle network operations.');}}).catch(function(error){console.log('ERROR: '+error);});}else{console.log('Service workers are not supported in the current browser.');}</script><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://new.halfrost.com/images/favicon.ico><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-82753806-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="single-max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a><a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a><a id=top-icon-tablet href=# onclick="$('html, body').animate({scrollTop:0},'fast');" style=display:none><i class="fas fa-chevron-up fa-lg"></i></a><span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=https://books.halfrost.com/>Books</a></li><li><a href=https://github.com/halfrost/Halfrost-Field>Github</a></li><li><a href=https://halfrost.me/>About</a></li><li><a href=/index.xml>RSS</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://new.halfrost.com/ghost_feature/><i class="fas fa-chevron-left" aria-hidden=true onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li><li><a class=icon href=https://new.halfrost.com/tls1-3_start/><i class="fas fa-chevron-right" aria-hidden=true onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li><li><a class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast');"><i class="fas fa-chevron-up" aria-hidden=true onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li><li><a class=icon href=#><i class="fas fa-share-alt" aria-hidden=true onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fnew.halfrost.com%2fghost_fast%2f"><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fnew.halfrost.com%2fghost_fast%2f&text=%e5%8d%9a%e5%ae%a2%e8%b7%91%e5%88%86%e4%bc%98%e5%8c%96"><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fnew.halfrost.com%2fghost_fast%2f&title=%e5%8d%9a%e5%ae%a2%e8%b7%91%e5%88%86%e4%bc%98%e5%8c%96"><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fnew.halfrost.com%2fghost_fast%2f&is_video=false&description=%e5%8d%9a%e5%ae%a2%e8%b7%91%e5%88%86%e4%bc%98%e5%8c%96"><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=%e5%8d%9a%e5%ae%a2%e8%b7%91%e5%88%86%e4%bc%98%e5%8c%96&body=Check out this article: https%3a%2f%2fnew.halfrost.com%2fghost_fast%2f"><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fnew.halfrost.com%2fghost_fast%2f&title=%e5%8d%9a%e5%ae%a2%e8%b7%91%e5%88%86%e4%bc%98%e5%8c%96"><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fnew.halfrost.com%2fghost_fast%2f&title=%e5%8d%9a%e5%ae%a2%e8%b7%91%e5%88%86%e4%bc%98%e5%8c%96"><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fnew.halfrost.com%2fghost_fast%2f&title=%e5%8d%9a%e5%ae%a2%e8%b7%91%e5%88%86%e4%bc%98%e5%8c%96"><i class="fab fa-stumbleupon" aria-hidden=true></i></a></li><li><a class=icon href="http://digg.com/submit?url=https%3a%2f%2fnew.halfrost.com%2fghost_fast%2f&title=%e5%8d%9a%e5%ae%a2%e8%b7%91%e5%88%86%e4%bc%98%e5%8c%96"><i class="fab fa-digg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fnew.halfrost.com%2fghost_fast%2f&name=%e5%8d%9a%e5%ae%a2%e8%b7%91%e5%88%86%e4%bc%98%e5%8c%96&description=%e6%9c%ac%e7%af%87%e6%96%87%e7%ab%a0%e4%bc%9a%e6%8c%81%e7%bb%ad%e6%9b%b4%e6%96%b0%ef%bc%8c%e5%9b%a0%e4%b8%ba%e4%bc%98%e5%8c%96%e6%97%a0%e6%ad%a2%e5%a2%83%e3%80%82%0a%e6%9c%ac%e6%96%87%e4%bc%9a%e7%bd%97%e5%88%97%e7%9b%ae%e5%89%8d%e5%b7%b2%e7%bb%8f%e4%bc%98%e5%8c%96%e8%bf%87%e7%9a%84%e7%82%b9%e3%80%82%e4%bb%8e%e5%bc%80%e5%a7%8b%e9%a1%b5%e9%9d%a2%e7%95%a5%e5%8d%a1%e9%a1%bf%ef%bc%8c%e5%88%b0%e6%9c%80%e5%90%8e%e8%b7%91%e6%bb%a1%e5%88%86%ef%bc%8c%e7%ac%94%e8%80%85%e5%9c%a8%e8%bf%99%e9%87%8c%e9%83%bd%e4%bc%9a%e4%b8%80%e4%b8%80%e5%b1%95%e7%8e%b0%e5%87%ba%e6%9d%a5%e3%80%82%0a%e8%b5%b7%e7%82%b9%20%e5%8d%9a%e5%ae%a2%e9%a1%b5%e9%9d%a2%e4%bc%98%e5%8c%96%e4%bb%8e%20Chrome%20%e7%9a%84%20Performance%20%e5%bc%80%e5%a7%8b%e3%80%82%0a%e4%bb%8e%e4%b8%8a%e5%9b%be%e4%b8%ad%e5%8f%af%e4%bb%a5%e7%9c%8b%e5%88%b0%e9%a1%b5%e9%9d%a2%e5%89%8d%20550ms%20%e9%83%bd%e6%98%af%e7%a9%ba%e7%99%bd%ef%bc%8c%e6%97%b6%e9%97%b4%e8%80%97%e5%9c%a8%e4%ba%86%e5%8a%a0%e8%bd%bd%20JS%20%e7%9a%84%e8%bf%87%e7%a8%8b%e4%b8%8a%e4%ba%86%e3%80%82%e8%bf%99%e6%ae%b5%e6%98%af%20Disqus%20%e7%9a%84%e8%84%9a%e6%9c%ac%e5%92%8c%20Google%20%e7%bb%9f%e8%ae%a1%e8%84%9a%e6%9c%ac%e3%80%82%0a%e7%ac%94%e8%80%85%e4%bc%98%e5%8c%96%e7%9a%84%e5%8e%9f%e5%88%99%e6%98%af%ef%bc%9a%e5%bf%85%e9%a1%bb%e8%a6%81%e5%8a%a0%e8%bd%bd%e7%9a%84%20pre-load%ef%bc%8c%e4%b8%8d%e5%bf%85%e9%a1%bb%e5%8a%a0%e8%bd%bd%e7%9a%84%e5%b9%b6%e4%b8%94%e6%9c%aa%e5%87%ba%e7%8e%b0%e5%9c%a8%e5%b1%8f%e5%b9%95%e9%87%8c%e9%9d%a2%e7%9a%84%20lazy-load%e3%80%82%0a%e4%bc%98%e5%8c%96%e7%9a%84%e6%80%9d%e8%b7%af%e5%be%88%e7%ae%80%e5%8d%95%ef%bc%8c%e5%9c%a8%20DOM%20%e6%b8%b2%e6%9f%93%e4%b9%8b%e5%89%8d%ef%bc%8c%e5%8e%bb%e6%8e%89%e4%b8%8a%e5%9b%be%e4%b8%ad%e5%a4%a7%e9%95%bf%e6%9d%a1%e7%9a%84%e9%bb%84%e8%89%b2%e7%9a%84%e7%9f%a9%e5%bd%a2%ef%bc%8c%e8%bf%99%e6%ae%b5%e6%97%b6%e9%97%b4%e6%98%af%e5%8a%a0%e8%bd%bd%20JS%20%e7%9a%84%e6%97%b6%e9%97%b4%ef%bc%8c%e9%98%bb%e5%a1%9e%e9%a1%b5%e9%9d%a2%e6%b8%b2%e6%9f%93%e4%ba%86%e3%80%82%e7%ac%94%e8%80%85%e5%9c%a8%e9%a1%b5%e9%9d%a2%e6%b8%b2%e6%9f%93%e7%9a%84%e6%97%b6%e5%80%99%e4%b8%8d%e4%bc%9a%e5%8a%a0%e8%bd%bd%20Disqus%20%e8%84%9a%e6%9c%ac%ef%bc%8c%e5%8f%aa%e5%9c%a8%e5%8d%9a%e6%96%87%e9%a1%b5%e9%9d%a2%e7%94%a8%e7%9a%84%e6%97%b6%e5%80%99%ef%bc%8c%e7%82%b9%e5%87%bb%e6%8c%89%e9%92%ae%e7%9a%84%e6%97%b6%e5%80%99%e6%89%8d%e4%bc%9a%20lazy-load%20%e5%8a%a0%e8%bd%bd%e8%84%9a%e6%9c%ac%e3%80%82%0a%e8%87%b3%e4%ba%8e%20Google%20%e7%bb%9f%e8%ae%a1%e8%84%9a%e6%9c%ac%ef%bc%8c%e9%9c%80%e8%a6%81%e7%94%a8%e6%9c%80%e6%96%b0%e7%9a%84%20gtag%20%e7%9a%84%e5%bc%82%e6%ad%a5%e7%89%88%e6%9c%ac%ef%bc%8c%e5%b9%b6%e4%b8%94%e5%8a%a0%e4%b8%8a%20async%20%e6%a0%87%e5%bf%97%e5%b0%b1%e5%8f%af%e4%bb%a5%e8%a7%a3%e5%86%b3%e3%80%82%e5%bd%93%e7%84%b6%e5%a6%82%e6%9e%9c%e6%83%b3%e5%bd%bb%e5%ba%95%e5%bc%82%e6%ad%a5%e8%bf%99%e6%ae%b5%e7%bb%9f%e8%ae%a1%e7%9a%84%e4%bb%a3%e7%a0%81%ef%bc%8c%e9%9c%80%e8%a6%81%e6%9c%8d%e5%8a%a1%e7%ab%af%e5%81%9a%e4%b8%80%e4%ba%9b%e6%94%b9%e9%80%a0%e3%80%82%0a%e8%bf%99%e9%87%8c%e5%8f%af%e4%bb%a5%e5%8f%82%e8%80%83%e8%bf%99%e4%b8%a4%e7%af%87%e6%96%87%e7%ab%a0%e3%80%8a%e4%bc%98%e5%8c%96%20Google%20Analytics%20%e5%bc%82%e6%ad%a5%e5%8a%a0%e8%bd%bd%e6%9d%a5%e6%8f%90%e9%ab%98%e4%bd%a0%e7%9a%84%e7%bd%91%e7%ab%99%e9%80%9f%e5%ba%a6%e3%80%8b%e3%80%81%e3%80%8a%e6%9c%8d%e5%8a%a1%e7%ab%af%e4%bd%bf%e7%94%a8%20Google%20Analytics%e3%80%8b%e3%80%82%0a%e5%a6%82%e6%9e%9c%e8%bf%98%e6%9c%89%e7%99%be%e5%ba%a6%e7%bb%9f%e8%ae%a1%e7%9a%84%e8%84%9a%e6%9c%ac%e7%9a%84%e8%af%9d%ef%bc%8c%e5%b0%86%20baidu%20%e7%bb%9f%e8%ae%a1%e7%94%9f%e6%88%90%e7%9a%84%e4%bb%a3%e7%a0%81%e7%a7%bb%e5%85%a5%e7%bd%91%e7%ab%99%ef%bc%8c%e5%b0%86%20type%20%e8%ae%be%e7%bd%ae%e4%b8%ba%20test%20%e7%ad%89%e9%9d%9e%20mime%2ftype%20%e7%b1%bb%e5%9e%8b%ef%bc%8c%e8%bf%99%e6%a0%b7%e6%b5%8f%e8%a7%88%e5%99%a8%e4%be%bf%e4%b8%8d%e4%bc%9a%e8%a7%a3%e6%9e%90%e8%bf%99%e6%ae%b5%20script%ef%bc%8cbaidu%20%e7%bb%9f%e8%ae%a1%e5%8d%b4%e4%b9%9f%e8%83%bd%e6%a0%a1%e9%aa%8c%e9%80%9a%e8%bf%87%ef%bc%9a%0a%26lt%3bscript%20type%3d%26%2334%3btext%2ftest%26%2334%3b%26gt%3b%20var%20_hmt%20%3d%20_hmt%20%7c%7c%20%5b%5d%3b%20%28function%28%29%20%7b%20var%20hm%20%3d%20document.createElement%28%26%2334%3bscript%26%2334%3b%29%3b%20hm.src%20%3d%20%26%2334%3bhttps%3a%2f%2fhm.baidu.com%2fhm.js%3fXXXX%26%2334%3b%3b%20var%20s%20%3d%20document."><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fnew.halfrost.com%2fghost_fast%2f&t=%e5%8d%9a%e5%ae%a2%e8%b7%91%e5%88%86%e4%bc%98%e5%8c%96"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div><div id=toc><nav id=TableOfContents><ul><li><a href=#起点>起点</a></li><li><a href=#跑分>跑分</a></li><li><a href=#优化>优化</a></li><li><a href=#其他优化>其他优化</a><ul><li><a href=#1-pwa>1. PWA</a></li><li><a href=#2-http2>2. HTTP/2</a></li><li><a href=#3-nginx-开启-gzip>3. Nginx 开启 gZip</a></li><li><a href=#4-支持-tls-13>4. 支持 TLS 1.3</a></li><li><a href=#5-启用-ocsp-stapling>5. 启用 OCSP Stapling</a></li><li><a href=#6-支持-quic>6. 支持 QUIC</a></li><li><a href=#7-开启-hsts>7. 开启 HSTS</a></li></ul></li><li><a href=#最后>最后</a></li></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">博客跑分优化</h1><div class=meta><div class=postdate><time datetime="2018-07-07 15:46:00 +0000 UTC" itemprop=datePublished>Jul 07</time></div><div class=article-category><i class="fas fa-archive"></i><a class=category-link href=/categories/ghost>Ghost</a></div><div class=article-tag><i class="fas fa-tag"></i><a class=tag-link href=/tags/ghost rel=tag>Ghost</a></div></div></header><div class=content itemprop=articleBody><p>本篇文章会持续更新，因为优化无止境。</p><p>本文会罗列目前已经优化过的点。从开始页面略卡顿，到最后跑满分，笔者在这里都会一一展现出来。</p><h2 id=起点>起点</h2><p>博客页面优化从 Chrome 的 Performance 开始。</p><p>从上图中可以看到页面前 550ms 都是空白，时间耗在了加载 JS 的过程上了。这段是 Disqus 的脚本和 Google 统计脚本。</p><p>笔者优化的原则是：<strong>必须要加载的 pre-load，不必须加载的并且未出现在屏幕里面的 lazy-load</strong>。</p><p>优化的思路很简单，在 DOM 渲染之前，去掉上图中大长条的黄色的矩形，这段时间是加载 JS 的时间，阻塞页面渲染了。笔者在页面渲染的时候不会加载 Disqus 脚本，只在博文页面用的时候，点击按钮的时候才会 lazy-load 加载脚本。</p><p>至于 Google 统计脚本，需要用最新的 gtag 的异步版本，并且加上 async 标志就可以解决。当然如果想彻底异步这段统计的代码，需要服务端做一些改造。</p><p>这里可以参考这两篇文章<a href=https://imiku.me/2017/07/14/916.html>《优化 Google Analytics 异步加载来提高你的网站速度》</a>、<a href=https://blog.alphatr.com/google-analytics-on-server.html>《服务端使用 Google Analytics》</a>。</p><p>如果还有百度统计的脚本的话，将 baidu 统计生成的代码移入网站，将 type 设置为 test 等非 mime/type 类型，这样浏览器便不会解析这段 script，baidu 统计却也能校验通过：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>script</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text/test&#34;</span><span style=color:#f92672>&gt;</span>
    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>_hmt</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_hmt</span> <span style=color:#f92672>||</span> [];
    (<span style=color:#66d9ef>function</span>() {
      <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>hm</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>createElement</span>(<span style=color:#e6db74>&#34;script&#34;</span>);
      <span style=color:#a6e22e>hm</span>.<span style=color:#a6e22e>src</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://hm.baidu.com/hm.js?XXXX&#34;</span>;
      <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>s</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementsByTagName</span>(<span style=color:#e6db74>&#34;script&#34;</span>)[<span style=color:#ae81ff>0</span>];
      <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>parentNode</span>.<span style=color:#a6e22e>insertBefore</span>(<span style=color:#a6e22e>hm</span>, <span style=color:#a6e22e>s</span>);
    })();
    <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/script&gt;</span>
</code></pre></div><p>百度统计可以参考这篇文章<a href=http://blog.angular.in/analyticsdai-ma-yan-chi-yi-bu-jia-zai/>《Analytics代码延迟异步加载》</a>。</p><p>把上面这两块弄好，会得到下面这张图：</p><p>效果就很明显了，首页首次有效渲染时间（FMP，是指主要内容出现在页面上所需的时间）小于 100 ms 了。</p><h2 id=跑分>跑分</h2><p>接下来是 Chrome 的 Audits。笔者第一次跑分的结果比较难看。分数比较低的是 Performance 和 Accessibility。</p><p>Performance 上，有以下几个衡量的指标：</p><ul><li>首次有效渲染（FMP，是指主要内容出现在页面上所需的时间），</li><li>重要渲染时间（页面最重要部分渲染完成所需的时间），</li><li>可交互时间（TTI，是指页面布局已经稳定，关键的页面字体已经可见，主进程可以足够的处理用户的输入 —— 基本的时间标记是，用户可以在 UI 上进行点击和交互），</li><li>输入响应，接口响应用户操作所需的时间，</li><li>Speed Index，测量填充页面内容的速度。 分数越低越好，</li></ul><p>一般对流畅的定义是 ：</p><p>控制响应时间在 100ms 内，控制帧速在 60 帧/秒。速度指标(SpeedIndex) &lt; 1250，3G 上交互时间 &lt; 5s，关键文件大小 &lt; 170Kb（SpeedIndex &lt; 1250, TTI &lt; 5s on 3G, Critical file size budget &lt; 170Kb）</p><p>HTML 的前 14~15kb 加载是是最关键的有效载荷块 —— 也是第一次往返（这是在400 ms 往返延时下 1 秒内所得到的）预算中唯一可以交付的部分。一般来说，为了实现上述目标，我们必须在关键的文件大小内进行操作。最高预算压缩之后 170 Kb（0.8-1MB解压缩），它已经占用多达 1s （取决于资源类型）来解析和编译。稍微高于这个值是可以的，但是要尽可能地降低这些值。</p><p>由于本博客首页大量使用图片，所以图片优化是大头。上图中可以看到 Chrome 对图片指出 3 点优化建议：</p><ul><li>图片格式尽量使用 JPEG 2000，JPEG XR 或者 WebP 替代 PNG 和 JPEG，这样图片大小更小。</li><li>从服务器上拿到的图片尺寸最好是缩放后的尺寸，不要下载过大尺寸的图片。</li><li>离屏渲染。屏幕以外的图片进行 lazy-load。</li></ul><p>在性能方面还有几处需要重点优化的：</p><ul><li>减少阻塞渲染的 stylesheets</li><li>减少不使用的 CSS 样式</li><li>减少阻塞渲染的 JS 脚本</li></ul><p>Accessibility 上，有以下容易漏掉的指标：</p><ul><li>元素使用正确的 Attributes，例如 <code>&lt;image></code> 加上 <code>[alt]</code> 的 Attributes。</li><li>元素加上 Discernible name。例如 <code>&lt;a></code> 加上 Discernible name。</li><li>表单元素缺失 associated 标签。</li><li>背景颜色和前景颜色要有足够的颜色区分度。sufficient contrast ratio。</li></ul><p>关于最后一点，推荐在 Chrome 上装上 aXe extension 插件，调试的时候选择它进行颜色区分度的调试。</p><p>在默认页面上，还有一些要求：</p><ul><li><code>&lt;html></code> 标签必须要加上 <code>[lang]</code> 属性</li><li><code>&lt;meta name="viewport"></code> 标签里面不要加入 <code>[user-scalable="no"]</code>，并且 <code>[maximum-scale]</code> 属性要大于 5</li></ul><p>最后 SEO 方面，文字有限制，那就是文字大小要求 75% 以上的文字 >= 16 px。</p><h2 id=优化>优化</h2><p>优化的重点当然是图片方面的。主要是 3 方面，图片格式用 WebP，图片缩放到合适大小，图片用 lazy-load。</p><p>关于 lazy-load 的原理简单说明一下，在 viewport 中可以获取到当前视窗里面元素的百分比，根据这个比例，我们会知道接下来哪个元素即将要被加载。</p><p>可以在图片的标签里面加上 <code>data-url</code> 属性来存储图片的真实地址。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>&lt;<span style=color:#f92672>img</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;lazy&#34;</span> <span style=color:#a6e22e>data-url</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{{img_url feature_image}}&#34;</span> <span style=color:#a6e22e>alt</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>&gt;
</code></pre></div><p>当滚动到图片需要被展示的时候，再进行一些处理，把最后真实要获取图片的地址赋值到 src 属性上，这样浏览器会加载指定的图片。</p><p>更加详细的说明可以看谷歌的这篇官方文档<a href=https://developers.google.com/web/updates/2016/04/intersectionobserver>《IntersectionObserver’s Coming into View》</a></p><p>图片换成 WebP 格式，这个要用到七牛提供的 API。如果读者用的是其他 CDN ，也可以去找找他们有没有提供相关可用的 API，如果也有，那么就方便了。</p><p>七牛提供了图片基本处理的一些 API，见这篇官方文档<a href=https://developer.qiniu.com/dora/manual/1279/basic-processing-images-imageview2>《七牛图片基本处理 API》</a></p><p>在上面基本处理的 API 中也有对图片进行缩放的 API，所以我们在从 CDN 获取图片的时候，图片缩放到合适尺寸并且转换成 WebP 格式，可以一起做。这样最终获得图片的 URL 直接赋值给 src 即可。</p><p>不过这里需要注意的一点是，Safari 和 iOS 这些苹果平台上的浏览器是都不支持 WebP 格式的，如果强行加载，图片有损非常严重，分辨率很差，实际展现出来会很模糊。所以加载 WebP 之前需要判断一下是否支持，如果不支持还需要换到 JPEG 2000 或者 JPEG XR。</p><p>其他优化就是 JS 和 CSS 文件的优化，发布到生产上之前一定要记得压缩这些资源文件。压缩完可以让它们的体积变得很小，网络传输消耗时间变少。JS 文件如果能变成 chunks，按需加载，效果会更好。</p><p>检查每个 JavaScript 依赖性的关键，像 webpack-bundle-analyzer、Source Map Explorer 和 Bundle Buddy 这样的工具可以帮助你完成这些。度量 JavaScript 解析和编译时间。Etsy 的 DeviceTiming，一个小工具可以让你的 JavaScript 测量任何设备或浏览器上的解析和执行时间。重要的是，虽然文件的大小重要，但它不是最重要的。解析和编译时间并不是随着脚本大小增加而线性增加。</p><p>关于 JS 文件的优化，首先推荐用 Webpack。</p><p>Code-splitting 是 Webpack 的一个特性，可将你的代码分解为按需加载的“块”。并不是所有的 JavaScript 都是必须下载、解析和编译的。一旦你在代码中确定了分割点，Webpack 会处理这些依赖关系和输出文件。在应用发送请求的时候，这样基本上确保初始的下载足够小并且实现按需加载。另外，考虑使用 preload-webpack-plugin 获取代码拆分的路径，然后使用 <code>&lt;link rel="preload"></code> or <code>&lt;link rel="prefetch"></code> 提示浏览器预加载它们。</p><p>如果用不了 Webpack，那么相比于 Browserify 的输出结果， Rollup 的输出更好一些。当使用 Rollup 时，推荐你了解下 Rollupify，它可以将 ECMAScript 2015 modules 转化为一个大的 CommonJS module —— 因为小的模块会有令人惊讶的高性能开销（取决于打包工具和模块加载系统的选择）。</p><p>为确保浏览器尽快开始渲染页面，通常会收集开始渲染页面的第一个可见部分所需的所有 CSS（称为 “关键CSS” 或 “首屏 CSS”）并将其内联添加到页面的 <code>&lt;head></code> 中，从而减少往返。 由于在慢启动阶段交换包的大小有限，所以关键 CSS 的预算大约是 14 KB。</p><h2 id=其他优化>其他优化</h2><h3 id=1-pwa>1. PWA</h3><p>没有什么网络性能优化能快过用户机器上的本地缓存。如果你的网站运行在 HTTPS 上，那么可以考虑做一下 PWA。使用 service worker 中缓存静态资源并存储离线资源（甚至离线页面）的目的，而且还会教你如何从用户的设备里面拿数据，也就是说，你现在是不需要通过网络的方式去请求之前的数据。</p><p>PWA 在第二次进入页面的时候，提升特别大，应为资源都是从本地加载的。</p><p>笔者在 PWA 上花了一些功夫，推荐看一下官方的这篇文章<a href=https://developers.google.com/web/fundamentals/web-app-manifest/#_5>《PWA 网络应用清单》</a>。</p><p>由于博客的特殊性，页面变化不大，所以很多资源都可以缓存下来。笔者的 PWA 缓存策略是，缓存 JS 和 CSS 框架类文件，缓存字体，缓存 Disqus 框架，缓存图片，缓存百度和 google 统计框架。这样用户在第二次加载的时候，99% 都是走的缓存。极大的提高的加载速度。</p><p>关于 Service Workers 有一篇写的比较好的文章，推荐一下<a href=https://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API/Using_Service_Workers>《使用 Service Workers》</a></p><h3 id=2-http2>2. HTTP/2</h3><p>这个也需要 Nginx 的支持。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=color:#66d9ef>server</span> {
    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>443</span> <span style=color:#e6db74>ssl</span> <span style=color:#e6db74>http2</span>;
}
</code></pre></div><p>关于 HTTP/2 的提升是很大的，这块笔者接下来会在系列文章里面分析，在这篇优化的文章里面就不分析了。</p><p>如果按照上面的设置以后，还没有开启 HTTP/2 的话，可以参考这篇文章<a href=https://zhangge.net/5114.html>《解决Nginx配置http2不生效，谷歌浏览器仍然采用http1.1协议问题》</a></p><h3 id=3-nginx-开启-gzip>3. Nginx 开启 gZip</h3><p>gZip 能有效减少网络传输消耗，开启以后会占用一点服务器的 CPU，对前端网页性能提升有一些帮助。笔者贴一下自己服务器上 Nginx 的配置：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=color:#66d9ef>http</span> {
    <span style=color:#f92672>include</span>            <span style=color:#e6db74>mime.types</span>;
    <span style=color:#f92672>default_type</span>       <span style=color:#e6db74>application/octet-stream</span>;

    <span style=color:#f92672>charset</span>            <span style=color:#e6db74>UTF-8</span>;

    <span style=color:#f92672>sendfile</span>           <span style=color:#66d9ef>on</span>;
    <span style=color:#f92672>tcp_nopush</span>         <span style=color:#66d9ef>on</span>;
    <span style=color:#f92672>tcp_nodelay</span>        <span style=color:#66d9ef>on</span>;

    <span style=color:#f92672>keepalive_timeout</span>  <span style=color:#ae81ff>60</span>;

    <span style=color:#75715e>#... ...#
</span><span style=color:#75715e></span>
    <span style=color:#f92672>gzip</span>               <span style=color:#66d9ef>on</span>;
    <span style=color:#f92672>gzip_vary</span>          <span style=color:#66d9ef>on</span>;

    <span style=color:#f92672>gzip_comp_level</span>    <span style=color:#ae81ff>6</span>;
    <span style=color:#f92672>gzip_buffers</span>       <span style=color:#ae81ff>16</span> <span style=color:#ae81ff>8k</span>;

    <span style=color:#f92672>gzip_min_length</span>    <span style=color:#ae81ff>1000</span>;
    <span style=color:#f92672>gzip_proxied</span>       <span style=color:#e6db74>any</span>;
    <span style=color:#f92672>gzip_disable</span>       <span style=color:#e6db74>&#34;msie6&#34;</span>;

    <span style=color:#f92672>gzip_http_version</span>  <span style=color:#ae81ff>1</span><span style=color:#e6db74>.0</span>;

    <span style=color:#f92672>gzip_types</span>         <span style=color:#e6db74>text/plain</span> <span style=color:#e6db74>text/css</span> <span style=color:#e6db74>application/json</span> <span style=color:#e6db74>application/x-javascript</span> <span style=color:#e6db74>text/xml</span> <span style=color:#e6db74>application/xml</span> <span style=color:#e6db74>application/xml+rss</span> <span style=color:#e6db74>text/javascript</span> <span style=color:#e6db74>application/javascript</span> <span style=color:#e6db74>image/svg+xml</span>;

    <span style=color:#75715e>#... ...#
</span><span style=color:#75715e></span>
    <span style=color:#f92672>include</span>            <span style=color:#e6db74>/home/jerry/www/nginx_conf/*.conf</span>;
}
</code></pre></div><h3 id=4-支持-tls-13>4. 支持 TLS 1.3</h3><p>这块网上的教程比较多，具体地址笔者就不贴了。</p><p>主要步骤需要先现在最新的 OpenSSL 和 Nginx，然后先编译 OpenSSL，再编译 Nginx。在编译 Nginx 的时候要带上刚刚编译的 OpenSSL 和 TLS1.3 的编译参数即可。</p><p>开启 TLS 1.3 可以参考这两篇文章<a href=https://www.cainwang.cn/tls1_3support/>《本站开始支持TLS1.3》</a>、<a href=https://imququ.com/post/enable-tls-1-3.html#comment-4000795428>《本博客开始支持 TLS 1.3》</a>。</p><h3 id=5-启用-ocsp-stapling>5. 启用 OCSP Stapling</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=color:#66d9ef>server</span> {
    <span style=color:#f92672>ssl_session_cache</span>        <span style=color:#e6db74>shared:SSL:10m</span>;
    <span style=color:#f92672>ssl_session_timeout</span>      <span style=color:#ae81ff>60m</span>;

    <span style=color:#f92672>ssl_session_tickets</span>      <span style=color:#66d9ef>on</span>;

    <span style=color:#f92672>ssl_stapling</span>             <span style=color:#66d9ef>on</span>;
    <span style=color:#f92672>ssl_stapling_verify</span>      <span style=color:#66d9ef>on</span>;
    <span style=color:#f92672>ssl_trusted_certificate</span>  <span style=color:#e6db74>/xxx/full_chain.crt</span>;

    <span style=color:#f92672>resolver</span>                 <span style=color:#ae81ff>8</span><span style=color:#e6db74>.8.4.4</span> <span style=color:#ae81ff>8</span><span style=color:#e6db74>.8.8.8</span>  <span style=color:#e6db74>valid=300s</span>;
    <span style=color:#f92672>resolver_timeout</span>         <span style=color:#e6db74>10s</span>;
    <span style=color:#f92672>...</span> <span style=color:#e6db74>...</span>
<span style=color:#960050;background-color:#1e0010>}</span>
</code></pre></div><p>TLS 会话恢复的目的是为了简化 TLS 握手，有两种方案：Session Cache 和 Session Ticket。他们都是将之前握手的 Session 存起来供后续连接使用，所不同是 Cache 存在服务端，占用服务端资源；Ticket 存在客户端，不占用服务端资源。另外目前主流浏览器都支持 Session Cache，而 Session Ticket 的支持度一般。</p><p><code>ssl_stapling</code> 开始的几行用来配置 OCSP stapling 策略。浏览器可能会在建立 TLS 连接时在线验证证书有效性，从而阻塞 TLS 握手，拖慢整体速度。OCSP stapling 是一种优化措施，服务端通过它可以在证书链中封装证书颁发机构的 OCSP（Online Certificate Status Protocol）响应，从而让浏览器跳过在线查询。服务端获取 OCSP 一方面更快（因为服务端一般有更好的网络环境），另一方面可以更好地缓存。</p><p>Let&rsquo;s Encrypt 目前支持 ECC 证书，申请完以后顺带记得开启 OCSP Stapling。具体的步骤可以参考这篇文章<a href=https://imququ.com/post/letsencrypt-certificate.html>《Let&rsquo;s Encrypt，免费好用的 HTTPS 证书》</a></p><p>配置完需要验证 OCSP Stapling 是否开启，可以用以下的命令：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=color:#66d9ef>$</span> <span style=color:#e6db74>cd</span> <span style=color:#e6db74>/var/www/ghost/ssl/</span>

$ <span style=color:#e6db74>openssl</span> <span style=color:#e6db74>ocsp</span> <span style=color:#e6db74>-CAfile</span> <span style=color:#e6db74>full_chained.pem</span> <span style=color:#e6db74>-issuer</span> <span style=color:#e6db74>intermediate.pem</span> <span style=color:#e6db74>-cert</span> <span style=color:#e6db74>chained.pem</span> <span style=color:#e6db74>-no_nonce</span> <span style=color:#e6db74>-text</span> <span style=color:#e6db74>-url</span> <span style=color:#e6db74>http://ocsp.int-x3.letsencrypt.org</span> <span style=color:#e6db74>-header</span> <span style=color:#e6db74>&#34;HOST&#34;</span> <span style=color:#e6db74>&#34;ocsp.int-x3.letsencrypt.org&#34;</span>

</code></pre></div><h3 id=6-支持-quic>6. 支持 QUIC</h3><p>本博客目前支持了 QUIC，但是性能上没有感觉有多少提升。而且目前只有 Chrome 支持 QUIC，开启几率也极低，基本上还都是走 HTTP/2。</p><p>想支持 QUIC 需要在服务器部署 caddy 这个 Go 的项目。由于我们已经有了 Nginx 占用了 443 端口，所以需要做一次端口映射，可以借助 Docker 来实现。另外 Nginx 配置里面也需要加一个头参数：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=color:#66d9ef>add_header</span> <span style=color:#e6db74>alt-svc</span> <span style=color:#e6db74>&#39;quic=&#34;:443&#34;</span>; <span style=color:#66d9ef>ma=2592000</span>; <span style=color:#66d9ef>v=&#34;39&#34;&#39;</span>;
</code></pre></div><h3 id=7-开启-hsts>7. 开启 HSTS</h3><p>开启 HSTS 首先需要满足以下条件：</p><ul><li>拥有合法的证书（如果使用 SHA-1 证书，过期时间必须早于 2016 年）；</li><li>将所有 HTTP 流量重定向到 HTTPS；</li><li>确保所有子域名都启用了 HTTPS；</li><li>输出 HSTS 响应头：
max-age 不能低于 18 周（10886400 秒）；
必须指定 includeSubdomains 参数；
必须指定 preload 参数；</li></ul><p>然后 Nginx 要加入相关的安全策略</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx>
<span style=color:#66d9ef>add_header</span>  <span style=color:#e6db74>Strict-Transport-Security</span>  <span style=color:#e6db74>&#34;max-age=31536000&#34;</span>;
<span style=color:#66d9ef>add_header</span>  <span style=color:#e6db74>X-Frame-Options</span>  <span style=color:#e6db74>deny</span>;
<span style=color:#66d9ef>add_header</span>  <span style=color:#e6db74>X-Content-Type-Options</span>  <span style=color:#e6db74>nosniff</span>;
<span style=color:#66d9ef>add_header</span>  <span style=color:#e6db74>Content-Security-Policy</span>  <span style=color:#e6db74>&#34;default-src</span> <span style=color:#e6db74>&#39;self&#39;</span>; <span style=color:#66d9ef>script-src</span> <span style=color:#e6db74>&#39;self&#39;</span> <span style=color:#e6db74>&#39;unsafe-inline&#39;</span> <span style=color:#e6db74>&#39;unsafe-eval&#39;</span> <span style=color:#e6db74>https://a.disquscdn.com</span>; <span style=color:#66d9ef>img-src</span> <span style=color:#e6db74>&#39;self&#39;</span> <span style=color:#e6db74>data:</span> <span style=color:#e6db74>https://www.google-analytics.com</span>; <span style=color:#66d9ef>style-src</span> <span style=color:#e6db74>&#39;self&#39;</span> <span style=color:#e6db74>&#39;unsafe-inline&#39;</span>; <span style=color:#66d9ef>frame-src</span> <span style=color:#e6db74>https://disqus.com&#34;</span>;

<span style=color:#66d9ef>ssl_certificate</span>      <span style=color:#e6db74>/home/ssl/server.crt</span>;
<span style=color:#66d9ef>ssl_certificate_key</span>  <span style=color:#e6db74>/home/ssl/server.key</span>;
<span style=color:#66d9ef>ssl_dhparam</span>          <span style=color:#e6db74>/home/ssl/dhparams.pem</span>;

<span style=color:#66d9ef>ssl_ciphers</span>          <span style=color:#e6db74>ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:AES128-GCM-SHA256:AES256-GCM-SHA384:DES-CBC3-SHA</span>;

<span style=color:#66d9ef>ssl_prefer_server_ciphers</span>  <span style=color:#66d9ef>on</span>;

<span style=color:#66d9ef>ssl_protocols</span>        <span style=color:#e6db74>TLSv1</span> <span style=color:#e6db74>TLSv1.1</span> <span style=color:#e6db74>TLSv1.2</span>;
</code></pre></div><p>最后可以在 <a href=https://www.ssllabs.com/ssltest/index.html>ssllabs</a>上进行测试。笔者拿到了 A+ 的成绩：</p><h2 id=最后>最后</h2><p>最后上述优化点都优化完，用 Chrome 版本 67.0.3396.99（正式版本）（64 位）匿名模式下跑分(选择在匿名模式下跑分是为了减少其他插件的影响)，在网络环境很好的条件下，得到的最好成绩如下：</p><p>没有缓存的情况下，FMP 160ms，FI 300ms</p><p>有缓存的情况下，FMP 和 FI 都是 110ms，这得益于 PWA 的缓存效果。</p><p>但是优化还远远没有终点。本文会持续更新。</p><hr><p>Reference：</p><p><a href=https://imiku.me/2017/07/14/916.html>优化 Google Analytics 异步加载来提高你的网站速度</a><br><a href=https://blog.alphatr.com/google-analytics-on-server.html>服务端使用 Google Analytics</a>
<a href=http://blog.angular.in/analyticsdai-ma-yan-chi-yi-bu-jia-zai/>Analytics代码延迟异步加载</a><br><a href=https://developers.google.com/web/updates/2016/04/intersectionobserver>IntersectionObserver’s Coming into View</a><br><a href=https://developer.qiniu.com/dora/manual/1279/basic-processing-images-imageview2>七牛图片基本处理 API</a><br><a href=https://developers.google.com/web/fundamentals/web-app-manifest/#_5>PWA 网络应用清单</a><br><a href=http://cherryblog.site/front-end-performance-checklist-2018.html>2018 前端性能优化清单</a><br><a href=https://imququ.com/post/my-nginx-conf-for-security.html>Nginx 配置之安全篇</a><br><a href=https://imququ.com/post/my-nginx-conf.html>Nginx 配置之完整篇</a><br><a href=https://zhangge.net/5114.html>解决Nginx配置http2不生效，谷歌浏览器仍然采用http1.1协议问题</a><br><a href=https://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API/Using_Service_Workers>使用 Service Workers</a><br><a href=https://blog.wangkaibo.com/node-express-ghost-progressive-web-apps-pwa/>让你的Ghost博客支持Progressive Web Apps (PWA)</a><br><a href=https://liudanking.com/beautiful-life/%E6%9C%AC%E7%AB%99%E5%BC%80%E5%90%AF%E6%94%AF%E6%8C%81-quic-%E7%9A%84%E6%96%B9%E6%B3%95%E4%B8%8E%E9%85%8D%E7%BD%AE/>本站开启支持-quic-的方法与配置</a><br><a href=https://imququ.com/post/letsencrypt-certificate.html>Let&rsquo;s Encrypt，免费好用的 HTTPS 证书</a><br><a href=https://www.cainwang.cn/tls1_3support/>本站开始支持TLS1.3</a><br><a href=https://imququ.com/post/enable-tls-1-3.html#comment-4000795428>本博客开始支持 TLS 1.3</a><br><a href=https://imququ.com/post/why-can-not-turn-on-ocsp-stapling.html>从无法开启 OCSP Stapling 说起</a></p><blockquote><p>GitHub Repo：<a href=https://github.com/halfrost/Halfrost-Field>Halfrost-Field</a></p><p>Follow: <a href=https://github.com/halfrost>halfrost · GitHub</a></p><p>Source: <a href=https://halfrost.com/ghost_fast/>https://halfrost.com/ghost_fast/</a></p></blockquote><img src=https://img.halfrost.com/wechat-qr-code.png></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=https://books.halfrost.com/>Books</a></li><li><a href=https://github.com/halfrost/Halfrost-Field>Github</a></li><li><a href=https://halfrost.me/>About</a></li><li><a href=/index.xml>RSS</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents><ul><li><a href=#起点>起点</a></li><li><a href=#跑分>跑分</a></li><li><a href=#优化>优化</a></li><li><a href=#其他优化>其他优化</a><ul><li><a href=#1-pwa>1. PWA</a></li><li><a href=#2-http2>2. HTTP/2</a></li><li><a href=#3-nginx-开启-gzip>3. Nginx 开启 gZip</a></li><li><a href=#4-支持-tls-13>4. 支持 TLS 1.3</a></li><li><a href=#5-启用-ocsp-stapling>5. 启用 OCSP Stapling</a></li><li><a href=#6-支持-quic>6. 支持 QUIC</a></li><li><a href=#7-开启-hsts>7. 开启 HSTS</a></li></ul></li><li><a href=#最后>最后</a></li></ul></nav></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fnew.halfrost.com%2fghost_fast%2f"><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fnew.halfrost.com%2fghost_fast%2f&text=%e5%8d%9a%e5%ae%a2%e8%b7%91%e5%88%86%e4%bc%98%e5%8c%96"><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fnew.halfrost.com%2fghost_fast%2f&title=%e5%8d%9a%e5%ae%a2%e8%b7%91%e5%88%86%e4%bc%98%e5%8c%96"><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fnew.halfrost.com%2fghost_fast%2f&is_video=false&description=%e5%8d%9a%e5%ae%a2%e8%b7%91%e5%88%86%e4%bc%98%e5%8c%96"><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=%e5%8d%9a%e5%ae%a2%e8%b7%91%e5%88%86%e4%bc%98%e5%8c%96&body=Check out this article: https%3a%2f%2fnew.halfrost.com%2fghost_fast%2f"><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fnew.halfrost.com%2fghost_fast%2f&title=%e5%8d%9a%e5%ae%a2%e8%b7%91%e5%88%86%e4%bc%98%e5%8c%96"><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fnew.halfrost.com%2fghost_fast%2f&title=%e5%8d%9a%e5%ae%a2%e8%b7%91%e5%88%86%e4%bc%98%e5%8c%96"><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fnew.halfrost.com%2fghost_fast%2f&title=%e5%8d%9a%e5%ae%a2%e8%b7%91%e5%88%86%e4%bc%98%e5%8c%96"><i class="fab fa-stumbleupon fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://digg.com/submit?url=https%3a%2f%2fnew.halfrost.com%2fghost_fast%2f&title=%e5%8d%9a%e5%ae%a2%e8%b7%91%e5%88%86%e4%bc%98%e5%8c%96"><i class="fab fa-digg fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fnew.halfrost.com%2fghost_fast%2f&name=%e5%8d%9a%e5%ae%a2%e8%b7%91%e5%88%86%e4%bc%98%e5%8c%96&description=%e6%9c%ac%e7%af%87%e6%96%87%e7%ab%a0%e4%bc%9a%e6%8c%81%e7%bb%ad%e6%9b%b4%e6%96%b0%ef%bc%8c%e5%9b%a0%e4%b8%ba%e4%bc%98%e5%8c%96%e6%97%a0%e6%ad%a2%e5%a2%83%e3%80%82%0a%e6%9c%ac%e6%96%87%e4%bc%9a%e7%bd%97%e5%88%97%e7%9b%ae%e5%89%8d%e5%b7%b2%e7%bb%8f%e4%bc%98%e5%8c%96%e8%bf%87%e7%9a%84%e7%82%b9%e3%80%82%e4%bb%8e%e5%bc%80%e5%a7%8b%e9%a1%b5%e9%9d%a2%e7%95%a5%e5%8d%a1%e9%a1%bf%ef%bc%8c%e5%88%b0%e6%9c%80%e5%90%8e%e8%b7%91%e6%bb%a1%e5%88%86%ef%bc%8c%e7%ac%94%e8%80%85%e5%9c%a8%e8%bf%99%e9%87%8c%e9%83%bd%e4%bc%9a%e4%b8%80%e4%b8%80%e5%b1%95%e7%8e%b0%e5%87%ba%e6%9d%a5%e3%80%82%0a%e8%b5%b7%e7%82%b9%20%e5%8d%9a%e5%ae%a2%e9%a1%b5%e9%9d%a2%e4%bc%98%e5%8c%96%e4%bb%8e%20Chrome%20%e7%9a%84%20Performance%20%e5%bc%80%e5%a7%8b%e3%80%82%0a%e4%bb%8e%e4%b8%8a%e5%9b%be%e4%b8%ad%e5%8f%af%e4%bb%a5%e7%9c%8b%e5%88%b0%e9%a1%b5%e9%9d%a2%e5%89%8d%20550ms%20%e9%83%bd%e6%98%af%e7%a9%ba%e7%99%bd%ef%bc%8c%e6%97%b6%e9%97%b4%e8%80%97%e5%9c%a8%e4%ba%86%e5%8a%a0%e8%bd%bd%20JS%20%e7%9a%84%e8%bf%87%e7%a8%8b%e4%b8%8a%e4%ba%86%e3%80%82%e8%bf%99%e6%ae%b5%e6%98%af%20Disqus%20%e7%9a%84%e8%84%9a%e6%9c%ac%e5%92%8c%20Google%20%e7%bb%9f%e8%ae%a1%e8%84%9a%e6%9c%ac%e3%80%82%0a%e7%ac%94%e8%80%85%e4%bc%98%e5%8c%96%e7%9a%84%e5%8e%9f%e5%88%99%e6%98%af%ef%bc%9a%e5%bf%85%e9%a1%bb%e8%a6%81%e5%8a%a0%e8%bd%bd%e7%9a%84%20pre-load%ef%bc%8c%e4%b8%8d%e5%bf%85%e9%a1%bb%e5%8a%a0%e8%bd%bd%e7%9a%84%e5%b9%b6%e4%b8%94%e6%9c%aa%e5%87%ba%e7%8e%b0%e5%9c%a8%e5%b1%8f%e5%b9%95%e9%87%8c%e9%9d%a2%e7%9a%84%20lazy-load%e3%80%82%0a%e4%bc%98%e5%8c%96%e7%9a%84%e6%80%9d%e8%b7%af%e5%be%88%e7%ae%80%e5%8d%95%ef%bc%8c%e5%9c%a8%20DOM%20%e6%b8%b2%e6%9f%93%e4%b9%8b%e5%89%8d%ef%bc%8c%e5%8e%bb%e6%8e%89%e4%b8%8a%e5%9b%be%e4%b8%ad%e5%a4%a7%e9%95%bf%e6%9d%a1%e7%9a%84%e9%bb%84%e8%89%b2%e7%9a%84%e7%9f%a9%e5%bd%a2%ef%bc%8c%e8%bf%99%e6%ae%b5%e6%97%b6%e9%97%b4%e6%98%af%e5%8a%a0%e8%bd%bd%20JS%20%e7%9a%84%e6%97%b6%e9%97%b4%ef%bc%8c%e9%98%bb%e5%a1%9e%e9%a1%b5%e9%9d%a2%e6%b8%b2%e6%9f%93%e4%ba%86%e3%80%82%e7%ac%94%e8%80%85%e5%9c%a8%e9%a1%b5%e9%9d%a2%e6%b8%b2%e6%9f%93%e7%9a%84%e6%97%b6%e5%80%99%e4%b8%8d%e4%bc%9a%e5%8a%a0%e8%bd%bd%20Disqus%20%e8%84%9a%e6%9c%ac%ef%bc%8c%e5%8f%aa%e5%9c%a8%e5%8d%9a%e6%96%87%e9%a1%b5%e9%9d%a2%e7%94%a8%e7%9a%84%e6%97%b6%e5%80%99%ef%bc%8c%e7%82%b9%e5%87%bb%e6%8c%89%e9%92%ae%e7%9a%84%e6%97%b6%e5%80%99%e6%89%8d%e4%bc%9a%20lazy-load%20%e5%8a%a0%e8%bd%bd%e8%84%9a%e6%9c%ac%e3%80%82%0a%e8%87%b3%e4%ba%8e%20Google%20%e7%bb%9f%e8%ae%a1%e8%84%9a%e6%9c%ac%ef%bc%8c%e9%9c%80%e8%a6%81%e7%94%a8%e6%9c%80%e6%96%b0%e7%9a%84%20gtag%20%e7%9a%84%e5%bc%82%e6%ad%a5%e7%89%88%e6%9c%ac%ef%bc%8c%e5%b9%b6%e4%b8%94%e5%8a%a0%e4%b8%8a%20async%20%e6%a0%87%e5%bf%97%e5%b0%b1%e5%8f%af%e4%bb%a5%e8%a7%a3%e5%86%b3%e3%80%82%e5%bd%93%e7%84%b6%e5%a6%82%e6%9e%9c%e6%83%b3%e5%bd%bb%e5%ba%95%e5%bc%82%e6%ad%a5%e8%bf%99%e6%ae%b5%e7%bb%9f%e8%ae%a1%e7%9a%84%e4%bb%a3%e7%a0%81%ef%bc%8c%e9%9c%80%e8%a6%81%e6%9c%8d%e5%8a%a1%e7%ab%af%e5%81%9a%e4%b8%80%e4%ba%9b%e6%94%b9%e9%80%a0%e3%80%82%0a%e8%bf%99%e9%87%8c%e5%8f%af%e4%bb%a5%e5%8f%82%e8%80%83%e8%bf%99%e4%b8%a4%e7%af%87%e6%96%87%e7%ab%a0%e3%80%8a%e4%bc%98%e5%8c%96%20Google%20Analytics%20%e5%bc%82%e6%ad%a5%e5%8a%a0%e8%bd%bd%e6%9d%a5%e6%8f%90%e9%ab%98%e4%bd%a0%e7%9a%84%e7%bd%91%e7%ab%99%e9%80%9f%e5%ba%a6%e3%80%8b%e3%80%81%e3%80%8a%e6%9c%8d%e5%8a%a1%e7%ab%af%e4%bd%bf%e7%94%a8%20Google%20Analytics%e3%80%8b%e3%80%82%0a%e5%a6%82%e6%9e%9c%e8%bf%98%e6%9c%89%e7%99%be%e5%ba%a6%e7%bb%9f%e8%ae%a1%e7%9a%84%e8%84%9a%e6%9c%ac%e7%9a%84%e8%af%9d%ef%bc%8c%e5%b0%86%20baidu%20%e7%bb%9f%e8%ae%a1%e7%94%9f%e6%88%90%e7%9a%84%e4%bb%a3%e7%a0%81%e7%a7%bb%e5%85%a5%e7%bd%91%e7%ab%99%ef%bc%8c%e5%b0%86%20type%20%e8%ae%be%e7%bd%ae%e4%b8%ba%20test%20%e7%ad%89%e9%9d%9e%20mime%2ftype%20%e7%b1%bb%e5%9e%8b%ef%bc%8c%e8%bf%99%e6%a0%b7%e6%b5%8f%e8%a7%88%e5%99%a8%e4%be%bf%e4%b8%8d%e4%bc%9a%e8%a7%a3%e6%9e%90%e8%bf%99%e6%ae%b5%20script%ef%bc%8cbaidu%20%e7%bb%9f%e8%ae%a1%e5%8d%b4%e4%b9%9f%e8%83%bd%e6%a0%a1%e9%aa%8c%e9%80%9a%e8%bf%87%ef%bc%9a%0a%26lt%3bscript%20type%3d%26%2334%3btext%2ftest%26%2334%3b%26gt%3b%20var%20_hmt%20%3d%20_hmt%20%7c%7c%20%5b%5d%3b%20%28function%28%29%20%7b%20var%20hm%20%3d%20document.createElement%28%26%2334%3bscript%26%2334%3b%29%3b%20hm.src%20%3d%20%26%2334%3bhttps%3a%2f%2fhm.baidu.com%2fhm.js%3fXXXX%26%2334%3b%3b%20var%20s%20%3d%20document."><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fnew.halfrost.com%2fghost_fast%2f&t=%e5%8d%9a%e5%ae%a2%e8%b7%91%e5%88%86%e4%bc%98%e5%8c%96"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu class=icon href=# onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden=true></i>Menu</a>
<a id=toc class=icon href=# onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden=true></i>TOC</a>
<a id=share class=icon href=# onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden=true></i>share</a>
<a id=top style=display:none class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i>Top</a></div></div></div><footer id=footer><div class=footer-left><p class=copyright style=float:left;margin-bottom:0><a href=https://github.com/halfrost/Halfrost-Field class=github-repo style=height:18px><span class=gadget-github></span>Star</a>
Copyright &copy;halfrost 2016 - 2021
<a href=http://www.miit.gov.cn/>鄂ICP备16014744号</a></p><br><p class="copyright statistics" style=margin-bottom:20px><span id=busuanzi_container_site_pv>Cumulative Page Views <span id=busuanzi_value_site_pv></span>| Unique Visitors <span id=busuanzi_value_site_uv></span></span></p></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/main.min.f870a4d110314b9e50e65f8ac982dc1c9c376c8f1a5083d39c62cfc49073f011.js></script><script async src=/prism.js></script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']]},svg:{fontCache:'global'}};</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></html>